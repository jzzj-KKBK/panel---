!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},u=n.iterator||"@@iterator",c=n.toStringTag||"@@toStringTag";function l(n,a,u,c){var l=a&&a.prototype instanceof o?a:o,s=Object.create(l.prototype);return r(s,"_invoke",function(n,a,r){var u,c,l,o=0,s=r||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return u=t,c=0,l=e,p.n=n,i}};function d(n,a){for(c=n,l=a,t=0;!f&&o&&!r&&t<s.length;t++){var r,u=s[t],d=p.p,m=u[2];n>3?(r=m===a)&&(l=u[(c=u[4])?5:(c=3,3)],u[4]=u[5]=e):u[0]<=d&&((r=n<2&&d<u[1])?(c=0,p.v=a,p.n=u[1]):d<m&&(r=n<3||u[0]>a||a>m)&&(u[4]=n,u[5]=a,p.n=m,c=0))}if(r||n>1)return i;throw f=!0,a}return function(r,s,m){if(o>1)throw TypeError("Generator is already running");for(f&&1===s&&d(s,m),c=s,l=m;(t=c<2?e:l)||!f;){u||(c?c<3?(c>1&&(p.n=-1),d(c,l)):p.n=l:p.v=l);try{if(o=2,u){if(c||(r="next"),t=u[r]){if(!(t=t.call(u,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=u.return)&&t.call(u),c<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),c=1);u=e}else if((t=(f=p.n<0)?l:n.call(a,p))!==i)break}catch(t){u=e,c=1,l=t}finally{o=1}}return{value:t,done:f}}}(n,u,c),!0),s}var i={};function o(){}function s(){}function f(){}t=Object.getPrototypeOf;var p=[][u]?t(t([][u]())):(r(t={},u,function(){return this}),t),d=f.prototype=o.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,c,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=f,r(d,"constructor",f),r(f,"constructor",s),s.displayName="GeneratorFunction",r(f,c,"GeneratorFunction"),r(d),r(d,c,"Generator"),r(d,u,function(){return this}),r(d,"toString",function(){return"[object Generator]"}),(a=function(){return{w:l,m:m}})()}function r(e,t,n,a){var u=Object.defineProperty;try{u({},"",{})}catch(e){u=0}r=function(e,t,n,a){function c(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?u?u(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(c("next",0),c("throw",1),c("return",2))},r(e,t,n,a)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){l(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(t,n,a){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var r=a.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}function i(e,t,n,a,r,u,c){try{var l=e[u](c),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var u=e.apply(t,n);function c(e){i(u,a,r,c,l,"next",e)}function l(e){i(u,a,r,c,l,"throw",e)}c(void 0)})}}System.register(["./utils-lib-legacy.js?v=1756369731","./base-lib-legacy.js?v=1756369731","./useStore-legacy2.js?v=1756369731","./index-legacy117.js?v=1756369731","./index-legacy103.js?v=1756369731","./column-legacy.js?v=1756369731","./database-legacy.js?v=1756369731","./index-legacy116.js?v=1756369731","./index-legacy101.js?v=1756369731","./index-legacy112.js?v=1756369731","./validator-legacy.js?v=1756369731","./useMethod-legacy4.js?v=1756369731","./__commonjsHelpers__-legacy.js?v=1756369731","./index-legacy104.js?v=1756369731"],function(e,n){"use strict";var r,u,l,i,s,f,p,d,m,v,b,g,y,h,_,x,k,w,j,D,B,O,P,C,q,S,V,T,F,M,z,A,U,E,I,G,H,R,N,W,Y,J,L,$,K,Q,X,Z,ee,te,ne,ae,re,ue,ce,le,ie,oe,se,fe,pe,de,me,ve,be,ge,ye,he,_e,xe,ke,we,je,De,Be,Oe,Pe,Ce,qe,Se,Ve,Te,Fe,Me,ze,Ae,Ue,Ee;return{setters:[function(e){r=e.u,u=e.a6,l=e.R,i=e.K,s=e.l,f=e.L,p=e.o,d=e.M,m=e.a8,v=e.v,b=e.bU,g=e.at,y=e.cp,h=e.S,_=e.k,x=e.a0,k=e.h,w=e.j,j=e.N,D=e.ai,B=e.e,O=e.al},function(e){P=e.c,C=e.g,q=e.k,S=e.r,V=e.p,T=e.q,F=e.v,M=e.x,z=e.M,A=e.C,U=e.y,E=e.z,I=e.H,G=e.J,H=e.e,R=e.A,N=e.B,W=e.aB,Y=e.a4,J=e.b3,L=e.aW,$=e.D,K=e.b6,Q=e.ai,X=e.aj,Z=e.bq,ee=e.ay,te=e.G,ne=e.F,ae=e.P,re=e.I,ue=e.ap,ce=e.ao,le=e.an,ie=e.a9,oe=e.a7,se=e.aA},function(e){fe=e.g},function(e){pe=e._},function(e){de=e._},function(e){me=e.u,ve=e.c,be=e.a,ge=e.h,ye=e.g},function(e){he=e.getBinlogBackupFiles,_e=e.delBinlogBackupTask,xe=e.getBinlogBackupLogs,ke=e.deleteBinlogBackupFile,we=e.clearBinlogBackup,je=e.restoreBinlogData,De=e.getBinlogBackupTask,Be=e.getIncrementBackupInfo,Oe=e.getRestoreProgress,Pe=e.backDatabase,Ce=e.backModuleDatabase,qe=e.delBackup,Se=e.checkDatabasePass,Ve=e.restoreModuleBack,Te=e.restoreBack},function(e){Fe=e._},function(e){Me=e._},function(e){ze=e._},function(e){Ae=e.f},function(e){Ue=e.t,Ee=e.w},null,null],execute:function(){var Ie={key:0},Ge={class:"data-show"},He={class:"bg-white rounded-lg border border-gray-200 p-6 mb-4"},Re={class:"grid grid-cols-1 md:grid-cols-3 gap-6 pb-6 border-b border-gray-100"},Ne={class:"text-center md:text-left"},We={class:"text-[1.6rem]"},Ye={class:"grid grid-cols-2 col-span-2 gap-6","element-loading-text":"获取中..."},Je={class:"text-center md:text-left"},Le={class:"text-[1.6rem]"},$e={class:"text-center md:text-left"},Ke={class:"text-[1.6rem]"},Qe={class:"pt-6 pb-3"},Xe={class:"flex items-center justify-between"},Ze={class:"flex items-center space-x-8"},et={class:"pb-3"},tt={class:"flex items-center space-x-4"},nt={class:"text-[1.2rem] text-[#666]"},at={class:"text-[1.2rem] text-[#666]"},rt={class:"flex items-center justify-between"},ut={class:"flex items-center space-x-8"},ct={class:"text-[1.2rem] font-medium"},lt={class:"text-[1.2rem] font-medium"},it={class:"flex items-center gap-4"},ot={class:"flex items-center"},st=P({__name:"index",props:{compData:{default:function(){return[]}},isRowBackup:{type:Boolean,default:!1}},setup:function(e,b){var g=b.expose,y=r().payment;C(function(){return y.value.authType}),fe();var h,_=e,x=q({name:"",tableCount:0,size:""}),k=S(!1),w=q({database_name:"test_db",full_backup_schedule:{type:"daily",time:"02:30:00",weekday:0,interval_days:0,interval_hours:0},incremental_backup_interval:30,enabled:!0,create_time:"",last_full_backup:"",last_incremental_backup:"",next_full_backup:"",next_incremental_backup:"",space_free:!0}),j=q({time:"",type:"all"}),D=q({disabledDate:function(e){var t=new Date;t.setHours(23,59,59,999);var n=t.getTime();return e.getTime()>n},defaultTime:[new Date,new Date]}),B={title:"企业增量备份",ps:"企业增量备份只定时备份发生变化新增、修改、删除文件和数据，不会每次都备份所有数据",source:54,desc:[],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/database/database_enterprise_backup.png"}]},O={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},ee=C(function(){if(!w.database_name)return"--";switch(w.full_backup_schedule.type){case"daily":return"每天 ".concat(w.full_backup_schedule.time," 备份");case"weekly":return"每周 ".concat(O[w.full_backup_schedule.weekday]," ").concat(w.full_backup_schedule.time," 备份");case"interval":return"每隔 ".concat(w.full_backup_schedule.interval_days," 天后 ").concat(w.full_backup_schedule.time," 备份");case"hours":return"每隔 ".concat(w.full_backup_schedule.interval_hours," 小时 ").concat(w.full_backup_schedule.time||""," 备份")}}),te=C(function(){return w.database_name?w.incremental_backup_interval>60?"每 ".concat(Math.floor(w.incremental_backup_interval/60),"小时").concat(w.incremental_backup_interval%60,"分钟备份"):"每 ".concat(w.incremental_backup_interval," 分钟备份"):"--"}),ne=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:s({title:"配置备份计划",area:85,component:function(){return f(function(){return n.import("./add-increment-legacy.js?v=1756369731")},void 0,n.meta.url)},showFooter:!0,compData:c(c({},_.compData),{},{backupPlan:w,refreshEvent:function(){ye()}})});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if(!w.enabled){e.n=3;break}return e.n=1,p({title:"停止备份计划",content:"确定停止数据库【".concat(w.database_name,"】增量备份计划吗？停止后将无法进行增量备份")});case 1:return e.n=2,i({loading:"停止备份计划中...",message:!0,request:_e({id:_.compData.id})});case 2:ye(),e.n=4;break;case 3:ne();case 4:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),re=function(){s({title:"备份日志",area:56,btns:!1,component:P({setup:function(){var e=S("");return i({loading:"获取日志中...",request:xe({id:_.compData.id}),success:function(t){if(!t.data.status)return d.error(t.data.msg);e.value=t.data.data.join("\n")}}),function(){return W("div",{class:"overflow-y-auto"},W(Fe,{class:"!h-[40rem]",content:e.value,isHtml:!0}))}}})})},ue=function(){var e=o(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,p({title:"删除备份",content:"确定删除该备份吗？删除后将无法恢复!"});case 1:return e.n=2,i({loading:"删除备份中...",message:!0,request:ke({backup_id:t})});case 2:ge();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,p({title:"清空备份",content:"当前将清空【".concat(_.compData.name,"】下通过备份计划备份的全量与增量备份（不会清除手动备份），请确保当前数据已正常，再清空备份"),type:"calc"});case 1:return e.n=2,i({loading:"清空备份中...",message:!0,request:we({id:_.compData.id})});case 2:ge();case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),le=function(){var e=o(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:window.open("/download?filename="+t,"_blank");case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=o(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,p({title:"还原备份【".concat(t.backup_time,"】"),content:"此操作将覆盖当前数据库的所有数据，请确保已经备份现有数据！",type:"calc"});case 1:return e.n=2,i({loading:"还原备份中...",request:je({id:_.compData.id,restore_time:t.backup_time})});case 2:if((n=e.v).data.status){e.n=3;break}return e.a(2,d.error(n.data.msg));case 3:s({title:"还原进度",area:56,btns:!1,component:P({setup:function(e,t){t.emit;var r=q({status:"preparing",progress:0,message:"准备还原数据...",restore_time:"",start_time:"",update_time:"",error:null,backup_files:[]}),u=S(null),c=S(!0),l={preparing:{text:"准备还原数据",color:"#20a53a",progress:0},analyzing:{text:"分析备份文件",color:"#20a53a",progress:10},restoring:{text:"正在还原数据",color:"#20a53a",progress:20},finalizing:{text:"完成还原操作",color:"#20a53a",progress:90},completed:{text:"还原完成",color:"#20a53a",progress:100},failed:{text:"还原失败",color:"#f56c6c",progress:0},not_found:{text:"任务不存在",color:"#e6a23c",progress:0}},s=function(){var e=o(a().m(function e(){var t,o,f,p,m,v,b,g;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(c.value){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,i({request:Oe({task_id:n.data.data.task_id})});case 2:null!=(o=e.v)&&null!==(t=o.data)&&void 0!==t&&t.status?(p=o.data.data,r.status=p.status||"preparing",r.message=p.message||(null===(f=l[r.status])||void 0===f?void 0:f.text)||"处理中...",r.restore_time=p.restore_time||"",r.start_time=p.start_time||"",r.update_time=p.update_time||"",r.backup_files=p.backup_files||[],r.error=p.error||null,void 0!==p.progress?r.progress=Math.min(Math.max(p.progress,0),100):r.progress=(null===(m=l[r.status])||void 0===m?void 0:m.progress)||0,!(v=["completed","failed","not_found"].includes(r.status))&&c.value?u.value=setTimeout(s,1500):v&&("completed"===r.status?(d.success("数据库还原成功"),ge()):"failed"===r.status&&d.error(r.error||"还原失败，请查看错误信息"),c.value=!1)):(r.status="failed",r.message=(null==o||null===(b=o.data)||void 0===b?void 0:b.msg)||"获取进度失败",r.error=(null==o||null===(g=o.data)||void 0===g?void 0:g.error_msg)||"未知错误",c.value=!1),e.n=4;break;case 3:e.p=3,e.v,r.status="failed",r.message="获取进度失败，请检查网络连接",r.error="网络连接异常",c.value=!1;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}();return s(),Y(function(){u.value&&(clearTimeout(u.value),u.value=null),c.value=!1}),function(){var e,t;return H("div",{class:"p-[2rem]"},[H("div",{class:"flex items-center mb-[2rem]"},[H("i",{class:["!text-[3rem] mr-[1rem]","completed"===r.status?"svgtofont-el-success-filled text-[#20a53a]":"failed"===r.status?"svgtofont-el-circle-close-filled text-[#ef0808]":"svgtofont-el-loading animate-spin text-[#20a53a]"]},null),H("div",{class:"flex-1"},[H("div",{class:"text-[1.6rem] font-medium mb-[4px]"},["completed"===r.status?"还原成功":"failed"===r.status?"还原失败":"正在还原数据库"]),H("div",{class:"text-[1.2rem] text-[#666]"},[N("数据库："),_.compData.name])])]),!["completed","failed"].includes(r.status)&&H("div",{class:"mb-[2rem]"},[H("div",{class:"flex justify-between items-center mb-[8px]"},[H("span",{class:"text-[1.4rem]"},[r.message]),H("span",{class:"text-[1.2rem] text-[#666]"},[r.progress,N("%")])]),H(J,{percentage:r.progress,"stroke-width":8,"show-text":!1,color:(null===(e=l[r.status])||void 0===e?void 0:e.color)||"#20a53a"},null)]),H("div",{class:"bg-[#f5f7fa] rounded-lg p-[1.5rem] mb-[1.5rem]"},[H("div",{class:"text-[1.3rem] font-medium mb-[1rem] text-[#333]"},[N("还原信息")]),H("div",{class:"space-y-[8px] text-[1.2rem] text-[#666]"},[r.restore_time&&H("div",{class:"flex"},[H("span",{class:"w-[8rem] flex-shrink-0"},[N("还原时间点：")]),H("span",null,[r.restore_time])]),r.start_time&&H("div",{class:"flex"},[H("span",{class:"w-[8rem] flex-shrink-0"},[N("开始时间：")]),H("span",null,[r.start_time])]),r.update_time&&H("div",{class:"flex"},[H("span",{class:"w-[8rem] flex-shrink-0"},[N("更新时间：")]),H("span",null,[r.update_time])]),H("div",{class:"flex"},[H("span",{class:"w-[8rem] flex-shrink-0"},[N("当前状态：")]),H("span",{class:"flex items-center"},[H("span",{class:["w-[8px] h-[8px] rounded-full mr-[6px]","completed"===r.status?"bg-[#20a53a]":"failed"===r.status?"bg-[#ef0808]":"hidden"]},null),(null===(t=l[r.status])||void 0===t?void 0:t.text)||r.message])])])]),r.backup_files&&r.backup_files.length>0&&H("div",{class:"bg-[#f5f7fa] rounded-lg p-[1.5rem] mb-[1.5rem]"},[H("div",{class:"text-[1.3rem] font-medium mb-[1rem] text-[#333]"},[N("相关备份文件 ("),r.backup_files.length,N("个)")]),H("div",{class:"space-y-[4px] max-h-[8rem] overflow-y-auto"},[r.backup_files.map(function(e,t){return H("div",{key:t,class:"text-[1.1rem] text-[#666] bg-white px-[8px] py-[4px] rounded"},[e])})])]),"failed"===r.status&&r.error&&H("div",{class:"bg-[#fef0f0] border border-[#fbc4c4] rounded-lg p-[1.5rem] mb-[1.5rem]"},[H("div",{class:"text-[1.3rem] font-medium mb-[1rem] text-[#f56c6c] flex items-center"},[H("i",{class:"svgtofont-el-warning-filled mr-[6px]"},null),N("错误详情")]),H("div",{class:"text-[1.2rem] text-[#666] whitespace-pre-wrap"},[r.error])])])}}})});case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),oe=m([{label:"删除备份",value:"delete",event:function(){}}]),se=u({request:(h=o(a().m(function e(t){var n,r,u;return a().w(function(e){for(;;)switch(e.n){case 0:return n=c({id:_.compData.id,page:t.p,limit:t.limit,backup_type:j.type},j.time?{date:l(j.time,"yyyy-MM-dd")}:{}),e.n=1,i({loading:"获取备份记录中...",request:he(n)});case 1:return r=e.v,u=r.data,e.a(2,{data:u.data.list,total:u.data.total})}},e)})),function(e){return h.apply(this,arguments)}),columns:[{label:"备份时间",prop:"backup_time",showOverflowTooltip:!0,minWidth:100},{label:"备份类型",prop:"backup_type",minWidth:100,render:function(e){return"incremental"===e.backup_type?"增量备份":"全量备份"}},{label:"备份大小",prop:"formatted_size",minWidth:100},me([{onClick:function(e){return ie(e)},title:"还原"},{onClick:function(e){return le(e.file_path)},title:"下载"},{onClick:function(e){return ue(e.backup_id)},title:"删除"}])],extension:[oe]}),ve=se.BtTable,be=se.BtPage,ge=se.refresh,ye=(se.BtBatch,function(){var e=o(a().m(function e(){var t,n;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,i({loading:"获取备份计划信息中...",request:De({id:_.compData.id})});case 1:t=e.v,(n=t.data).status?(w.database_name=n.data.database_name,w.full_backup_schedule=n.data.full_backup_schedule,w.incremental_backup_interval=n.data.incremental_backup_interval,w.enabled=n.data.enabled,w.create_time=n.data.create_time,w.last_full_backup=n.data.last_full_backup,w.last_incremental_backup=n.data.last_incremental_backup,w.next_full_backup=n.data.next_full_backup,w.next_incremental_backup=n.data.next_incremental_backup,w.space_free=n.data.space_free):w.database_name="";case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}()),Pe=function(){var e=o(a().m(function e(){var t,n;return a().w(function(e){for(;;)switch(e.n){case 0:return x.name=_.compData.name,ye(),e.n=1,i({loading:k,request:Be({id:_.compData.id})});case 1:t=e.v,(n=t.data).status&&(x.tableCount=n.data.table_count||0,x.size=v(n.data.db_size)||"--");case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();return V(Pe),g({init:Pe}),function(e,n){var a,r=L,u=$,c=K,l=Q,i=X,o=de,s=pe,f=Z;return T(),F("div",null,["ltd"===M(y).authType?(T(),F("div",Ie,[M(w).space_free?A("",!0):(T(),z(r,{key:0,title:"当前磁盘空间不足1GB，已自动停止增量备份，如需继续请释放磁盘空间",type:"warning","show-icon":"",class:"!mb-4"})),U("div",Ge,[U("div",He,[U("div",Re,[U("div",Ne,[n[2]||(n[2]=U("div",{class:"text-[1.2rem] text-[#666] mb-1"},"数据库名称",-1)),U("div",We,E(M(x).name||"--"),1)]),I((T(),F("div",Ye,[U("div",Je,[n[3]||(n[3]=U("div",{class:"text-[1.2rem] text-[#666] mb-1"},"表数量",-1)),U("div",Le,E(M(x).tableCount||0),1)]),U("div",$e,[n[4]||(n[4]=U("div",{class:"text-[1.2rem] text-[#666] mb-1"},"数据库大小",-1)),U("div",Ke,E(M(x).size||"--"),1)])])),[[f,M(k)]])]),U("div",Qe,[U("div",Xe,[U("div",Ze,[n[5]||(n[5]=U("h3",{class:"text-[1.4rem] font-medium text-[#666]"},"备份计划",-1)),U("span",{class:G(["px-3 py-1 rounded-full text-[1.2rem] font-medium cursor-pointer",M(w).enabled?"bg-[#e9f8ec] text-[#20a53a]":"bg-red-100 text-red-700"]),onClick:ae},E((a=M(w).enabled,a?"运行中":"已停止")),3)])])]),U("div",et,[U("div",tt,[U("span",nt,"全量: "+E(M(ee)),1),n[7]||(n[7]=U("span",{class:"text-gray-300"},"|",-1)),U("span",at,"增量: "+E(M(te)),1),H(u,{type:"primary",class:"ml-[1rem]",size:"small",text:"",onClick:re},{default:R(function(){return t(n[6]||(n[6]=[N(" 查看日志 ",-1)]))}),_:1})])]),U("div",null,[U("div",rt,[U("div",ut,[n[8]||(n[8]=U("div",{class:"text-[1.2rem] text-[#666]"},"最近执行时间",-1)),U("div",ct,E(M(w).last_incremental_backup||"--"),1),n[9]||(n[9]=U("div",{class:"text-[1.2rem] text-[#666]"},"下次执行时间",-1)),U("div",lt,E(M(w).next_incremental_backup||"--"),1)]),n[10]||(n[10]=U("div",null,null,-1))])])])]),H(o,null,{"header-left":R(function(){return[U("div",it,[H(u,{type:"primary",onClick:ne},{default:R(function(){return t(n[11]||(n[11]=[N("编辑计划 ",-1)]))}),_:1}),H(u,{type:"default",onClick:ce},{default:R(function(){return t(n[12]||(n[12]=[N("清空备份 ",-1)]))}),_:1})])]}),"header-right":R(function(){return[U("div",ot,[H(c,{type:"date",modelValue:M(j).time,"onUpdate:modelValue":n[0]||(n[0]=function(e){return M(j).time=e}),"show-after":100,class:"!w-[24rem] !h-[30px]","disabled-date":M(D).disabledDate,placeholder:"请选择日期",format:"YYYY-MM-DD","value-format":"x",onChange:M(ge)},null,8,["modelValue","disabled-date","onChange"]),H(i,{modelValue:M(j).type,"onUpdate:modelValue":n[1]||(n[1]=function(e){return M(j).type=e}),class:"rounded-none !w-[12rem] ml-[1rem]",onChange:M(ge)},{default:R(function(){return[H(l,{label:"全部类型",value:"all"}),H(l,{label:"增量备份",value:"incremental"}),H(l,{label:"全量备份",value:"full"})]}),_:1},8,["modelValue","onChange"])])]}),content:R(function(){return[H(M(ve),{"max-height":221})]}),"footer-left":R(function(){return t(n[13]||(n[13]=[]))}),"footer-right":R(function(){return[H(M(be))]}),popup:R(function(){return t(n[14]||(n[14]=[]))}),_:1}),n[15]||(n[15]=U("ul",{class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-[20px]"},[U("li",null,"还原数据等操作将会被增量备份记录，导致备份大小增大"),U("li",null,"建议确认数据正常后，手动备份并【清空备份】，重置为干净状态")],-1))])):(T(),z(s,{key:1,data:B,class:"p-20px"}))])}}}),ft={class:"p-20px"},pt={class:"p-20px"},dt={class:"mt-4px leading-8 text-[1.2rem] list-disc ml-[20px]"},mt=P({__name:"route-back",props:{compData:{default:function(){return{id:0,name:""}}}},setup:function(e){var u,l=e,m=fe(),v=m.refs.tabActive,B=m.refreshTableList,O=r().panel,P=ee("popupClose"),C=S(),A=S(),E=S(),G=S([]),W=S(!1),Y=S(!1),J=l.compData,L=J.id,K=(J.name,q({search:L,type:1,table:"backup",total:0,p:1,limit:10})),Q=S(!1),X=q({backupPath:""}),Z=S(),se=S(!1),pe=q({pwd:""}),he=[{label:"删除",value:"delete",event:(u=o(a().m(function e(t,n,r,u){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t({title:"批量删除备份文件",content:"批量删除已选备份文件，是否继续操作？",column:[{prop:"filename",label:"文件名"},ve()],onConfirm:function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n(Be);case 1:return Ne(),B(),e.a(2,!1)}},e)}));return function(){return e.apply(this,arguments)}}()});case 1:return e.a(2)}},e)})),function(e,t,n,a){return u.apply(this,arguments)})}],_e=function(){Ae({type:"dir",path:X.backupPath,change:function(e){X.backupPath=e}})},xe=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,p({title:"提示",content:"修改默认备份目录，会导致网站和站点默认备份会备份到该目录下，是否继续操作？"});case 1:O.value.backupPath=X.backupPath;case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),ke=function(e){var t=e.filename;return(j(t)||D(t))&&-1!==t.indexOf("|")},we=function(){s({title:"表备份",area:60,component:function(){return f(function(){return n.import("./table-back-legacy.js?v=1756369731")},void 0,n.meta.url)},compData:c(c({},l.compData),{},{refreshFn:Ne}),showFooter:!0})},je=function(){var e=o(a().m(function e(){var t,r;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,f(function(){return n.import("./utils-lib-legacy.js?v=1756369731").then(function(e){return e.jG})},void 0,n.meta.url);case 1:t=e.v,r=t.router,P(),r.push({name:"crontab"});case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),De=function(){var e=o(a().m(function e(t){var n,r;return a().w(function(e){for(;;)switch(e.n){case 0:return n=null,"mysql"===v.value&&(n=Ue({type:"backup",config:{path:"/tmp/import_sql.log",id:l.compData.id,name:l.compData.name}})),r={id:l.compData.id},t&&(r.password=pe.pwd),e.n=1,i({loading:"mysql"===v.value?void 0:"正在备份数据库，请稍后...",request:"mysql"===v.value?Pe(r):Ce({data:JSON.stringify(r)},v.value),message:!0,success:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n;case 1:null==(r=e.v)||r.unmount(),t.status&&(Ne(),B());case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()});case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),Be=function(){var e=o(a().m(function e(t){var n,r,u,c=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=c.length>1&&void 0!==c[1]&&c[1],e.p=1,!n){e.n=2;break}return e.n=2,p({title:"删除备份",content:'<p>删除备份后，<span class="text-danger">备份数据将无法恢复</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0});case 2:return e.n=3,qe({id:t.id});case 3:return r=e.v,n&&(d.request(r),Ne()),e.a(2,r);case 4:e.p=4,u=e.v,g(u,"delBackEvent");case 5:return e.p=5,Y.value&&Y.value.close(),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(t){return e.apply(this,arguments)}}(),Oe=function(){var e=o(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:if("mysql"!==v.value||t.localexist){e.n=3;break}if(!ke(t)){e.n=1;break}return d.error("不支持从此处下载云存储备份，如需下载请在备份时勾选同时保留本地备份"),e.a(2);case 1:d.error("备份文件不存在");case 2:e.n=4;break;case 3:window.open("/download?filename="+t.local,"_blank");case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),Fe=function(){var e=o(a().m(function e(t){var n,r,u,c=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:return n=c.length>1&&void 0!==c[1]&&c[1],A.value=t,e.n=1,p({title:"恢复数据库",content:"恢复备份文件将会覆盖当前数据库[".concat(l.compData.name,"]，是否继续？"),type:"calc",icon:"warning-filled"});case 1:if(r={file:t.localexist?t.local:t.filename,name:l.compData.name},n&&(r.disk_check=!0),"mysql"!==v.value){e.n=4;break}return e.n=2,Se({file:t.localexist?t.local:t.filename});case 2:if(u=e.v,!u.data){e.n=3;break}return C.value=!0,se.value=!0,e.a(2);case 3:Ie(r,t),e.n=5;break;case 4:r.file=t.local,i({loading:"正在恢复数据库,请稍后...",request:Ve({data:JSON.stringify(r)},v.value),message:!0});case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=o(a().m(function e(t,n){var r,u;return a().w(function(e){for(;;)switch(e.n){case 0:return r=Ue({type:"import",config:{path:"/tmp/import_sql.log",id:n.id,name:l.compData.name}}),e.n=1,i({request:Te(t),message:!0,success:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(-1===(null===(r=t.msg)||void 0===r?void 0:r.indexOf("警告"))){e.n=2;break}return e.n=1,Ge(t.msg,"恢复");case 1:return Fe(n,!0),e.a(2);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()});case 1:return e.n=2,r;case 2:null==(u=e.v)||u.unmount();case 3:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Ge=function(e,t){return p({title:"提示",isHtml:!0,width:"50rem",confirmText:"继续".concat(t),content:'<div class="flex"><i class="svgtofont-el-warning-filled text-[4rem] text-warning mr-4"></i><div><div>'.concat(e,"</div><div>\n\t\t\t<p>如继续").concat(t,"可能会有以下影响：</p>\n\t\t\t<p>1.").concat(t,"数据不完整</p>\n\t\t\t<p>2.系统运行缓慢</p>\n\t\t\t<p>3.面板无法正常工作</p>\n\t\t\t<p>4.mysql无法正常运行</p></div></div></div>")})},He=function(e){switch(e){case"databaseBack":De(!1);break;case"backPath":break;case"databasePwdBack":se.value=!0;break;case"tableBack":we()}},Re=function(){var e=o(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Z.value.validate();case 1:C.value?(t={file:A.value.localexist?A.value.local:A.value.filename,name:l.compData.name,password:pe.pwd},Ie(t,A.value),se.value=!1,C.value=!1):(De(!0),se.value=!1);case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ne=function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:i({request:y(c({},K)),loading:W,data:{data:[Array,G],page:h(K)}});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),We=[be(),{label:"文件名称",prop:"name",width:220,showOverflowTooltip:!0},{label:"存储对象",render:function(e){var t=!1,n="";return ke(e)&&(t=!0,n=e.filename.match(/\|(.+)\|/,"$1")),H("span",null,[t?Ee[n[1]]:"本地"])}},ge({prop:"size",width:100}),{width:160,prop:"addtime",label:"备份时间"},ye({table:"backup"}),me([{isHide:function(e){return ke(e)},onClick:function(e){return Fe(e)},title:"恢复"},{onClick:function(e){return Oe(e)},title:"下载"},{onClick:function(e){return Be(e,!0)},title:"删除"}])];return V(Ne),function(e,n){var a=ue,r=ce,u=le,c=$,l=_,i=x,o=ze,s=Me,f=ie,p=oe,d=k,m=w,g=de,y=te("bt-loading");return T(),F("div",null,[H(g,null,{"header-left":R(function(){return["mysql"==M(v)?(T(),z(u,{key:0,"split-button":"",class:"active-route",onCommand:He,onClick:n[0]||(n[0]=function(e){return He("databaseBack")})},{dropdown:R(function(){return[H(r,null,{default:R(function(){return[H(a,{command:"databaseBack"},{default:R(function(){return t(n[12]||(n[12]=[N(" 备份数据库 ",-1)]))}),_:1}),H(a,{command:"databasePwdBack"},{default:R(function(){return t(n[13]||(n[13]=[N(" 加密备份数据库 ",-1)]))}),_:1}),H(a,{command:"tableBack"},{default:R(function(){return t(n[14]||(n[14]=[N("表备份",-1)]))}),_:1})]}),_:1})]}),default:R(function(){return[n[15]||(n[15]=U("span",{class:"text-white"},"备份数据库",-1))]}),_:1})):(T(),F(ne,{key:1},[H(c,{type:"primary",onClick:n[1]||(n[1]=function(e){return De(!1)})},{default:R(function(){return t(n[16]||(n[16]=[N(" 备份数据库 ",-1)]))}),_:1}),H(c,{type:"default",onClick:n[2]||(n[2]=function(e){return we()})},{default:R(function(){return t(n[17]||(n[17]=[N(" 表备份 ",-1)]))}),_:1})],64))]}),"header-right":R(function(){return t(n[18]||(n[18]=[]))}),content:R(function(){return[I(H(l,{ref_key:"routeBackupRef",ref:E,data:M(G),description:"暂无数据","max-height":460,column:M(We)},null,8,["data","column"]),[[y,M(W)],[y,"正在加载中，请稍后...","title"]])]}),"footer-left":R(function(){return[H(i,{options:he,"table-ref":M(E)},null,8,["table-ref"])]}),"footer-right":R(function(){return[H(o,{total:M(K).total,page:M(K).p,"onUpdate:page":n[3]||(n[3]=function(e){return M(K).p=e}),row:M(K).limit,"onUpdate:row":n[4]||(n[4]=function(e){return M(K).limit=e}),onChange:Ne},null,8,["total","page","row"])]}),popup:R(function(){return[H(d,{title:"更换默认备份目录",modelValue:M(Q),"onUpdate:modelValue":n[6]||(n[6]=function(e){return ae(Q)?Q.value=e:null}),area:42,onConfirm:xe,showFooter:""},{default:R(function(){return[U("div",ft,[H(p,{ref:"ruleFormData",class:"mr-[16px] w-[80%]",model:M(X),rule:{backupPath:[{required:!0,message:"请输入默认备份目录",trigger:"blur"}]}},{default:R(function(){return[H(f,{label:"默认备份目录",prop:"backupPath"},{default:R(function(){return[H(s,{icon:"icon-file_mode",modelValue:M(X).backupPath,"onUpdate:modelValue":n[5]||(n[5]=function(e){return M(X).backupPath=e}),onIconClick:_e,width:"26rem"},null,8,["modelValue"])]}),_:1})]}),_:1},8,["model"])])]}),_:1},8,["modelValue"]),H(d,{title:M(C)?"数据库加密密码":"加密备份数据库",modelValue:M(se),"onUpdate:modelValue":n[10]||(n[10]=function(e){return ae(se)?se.value=e:null}),area:42,onConfirm:Re,showFooter:"",onCancel:n[11]||(n[11]=function(){return M(pe).pwd=""})},{default:R(function(){return[U("div",pt,[H(p,{ref_key:"pwdBackFormRef",ref:Z,class:"mr-[16px] w-[80%]",model:M(pe),rules:{pwd:[{required:!0,message:"请输入压缩密码",trigger:"blur"}]}},{default:R(function(){return[H(f,{label:"压缩密码",prop:"pwd"},{default:R(function(){return[M(C)?(T(),z(m,{key:1,modelValue:M(pe).pwd,"onUpdate:modelValue":n[9]||(n[9]=function(e){return M(pe).pwd=e}),width:"26rem"},null,8,["modelValue"])):(T(),z(s,{key:0,modelValue:M(pe).pwd,"onUpdate:modelValue":n[7]||(n[7]=function(e){return M(pe).pwd=e}),icon:"el-refresh",width:"26rem",onIconClick:n[8]||(n[8]=function(){return M(pe).pwd=M(b)(16)}),"is-active":!0},null,8,["modelValue"]))]}),_:1})]}),_:1},8,["model"]),I(U("ul",dt,t(n[19]||(n[19]=[U("li",{class:"text-warning"},"设置密码后请注意保存密码，以防忘记密码导致无法恢复备份数据",-1)])),512),[[re,M(C)]])])]}),_:1},8,["title","modelValue"])]}),_:1}),U("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-20px"},[U("li",null,[n[20]||(n[20]=N(" 定时备份请前往【 ",-1)),U("span",{title:"点击前往【计划任务】",class:"bt-link",onClick:je}," 计划任务 "),n[21]||(n[21]=N(" 】增加【备份数据库】 ",-1))])])])}}}),vt=B(mt,[["__scopeId","data-v-9970ea25"]]),bt={class:"p-[20px] h-full"};e("default",P({__name:"index",props:{compData:{default:function(){return{row:{}}}}},emits:["close"],setup:function(e,n){n.emit;var a=fe().refs.tabActive,r=S("routeBackup");return V(function(){}),function(e,n){var u=se,c=O;return T(),F("div",bt,[H(c,{type:"card",modelValue:M(r),"onUpdate:modelValue":n[0]||(n[0]=function(e){return ae(r)?r.value=e:null}),class:"bt-tabs bt-tabs-card"},{default:R(function(){return[H(u,{name:"routeBackup",label:"常规备份",lazy:!0},{default:R(function(){return[H(vt,{compData:e.compData.row},null,8,["compData"])]}),_:1}),"mysql"==M(a)?(T(),z(u,{key:0,name:"increment",class:"mt-4",lazy:!0},{label:R(function(){return t(n[1]||(n[1]=[U("span",{class:"flex items-center"},[U("i",{class:"mr-[4px] svgtofont-icon-ltd text-[1.8rem] text-[#9B7E48]"}),U("span",null,"增量备份")],-1)]))}),default:R(function(){return[H(st,{compData:e.compData.row,isRowBackup:!0},null,8,["compData"])]}),_:1})):A("",!0)]}),_:1},8,["modelValue"])])}}}))}}})}();
