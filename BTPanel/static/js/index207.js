import{K as a,h as e,b as l}from"./utils-lib.js?v=1756369731";import{c as s,s as t,r as i,p as o,q as n,v as u,y as r,B as m,e as d,A as c,F as p,a_ as f,x as v,M as x,P as y,z as _,ai as b,aj as j,a$ as w,D as h}from"./base-lib.js?v=1756369731";import{B as V}from"./index140.js?v=1756369731";import{h as g,i as k,o as C}from"./validator.js?v=1756369731";import{S as D}from"./useStore4.js?v=1756369731";import{getRewriteLists as P,batchPhpRewrite as S}from"./site.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./ace.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const U={class:"p-2rem"},H={class:"flex items-center"},q={class:"relative h-full"},B={class:"p-20px"},F={class:"overflow-auto h-[12rem] border border-[#efefef] p-12px"},J={class:"absolute bottom-0 w-full bg-[#f6f8f8] flex items-center justify-end p-12px"},N=s({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(s,{expose:N,emit:O}){const{batchConfig:z}=t(D()),{getFileEvent:A}=D(),E=l(),K=s,M=O,$=i(""),G=i(!1),I=i([]),L=i([]),Q=i(),R=i(),T=async a=>{await X(a),R.value=""},W=async a=>{await X(a),Q.value=""},X=async a=>{try{const{data:e}=await A({path:a});$.value=e.data}catch(e){}},Y=async()=>{const e=JSON.stringify(K.compData.map(a=>{const e=I.value.find(e=>e.id===a.id);return{id:a.id,name:a.name,file:e.file}})),{exclude:l,enable:s}=z.value,t=g(!1,l,s,{params:{site_list:e,project_type:"PHP",rewrite_data:$.value}});a({loading:"正在部署，请稍后...",request:S(t),success:a=>{const{data:e}=k(a.data);C(e,{title:"部署伪静态"}),G.value=!1,M("close")}})};return N({onConfirm:()=>{Q.value||R.value?G.value=!0:E.error("请选择一种伪静态规则")}}),o(async()=>{await(async()=>{try{const a=await P({site_ids:JSON.stringify(K.compData.map(a=>a.id)),site_type:"PHP"});I.value=a.data.site_rewrites,L.value=a.data.template_rewrites}catch(a){}})()}),(a,l)=>{const s=b,t=j,i=w,o=V,g=h,k=e;return n(),u("div",U,[r("div",H,[l[5]||(l[5]=m(" 站点已有伪静态规则： ",-1)),d(t,{class:"mx-12px !w-16rem",modelValue:v(Q),"onUpdate:modelValue":l[0]||(l[0]=a=>y(Q)?Q.value=a:null),onChange:T},{default:c(()=>[(n(!0),u(p,null,f(v(I),a=>(n(),x(s,{key:a.id,label:a.name+"站点的伪静态配置",value:a.file},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[6]||(l[6]=m(" 模板伪静态规则： ",-1)),d(t,{class:"mx-12px !w-16rem",modelValue:v(R),"onUpdate:modelValue":l[1]||(l[1]=a=>y(R)?R.value=a:null),onChange:W},{default:c(()=>[(n(!0),u(p,null,f(v(L),a=>(n(),x(s,{key:a.id,label:a.name+"模板的伪静态配置",value:a.file},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),d(i),d(o,{modelValue:v($),"onUpdate:modelValue":l[2]||(l[2]=a=>y($)?$.value=a:null),class:"!h-[42rem]"},null,8,["modelValue"]),d(k,{title:"部署当前伪静态",modelValue:v(G),"onUpdate:modelValue":l[4]||(l[4]=a=>y(G)?G.value=a:null),area:[52,28]},{default:c(()=>[r("div",q,[r("div",B,[l[7]||(l[7]=r("span",{class:"!mb-4px inline-block"},"如下是需要批量部署伪静态的站点：",-1)),r("div",F,[(n(!0),u(p,null,f(a.compData,(a,e)=>(n(),u("div",{key:e,class:"p-4px w-full"},_(a.name),1))),128))]),l[8]||(l[8]=r("div",{class:"text-danger mt-4px"},"注意：批量设置站点伪静态后，原有站点伪静态配置将被覆盖。",-1))]),r("div",J,[d(g,{type:"warning",onClick:l[3]||(l[3]=a=>G.value=!1)},{default:c(()=>[...l[9]||(l[9]=[m("取消",-1)])]),_:1}),d(g,{type:"primary",onClick:Y},{default:c(()=>[m("部署("+_(a.compData.length)+"项)",1)]),_:1})])])]),_:1},8,["modelValue"])])}}});export{N as default};
