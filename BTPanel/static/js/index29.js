import{k as e,r as a,ar as t,c as s,ay as l,p as o,a4 as n,q as r,v as i,e as c,A as m,y as p,x as u,O as d,F as _,a_ as f,Q as h,ao as g,an as b,a7 as y,z as v,ap as x}from"./base-lib.js?v=1756369731";import{_ as w}from"./index103.js?v=1756369731";import{K as k,bY as j,l as R,L as H,o as S,bZ as D,M as C,ah as O,u as q,a6 as T,j as P}from"./utils-lib.js?v=1756369731";import{a as V}from"./useMethods.js?v=1756369731";import{u as A}from"./column.js?v=1756369731";import{_ as E}from"./index104.js?v=1756369731";const M=e({name:"",description:"暂无数据",isRefresh:!0}),N=e({loading:!1,list:[],total:0,tableHeight:"410px"}),F=a(!0);a([]);const L=a(""),z=(e,a,t,s)=>{const l=e.data;a.value+="".concat(l),l.includes("bt_successful")&&(C.success("拉取成功"),t()),l.includes("bt_failed")&&(C.error("拉取失败"),t())},B=async(e,a)=>{let t={model_index:"btdocker",mod_name:"image",def_name:"pull_from_some_registry",ws_callback:111,name:"docker官方库",image:"".concat(e.name,":").concat(e.tag),registry_mirrors:"noSpeed"==L.value?"":L.value};await R({title:"拉取镜像",area:65,component:()=>H(()=>import("./pull-image-log-dialog.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{url:"/ws_model",params:t,onWSReceive:z,onRefresh:()=>a()}})},I=async e=>{V({image:e.name})},J=e=>({data:N.list.slice((e.p-1)*e.limit,e.p*e.limit),total:N.total}),K=e=>{M.description="暂无数据",M.name=M.name.replace(/\s+/g,"")};let W=null;const Q=a("开始拉取镜像...\n"),U=e=>{W&&(W.socket.close(),W=null),e&&e()},Y=async(e,a)=>{await((e,a)=>{W=O({route:e.compData.url,onMessage:(t,s)=>{e.compData.onWSReceive(s,Q,U,a)}})})(e,a),(e=>{let a={...e.compData.params};null==W||W.send(a)})(e)},Z=e=>{U(e||!1),Q.value="开始拉取镜像...\n"},G={class:"container-dialog p-[2.4rem]"},X={class:"flex items-center relative"},$={class:"py-[1rem]"},ee=s({__name:"index",setup(e){const{mainHeight:s}=q(),O=l("popupSetFooter",!1),V=a("1ms加速站搜索"),L=e=>{M.isRefresh=!0,e&&!isNaN(e)&&(Y.value.p=e),U()},z=[{value:"1ms",text:"1ms加速站搜索"},{value:"dockerHub",text:"Docker Hub搜索"}],B=e=>{V.value=e.text,(e=>{if(""===M.name)return C.error("请输入需要搜索的镜像名");const a=0===e?"https://1ms.run/search?query=":"https://hub.docker.com/search?type=image&q=";window.open(a+M.name,"_blank","noopener,noreferrer")})("Docker Hub搜索"==e.text?1:0)},{BtTable:W,BtPage:Q,refresh:U,param:Y}=T({request:e=>(async e=>{if(0===N.list.length||M.isRefresh){M.isRefresh=!1;const a=await k({request:j({data:JSON.stringify({name:M.name})}),data:Array,loading:t(N,"loading")});return 0===a.length&&(M.description="没有搜索到".concat(M.name,"相关的镜像")),N.list=a,N.total=a.length,J(e)}return J(e)})(e),columns:[{label:"镜像名",prop:"name",width:200},{label:"Start数",prop:"star_count",width:70},{label:"来源",width:60,render:e=>e.is_official?"官方":"非官方"},{label:"描述/说明",prop:"description",showOverflowTooltip:!0},A([{onClick:I,width:80,title:"创建容器"},{onClick:e=>{const a="https://1ms.run/r/"+(e.is_official?"library/":"");window.open("".concat(a+e.name),"_blank","noopener noreferrer")},title:"简介"},{title:"拉取",render:e=>c("span",{class:"cursor-pointer text-primary",onClick:()=>(async(e,a)=>{await R({title:"".concat(e.is_pull?"更新":"拉取","镜像"),area:50,component:()=>H(()=>import("./pull-image-details-dialog.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{name:e.name,refresh:a}})})(e,L)},[e.is_pull?["更新",c(E,null,null)]:"拉取"])},{onClick:e=>(async(e,a)=>{const t={id:e.id,name:e.name,force:"0"};try{await S({type:"calc",title:"删除镜像【".concat(e.name,"】"),content:"您真的要删除镜像【".concat(e.name,"】吗？")}),k({request:D({data:JSON.stringify(t)}),message:!0,success:a})}catch(s){}})(e,L),isHide:e=>!e.is_pull,title:"删除"}])]});return o(()=>{((e,a,t)=>{setTimeout(()=>{if(a)N.tableHeight="410px";else{F.value=!1;const a=e.value-270;N.tableHeight="".concat(a,"px"),a>800&&(t.value.limit=20)}},0)})(s,O,Y)}),n(()=>{M.name="",M.description="暂无数据",N.list=[],N.total=0,N.loading=!1,N.tableHeight="410px",M.isRefresh=!0}),(e,a)=>{const t=P,s=x,l=g,o=b,n=w,k=y;return r(),i("div",G,[c(k,{ref:"searchFormRef",model:u(M),"label-position":"right",onSubmit:a[5]||(a[5]=h(()=>{},["prevent"]))},{default:m(()=>[p("div",X,[c(t,{modelValue:u(M).name,"onUpdate:modelValue":a[0]||(a[0]=e=>u(M).name=e),class:"!w-[51rem]",onChangePassive:a[1]||(a[1]=e=>u(K)("name")),placeholder:"请输入需要搜索的镜像名",clearable:"",onClear:a[2]||(a[2]=e=>L(1)),onKeyup:a[3]||(a[3]=d(e=>L(1),["enter"]))},null,8,["modelValue"]),c(o,{onCommand:B,"split-button":"",class:"ml-8px",type:"primary"},{dropdown:m(()=>[c(l,null,{default:m(()=>[(r(),i(_,null,f(z,e=>c(s,{key:e.value,command:e},{default:m(()=>[p("span",null,v(e.text),1)]),_:2},1032,["command"])),64))]),_:1})]),default:m(()=>[p("span",{onClick:a[4]||(a[4]=h(e=>L(1),["stop"]))},"搜索")]),_:1})]),p("div",$,[c(n,null,{content:m(()=>[c(u(W),{"max-height":u(N).tableHeight},null,8,["max-height"])]),"footer-right":m(()=>[c(u(Q))]),_:1})])]),_:1},8,["model"])])}}}),ae=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{ae as a,Y as i,Q as l,B as p,W as s,Z as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
