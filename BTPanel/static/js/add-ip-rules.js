import{c as e,r as a,p as l,q as s,M as t,A as d,e as o,x as i,y as r,v as m,C as p,a9 as u,ai as n,aj as c,a7 as f}from"./base-lib.js?v=1756369731";import{K as b,j as y}from"./utils-lib.js?v=1756369731";import{g as _}from"./useStore5.js?v=1756369731";import{g,a as D}from"./useMethod6.js?v=1756369731";import{A as h,B as j}from"./firewall.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./validator.js?v=1756369731";const v={class:"pl-[4.4rem] pt-[2.4rem] leading-8 text-[1.2rem] list-disc"},I={key:0},P=e({__name:"add-ip-rules",props:{compData:{default:()=>{}}},setup(e,{expose:P}){const V=e,{refs:{firewallInfo:w}}=_(),x=a({types:"accept",brief:"",address:"",id:"",chain:"INPUT",family:"ipv4",zone:"public"}),U=a(),N={address:[{trigger:["blur","change"],required:!0,message:"请输入指定IP"}]},O=e=>{"INPUT"===e&&(x.value.zone="public")};return l(()=>{V.compData.isEdit&&Object.assign(x.value,{types:V.compData.Strategy,brief:V.compData.brief,chain:V.compData.Chain,address:V.compData.Address,domain:V.compData.domain,id:V.compData.id||"",zone:V.compData.Zone||"public"})}),P({onConfirm:async e=>{await U.value.validate();const a={...x.value,operation:"add",strategy:x.value.types};V.compData.isEdit||delete a.id,await b({loading:"正在设置IP规则，请稍后...",request:V.compData.isEdit?h({new_data:JSON.stringify(a),old_data:JSON.stringify(V.compData)}):j(a),message:!0,success:()=>{V.compData.refreshFn(),g(),D(),e()}})}}),(e,a)=>{const l=y,b=u,_=n,g=c,D=f;return s(),t(D,{ref_key:"editIpRulesRef",ref:U,rules:N,disabled:e.formDisabled,model:i(x),class:"p-[2rem] addfrom"},{default:d(()=>[o(b,{label:"IP",prop:"address"},{default:d(()=>[o(l,{type:"textarea",modelValue:i(x).address,"onUpdate:modelValue":a[0]||(a[0]=e=>i(x).address=e),width:"24rem",resize:"none",rows:4,placeholder:"请输入IP地址",disabled:!!V.compData.selectOptions,clearable:""},null,8,["modelValue","disabled"])]),_:1}),o(b,{label:"策略"},{default:d(()=>[o(g,{modelValue:i(x).types,"onUpdate:modelValue":a[1]||(a[1]=e=>i(x).types=e),class:"!w-[24rem]"},{default:d(()=>[o(_,{label:"放行",value:"accept"}),o(_,{label:"禁止",value:"drop"})]),_:1},8,["modelValue"])]),_:1}),o(b,{label:"方向"},{default:d(()=>[o(g,{modelValue:i(x).chain,"onUpdate:modelValue":a[2]||(a[2]=e=>i(x).chain=e),class:"!w-[24rem]",onChange:O},{default:d(()=>[o(_,{label:"入站(默认)",value:"INPUT"}),o(_,{label:"出站",value:"OUTPUT"})]),_:1},8,["modelValue"])]),_:1}),o(b,{label:"备注"},{default:d(()=>[o(l,{modelValue:i(x).brief,"onUpdate:modelValue":a[3]||(a[3]=e=>i(x).brief=e),width:"24rem",placeholder:"可为空",clearable:""},null,8,["modelValue"])]),_:1}),r("ul",v,[a[4]||(a[4]=r("li",null,'支持添加IP：如果添加多个IP请用","隔开',-1)),a[5]||(a[5]=r("li",null,"支持添加IP段,如：192.168.0.0/24",-1)),a[6]||(a[6]=r("li",null,"支持添加IP范围,格式如：192.168.1.xx-192.168.1.xx，暂不支持跨网段范围",-1)),"firewalld"===i(w).type?(s(),m("li",I,"区域：非专业人士请勿修改，建议使用public")):p("",!0),a[7]||(a[7]=r("li",null,"此操作将重载防火墙，未持久化的 iptables 规则会清空，请先备份保存！",-1))])]),_:1},8,["disabled","model"])}}});export{P as default};
