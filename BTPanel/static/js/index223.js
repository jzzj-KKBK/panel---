import{G as e,M as a,gx as t,e as s,al as o}from"./utils-lib.js?v=1756369731";import{c as l,g as r,e as n,T as m,q as d,M as c,x as i,r as p,v as u,A as v,P as f,aA as h}from"./base-lib.js?v=1756369731";import{b as y,d as b,e as _,l as w,g,h as j}from"./form-item.js?v=1756369731";import{f as x}from"./validator.js?v=1756369731";import{B as k}from"./index140.js?v=1756369731";import{A as C}from"./add-compose.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./ace.js?v=1756369731";import"./useMethods.js?v=1756369731";const V=s(l({__name:"add-common",emits:["close","submit"],setup(s,{expose:o,emit:l}){const p=l,{BtForm:u,submit:v}=e({data:()=>({name:"",remark:"",data:"",env:"",save:!1,template:"",path:"",envpath:"",type:"data"}),options:e=>r(()=>[y("编排名称","name",{attrs:{placeholder:"请输入编排名称",class:"!w-[43.5rem]"},rules:[{required:!0,message:"请输入编排名称",trigger:["blur"]}]}),b([_("来源","type",[{label:"编辑",value:"data"},{label:"文件",value:"path"}],{attrs:{size:"default",onChange:()=>{}}})]),..."path"==e.value.type?[b([w(" ","path",{attrs:{class:"!w-[30rem]",placeholder:"请选择compose文件"}},()=>f(e,"compose")),g("本地上传",{attrs:{class:"!ml-[1rem]",onClick:()=>{W(e,"compose")}}})])]:[],j("compose内容",()=>n(k,{key:"editer1",class:"w-full h-[30rem]",modelValue:e.value.data,"onUpdate:modelValue":a=>e.value.data=a,editorOption:h},null),"data"),..."path"==e.value.type?[b([w(" ","envpath",{attrs:{class:"!w-[30rem]",placeholder:"请选择.env文件"}},()=>f(e,"env")),g("本地上传",{attrs:{class:"!ml-[1rem]",onClick:()=>{W(e,"env")}}})])]:[],j(".env内容",()=>n(k,{key:"editer2",class:"w-full h-[10rem]",modelValue:e.value.env,"onUpdate:modelValue":a=>e.value.env=a,editorOption:h},null),"data"),j("同时存为模板",()=>n(m,{modelValue:e.value.save,"onUpdate:modelValue":a=>e.value.save=a},null),"save"),...e.value.save?[y("模板名称","template",{attrs:{placeholder:"请输入模板名称",class:"!w-[43.5rem]"}}),y("备注","remark",{attrs:{placeholder:"备注",class:"!w-[43.5rem]"}})]:[]]),submit:async(e,a,t)=>{await a(),V(e)}}),f=(e,t)=>{x({type:"file",change:s=>{s&&("compose"==t&&(e.value.path=s),"env"==t&&(e.value.envpath=s),s.endsWith(".yml")||s.endsWith(".yaml")||"compose"!=t?s.endsWith(".env")||"env"!=t?C(s,e,t):a.error("请选择.env文件"):a.error("请选择compose文件"))}})},h={mode:"ace/mode/yaml",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"},C=async(e,a,s)=>{try{const{data:o}=await t({path:e});"object"==typeof o&&("compose"==s&&(a.value.data=o.data||""),"env"==s&&(a.value.env=o.data||""))}catch(o){}},V=async e=>{const a=e.value;let t={mod_name:"docker",sub_mod_name:"com",def_name:"create",project_name:a.name,config:a.data,env:a.env,add_template:a.save?1:0,remark:a.remark,ws_callback:"create"};a.save&&(t.template_name=a.template),p("submit",{params:t,close:()=>p("close")})},W=(e,t)=>{const s=document.createElement("input");s.type="file",s.style.display="none","compose"===t&&(s.accept=".yml,.yaml"),s.addEventListener("change",s=>{var o;const l=null==(o=s.target.files)?void 0:o[0];if(!l)return;if("compose"===t&&!l.name.endsWith(".yml")&&!l.name.endsWith(".yaml"))return void a.error("请选择compose文件");if("env"===t&&!l.name.endsWith("env"))return void a.error("请选择env文件");const r=new FileReader;r.onload=a=>{var s;const o=null==(s=a.target)?void 0:s.result;"compose"===t?(e.value.path=l.name,e.value.data=o):"env"===t&&(e.value.envpath=l.name,e.value.env=o)},r.onerror=()=>{a.error("读取文件内容失败")},r.readAsText(l)}),document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s)},0)};return o({onConfirm:v}),(e,a)=>(d(),c(i(u),{class:"p-[1.6rem]"}))}}),[["__scopeId","data-v-263a1ee9"]]),W={class:"flex flex-col p-[16px] lib-box"},S=s(l({__name:"index",props:{compData:{default:()=>({})}},emits:["close"],setup(e,{expose:a,emit:t}){const s=t,l=p("first"),r=p(),m=p(),c=()=>{s("close")};return a({onConfirm:async()=>{try{"first"==l.value?r.value.onConfirm():m.value.onConfirm()}catch(e){}}}),(e,a)=>{const t=h,s=o;return d(),u("div",W,[n(s,{type:"card",modelValue:i(l),"onUpdate:modelValue":a[0]||(a[0]=e=>f(l)?l.value=e:null)},{default:v(()=>[n(t,{label:"常规创建",name:"first"},{default:v(()=>[n(V,{ref_key:"first",ref:r,onClose:c,onSubmit:e.compData.wsConfirm},null,8,["onSubmit"])]),_:1}),n(t,{label:"使用模板",name:"second"},{default:v(()=>[n(C,{ref_key:"second",ref:m,onClose:c},null,512)]),_:1})]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-4f7f2067"]]);export{S as default};
