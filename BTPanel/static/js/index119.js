import{j as e,b as a,e as t,o as s,W as l,h as i}from"./utils-lib.js?v=1756369731";import{_ as n}from"./index116.js?v=1756369731";import{c as r,r as u,k as o,w as c,a4 as m,q as v,v as d,y as p,e as f,A as x,x as g,M as w,z as h,C as b,H as y,B as _,I as C,b3 as k,D as j,al as I,ax as F,s as T,n as V,g as D,p as S,F as H,a_ as z,P as N,a$ as O,b5 as q,b6 as A}from"./base-lib.js?v=1756369731";import{C as B,w as L,s as M,i as U,o as G}from"./index14.js?v=1756369731";import{A as J,B as R,C as P}from"./useController3.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index103.js?v=1756369731";import"./index112.js?v=1756369731";import"./index123.js?v=1756369731";import"./index124.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./validator.js?v=1756369731";const W={class:"mr-[10px]"},$={class:"flex items-center"},E={class:"flex items-center"},K={class:"text-primary"},Q={class:"flex flex-col text-[#666] p-12px"},X={class:"flex items-center"},Y={class:"flex items-center mt-[8px] w-full"},Z=t(r({__name:"index",props:{refreshFn:{type:Function,default:()=>({})},sessionConfig:{default:()=>{}}},emits:["save"],setup(t,{expose:s,emit:l}){const i=t,n=a(),r=l,T=u(!1),V=u(),D=u(!0),S=u(0),H=u(100),z=u(5),N=u(5),O=o({status:!1,time:5,timer:0});let q=!1;const A=async e=>{O.status=e,O.time=N.value,(!O.time||O.time<1)&&(O.time=5,N.value=5),e?(O.timer=setInterval(()=>{q||i.refreshFn()},1e3*N.value),S.value=setInterval(()=>{q||(z.value--,0===z.value&&(z.value=N.value),H.value=z.value/N.value*100)},1e3)):(clearInterval(O.timer),clearInterval(S.value),z.value=N.value,H.value=100,D.value||n.success("关闭成功")),r("save",O)},B=async()=>{O.time<1||!Number.isInteger(parseFloat(O.time.toString()))||O.time>99?n.error("时间间隔须在范围1~99秒内的整数"):(z.value=O.time,N.value=O.time,n.success("保存成功"),clearInterval(O.timer),clearInterval(S.value),A(!0),r("save",O))},L=async()=>{await i.refreshFn(),n.success("刷新成功")},M=()=>{T.value=!1,O.time=N.value};c(()=>i.sessionConfig,e=>{V.value=e,(null==e?void 0:e.time)&&D.value&&(N.value=e.time,z.value=e.time,A(e.status),D.value=!1)},{deep:!0});const U=()=>{clearInterval(O.timer),clearInterval(S.value)};return m(()=>{q=!0,U()}),s({clearIntervalFn:U}),(a,t)=>{const s=k,l=j,i=I,n=e,r=F;return v(),d("div",W,[p("div",$,[f(l,{class:"h-[3.2rem] refresh-btn",onClick:L},{default:x(()=>[p("div",E,[g(O).status?(v(),w(s,{key:0,class:"mr-8px",width:22,"show-text":!0,"stroke-width":1,type:"circle",color:"#20a53a","text-color":"#20a53a",percentage:g(H)},{default:x(()=>[p("span",K,h(Number(g(z))),1)]),_:1},8,["percentage"])):b("",!0),t[3]||(t[3]=p("span",null,"刷新日志",-1))])]),_:1}),f(r,{placement:"bottom-start",width:"280",trigger:"click","popper-class":"el-tooltip-white",onHide:M},{reference:x(()=>[f(l,{class:"down-button !ml-0",onClick:t[2]||(t[2]=e=>T.value=!g(T))},{default:x(()=>[...t[7]||(t[7]=[p("i",{class:"svgtofont-el-arrow-down"},null,-1)])]),_:1})]),default:x(()=>[p("div",Q,[p("div",X,[t[4]||(t[4]=p("span",{class:"mr-4px"},"定时刷新",-1)),f(i,{modelValue:g(O).status,"onUpdate:modelValue":t[0]||(t[0]=e=>g(O).status=e),onChange:A},null,8,["modelValue"])]),y(p("div",Y,[t[6]||(t[6]=p("span",{class:"mr-4px flex-nowrap"},"时间间隔",-1)),f(n,{modelValue:g(O).time,"onUpdate:modelValue":t[1]||(t[1]=e=>g(O).time=e),"text-type":"秒",min:1,type:"number",class:"!w-[10rem]"},null,8,["modelValue"]),f(l,{class:"!ml-4px",type:"primary",onClick:B},{default:x(()=>[...t[5]||(t[5]=[_("保存",-1)])]),_:1})],512),[[C,g(O).status]])])]),_:1})])])}}}),[["__scopeId","data-v-c40a519b"]]),ee=a(),ae=B(),{rowData:te}=T(ae),se=u("正在获取中...."),le=u({log_path:"",size:""}),ie=u(!1),ne=u(""),re=u([]),ue=u(0),oe=u(""),ce=u(),me=u(),ve=o({status:!1,time:3}),de=u([new Date((new Date).setHours(0,0,0,0)),new Date((new Date).setHours(23,59,59,999))]),pe=u(),fe=[{label:"全部",value:0},{label:"近7天",value:1},{label:"近30天",value:2},{label:"自定义时间",value:3}],xe=e=>{ue.value=e,3!==e?(oe.value="",we(!1)):ce.value.focus()},ge=e=>{ue.value=3,oe.value=e,we(!1)},we=async e=>{try{e&&(me.value=(e=>{let a=Number(e);return a=a<3?3:a,a})(ve.time));let a=0,t=0;if(0!==ue.value){const e=1===ue.value?7:30,s=(new Date).getTime();a=(new Date(s-24*e*60*60*1e3).getTime()/1e3).toFixed(0),t=(s/1e3).toFixed(0),3===ue.value&&(a=(new Date(oe.value[0]).getTime()/1e3).toFixed(0),t=(new Date(oe.value[1]).getTime()/1e3).toFixed(0))}else a="",t="";const s=await J({id:te.value.id,start_timestamp:a,end_timestamp:t});se.value=s.data.msg||"暂无日志",he(),e&&be()}catch(a){}},he=()=>{V(()=>{const e=document.querySelector(".pre-box");e&&(e.scrollTop=e.scrollHeight)})},be=async()=>{try{const{data:e}=await R({id:te.value.id});le.value.log_path=e.log_path,le.value.size=e.size}catch(e){}},ye=e=>{ve.status=e.status,ve.time=e.time,pe.value[te.value.id]=ve,pe.value[te.value.id].id=te.value.id,sessionStorage.setItem("CRONTAB-LOGS",JSON.stringify(pe.value))},_e=()=>{const e=sessionStorage.getItem("CRONTAB-LOGS");pe.value=e?JSON.parse(e):{},pe.value&&pe.value[te.value.id]?(ve.status=pe.value[te.value.id].status,ve.time=Number(pe.value[te.value.id].time)||3,pe.value[te.value.id].id=te.value.id):ye({status:!1,time:5,id:te.value.id}),be(),we()},Ce=async()=>{try{await s({title:"提示",content:"确定清空日志吗？"});const e=await P({id:te.value.id});ee.request(e),we(!0)}catch(e){}},ke=e=>{const a=new Date;return a.setHours(23,59,59,999),e.getTime()>a.getTime()},je=async()=>{await M(!1,!0),_e()},Ie={class:"p-[20px]"},Fe={class:"pb-2rem flex gap-2rem leading-2rem"},Te={class:"max-w-[54rem] truncate"},Ve=["title"],De={class:"flex justify-between items-end"},Se={class:"flex items-center"},He={class:"flex refresh-btn"},ze={class:"flex items-center relative"},Ne={class:"pre-box bg-[#333] mt-[12px] text-white h-[48rem] overflow-auto p-[20px]"},Oe=["innerHTML"],qe={class:"flex-wrap"},Ae=t(r({__name:"index",emits:["close"],setup(e,{emit:a}){const t=a,s=D(()=>[...U.value?[{content:f("span",{class:"bt-link",onClick:()=>G(r)},[_("一键跳转至本地备份目录")])}]:[],{content:()=>f("span",null,[_("若您发现任务无法定时执行，可尝试点击"),f("span",{class:"bt-link",onClick:()=>(async()=>{try{ie.value=!0,ne.value="",re.value=[],L.request("/crontab/set_execute_script",{customType:"model",onMessage:e=>{!0!==e&&"successful"!==e&&(re.value.push(e),ne.value=re.value.join("\n"))}})}catch(e){}})()},[_("【重装Crontab】")]),_("进行重新安装")])}]),r=()=>{t("close")};return S(_e),(e,a)=>{const t=Z,r=j,u=O,o=q,c=A,m=l,b=n,y=i;return v(),d("div",Ie,[p("div",Fe,[p("div",Te,"日志路径："+h(g(le).log_path),1),p("div",{class:"w-[20rem] truncate",title:"大小：".concat(g(le).size)},"大小： "+h(g(le).size),9,Ve)]),p("div",De,[p("div",Se,[p("div",He,[f(t,{refreshFn:()=>g(we)(!0),"session-config":g(ve),onSave:g(ye)},null,8,["refreshFn","session-config","onSave"])]),f(r,{onClick:g(Ce)},{default:x(()=>[...a[2]||(a[2]=[_(" 清空日志 ",-1)])]),_:1},8,["onClick"]),f(u,{direction:"vertical",class:"!h-[2rem] !mx-1rem"}),f(r,{onClick:g(je)},{default:x(()=>[...a[3]||(a[3]=[_("执行任务",-1)])]),_:1},8,["onClick"])]),p("div",ze,[f(o,{size:"default",class:"control-btn"},{default:x(()=>[(v(!0),d(H,null,z(g(fe),(e,a)=>(v(),w(r,{key:a,type:g(ue)===a?"primary":"",onClick:a=>g(xe)(e.value)},{default:x(()=>[_(h(e.label),1)]),_:2},1032,["type","onClick"]))),128))]),_:1}),f(c,{modelValue:g(oe),"onUpdate:modelValue":a[0]||(a[0]=e=>N(oe)?oe.value=e:null),type:"daterange",ref_key:"player",ref:ce,align:"right",size:"default",class:"!absolute right-0 top-0 opacity-0 !w-0 !h-0","range-separator":"","start-placeholder":"开始日期","end-placeholder":"结束日期","disabled-date":g(ke),"default-time":g(de),onChange:g(ge)},null,8,["modelValue","disabled-date","default-time","onChange"])])]),p("div",Ne,[p("pre",{class:"whitespace-pre-wrap",innerHTML:g(se)},null,8,Oe)]),f(m,{options:g(s),"list-style":"disc",class:"mt-[1rem] mx-[1rem]"},null,8,["options"]),f(y,{title:"正在检查Crontab，请耐心等候",modelValue:g(ie),"onUpdate:modelValue":a[1]||(a[1]=e=>N(ie)?ie.value=e:null),area:[60]},{default:x(()=>[p("div",qe,[f(b,{class:"h-[40rem] !rounded-none",content:g(ne)},null,8,["content"])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-d9a2628c"]]);export{Ae as default};
