import{at as e,K as l,o as a,j as o,c as s,h as t,b as r}from"./utils-lib.js?v=1756369731";import{_ as p}from"./index116.js?v=1756369731";import{c as m,r as n,k as u,w as c,p as i,aD as d,q as v,v as _,x as h,M as f,A as b,B as y,C as V,y as j,e as k,F as w,a_ as g,z as x,P as C,ai as P,aj as H,a9 as U,D as q,a$ as I,a7 as B}from"./base-lib.js?v=1756369731";import{_ as A}from"./index101.js?v=1756369731";import{_ as D}from"./index130.js?v=1756369731";import{getComposerVersion as M,deleteComposerFile as O,execComposer as R,getComposerLine as z}from"./site.js?v=1756369731";import{u as F}from"./useStore4.js?v=1756369731";import{f as K}from"./validator.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";import"./column.js?v=1756369731";const N={class:"p-1rem"},S={class:"flex items-center"},$={key:0,class:"text-danger"},E={key:1,class:"text-danger text-[1.2rem]"},G={class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-[20px]"},J={key:0},L={class:"p-2rem h-50rem flex flex-col"},Q={class:"mb-1rem"},T={class:"flex-1 overflow-auto"},W=m({__name:"index",setup(m){var W;const{siteInfo:X}=F(),Y=null==(W=X.value)?void 0:W.project_type,Z=r(),ee=n(!1),le=n(!1),ae=u({path:X.value.path,user:"phpasync"!==Y?"www":"root",php:["静态","其它"].includes(X.value.php_version)?"auto":"PHP-"+X.value.php_version.replace(".",""),otherCommand:"",mirror:"https://mirrors.aliyun.com/composer/",command:"install",composerVersion:"install",version:"2.7.3",help_tips:"",comp_json:"",comp_lock:"",phpVersion:[],commandOptions:[{label:"install",value:"install"},{label:"update",value:"update"},{label:"require",value:"require"},{label:"create-project",value:"create-project"},{label:"自定义",value:""}]}),oe=n("正在执行..."),se=n(!1),te=n(),re=n(!1);c(()=>X.value,e=>{ae.php=["静态","其它"].includes(e.php_version)?"auto":"PHP-"+e.php_version.replace(".","")},{immediate:!0});const pe=async l=>{ee.value=!0;try{const e=await M({path:l||X.value.path});e.data.status?(le.value=!1,ae.phpVersion=e.data.php_versions.filter(e=>"00"!==e.version),ae.phpVersion.unshift({name:"自动选择",version:"auto"}),ae.comp_json=!1,ae.comp_lock=!1,"string"==typeof e.data.comp_json&&(ae.comp_json=e.data.comp_json),"string"==typeof e.data.comp_lock&&(ae.comp_lock=e.data.comp_lock)):(le.value=!0,Z.request(e))}catch(a){e(a)}finally{ee.value=!1}},me=()=>{K({type:"dir",path:ae.path,change:e=>{ae.path=e,pe(ae.path)}})},ne=async()=>{l({loading:"正在删除，请稍后...",request:O({path:ae.path+"/composer.lock"}),message:!0,success:e=>{e.status&&pe(ae.path)}})},ue=async()=>{var e;let o={php_version:null==(e=ae.php)?void 0:e.replace("PHP-",""),composer_args:ae.command,composer_cmd:ae.otherCommand,repo:ae.mirror,path:ae.path,user:ae.user,composer_version:ae.version,siteName:X.value.name};await a({title:"执行composer命令",content:"即将执行设定的composer命令，继续吗？",icon:"warning-filled"}),l({loading:"正在执行，请稍后...",request:R(o),message:!0,success:e=>{e.status&&(se.value=!0,(async()=>{te.value=setInterval(async()=>{try{ce()}catch(e){clearInterval(te.value)}},2e3)})())}})},ce=async(l=!1)=>{try{const e=await z({filename:"/tmp/composer_".concat(X.value.name,".log"),num:100});oe.value=e.data.msg,l&&Z.success("刷新成功")}catch(a){e(a)}},ie=()=>{re.value=!0,ce()},de=()=>{clearInterval(te.value),se.value=!1,re.value=!1,oe.value=""};return i(()=>{pe()}),d(()=>{clearInterval(te.value)}),(e,l)=>{const a=D,r=P,m=H,n=U,u=o,c=A,i=s,d=q,M=I,O=B,R=p,z=t;return v(),_("div",null,[h(le)?(v(),f(a,{key:0},{content:b(()=>[...l[11]||(l[11]=[y(" 没有找到可用的composer版本 ",-1)])]),_:1})):V("",!0),j("div",N,[k(O,{model:h(ae)},{default:b(()=>[k(n,{label:"Composer版本"},{default:b(()=>[j("div",S,[k(m,{modelValue:h(ae).version,"onUpdate:modelValue":l[0]||(l[0]=e=>h(ae).version=e),class:"!w-[24rem]"},{default:b(()=>[k(r,{label:"2.7.3",value:"2.7.3"}),k(r,{label:"1.10.27",value:"1.10.27"})]),_:1},8,["modelValue"])])]),_:1}),k(n,{label:"PHP版本"},{default:b(()=>["phpasync"!==h(Y)?(v(),f(m,{key:0,class:"!w-[24rem]",modelValue:h(ae).php,"onUpdate:modelValue":l[1]||(l[1]=e=>h(ae).php=e)},{default:b(()=>[(v(!0),_(w,null,g(h(ae).phpVersion,(e,l)=>(v(),f(r,{key:l,label:e.name,value:e.version},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(v(),f(u,{key:1,modelValue:h(ae).php,"onUpdate:modelValue":l[2]||(l[2]=e=>h(ae).php=e),disabled:"",width:"24rem"},null,8,["modelValue"]))]),_:1}),k(n,{label:"执行参数"},{default:b(()=>[k(m,{class:"!w-[24rem]","empty-values":[null,void 0],modelValue:h(ae).command,"onUpdate:modelValue":l[3]||(l[3]=e=>h(ae).command=e)},{default:b(()=>[(v(!0),_(w,null,g(h(ae).commandOptions,(e,l)=>(v(),f(r,{key:l,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),k(n,{label:"补充命令"},{default:b(()=>[k(u,{modelValue:h(ae).otherCommand,"onUpdate:modelValue":l[4]||(l[4]=e=>h(ae).otherCommand=e),placeholder:"请输入补充命令",width:"24rem"},null,8,["modelValue"])]),_:1}),k(n,{label:"镜像源"},{default:b(()=>[k(m,{modelValue:h(ae).mirror,"onUpdate:modelValue":l[5]||(l[5]=e=>h(ae).mirror=e),filterable:"","allow-create":"","default-first-option":"",class:"!w-[24rem]"},{default:b(()=>[k(r,{label:"阿里云(mirrors.aliyun.com)",value:"https://mirrors.aliyun.com/composer/"}),k(r,{label:"官方源(packagist.org)",value:"repos.packagist"}),k(r,{label:"中国全量镜像(packagist.phpcomposer.com)",value:"https://packagist.phpcomposer.com"}),k(r,{label:"Packagist Mirror(packagist.mirrors.sjtug.sjtu.edu.cn)",value:"https://packagist.mirrors.sjtug.sjtu.edu.cn"}),k(r,{label:"腾讯源(mirrors.tencent.com)",value:"https://mirrors.tencent.com/composer/"}),k(r,{label:"华为云(mirrors.huaweicloud.com)",value:"https://mirrors.huaweicloud.com/repository/php/"})]),_:1},8,["modelValue"])]),_:1}),"phpasync"!==h(Y)?(v(),f(n,{key:0,label:"执行用户",prop:"command"},{default:b(()=>[k(m,{modelValue:h(ae).user,"onUpdate:modelValue":l[6]||(l[6]=e=>h(ae).user=e),class:"!w-24rem"},{default:b(()=>[k(r,{label:"www(推荐)",value:"www"}),k(r,{label:"root(不推荐)",value:"root"})]),_:1},8,["modelValue"])]),_:1})):V("",!0),k(n,{label:"执行目录",prop:"composerVersion"},{default:b(()=>[k(c,{modelValue:h(ae).path,"onUpdate:modelValue":l[7]||(l[7]=e=>h(ae).path=e),icon:"el-folder-opened",onIconClick:me,width:"32rem"},null,8,["modelValue"])]),_:1}),k(n,{label:" ",prop:"composerVersion"},{default:b(()=>[j("div",null,[h(ae).comp_lock?(v(),_("span",$,[y(x(h(ae).comp_lock)+" ",1),k(i,{onClick:ne},{default:b(()=>[...l[12]||(l[12]=[y("[点击删除]",-1)])]),_:1})])):V("",!0),h(ae).comp_json?(v(),_("span",E,x(h(ae).comp_json),1)):V("",!0)])]),_:1}),k(n,{label:" "},{default:b(()=>[k(d,{type:"primary",disabled:!!("boolean"!=typeof h(ae).comp_json&&h(ae).comp_json||"boolean"!=typeof h(ae).comp_lock&&h(ae).comp_lock),onClick:ue},{default:b(()=>[...l[13]||(l[13]=[y("执行",-1)])]),_:1},8,["disabled"]),k(M,{direction:"vertical",class:"!h-1rem !mx-2rem"}),k(d,{onClick:ie},{default:b(()=>[...l[14]||(l[14]=[y("查看日志",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),j("ul",G,[l[15]||(l[15]=j("li",null,"Composer是PHP主流依赖包管理器，若您的项目使用Composer管理依赖包，可在此处对依赖进行升级或安装",-1)),l[16]||(l[16]=j("li",null,"Composer版本：当前安装的Composer版本，可点击右侧的【升级Composer】将Composer升级到最新稳定版",-1)),l[17]||(l[17]=j("li",null,"PHP版本：用于执行composer的PHP版本，无特殊要求，默认即可，如安装出错，可尝试选择其它PHP版本",-1)),l[18]||(l[18]=j("li",null,"执行参数：按需选择执行参数,可配合补充命令使用",-1)),l[19]||(l[19]=j("li",null,"补充命令：若此处为空，则按composer.json中的配置执行，此处支持填写完整composer命令",-1)),l[20]||(l[20]=j("li",null,"镜像源：提供【阿里源】和【官方源】，建议国内服务器使用【阿里源】，海外服务器使用【官方源】",-1)),"phpasync"!==h(Y)?(v(),_("li",J,"执行用户：默认为www用户，除非您的网站以root权限运行，否则不建议使用root用户执行composer")):V("",!0),l[21]||(l[21]=j("li",null,"执行目录：默认为当前网站根目录",-1))])]),k(z,{title:"请执行完毕确认结果无误后关闭此窗口",onCancel:de,modelValue:h(se),"onUpdate:modelValue":l[8]||(l[8]=e=>C(se)?se.value=e:null),area:[50,42]},{default:b(()=>[k(R,{class:"h-full",title:"全屏查看composer执行日志",content:h(oe),isHtml:!0,isRefreshBtn:!1,isAuto:!0},null,8,["content"])]),_:1},8,["modelValue"]),k(z,{title:"composer执行日志",onCancel:de,modelValue:h(re),"onUpdate:modelValue":l[10]||(l[10]=e=>C(re)?re.value=e:null),area:60},{default:b(()=>[j("div",L,[j("div",Q,[k(d,{type:"primary",onClick:l[9]||(l[9]=e=>ce(!0))},{default:b(()=>[...l[22]||(l[22]=[y("刷新日志",-1)])]),_:1})]),j("div",T,[k(R,{class:"h-full",title:"全屏查看composer执行日志",content:h(oe),isHtml:!0,isRefreshBtn:!1},null,8,["content"])])])]),_:1},8,["modelValue"])])}}});export{W as default};
