import{ay as e,bC as a,aj as t,at as s,K as n,bD as i,bE as l,bF as o,bG as r,M as c,o as u,bH as m,bI as d,bJ as p,bK as v,bL as g,bM as y,bN as w,bO as f,bP as b,u as h,l as _,L as k,aL as D,aA as E,bQ as C,bR as S}from"./utils-lib.js?v=1756369731";import{j as T,r as x,s as j,e as q,H as I,G as L}from"./base-lib.js?v=1756369731";import{l as O,c as P}from"./validator.js?v=1756369731";import{B as R}from"./column.js?v=1756369731";import{o as A}from"./useController5.js?v=1756369731";const V=T("DOCKER-SITE-STORE",()=>{const v=x({}),{refreshSiteTable:g}=e(),y=x(""),w=x({}),f=x("all"),b=x([]);return{getDockerSiteList:async e=>{try{const{data:s}=await a(e);return{data:s.data,total:t(s.page)}}catch(n){s(n)}},pluginInfo:v,setDockerSiteStatus:async(e,a)=>{try{const t=(new Date).setHours(0,0,0,0);if("0000-00-00"!==e.edate&&new Date(e.edate).getTime()/1e3<t/1e3)return void c.error("项目已过期，请设置站点到期时间后再操作");await u({title:"提示",content:e.status?"启动站点【".concat(e.site_name,"】后，用户可以正常访问网站内容，是否继续操作？"):"停用站点【".concat(e.site_name,"】后，用户访问会显示当前网站停用后的提示页，是否继续操作？"),icon:"warning-filled"}),await n({loading:"正在".concat(e.status?"开启":"关闭","，请稍后..."),request:m(e),message:!0,success:e=>{g(),a&&a(e)}})}catch(t){s(t)}},setDockerSiteRemark:async(e,a)=>{try{await n({loading:"正在保存备注，请稍后...",request:d(e),message:!0,success:e=>{g(),a&&a(e)}})}catch(t){s(t)}},getEnvList:async e=>{try{const{data:a}=await r(e);return{data:a.data,total:t(a.page)}}catch(a){s(a)}},delDockerSite:async(e,a)=>{try{await u({title:"删除【".concat(e.name,"】项目"),content:"风险操作，此操作不可逆，删除【".concat(e.name,"】项目后您将无法管理该项目，是否继续操作？"),icon:"warning-filled",type:"check",check:{content:"同时删除网站根目录",onConfirm:async t=>{const s={id:e.id,site_name:e.name,remove_path:t?1:0};await n({loading:"正在删除，请稍后...",request:p(s),message:!0,success:e=>{g(),a&&a(e)}})}}})}catch(t){s(t)}},setSiteInfo:async(e,a)=>(e&&(w.value={...e}),y.value=("string"==typeof a?a:"")||"",w.value),siteInfo:w,settingTabActive:y,getClassList:async()=>{try{return await n({request:i(),success:({data:e})=>{b.value=[{label:"全部分类",value:"all"},...e.data.map(e=>({label:e.name,value:String(e.id)}))]}}),{data:b.value,status:!0}}catch(e){return{data:[],status:!1}}},setClass:async(e,a)=>{try{switch(a){case"add":return await n({loading:"正在新增分类，请稍后...",request:o({name:e.name}),message:!0});case"edit":return await n({loading:"正在编辑分类，请稍后...",request:o({name:e.name,id:e.id}),message:!0});case"del":return await n({loading:"正在删除分类，请稍后...",request:l({id:e.id}),message:!0})}}catch(t){}},classList:b,resetData:()=>{y.value="",w.value={},b.value=[]},statusFilterKey:f}}),W=()=>j(V()),N=T("DOCKER-SITE-ENV-STORE",()=>{const e=x("php"),a=x(!1),t=x(!1),i=x(!1),l=x(!1),o=e=>{switch(e){case"php":a.value=!0;break;case"java":t.value=!0;break;case"python":i.value=!0;break;case"go":l.value=!0}};return{tabActive:e,refreshEnvTable:a,refreshJavaEnvTable:t,refreshPythonEnvTable:i,refreshGoEnvTable:l,setTypeRefreshTable:o,delDockerEnv:async(e,a,t)=>{try{await u({title:"删除【".concat(e.name,"】环境"),content:"风险操作删除【".concat(e.name,"】环境，此操作不可逆，是否继续操作？"),icon:"warning-filled"}),await n({loading:"正在删除，请稍后...",request:v({id:e.id}),message:!0,success:e=>{o(a),t&&t(e)}})}catch(i){s(i)}},useBatchEventHandle:async(a,t,s,i,l)=>{await u({title:"删除环境",content:"风险操作删除选中的".concat(s.value.length,"个环境，此操作不可逆，是否继续操作？"),icon:"warning-filled"});const r={ids:s.value.map(e=>e.id).join(",")};await n({loading:"正在删除，请稍后...",request:g(r),message:!0,success:()=>{l(),o(e.value)}})},cleanCache:async(e,a)=>{try{await u({title:"清理构建缓存",content:"即将清理构建缓存，是否继续操作？",icon:"warning-filled"}),await n({loading:"正在清理，请稍后...",request:y(),message:!0,success:t=>{o(e),a&&a(t)}})}catch(t){s(t)}},refreshTemplate:async(e,a)=>{try{await n({loading:"正在刷新，请稍后...",request:f(),message:!0,success:t=>{o(e),a&&a(t)}})}catch(t){s(t)}},getVersion:async(e="all")=>{try{const a={runtime_type:e};return await n({loading:"正在获取版本，请稍后...",request:b(a),message:!1})}catch(a){s(a)}},setStatus:async(e,a,t,i)=>{try{await n({loading:"正在设置，请稍后...",request:w({runtime_status:e,compose_file:a.compose}),message:!0,success:e=>{o(t),i&&i(e)}})}catch(l){s(l)}},resetData:()=>{e.value="php",a.value=!1,t.value=!1,i.value=!1,l.value=!1}}}),F=()=>j(N()),{plugin:H}=h(),{refreshSiteTable:K}=e(),{pluginInfo:B}=j(V()),{setSiteInfo:J,getClassList:M,setClass:G}=V(),{resetData:z}=N(),Q={get:async()=>{const{data:e}=await M();return e},add:e=>G({...e},"add"),update:e=>{const{id:a,name:t}=e;return G({id:a,name:t},"edit")},delete:e=>{const{id:a}=e;return G({id:a},"del")}},$=e=>({label:"设置分类",value:"setClass",event:async(a,t,s,i,l)=>{await P({name:"分类",options:e.classList.value.filter(e=>"all"!==e.value&&"-2"!==e.value),selectList:s.value,request:async(e,a)=>{const t=s.value.map(e=>e.id);await n({loading:"正在批量设置分类，请稍后...",request:C({id:JSON.stringify(t),classify:e.id}),message:!0}),l(),K(),a()}})}}),U=e=>({label:"到期时间",isCustom:!0,render:e=>{const a=(new Date).setHours(0,0,0,0),t=Date.now(),s="0000-00-00"!==e.edate?new Date(e.edate).getTime():null,n=s&&s<a;return q("span",{class:"cursor-pointer "+(n?"bt-danger":s&&s-t<6048e5?"bt-warn":"bt-link"),onClick:()=>X(e)},[n?"已过期":"0000-00-00"===e.edate?"永久":e.edate])}}),X=(e,a=!1)=>{_({title:"【".concat(e.name,"】到期时间设置"),area:48,component:()=>k(()=>import("./index198.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{rowData:e,isMult:a},showFooter:!0})},Y=e=>({label:(null==e?void 0:e.label)||"网站名",prop:"name",minWidth:150,showOverflowTooltip:{show:!0,enterable:!1},render:a=>{var t;let s=null==(t=H.value)?void 0:t.web;const n="java"===(null==e?void 0:e.type)&&!(a.is_file_ok||void 0===a.is_file_ok);return q("div",{class:"flex items-center inline-block truncate"},[(null==a?void 0:a.waf)&&((null==a?void 0:a.isWaf)||void 0===(null==a?void 0:a.isWaf))?q("span",{class:"w-[1.6rem] mr-[4px] cursor-pointer flex items-center",onClick:()=>{e.openPlugin&&e.openPlugin(a,"iconWaf")}},[q("i",{class:"svgtofont-left-waf !text-[2rem] ".concat(a.waf.status&&"proxy"===(null==s?void 0:s.type)&&(null==s?void 0:s.status)&&(null==s?void 0:s.setup)?"text-primary":"text-[#999]")},null)]):"",q("span",{class:"!whitespace-pre-line inline-block w-[calc(100%-1.6rem)]",title:null==a?void 0:a.cn_name},[q("span",{onClick:()=>{n||e.onClick(a)},class:"justify-start cursor-pointer ".concat(n?"":"bt-link"," ")},[a.name])])])}}),Z=e=>({label:"状态",prop:"status",minWidth:70,isCustom:!0,sortable:!1,width:80,render:a=>{let t=null==a?void 0:a.run;return(null==e?void 0:e.prop)&&(t="1"===a[e.prop]),void 0===a[e.prop||"status"]?I(q("div",{class:"loading h-[2rem]"},null),[[L("bt-loading"),!0]]):q(R,{modelValue:t?1:0,data:["已停止","运行中"],onClick:()=>e.onClick(a)},null)}}),ee=e=>({label:"SSL证书",isCustom:!0,render:a=>{var t,s,n;return q("span",{class:"cursor-pointer ".concat(-1===a.ssl?"text-[#f0ad4e]":(null==(t=a.ssl)?void 0:t.endtime)<0?"text-danger":"text-[#20a53a]"),onClick:()=>{e.onClick(a)}},[-1===a.ssl?"未部署":(null==(s=a.ssl)?void 0:s.endtime)<0?"已过期":"剩余".concat(null==(n=a.ssl)?void 0:n.endtime,"天")])}}),ae=async(e,a,t,s,i)=>{await u({title:"删除项目",content:"风险操作，此操作不可逆，删除选中的".concat(t.value.length,"个项目后您将无法管理这些项目，是否继续操作？"),icon:"warning-filled",type:"check",check:{content:"同时删除网站根目录",onConfirm:async e=>{const a={site_list:JSON.stringify(t.value.map(e=>({site_name:e.name,id:e.id}))),remove_path:e?1:0};await n({loading:"正在删除，请稍后...",request:S(a),message:!0,success:()=>{i(),K()}})}}})},te=async()=>{try{const{data:e}=await D({name:"nginx"});return B.value=e,e}catch(e){return{}}},se=(e={readonly:!1,theme:"chrome"})=>({mode:"ace/mode/nginx",theme:"ace/theme/".concat(e.theme),wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:e.readonly,fontSize:"12px"}),ne=e=>new Promise((a,t)=>{_({title:"创建网站",area:70,btn:["确认","取消"],component:()=>k(()=>import("./index199.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:e||{}})}),ie=e=>new Promise((a,t)=>{_({title:"运行环境",area:120,component:()=>k(()=>import("./index200.js?v=1756369731").then(e=>e.I),__vite__mapDeps([]),import.meta.url),onCancel:()=>{z(),e&&e()}})}),le=(e,a)=>{_({title:(null==e?void 0:e.title)||"批量操作结果",area:42,component:()=>k(()=>import("./index118.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:e})},oe=(e="setDefaultPage")=>_({isAsync:!0,title:"常用设置",area:[96,62],component:()=>k(()=>import("./index201.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:e,showFooter:!1}),re=(e,a="")=>{J(e,a),_({title:"Docker项目管理【"+e.name+"】 -- 添加时间【"+e.addtime+"】",area:[84,70],component:()=>k(()=>import("./index202.js?v=1756369731").then(e=>e.$),__vite__mapDeps([]),import.meta.url)})},ce=async(e,a)=>{if("monitor-setting"===a&&(a="monitor"),"monitor"===a){if(!(await A(e,!1)))return;E("total_website",e.name)}const t="nginx"===H.value.web.type?"btwaf":"btwaf_httpd",s=(e=>{switch(e){case"monitor":return 47;case"bt_waf":return 48;case"iconWaf":return 49}})(a);"monitor"!==a&&(a=t),await O({source:s,name:a,callback:t=>{if(t&&"monitor"!==a){const a=setInterval(()=>{var s;const n=t.document.getElementsByClassName("layui-layer-page")[0];if(t.site_waf_config&&n){clearInterval(a),n&&(n.style.display="none"),t.site_waf_config(e.name);const i=t.document.getElementsByClassName("layui-layer-page")[1];i&&(null==(s=i.querySelector(".layui-layer-close"))||s.addEventListener("click",()=>{var e;null==(e=n.querySelector(".layui-layer-close"))||e.click()}))}},50)}}})};export{V as D,Z as a,U as b,ee as c,Q as d,ce as e,ne as f,te as g,oe as h,$ as i,ae as j,le as k,N as l,F as m,W as n,re as o,se as p,ie as s,Y as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
