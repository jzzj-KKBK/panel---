import{s as e,j as a,r as t,g as s,k as l,n as u,c as n,p as o,a4 as i,q as r,v as d,e as c,A as m,J as p,x as v,P as f,F as y,M as _,C as h,K as b,b6 as g,a9 as D,a7 as w}from"./base-lib.js?v=1756369731";import{_ as F}from"./validator.js?v=1756369731";import{R as k,K as V,$ as M,e as j}from"./utils-lib.js?v=1756369731";import{F as C,u as P,r as T,t as I}from"./useStore8.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const x=a("FTP_PWD_VALIDITY_PERIOD",()=>{const a=C(),{rowData:n}=e(a),o=t(),i=t(),r=t(!1),d=t();s(()=>n.value.id);const c=s(()=>n.value.end_time),m=l({disabledDate:e=>e.getTime()<Date.now(),shortcuts:[{text:"永久",value:()=>{(new Date).setTime(0),p.value=0,d.value=0,u(()=>{z()})}}]}),p=t(k(new Date,"yyyy-MM-dd")),v=t({status:"1",channel:[]}),f=s(()=>p.value===k(new Date,"yyyy-MM-dd")?"0"===c.value:0==Number(d.value)||p.value===k(new Date,"yyyy-MM-dd"));return{pickerRef:o,rowData:n,updateFtpInfo:i,ftpForm:v,isTime:f,pickerOptions:m,datePicker:p,isChange:r,selectValue:d}}),R=()=>e(x()),{rowData:q,isRefreshFtpList:S}=P(),{updateFtpInfo:Y,ftpForm:N,datePicker:O,isChange:U,selectValue:A}=R(),J=[{label:"仅发送通知",value:"1"},{label:"停用当前FTP账号",value:"2"},{label:"自动修改FTP密码并发送",value:"3"},{label:"不触发",value:"0"}],K={channel:[{required:!0,message:"请选择告警方式",trigger:"blur"}]},L=e=>{U.value=!0,A.value=e},z=()=>{const e=document.querySelector(".date .el-input__inner");e&&(e.value="永久")},B=async()=>{N.value.channel=N.value.channel.filter(e=>""!==e),await Y.value.validate();const e={id:JSON.stringify([q.value.id]),end_time:!U.value&&!Number(q.value.end_time)||0==A.value?0:new Date(O.value).getTime()/1e3,push_action:N.value.status,channel:N.value.channel.join(",")},a=await V({loading:"正在设置到期密码配置，请稍候...",request:T(e),data:{status:Boolean},message:!0});return S.value=!0,a.status},E=async()=>{await(async(e={id:q.value.id})=>{const a=await V({loading:"正在设置到期密码配置，请稍候...",request:I(e),data:{channel:String,push_action:String}});N.value.channel=""===a.channel?[]:a.channel.split(","),N.value.status=a.push_action})(),"0"===q.value.end_time?z():O.value=k(Number(q.value.end_time),"yyyy-MM-dd")},H=()=>{q.value={},N.value={status:"1",channel:[]}},W={class:"container-dialog"},$=j(n({__name:"index",setup(e,{expose:a}){const{updateFtpInfo:t,ftpForm:s,isTime:l,pickerOptions:u,datePicker:n,pickerRef:k}=R();return a({onConfirm:B}),o(E),i(H),(e,a)=>{const o=g,i=D,V=M,j=F,C=w;return r(),d("div",W,[c(C,{ref_key:"updateFtpInfo",ref:t,rules:v(K),model:v(s),class:p(v(l)?"btCustomForm":"btCustomForm bt-custom-form1"),style:b("0"==v(s).status||v(l)?"":"padding-left: 1rem")},{default:m(()=>[c(i,{label:"密码有效期",class:p(v(l)?"typeClass":"")},{default:m(()=>[c(o,{ref_key:"pickerRef",ref:k,modelValue:v(n),"onUpdate:modelValue":a[0]||(a[0]=e=>f(n)?n.value=e:null),type:"date",class:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD","disabled-date":v(u).disabledDate,shortcuts:v(u).shortcuts,onChange:v(L)},null,8,["modelValue","disabled-date","shortcuts","onChange"])]),_:1},8,["class"]),v(l)?h("",!0):(r(),d(y,{key:0},[c(i,{label:"到期动作"},{default:m(()=>[c(V,{modelValue:v(s).status,"onUpdate:modelValue":a[1]||(a[1]=e=>v(s).status=e),options:v(J),size:"small",style:{gap:"0.8rem"}},null,8,["modelValue","options"])]),_:1}),"0"!==v(s).status?(r(),_(i,{key:0,label:"告警方式",prop:"channel"},{default:m(()=>[c(j,{modelValue:v(s).channel,"onUpdate:modelValue":a[2]||(a[2]=e=>v(s).channel=e),class:"!w-[22rem]",limit:["wx_account","sms"]},null,8,["modelValue"])]),_:1})):h("",!0)],64))]),_:1},8,["rules","model","class","style"])])}}}),[["__scopeId","data-v-96f39ec2"]]);export{$ as default};
