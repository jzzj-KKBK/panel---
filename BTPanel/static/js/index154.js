import{u as a,b3 as e,a3 as t,fR as s,ah as l,c as n,ai as o,a5 as r,L as i,o as c,fS as u,b as p,e as m,cY as d,K as v,fT as f,aj as g,_ as x,d as h,fU as y,l as k,fV as w,a2 as b,cp as _}from"./utils-lib.js?v=1756369731";import{c as A,r as T,ay as j,p as I,G as L,H as B,x as C,q as E,v as S,y as R,e as O,A as Z,B as z,C as V,F as q,a_ as M,n as D,av as F,a$ as P,z as G,J,M as K,ar as Q,g as X,w as U,Z as H}from"./base-lib.js?v=1756369731";import{_ as N}from"./index104.js?v=1756369731";import{A as Y}from"./validator.js?v=1756369731";import{_ as W}from"./index103.js?v=1756369731";import{B as $}from"./index100.js?v=1756369731";import{_ as aa}from"./index116.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";const ea={class:"w-full h-full flex flex-col justify-center content-center"},ta={key:0,class:"h-full"},sa={class:"flex align-middle justify-center h-full"},la={key:1,class:"taskList pr-[10px] mb-[10px]"},na={key:0,class:"taskTips flex justify-between"},oa={class:"taskItemHeader"},ra={class:"taskItemName"},ia=["onClick"],ca={key:0,id:"taskRealTimeLogs",class:"taskRealTimeLog"},ua=m(A({__name:"task-list",setup(m,{expose:d}){const{panel:v}=a(),f=p(),g=T(!0),x=T(!0),h=T([]),y=T(""),k=T(!1),w=T(j("msgBoxSockShell",null)),b=[];let _=null;const A=async()=>{try{g.value=!0;const{data:a}=await e();if(t(a)&&void 0!==a.task){const{task:e,msg:t}=a;if(v.value.msgBoxTaskCount=e.length,e.length>0){x.value=!0,h.value=e;const{type:a,status:l}=e[0];"execshell"===a?"-1"===l?(K(),y.value="",y.value=t,D(()=>s("#taskRealTimeLogs")),k.value=!0):(setTimeout(()=>{A()},2e3),k.value=!0):k.value=!1}}else v.value.msgBoxTaskCount=0,x.value=!1}catch(a){}finally{g.value=!1}},K=async()=>{w.value||(w.value=l({route:"/sock_shell",onMessage:async(a,e)=>{const{data:t}=e;if(t.indexOf("|-Successify --- 命令已执行! ---")>-1)await A(),await Q(),setTimeout(async()=>{var a;await A(),k.value||(null==(a=w.value)||a.close(),w.value=null,y.value="")},2e3);else if(o(t)){if(b.push(t),(null==b?void 0:b.length)>50&&b.shift(),r(_))return;_=setTimeout(()=>{y.value=b.join(""),_=null},500)}}}),w.value.send("tail -n 100 -f /tmp/panelExec.log"))},Q=async()=>{const{useSoftStore:a}=await i(()=>import("./validator.js?v=1756369731").then(a=>a.aN),__vite__mapDeps([]),import.meta.url),{refreshRouteData:e}=a();e("1")};return d({init:A}),I(A),(a,e)=>{const t=F,s=n,l=P,o=N,r=L("scroll-bottom"),i=L("bt-loading");return B((E(),S("div",ea,[C(x)?(E(),S("div",la,[C(h).length>0?(E(),S("div",na,[e[3]||(e[3]=R("span",null," 提示：若任务长时间未执行，请尝试点击【重启面板】来重置任务队列 ",-1)),O(s,{onClick:C(Y)},{default:Z(()=>[...e[2]||(e[2]=[z("重启面板",-1)])]),_:1},8,["onClick"])])):V("",!0),O(l,{class:"!my-1rem"}),(E(!0),S(q,null,M(C(h),(a,e)=>(E(),S("div",{key:e,class:"taskItem"},["execshell"===a.type?(E(),S(q,{key:0},[R("div",oa,[R("span",ra,G(a.name),1),R("span",null,[R("span",{class:J({leaveOut:"-1"===a.status})},G("0"===a.status?"等待":"正在安装"),3),O(o),R("span",{class:"bt-link",onClick:e=>(async a=>{var e;let t=null;try{await c({icon:"warning-filled",title:"删除任务",content:"删除当前选中任务，删除后将取消任务执行，是否继续操作？"}),t=f.load("正在删除任务，请稍后...");const s=await u({id:a});f.request(s),s.status&&A(),null==(e=w.value)||e.close()}catch(s){}finally{t.close()}})(a.id)}," 删除 ",8,ia)])]),"-1"===a.status&&"execshell"===a.type?B((E(),S("pre",ca,[z(G(C(y)),1)])),[[r]]):V("",!0)],64)):V("",!0)]))),128))])):(E(),S("div",ta,[R("div",sa,[O(t,{class:"flex"},{image:Z(()=>[...e[0]||(e[0]=[R("i",{class:"!text-[#999] svgtofont-empty !text-7rem"},null,-1)])]),description:Z(()=>[...e[1]||(e[1]=[R("span",{class:"text-[16px] text-medium"},"当前没有任务执行",-1)])]),_:1})])]))])),[[i,C(g)]])}}}),[["__scopeId","data-v-2845c920"]]),pa={class:"mt-8px leading-8 text-[1.2rem] list-disc ml-20px"},ma={id:"wechat-customer",class:"wechat-customer"},da={class:"customer-title"},va={class:"flex border-solid border-b-1 border-[#20a53a] text-[#20a53a] justify-center items-center"},fa={class:"qrcode-wechat w-[128px] h-[128px] mt-[8px] mb-[4px]"},ga={id:"wechatCustomerQrcode"},xa=m(A({__name:"completed-list",setup(a,{expose:e}){const t=T([{label:"名称",prop:"name",showOverflowTooltip:!0,render:a=>O("div",null,[O("span",{class:"mr-2 font-bold !text-[12px] ".concat(a.install_status?"text-primary svgtofont-el-check":"text-danger svgtofont-el-close")},null),a.name])},{label:"创建时间",prop:"addtime",width:110,render:a=>O("span",null,[a.addtime.replace(/^\d{4}-/,"")])},{label:"任务耗时",width:80,render:a=>O("span",null,[y(a.end-a.start)])},{label:"安装详情",width:140,showOverflowTooltip:!0,render:a=>O("span",{class:a.install_status?"text-primary":"text-danger"},[a.msg||"安装成功"])},{label:"操作",align:"right",width:55,render:a=>null!==a.msg_info?O("span",{class:"text-primary cursor-pointer",onClick:()=>s(a)},[z("详情")]):""}]),s=a=>k({title:"当前状态：".concat(a.msg_info.title),area:[72,50],compData:a.msg_info,component:()=>i(()=>import("./details.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)}),{BtTable:l,BtPage:o,refresh:r}=d({request:async a=>{try{const{data:e,page:t}=await v({request:f({table:"tasks",search:"1",limit:10,p:a.p}),data:{page:String,data:Array}});return{data:e,total:g(t),other:{}}}catch(e){return{data:[],total:0,other:{}}}},columns:t.value});return e({init:r}),(a,e)=>{const t=x,s=n,r=h,i=$,c=W;return E(),K(c,null,{content:Z(()=>[O(C(l)),R("ul",pa,[R("li",null,[e[4]||(e[4]=z(" 如安装或启动失败，请点击详情，截图相关错误信息 ",-1)),O(i,{placement:"bottom-start",effect:"light","popper-class":"!p-0",trigger:"hover",width:"160px"},{reference:Z(()=>[...e[3]||(e[3]=[R("span",{class:"inline-block bt-link"},"咨询客服",-1)])]),default:Z(()=>[R("div",ma,[R("div",da,[O(s,{target:"_blank",href:"https://www.bt.cn/new/wechat_customer",class:"text-[16px] cursor-pointer flex flex-row items-center flex-nowrap"},{default:Z(()=>[R("div",va,[e[0]||(e[0]=z(" 点击咨询客服 ",-1)),O(t,{icon:"arrow",size:16,color:"#20a53a",class:"ml-[5px]"})])]),_:1})]),R("div",fa,[R("div",ga,[O(r,{src:"/customer/customer-qrcode.png"})])]),e[1]||(e[1]=R("div",{class:"wechat-title flex"},[R("img",{class:"w-[14px] h-[14px]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAATlJREFUSEvtVrFOw0AMfed8AxJsZWGAgQHBXP4DCQa+Ioou7g18BRIg9T/KDGJggIGFbiDxDXGQowSBuGvrFISEmtF+7/nis312RVEMiWgIoMT375aIjpj5KeJrTMy8JSJjAPsRzEhErl1Zlhd1XZ8kRKZEdMjM0xlBBiIyATCIYZxzl857X6uTiHaY+TElZrUz87aIPCjvI0gIwVmF5uG7H1gFmZepxv85XTdqCCEcLMQ0gLz3jbbTOm/rPdkLBt0v0E77xysq2it9T2nhuTzPN4ho10KyYEXkXvvkBcC6hWjEvmqQMwCnANZa8p1RJAbfa41vAM7/0cUzczOiZ43zvunrtPVOntuO3+wrluJ12qspvFBm/+bR+u03nhPrkKZk2ZVINUZO964sy44Ta9FSK5GuQ1VVXb0DLf+sHQ9tLL0AAAAASUVORK5CYII="}),R("div",{class:"text-[14px] font-black"},"扫一扫")],-1)),e[2]||(e[2]=R("span",{class:"layui-layer-setwin wechat-close",style:{display:"block"}},[R("a",{href:"javascript:;",class:"layui-layer-ico layui-layer-close layui-layer-close2"})],-1))])]),_:1}),e[5]||(e[5]=z(" 求助 ",-1))])])]),"footer-right":Z(()=>[O(C(o),{"pager-count":5,layout:"prev, pager, next, total, jumper"})]),_:1})}}}),[["__scopeId","data-v-e78a2174"]]),ha=A({__name:"perform-log",setup(a,{expose:e}){const t=T(!1),s=T("获取中..."),l=async()=>{try{const a=await v({loading:t,request:w(),data:String});s.value=a.trim()||"暂无执行日志"}catch(a){}};return e({init:l}),I(l),(a,e)=>{const l=aa,n=L("bt-loading");return B((E(),K(l,{class:"h-50rem",content:C(s)},null,8,["content"])),[[n,C(t)]])}}});var ya=function(a){return a.taskList="taskList",a.completedList="completedList",a.performLog="performLog",a}(ya||{});const ka=A({__name:"index",setup(e,{expose:t}){const{panel:s}=a(),l=Q(s.value,"msgBoxTaskCount"),n=T(0),o=T(null),r=X(()=>"任务列表(".concat(l.value,")")),i=X(()=>"消息列表(".concat(n.value,")"));U(l,(a,e)=>{e>a&&(n.value+=e-a)});const{BtTabs:c}=b({type:"left-bg-card",options:[{label:()=>O(q,null,[r.value]),name:ya.taskList,lazy:!0,render:ua},{label:()=>O(q,null,[i.value]),name:"completedList",lazy:!0,render:xa},{label:"执行日志",name:"performLog",lazy:!0,render:ha}]});return I(async()=>{try{const{page:a}=await v({request:_({table:"tasks",search:"1",limit:11}),data:{page:String}});n.value=g(a)}catch(a){}}),H("msgBoxSockShell",o),t({onCancel:()=>{o.value&&(o.value.close(),o.value=null)}}),(a,e)=>(E(),K(C(c)))}});export{ka as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
