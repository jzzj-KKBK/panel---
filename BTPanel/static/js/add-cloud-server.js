import{c as e,r as a,p as l,G as s,q as r,v as o,e as t,A as d,H as u,x as p,M as m,C as n,Q as i,y as b,z as _,F as c,a_ as v,S as g,a9 as f,a7 as w}from"./base-lib.js?v=1756369731";import{fi as h,j4 as y,j as V,K as q}from"./utils-lib.js?v=1756369731";import{addServer as j,addModulesServer as x,modifyServer as D,modifyModulesServer as k}from"./database.js?v=1756369731";import{g as S}from"./useStore2.js?v=1756369731";import{q as U}from"./useMethod4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./validator.js?v=1756369731";const E={class:"p-[24px]"},A={class:"ml-20px mt-12px leading-8 text-[1.2rem] list-disc"},C={key:0},F={key:1},H=e({__name:"add-cloud-server",props:{compData:{default:()=>({row:{},refreshEvent:()=>{}})}},setup(e,{expose:H}){const{refs:{tabActive:J}}=S(),M=e,N=a(),O=a(!0),z={mysql:{port:3306,db_user:"root"},mongodb:{port:27017,db_user:"root"},sqlserver:{port:1433,db_user:"sa"},pgsql:{port:5432,db_user:"postgres"},redis:{port:6379,db_user:""}},G=a({db_host:"",db_port:z[J.value].port,db_user:z[J.value].db_user,db_password:"",ps:"",type:J.value}),I=[{content:"支持阿里云、腾讯云等云厂商的云数据库"},{content:"注意1：请确保本服务器有访问数据库的权限"},{content:"注意2：请确保填写的管理员帐号具备足够的权限"}],K={db_host:[{required:!0,message:"请输入服务器地址",trigger:["blur","change"]},{validator:(e,a,l)=>{(h(a)||y(a))&&""!==a||l(new Error("请输入正确的服务器地址")),l()},trigger:["blur","change"]}],db_password:[{required:!0,message:"请输入服务器密码",trigger:["blur","change"]}],db_user:[{required:!0,message:"请输入管理员名称",trigger:["blur","change"]}],db_port:[{required:!0,message:"请输入服务器端口",trigger:["blur","change"]}]},Q=e=>{if(O.value&&M.compData.row)return O.value=!1;O.value=!1,G.value.ps=e};return l(()=>{var e;(null==(e=M.compData.row)?void 0:e.db_host)&&(G.value={...M.compData.row,type:J.value})}),H({onConfirm:async e=>{var a;(null==(a=M.compData.row)?void 0:a.db_host)?await(async()=>{await N.value.validate();let e={...G.value,db_ps:G.value.ps};"mysql"!==J.value&&(e.type=J.value),await q({loading:"正在修改远程服务器信息，请稍候...",request:"mysql"===J.value?D(e):k({data:JSON.stringify(e)},J.value),message:!0})})():await(async()=>{await N.value.validate();let e={...G.value,db_ps:G.value.ps};await q({loading:"正在添加远程服务器信息，请稍候...",request:"mysql"===J.value?j(e):x({data:JSON.stringify(e)},J.value),message:!0})})(),M.compData.refreshEvent(),e()}}),(e,a)=>{var l,h;const y=g,q=f,j=V,x=w,D=s("focus");return r(),o("div",E,[t(x,{model:p(G),rules:K,ref_key:"cloudForm",ref:N,onSubmit:a[5]||(a[5]=i(()=>{},["prevent"]))},{default:d(()=>[t(q,{label:"服务器地址",prop:"db_host"},{default:d(()=>[u(t(y,{class:"!w-[24rem]",placeholder:"请输入服务器地址",modelValue:p(G).db_host,"onUpdate:modelValue":a[0]||(a[0]=e=>p(G).db_host=e),onInput:Q},null,8,["modelValue"]),[[D]])]),_:1}),t(q,{label:"数据库端口",prop:"db_port"},{default:d(()=>[t(j,{type:"number",class:"!w-[24rem]",modelValue:p(G).db_port,"onUpdate:modelValue":a[1]||(a[1]=e=>p(G).db_port=e)},null,8,["modelValue"])]),_:1}),"redis"!=p(J)?(r(),m(q,{key:0,label:"管理员名称",prop:"db_user"},{default:d(()=>[t(j,{modelValue:p(G).db_user,"onUpdate:modelValue":a[2]||(a[2]=e=>p(G).db_user=e),placeholder:"请输入管理员名称",class:"!w-[24rem]"},null,8,["modelValue"])]),_:1})):n("",!0),t(q,{label:"管理员密码",prop:"db_password"},{default:d(()=>[t(j,{modelValue:p(G).db_password,"onUpdate:modelValue":a[3]||(a[3]=e=>p(G).db_password=e),placeholder:"请输入管理员密码",class:"!w-[24rem]"},null,8,["modelValue"])]),_:1}),t(q,{label:"备注"},{default:d(()=>[t(j,{modelValue:p(G).ps,"onUpdate:modelValue":a[4]||(a[4]=e=>p(G).ps=e),placeholder:"服务器备注",class:"!w-[24rem]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),b("ul",A,[(null==(l=p(U))?void 0:l.length)&&p(U)[0]?(r(),o("li",C,_(p(U)[0]),1)):n("",!0),(r(),o(c,null,v(I,(e,a)=>b("li",{key:a},_(e.content),1)),64)),(null==(h=p(U))?void 0:h.length)&&p(U)[1]?(r(),o("li",F,_(p(U)[1]),1)):n("",!0)])])}}});export{H as default};
