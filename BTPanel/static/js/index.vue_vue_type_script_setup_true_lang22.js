import{G as e,bV as l,aa as a,c as t,fg as o,j as r,ag as s,W as n,b as p}from"./utils-lib.js?v=1756369731";import{c as d,r as u,g as i,p as c,q as m,M as _,A as f,e as v,x as w,y as j,B as b,C as g,P as h,H as V,I as x,a9 as y,aQ as k,T as U,ag as P,af as I,ax as C,D as O}from"./base-lib.js?v=1756369731";import{_ as A}from"./index101.js?v=1756369731";import{advanceCheckPort as q}from"./site.js?v=1756369731";import{f as B}from"./validator.js?v=1756369731";import{u as S,S as z}from"./useStore4.js?v=1756369731";import{a as F}from"./index71.js?v=1756369731";const G={class:"flex items-center"},H={class:"flex items-center"},J=d({__name:"index",setup(d,{expose:J}){const M=p(),{siteInfo:D}=S(),{getRootUser:E,getProjectConfig:N}=z(),Q=u(!!D.value),R=u([]),T=u(!1),W=u(0),K=u({project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1,env:"",envPath:""}),L=[{content:"执行命令：请输入项目需要携带的参数，默认请输入执行文件名"},{content:()=>v("span",null,[b("项目教程可参考:"),v(t,{target:"_blank",href:"https://www.bt.cn/bbs/thread-93034-1-1.html"},{default:()=>[b("https://www.bt.cn/bbs/thread-93034-1-1.html")]})])}],X=()=>{B({type:"file",path:K.value.project_exe,change:e=>{var l;K.value.project_exe=e,K.value.project_cmd=null==e?void 0:e.replace(/\/\//g,"/");let a=null==(l=e.substring(e.lastIndexOf("/")+1))?void 0:l.replace(/\./g,"_");Q.value||(K.value.project_name=a),K.value.project_ps=a.replace(/\./g,"_")}})},Y=e=>{K.value.project_ps=e},Z=async()=>{if(K.value.port)try{const e=await q({port:K.value.port},"go");e.status||(M.request(e),K.value.port="")}catch(e){}},$=()=>{B({type:"file",path:K.value.envPath,change:e=>{K.value.envPath=e}})},{BtForm:ee,submit:le}=e({data:K.value,options:e=>i(()=>[{type:"slots",key:"custom",rules:{project_exe:[l({message:"请选择项目可执行文件"})],project_name:[l({message:"请输入项目名称"})],port:[l({message:"请输入端口号",trigger:["change"]}),a()],project_cmd:[l({message:"请输入项目执行命令"})]}}]),submit:async(e,l)=>await F(e,l,W.value)});return c(async()=>{const e=await E();if(R.value=e.data.map(e=>({label:e,value:e})),Object.assign(K.value,{project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1,env:"",envPath:""}),Q.value){const{data:e}=await N({data:JSON.stringify({project_name:D.value.name})}),{env_list:l,env_file:a}=e.project_config;a&&(W.value=2),(null==l?void 0:l.length)>0&&(W.value=1),Object.assign(K.value,{...null==e?void 0:e.project_config,project_ps:o(null==e?void 0:e.ps),is_power_on:!!(null==e?void 0:e.project_config.is_power_on),not_install_pkg:!!(null==e?void 0:e.project_config.not_install_pkg),envPath:a||"",env:(null==l?void 0:l.length)&&Array.isArray(l)?l.map(e=>e.k+"="+e.v).join("\n"):""})}}),J({onConfirm:le}),(e,l)=>{const a=A,t=y,o=r,p=k,d=U,u=P,i=I,c=s,q=C,B=O,S=n;return m(),_(w(ee),{"label-width":"100px",class:"p-[20px]"},{custom:f(()=>[v(t,{label:"项目执行文件",prop:"project_exe"},{default:f(()=>[v(a,{modelValue:w(K).project_exe,"onUpdate:modelValue":l[0]||(l[0]=e=>w(K).project_exe=e),icon:"el-folder-opened",placeholder:"请选择项目可执行文件",onIconClick:X,width:"32rem"},null,8,["modelValue"])]),_:1}),v(t,{label:"项目名称",prop:"project_name"},{default:f(()=>[v(o,{onInput:Y,width:"32rem",disabled:w(Q),modelValue:w(K).project_name,"onUpdate:modelValue":l[1]||(l[1]=e=>w(K).project_name=e),placeholder:"请输入GO项目名称"},null,8,["disabled","modelValue"])]),_:1}),v(t,{label:"项目端口",prop:"port"},{default:f(()=>[j("div",G,[v(o,{width:"20rem",type:"number",onBlur:Z,class:"mr-[12px]",modelValue:w(K).port,"onUpdate:modelValue":l[2]||(l[2]=e=>w(K).port=e),placeholder:"请输入项目的真实端口"},null,8,["modelValue"]),w(Q)?g("",!0):(m(),_(d,{key:0,modelValue:w(K).release_firewall,"onUpdate:modelValue":l[3]||(l[3]=e=>w(K).release_firewall=e)},{default:f(()=>[l[15]||(l[15]=b(" 放行端口 ",-1)),v(p,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:f(()=>[...l[14]||(l[14]=[j("i",{class:"svgtofont-el-question-filled text-warning"},null,-1)])]),_:1})]),_:1},8,["modelValue"]))])]),_:1}),v(t,{label:"执行命令",prop:"project_cmd"},{default:f(()=>[v(o,{modelValue:w(K).project_cmd,"onUpdate:modelValue":l[4]||(l[4]=e=>w(K).project_cmd=e),placeholder:"请输入项目的执行命令",width:"32rem"},null,8,["modelValue"])]),_:1}),v(t,{label:"环境变量",class:"mt-[1.6rem]"},{default:f(()=>[v(i,{modelValue:w(W),"onUpdate:modelValue":l[5]||(l[5]=e=>h(W)?W.value=e:null)},{default:f(()=>[v(u,{label:0},{default:f(()=>[...l[16]||(l[16]=[b("无",-1)])]),_:1}),v(u,{label:1},{default:f(()=>[...l[17]||(l[17]=[b("指定变量",-1)])]),_:1}),v(u,{label:2},{default:f(()=>[...l[18]||(l[18]=[b("从文件加载",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),V(v(t,{label:" "},{default:f(()=>[V(v(o,{width:"40rem",type:"textarea",rows:3,resize:"none",modelValue:w(K).env,"onUpdate:modelValue":l[6]||(l[6]=e=>w(K).env=e),placeholder:"环境变量，1行1个，例如： JAVA_HOME=/usr/local/btjdk/jdk8"},null,8,["modelValue"]),[[x,1===w(W)]]),V(v(a,{modelValue:w(K).envPath,"onUpdate:modelValue":l[7]||(l[7]=e=>w(K).envPath=e),icon:"el-folder-opened",placeholder:"请选择环境变量文件",onIconClick:$,width:"32rem"},null,8,["modelValue"]),[[x,2===w(W)]])]),_:1},512),[[x,0!==w(W)]]),v(t,{label:"运行用户"},{default:f(()=>[j("div",H,[v(c,{modelValue:w(K).run_user,"onUpdate:modelValue":l[8]||(l[8]=e=>w(K).run_user=e),options:w(R),class:"mr-[8px] !w-[16rem]"},null,8,["modelValue","options"]),l[19]||(l[19]=j("span",{class:"text-[1.2rem] text-[#666]"},"* 无特殊需求请选择www用户",-1))])]),_:1}),v(t,{label:"开机启动"},{default:f(()=>[v(d,{modelValue:w(K).is_power_on,"onUpdate:modelValue":l[9]||(l[9]=e=>w(K).is_power_on=e)},{default:f(()=>[...l[20]||(l[20]=[b("是否设置开机自动启动（默认自带守护进程每120秒检测一次）",-1)])]),_:1},8,["modelValue"])]),_:1}),v(t,{label:"项目备注"},{default:f(()=>[v(o,{width:"32rem",modelValue:w(K).project_ps,"onUpdate:modelValue":l[10]||(l[10]=e=>w(K).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])]),_:1}),w(Q)?g("",!0):(m(),_(t,{key:0,label:"绑定域名"},{default:f(()=>[v(q,{placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:w(T),"onUpdate:visible":l[13]||(l[13]=e=>h(T)?T.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:f(()=>[v(o,{rows:4,resize:"none",width:"40rem",modelValue:w(K).domains,"onUpdate:modelValue":l[11]||(l[11]=e=>w(K).domains=e),type:"textarea",onFocus:l[12]||(l[12]=e=>T.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),default:f(()=>[l[21]||(l[21]=j("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[b(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),j("br"),b(" IP地址格式：192.168.1.199"),j("br"),b(" 泛解析添加方法 *.domain.com"),j("br"),b(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1})),w(Q)?(m(),_(t,{key:1,label:" "},{default:f(()=>[v(B,{type:"primary",onClick:w(le)},{default:f(()=>[...l[22]||(l[22]=[b("保存配置",-1)])]),_:1},8,["onClick"])]),_:1})):(m(),_(t,{key:2,label:""},{default:f(()=>[v(S,{options:L})]),_:1}))]),_:1})}}});export{J as _};
