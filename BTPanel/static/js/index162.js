import{g5 as e,b as l,e as a,u as t,g6 as s,R as i,g7 as u,_ as r,j as n,J as o,k as c,H as p}from"./utils-lib.js?v=1756369731";import{c as v,r as d,G as m,q as f,v as h,y,H as b,e as x,x as w,P as g,O as k,A as _,B as C,J as D,S as I,D as R,U as V,g as S,a0 as j,z as F,F as H,a_ as P,C as T}from"./base-lib.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const A={class:"create-file-view flex"},B={class:"flex-1 flex items-center"},E=a(v({__name:"create-file",props:{type:{default:"Dir"},path:{},filelist:{}},emits:["createStatus"],setup(a,{emit:t}){const{error:s}=l(),i=t,u=a;let r=d("");const n=d(),o=async()=>{const l=n.value;if(!r.value)return void s("".concat("Dir"===u.type?"文件夹":"文件","名称不能为空"));const a=await e({type:u.type,path:u.path+"/"+r.value});a.status?c():(s(a.msg),l.$el.querySelector("input").focus())},c=()=>{u.filelist.value.shift(),i("createStatus")},p=e=>{r.value=e,/(\\|\/|\<|\>|\"|\&|\;)/g.test(e)&&(s('名称不能含有 /\\<>"&;符号'),r.value=e.replace(/(\\|\/|\<|\>|\"|\&|\;)/g,""))};return(e,l)=>{const a=I,t=R,s=m("focus");return f(),h("div",A,[y("div",{class:D(["flex","".concat("Dir"===e.type?"bt-open-dir folder-open-icon":"bt-open-dir file-text-icon")])},[l[4]||(l[4]=y("i",{class:"icon"},null,-1)),y("div",B,[b(x(a,{class:"!w-[22rem] mr-[1.6rem]",clearable:"",modelValue:w(r),"onUpdate:modelValue":l[0]||(l[0]=e=>g(r)?r.value=e:r=e),ref_key:"createfile",ref:n,onInput:p,onKeyup:l[1]||(l[1]=k(e=>e.target.blur(),["enter","native"]))},null,8,["modelValue"]),[[s]]),x(t,{type:"primary",class:"!mr-[.8rem]",onClick:o},{default:_(()=>[...l[2]||(l[2]=[C(" 创建 ",-1)])]),_:1}),x(t,{type:"default",onClick:c},{default:_(()=>[...l[3]||(l[3]=[C("取消",-1)])]),_:1})])],2)])}}}),[["__scopeId","data-v-c17175a3"]]),U={class:"text-black text-1.4rem pl-[1.6rem] pt-[1.6rem]"},q={class:"p-[1.6rem] flex justify-between"},z={class:"file-selector-head"},K=["onClick"],O={class:"truncate max-w-[8rem]"},J={class:"ml-[0.4rem] flex items-align"},M={class:"ml-[1.6rem] mb-[1.6rem]"},$={class:"flex h-[48rem] file-selector-main"},G={class:"w-[16rem] h-full pt-[1.2rem] text-xl inline-block overflow-auto disk-list"},L={class:"flex items-center flex-col"},N=["onClick"],Q=["title"],W={class:"h-full w-full inline-block flex w-[59rem]"},X={class:"flex justify-between bg-[#f6f8f8] p-[1.2rem] pr-[1.6rem] rounded-md"},Y={class:"ml-[9.6rem]"},Z={key:0,class:"flex align-middle items-center"},ee={class:"bg-white rounded-[.8rem] px-4 h-12 leading-[2.8rem] w-[30rem] inline-block border-light border-1 border-opacity-20 truncate"},le={class:"flex"},ae=a(v({__name:"index",props:{compData:{default:()=>({type:"all",path:"/www/wwwroot",change:()=>{},confirmText:"确认"})}},emits:["close"],setup(e,{expose:a,emit:v}){const D=v,I=e,{type:A,path:B,change:ae}=I.compData,{error:te,request:se}=l(),{panel:ie}=t(),ue=d(),re=d(),ne=d(0),oe=d(0),ce=d(""),pe=d(),ve=d(A),de=d(!1),me=d(!0),fe=d(!1),he=d(B||ie.value.sitePath),ye=d(B||ie.value.sitePath),be=V([]),xe=V([]),we=d([]),ge=d(""),ke=d(),_e=d(),Ce=S(()=>"file"===ve.value?"文件":"dir"===ve.value?"文件夹":"文件/文件夹");j(re,e=>{const l=e[0],{width:a}=l.contentRect;ne.value=a}),j(ue,e=>{const l=e[0],{width:a}=l.contentRect;oe.value=a,oe.value>ne.value&&(xe.value=be.value.slice(-4))});const De=d([{label:"名称",prop:"name",showOverflowTooltip:!1,render:e=>e.create&&He?x(E,{type:e.type,path:he.value,filelist:_e,onCreateStatus:()=>{Te()}},null):x("span",{class:"bt-open-dir"},[x("i",{class:"svgtofont"+("dir"===e.type?"-icon-file_mode":"-file-text")},null),x("span",{onClick:l=>{"dir"===e.type&&qe(e,l)}},[e.name])])},{label:"修改时间",width:160,prop:"mtime"},{label:"权限/所有者",width:125,prop:"accept"}]),Ie=({row:e,column:l,rowIndex:a,columnIndex:t})=>{if(0===a&&e.create&&He)return[1,3]},Re=()=>{1!==be.value.length&&(he.value=be.value[be.value.length-2].path,Ae())},Ve=()=>{me.value=!1,ye.value=he.value},Se=()=>{me.value=!0,setTimeout(()=>{ye.value=he.value},1500)},je=e=>{he.value=ye.value,Ae(),e.preventDefault(),e.target.blur()},Fe=e=>{e||(e=""),ge.value=e,Ae(!0)};let He=d(!1);const Pe=e=>{var l;if(He.value)return!1;He.value=!0,null==(l=_e.value)||l.unshift({title:"",name:"",mtime:"",accept:"",type:e,path:"",create:!0})},Te=()=>{He.value=!1,Ae()},Ae=async e=>{de.value=!0;try{const l=await s({path:he.value,disk:!0,search:e?ge.value:""});if(ke.value&&(ke.value.path=he.value,ke.value.title=he.value.split("/")[he.value.split("/").length-1]),!l.status)return ke.value=void 0,se(l),!1;const{DIR:a,FILES:t,DISK:i,PATH:u}=l.data;Be(u),we.value=i,_e.value=[...Ee(a,"dir"),...Ee(t)],ze()}catch(l){}finally{de.value=!1}},Be=e=>{let l="";const a=e.replace(/\/*$/,"");if(he.value=a,ye.value=a,be.value=[],""===a)return be.value.push({title:"根目录",path:"/"}),void(xe.value=be.value);a.split("/").forEach((e,a)=>{l+="".concat(1===a?"":"/").concat(e),be.value.push({title:""===e&&0==a?"根目录":e,path:l})}),xe.value=be.value},Ee=(e,l)=>{let a=[];return e.forEach(e=>{const t=e.split(";");let s=t[0];s.length>30&&(s=s.slice(0,30)+"..."),/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(s)&&(s=s.slice(0,16)+"..."),a.push({title:t[0],name:s,mtime:i(1e3*Number(t[2]),"yyyy/MM/dd HH:mm:ss"),accept:"".concat(t[3]," / ").concat(t[4]),type:l||"file",path:he.value+"/"+t[0]})}),a},Ue=e=>{if(e&&!e.create){if("all"==ve.value)ke.value=e;else{if("dir"!==e.type&&"dir"===ve.value)return void te("请选择文件夹，否则将无法选择");if("file"!==e.type&&"file"===ve.value)return;if(ve.value!==e.type)return ke.value=void 0,void u(pe.value).setCurrentRow();null!==e&&(ke.value=e)}fe.value=!0}},qe=(e,l)=>{"dir"!==e.type||e.create||("file"===ve.value&&(fe.value=!1),he.value=e.path,Ae(),l.stopPropagation&&l.stopPropagation())},ze=()=>{"file"==pe.value.type&&(ke.value=void 0,fe.value=!1),He.value=!1};return a({onOpen:()=>(async()=>{await Ae(),"file"!==ve.value&&(ke.value=be.value[be.value.length-1],fe.value=!0)})()}),(e,l)=>{var a;const t=r,s=n,i=o,u=R,v=c,d=p,I=m("bt-loading");return f(),h("section",null,[y("div",U,"选择"+F(w(Ce)),1),y("div",q,[y("div",z,[y("i",{title:"返回上一层",class:"bt-open-icon inline-block !rounded-tl-[.8rem] !rounded-bl-[.8rem]",onClick:Re},[x(t,{icon:"el-back",class:"leading-[2rem]"})]),y("div",{ref_key:"pathInputRef",ref:re,class:"file-selector-input overflow-hidden"},[w(me)?(f(),h("ul",{key:0,ref_key:"pathRef",ref:ue,class:"absolute h-[30px] z-1 flex rounded-none bg-white"},[(f(!0),h(H,null,P(w(xe),(e,l)=>(f(),h("li",{key:l,class:"flex items-center px-[1rem] h-[30px]",onClick:l=>{return a=e.path,void(he.value!==a&&(he.value=a,ye.value=a,Ae()));var a}},[y("span",O,F(e.title),1),y("i",J,[x(t,{icon:"el-arrow-right"})])],8,K))),128))],512)):T("",!0),x(s,{class:"!w-[400px]",onFocus:Ve,onBlur:Se,onKeyup:k(je,["enter"]),modelValue:w(ye),"onUpdate:modelValue":l[0]||(l[0]=e=>g(ye)?ye.value=e:null)},null,8,["modelValue"])],512),y("i",{title:"刷新",class:"bt-open-icon inline-block !rounded-tr-[.8rem] !rounded-br-[.8rem]",onClick:l[1]||(l[1]=e=>Ae())},[x(t,{icon:"el-refresh-right",class:"leading-[2rem]"})])]),x(i,{modelValue:w(ge),"onUpdate:modelValue":l[2]||(l[2]=e=>g(ge)?ge.value=e:null),placeholder:"搜索文件/目录",class:"!w-[220px]",onSearch:Fe},null,8,["modelValue"])]),y("div",M,[x(u,{type:"default",onClick:l[3]||(l[3]=e=>Pe("File"))},{default:_(()=>[...l[7]||(l[7]=[C("新建文件",-1)])]),_:1}),x(u,{type:"default",onClick:l[4]||(l[4]=e=>Pe("Dir"))},{default:_(()=>[...l[8]||(l[8]=[C("新建文件夹",-1)])]),_:1})]),y("div",$,[y("div",G,[y("ul",L,[(f(!0),h(H,null,P(w(we),(e,a)=>(f(),h("li",{class:"flex p-[0.8rem] pl-[1.6rem] items-center w-full",key:a,onClick:l=>{return a=e.path,he.value=a,void Ae();var a}},[l[9]||(l[9]=y("i",{class:"file-disk-icon mr-[0.8rem] text-[14px]"},null,-1)),y("span",{class:"w-full truncate",title:"/"===e.path?"".concat("根目录"):e.path},F("/"===e.path?"根目录":e.path)+" ("+F(e.size[2])+") ",9,Q)],8,N))),128))])]),y("div",W,[b(x(v,{ref_key:"tableRef",ref:pe,class:"file-selector-table",column:w(De),data:w(_e),"span-method":Ie,"highlight-current-row":"",border:!1,onCurrentChange:Ue,onRowDblclick:qe,"empty-text":"(空)","max-height":"480"},null,8,["column","data"]),[[I,w(de)],[I,"正在加载文件列表，请稍后...","title"]])])]),y("div",X,[y("div",Y,[w(fe)?(f(),h("div",Z,[y("span",null,"当前选中"+F(w(Ce))+"：",1),y("span",ee,F(null==(a=w(ke))?void 0:a.title),1)])):T("",!0)]),y("span",le,[x(d,{type:"default",class:"BtButton--cancel",onClick:l[5]||(l[5]=e=>D("close"))},{default:_(()=>[...l[10]||(l[10]=[C(" 取消 ",-1)])]),_:1}),x(d,{type:"primary",disabled:!w(fe),onClick:l[6]||(l[6]=e=>(ae&&ae(ke.value.path,ke.value.type),ce.value=ke.value.path,void D("close")))},{default:_(()=>[C(F(e.compData.confirmText||"确认"),1)]),_:1},8,["disabled"])])])])}}}),[["__scopeId","data-v-e7eca6d4"]]);export{ae as default};
