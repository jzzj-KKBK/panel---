import{c as e,r as a,k as t,p as s,n as r,q as o,v as d,e as l,A as i,y as m,x as u,B as p,C as c,D as n,a9 as f,a7 as _}from"./base-lib.js?v=1756369731";import{B as j}from"./index398.js?v=1756369731";import{b as y,e as v}from"./utils-lib.js?v=1756369731";import{h as x,i as D}from"./validator.js?v=1756369731";import{batchPhpEdate as b,setModulesEtimeMultiple as g,setEdate as h}from"./site.js?v=1756369731";import{o as q}from"./useController6.js?v=1756369731";import{u as w}from"./useStore4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const C={class:"p-2rem"},k={class:"flex items-center"},Y={key:0,class:"text-[#888] mt-[8px] ml-10rem"},A=v(e({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:v,emit:A}){const T=y(),V=e,{rowData:B,siteType:H}=V.compData,M=!!Array.isArray(B),{isRefreshList:P}=w(),R=A,S=a(),I=t({edate:B.edate||""}),L={edate:[{required:!0,message:"请选择到期时间",trigger:"blur"}]},U=e=>e.getTime()<Date.now()-864e5,z=()=>{I.edate="",E(),G()},E=()=>{const e=document.querySelector(".date .el-input__inner");e&&(e.value="永久")},F=e=>{},G=async e=>{try{if(M){const{enable:e,exclude:a}=V.compData.config,t=x(B,a,e,{params:{edate:I.edate?I.edate:"0000-00-00",project_type:"PHP"}}),s=await b(t),{data:r}=D(s.data);q({title:"批量设置到期时间",resultTitle:"设置到期时间",resultData:r}),P.value=!0,R("close")}else{let e,a=T.load("正在设置到期时间，请稍后...");if(H){const e=await g({sites_id:B.id,edate:I.edate?I.edate:"0000-00-00"});e.data.status?(T.request(e),P.value=!0):T.error(e.data.msg)}else e=await h({id:B.id,edate:I.edate?I.edate:"0000-00-00"}),T.request(e),e.status&&(P.value=!0);a.close(),R("close")}}catch(a){}};return v({onConfirm:G}),s(()=>{"0000-00-00"===B.edate&&(I.edate="",r(()=>{E()}))}),(e,a)=>{const t=j,s=n,r=f,y=_;return o(),d("div",C,[l(y,{ref_key:"formRef",ref:S,model:u(I),rules:L},{default:i(()=>[l(r,{label:"到期时间",prop:"edate"},{default:i(()=>[m("div",k,[l(t,{modelValue:u(I).edate,"onUpdate:modelValue":a[0]||(a[0]=e=>u(I).edate=e),"value-format":"YYYY-MM-DD","disabled-date":U,class:"date",onChange:F,type:"date",placeholder:"选择日期"},null,8,["modelValue"]),l(s,{type:"default",class:"!ml-[.4rem]",onClick:z},{default:i(()=>[...a[1]||(a[1]=[p(" 设为永久 ",-1)])]),_:1})])]),_:1})]),_:1},8,["model"]),u(I).edate?(o(),d("div",Y,"* 到期当天24点后过期")):c("",!0)])}}}),[["__scopeId","data-v-26d5d260"]]);export{A as default};
