import{u as e,aq as a,bv as l,bU as s,l as t,L as o,at as d,j as u,ag as r,c as p,b as n,e as m}from"./utils-lib.js?v=1756369731";import{c as i,k as v,ay as c,r as f,g as b,p as w,q as _,v as g,e as h,A as V,x as y,P as x,H as j,y as k,B as q,C as P,M as S,F as U,a_ as C,ax as D,a9 as T,ai as F,aj as I,a7 as M,bx as L}from"./base-lib.js?v=1756369731";import{_ as H}from"./index101.js?v=1756369731";import{k as N,f as O}from"./validator.js?v=1756369731";import{addPhpSite as A,GetPHPVersion as E}from"./site.js?v=1756369731";import{u as R}from"./useStore4.js?v=1756369731";import{l as Q,v as W,h as z}from"./useController5.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./useController6.js?v=1756369731";import"./useMethod5.js?v=1756369731";const B={class:""},J={class:"items-center flex"},G={class:"flex items-center mb-[8px]"},K={class:"flex items-center"},X={class:"flex items-center mb-[4px]"},Y=m(i({__name:"index",props:{compData:{default:{}}},setup(m,{expose:i}){const Y=m,{panel:Z}=e(),{isRefreshList:$}=R(),ee=n(),ae=v({database:!1,ftp:!1}),le=c("popupClose"),se=f(!1),te=f(),oe=f(!1),de=f({menuType:"addDefault",path:"/www/wwwroot",ftp:!1,type:"PHP",type_id:0,ps:"",port:"",version:"",need_index:0,need_404:0,sql:!1,codeing:"utf8mb4",webname:"",add_dns_record:!1,ftp_username:"",ftp_password:"",datauser:"",datapassword:""}),ue=f({ftp:!0,ftpStatus:!0,ftpData:{username:"",password:""},sql:!0,databaseStatus:!0,sqlData:{username:"",password:""},siteStatus:!1,site:{name:!1},dns:[],title:""});let re="/www/wwwroot/";const pe=f([]),ne=b(()=>Q.value.filter(e=>"all"!==e.value&&Number(e.value)>=0)),me=()=>{var e;(null==(e=z.value)?void 0:e.setClassManage)&&z.value.setClassManage()},ie=async e=>{const{data:l}=await a({sName:e});N({name:l.name,type:"i",pluginInfo:l})},ve=()=>{O({type:"dir",path:de.value.path,change:e=>{var a;const s=l(e,"string","");de.value.path=s,re=null==(a=s+"/")?void 0:a.replace(/\/\//g,"/")}})},ce=e=>{var a,l,t,o,d;"string"==typeof e&&(de.value.ps=e.split("\n")[0],de.value.path=(null==re?void 0:re.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim()),de.value.ftp_username=null==(t=e.split("\n")[0])?void 0:t.replace(/\W/g,"_"),de.value.ftp_password=s(16),de.value.datauser=null==(d=null==(o=e.split("\n")[0])?void 0:o.replace(/\W/g,"_"))?void 0:d.substr(0,16),de.value.datapassword=s(16))},fe=async()=>{var e,a;const l=await Y.compData.getStatus();ae.database=l.mysql,ae.ftp=l.ftp,de.value.type_id=null==(e=ne.value[0])?void 0:e.value,await(async()=>{var e;try{const a=await E();pe.value=a.data;let l="00";null==(e=pe.value)||e.forEach(e=>{Number(e.version)>Number(l)&&(l=e.version)}),de.value.version=l}catch(a){}})();const s=Z.value.sitePath;s&&(de.value.path=s,re=null==(a=s+"/")?void 0:a.replace(/\/\//g,"/"))};return w(fe),i({init:fe,onConfirm:async e=>{let a=Object.assign({},de.value);a.ftp?(ue.value.ftpData.username=a.ftp_username,ue.value.ftpData.password=a.ftp_password):(delete a.ftp_username,delete a.ftp_password,ue.value.ftp=!1),a.sql?(ue.value.sqlData.username=a.datauser,ue.value.sqlData.password=a.datapassword):(delete a.datauser,delete a.datapassword,ue.value.sql=!1),-1!==a.webname.split("\n")[0].indexOf(":")?a.port=a.webname.split("\n")[0].split(":")[1]:a.port=80;let l=a.webname.split("\n");const s=null==l?void 0:l.map(e=>e.split(":")[0]);l.shift(),a.webname=JSON.stringify({domain:a.webname.split("\n")[0],domainlist:l,count:l.length}),delete a.menuType,await te.value.validate();try{se.value=!0;const e=await A(a);de.value.add_dns_record&&e.status&&(ue.value.dns=s.filter(e=>e.length).map(e=>({domain:e,status:!1,msg:""})),ue.value.title=e.status?"添加网站成功":e.msg),e.status&&le(),a.ftp||a.sql||ue.value.dns.length?(ue.value.ftpStatus=e.data.ftpStatus,ue.value.databaseStatus=e.data.databaseStatus,ue.value.siteStatus=e.data.siteStatus,ue.value.site.name=!1,t({isAsync:!0,title:"网站添加结果",area:46,component:()=>o(()=>import("./add-result.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:ue.value})):ee.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.status?"添加网站成功":e.msg,type:e.status?"success":"error",duration:e.status?3e3:0,showClose:!e.status}),$.value=!0}catch(u){d(u)}finally{se.value=!1}}}),(e,a)=>{const l=u,s=D,t=T,o=H,d=F,n=I,m=r,i=p,v=M,c=L;return _(),g("div",B,[h(v,{model:y(de),rules:y(W),disabled:y(se),ref_key:"addSiteFormRef",ref:te},{default:V(()=>[h(t,{label:"域名",prop:"webname"},{default:V(()=>[h(s,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:y(oe),"onUpdate:visible":a[2]||(a[2]=e=>x(oe)?oe.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:V(()=>[j(h(l,{onInput:ce,modelValue:y(de).webname,"onUpdate:modelValue":a[0]||(a[0]=e=>y(de).webname=e),type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:a[1]||(a[1]=e=>oe.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"]),[[c,void 0,"popover"]])]),default:V(()=>[a[16]||(a[16]=k("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[q(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),k("br"),q(" IP地址格式：192.168.1.199 "),k("br"),q(" 泛解析添加方法 *.domain.com "),k("br"),q(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1}),h(t,{label:"备注"},{default:V(()=>[h(l,{modelValue:y(de).ps,"onUpdate:modelValue":a[3]||(a[3]=e=>y(de).ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])]),_:1}),h(t,{label:"根目录",prop:"path"},{default:V(()=>[h(o,{modelValue:y(de).path,"onUpdate:modelValue":a[4]||(a[4]=e=>y(de).path=e),placeholder:"请输入根目录",icon:"el-folder-opened",width:"52rem",onIconClick:ve},null,8,["modelValue"])]),_:1}),h(t,{label:"FTP"},{default:V(()=>[k("div",J,[h(n,{class:"!w-[15rem]",modelValue:y(de).ftp,"onUpdate:modelValue":a[5]||(a[5]=e=>y(de).ftp=e),disabled:!y(ae).ftp},{default:V(()=>[h(d,{label:"不创建",value:!1}),h(d,{label:"创建",value:!0})]),_:1},8,["modelValue","disabled"]),y(ae).ftp?P("",!0):(_(),g("span",{key:0,onClick:a[6]||(a[6]=e=>ie("pureftpd")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装FTP，点击安装"))])]),_:1}),y(de).ftp?(_(),S(t,{key:0,label:"FTP账号"},{default:V(()=>[k("div",G,[h(t,{prop:"ftp_username"},{default:V(()=>[h(l,{placeholder:"创建FTP账号",modelValue:y(de).ftp_username,"onUpdate:modelValue":a[7]||(a[7]=e=>y(de).ftp_username=e),width:"24rem"},null,8,["modelValue"])]),_:1}),h(t,{label:"密码",class:"!mt-0"},{default:V(()=>[h(l,{placeholder:"FTP密码",modelValue:y(de).ftp_password,"onUpdate:modelValue":a[8]||(a[8]=e=>y(de).ftp_password=e),width:"24rem"},null,8,["modelValue"])]),_:1})]),a[17]||(a[17]=k("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应FTP帐户，并且FTP目录指向站点所在目录。",-1))]),_:1})):P("",!0),h(t,{label:"数据库"},{default:V(()=>[k("div",K,[h(n,{class:"!w-[15rem]",modelValue:y(de).sql,"onUpdate:modelValue":a[9]||(a[9]=e=>y(de).sql=e),disabled:!y(ae).database},{default:V(()=>[h(d,{label:"不创建",value:!1}),h(d,{label:"MySQL",value:"MySQL"})]),_:1},8,["modelValue","disabled"]),y(ae).database?P("",!0):(_(),g("span",{key:0,onClick:a[10]||(a[10]=e=>ie("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装数据库，点击安装")),y(de).sql?(_(),S(n,{key:1,class:"ml-[8px] !w-[15rem]",modelValue:y(de).codeing,"onUpdate:modelValue":a[11]||(a[11]=e=>y(de).codeing=e)},{default:V(()=>[h(d,{label:"utf8mb4",value:"utf8mb4"}),h(d,{label:"utf8",value:"utf8"}),h(d,{label:"gbk",value:"gbk"}),h(d,{label:"big5",value:"big5"})]),_:1},8,["modelValue"])):P("",!0)])]),_:1}),y(de).sql?(_(),S(t,{key:1,label:"数据库账号"},{default:V(()=>[k("div",X,[h(t,{prop:"datauser"},{default:V(()=>[h(l,{placeholder:"创建数据库账号",class:"w-[24rem]",modelValue:y(de).datauser,"onUpdate:modelValue":a[12]||(a[12]=e=>y(de).datauser=e)},null,8,["modelValue"])]),_:1}),h(t,{label:"密码",class:"!mt-0"},{default:V(()=>[h(l,{placeholder:"数据库密码",class:"w-[24rem]",modelValue:y(de).datapassword,"onUpdate:modelValue":a[13]||(a[13]=e=>y(de).datapassword=e)},null,8,["modelValue"])]),_:1})]),a[18]||(a[18]=k("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))]),_:1})):P("",!0),h(t,{label:"PHP版本"},{default:V(()=>[h(n,{class:"!w-[15rem]",modelValue:y(de).version,"onUpdate:modelValue":a[14]||(a[14]=e=>y(de).version=e)},{default:V(()=>[(_(!0),g(U,null,C(y(pe),e=>(_(),S(d,{key:e.value,label:e.name,value:e.version},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),h(t,{label:"网站分类"},{default:V(()=>[h(m,{modelValue:y(de).type_id,"onUpdate:modelValue":a[15]||(a[15]=e=>y(de).type_id=e),options:y(ne),class:"!w-[15rem]"},null,8,["modelValue","options"]),h(i,{class:"ml-[8px]",onClick:me},{default:V(()=>[...a[19]||(a[19]=[q("分类设置",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])])}}}),[["__scopeId","data-v-61ad041d"]]);export{Y as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
