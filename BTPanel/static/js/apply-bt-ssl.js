import{fZ as e,K as a,c as l,W as s,b as r}from"./utils-lib.js?v=1756369731";import{c as o,s as t,r as n,p as m,q as d,v as u,e as i,A as g,y as c,B as p,x as f,F as h,a_ as b,M as v,aW as _,a9 as w,ai as y,aj as C,D as S,a7 as V}from"./base-lib.js?v=1756369731";import{_ as T}from"./input-popover.vue_vue_type_script_setup_true_lang.js?v=1756369731";import{u as A}from"./useStore4.js?v=1756369731";import{applyTrustAsiaCert as P,verifyTrustAsiaCret as x,getDomainList as L}from"./site.js?v=1756369731";import{u as j}from"./useStore11.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const q={class:"relative p-[1.6rem] w-[90%] mx-[auto]"},U={class:"text-[1.2rem] flex items-center"},k={class:"leading-7 mt-[.2rem]"},N={class:"inline-block"},R={class:"flex flex-row"},D=o({__name:"apply-bt-ssl",emits:["close"],setup(o,{emit:D}){const{testIsRefresh:H}=t(j()),E=r(),I=D;A();const M=[{content:"注意：请勿将SSL证书用于非法网站，一经发现，吊销证书。",class:"text-danger"},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)。"},{content:"宝塔SSL申请的是免费版TrustAsia DV SSL CA - G5证书，仅支持单个域名申请。"},{content:"建议使用二级域名为www的域名申请证书,此时系统会默认赠送顶级域名为可选名称"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:'测试SSL申请注意事项及教程<a href="https://www.bt.cn/bbs/thread-33113-1-1.html" target="_blank" class="bt-link" rel="noreferrer noopener"> 使用帮助</a>',isHtml:!0}],O=n(),F=n(),W=n({domain:"",orgName:"",orgRegion:"",orgCity:"",orgAddress:"",orgPhone:"",orgPostalCode:"",orgDivision:"总务"}),B=n({orgName:[{required:!0,message:"请输入个人/公司名称",trigger:["blur","change"]}],orgRegion:[{required:!0,message:"请输入所在省份",trigger:["blur","change"]}],orgCity:[{required:!0,message:"请输入所在市/县",trigger:["blur","change"]}],orgAddress:[{required:!0,message:"请输入个人/公司地址",trigger:["blur","change"]}],orgPhone:[{required:!0,message:"请输入手机号码",validator:(a,l,s)=>{e(l)?s():s(new Error("请输入正确的手机号码"))},trigger:["blur","change"]}],orgPostalCode:[{required:!0,message:"请输入邮政编码",validator:(e,a,l)=>{6===a.length?l():l(new Error("请输入正确的邮政编码"))},trigger:["blur","change"]}]}),G=async()=>{if(await F.value.validate())try{const{status:e,data:l,msg:s}=await a({loading:"正在提交证书申请资料，请稍后...",request:P({...W.value})});if(e){I("close"),E.success(l.msg||s||"申请成功");const{status:e,data:r,msg:o}=await a({loading:"正在验证证书申请状态，请稍后...",request:x({partnerOrderId:l.partnerOrderId,siteName:W.value.domain})});e?"COMPLETED"==r.stateCode?E.success("验证成功！"):E.success("等待CA验证中，若长时间未能成功验证，请登录官网使用DNS方式重新申请..."):E.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:o,type:"error",duration:0,showClose:!0})}else E.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:(null==l?void 0:l.msg)||s,type:"error",duration:0,showClose:!0});H.value=!0}catch(e){}};return m(()=>{(async()=>{var e,a;let l=null;try{l=E.load("正在获取所有域名列表，请稍后...");const{data:s}=await L();O.value=s,(null==(a=null==(e=O.value)?void 0:e.data)?void 0:a.length)&&(W.value.domain=O.value.data[0].name)}catch(s){}finally{l&&l.close()}})()}),(e,a)=>{const r=l,o=_,t=w,n=y,m=C,A=S,P=V,x=s;return d(),u("div",q,[i(o,{type:"error",closable:!1},{title:g(()=>[c("span",U,[a[9]||(a[9]=c("span",{class:"svgtofont-hint-confirm-icon !text-[2rem] mr-[.5rem]"},null,-1)),c("div",k,[a[8]||(a[8]=p(" 提示：尊敬的用户您好，感谢您对宝塔免费证书的支持，由于证书签发机制的调整，原一年的免费证书，将缩短至90天。本调整将于2024年4月25日生效。请注意及时续签。 ",-1)),c("div",N,[i(r,{href:"https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/",target:"_blank"},{default:g(()=>[...a[7]||(a[7]=[p(" 查看详情 ",-1)])]),_:1})])])])]),_:1}),i(P,{class:"mt-[1rem]",rules:f(B),ref_key:"applySslInfoForm",ref:F,model:f(W),"label-width":"100px"},{default:g(()=>[i(t,{label:"证书信息"},{default:g(()=>[...a[10]||(a[10]=[c("span",{class:"text-primary"}," TrustAsia TLS RSA CA(免费版)",-1)])]),_:1}),i(t,{label:"域名",prop:"domain"},{default:g(()=>[i(m,{modelValue:f(W).domain,"onUpdate:modelValue":a[0]||(a[0]=e=>f(W).domain=e),class:"!w-[36rem]",filterable:"",placeholder:"请选择"},{default:g(()=>{var e;return[(d(!0),u(h,null,b(null==(e=f(O))?void 0:e.data,e=>(d(),v(n,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]}),_:1},8,["modelValue"])]),_:1}),i(t,{label:"个人/公司名称",prop:"orgName"},{default:g(()=>[i(T,{modelValue:f(W).orgName,"onUpdate:modelValue":a[1]||(a[1]=e=>f(W).orgName=e),placeholderTips:"请输入个人/公司名称，必填项",customClass:"!w-[36rem]"},null,8,["modelValue"])]),_:1}),i(t,{label:"所在地区",prop:"orgRegion"},{default:g(()=>[c("div",R,[i(T,{modelValue:f(W).orgRegion,"onUpdate:modelValue":a[2]||(a[2]=e=>f(W).orgRegion=e),placeholderTips:"请输入所在省份，必填项",customClass:"mr-[1.6rem] !w-[17rem]"},null,8,["modelValue"]),i(T,{modelValue:f(W).orgCity,"onUpdate:modelValue":a[3]||(a[3]=e=>f(W).orgCity=e),placeholderTips:"请输入所在市/县，必填项",customClass:"!w-[17.4rem]"},null,8,["modelValue"])])]),_:1}),i(t,{label:"地址",prop:"orgAddress"},{default:g(()=>[i(T,{modelValue:f(W).orgAddress,"onUpdate:modelValue":a[4]||(a[4]=e=>f(W).orgAddress=e),placeholderTips:"请输入个人/公司地址，必填项",customClass:"!w-[36rem]"},null,8,["modelValue"])]),_:1}),i(t,{label:"手机",prop:"orgPhone"},{default:g(()=>[i(T,{modelValue:f(W).orgPhone,"onUpdate:modelValue":a[5]||(a[5]=e=>f(W).orgPhone=e),placeholderTips:"请输入手机号码，必填项",customClass:"!w-[36rem]"},null,8,["modelValue"])]),_:1}),i(t,{label:"邮政编码",prop:"orgPostalCode"},{default:g(()=>[i(T,{modelValue:f(W).orgPostalCode,"onUpdate:modelValue":a[6]||(a[6]=e=>f(W).orgPostalCode=e),placeholderTips:"请输入邮政编码，必填项",customClass:"!w-[36rem]"},null,8,["modelValue"])]),_:1}),i(t,{label:" "},{default:g(()=>[i(A,{type:"primary",onClick:G},{default:g(()=>[...a[11]||(a[11]=[p("申请证书",-1)])]),_:1})]),_:1})]),_:1},8,["rules","model"]),i(x,{options:M,listStyle:"disc",class:"ml-[2rem] bottom-0"})])}}});export{D as default};
