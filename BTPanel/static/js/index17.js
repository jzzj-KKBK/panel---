import{u as a,K as e,l as s,L as l,an as t,M as n,ao as o,c as i,ap as r,J as u,ak as m,k as d,a0 as c,aq as p,ar as f,as as y,S as v}from"./utils-lib.js?v=1756369731";import{_}from"./index103.js?v=1756369731";import{_ as g}from"./index112.js?v=1756369731";import{_ as b}from"./index123.js?v=1756369731";import{B as h}from"./index124.js?v=1756369731";import{c as x,aE as k,g as C,k as w,r as q,w as j,Z as A,p as L,G as M,q as S,v as V,x as R,M as D,A as E,e as U,C as I,y as T,P,F as B,z as H,B as N,Q,J as z,H as F,al as J,aW as O,D as W,ap as Y,ao as G,an as K,aQ as Z}from"./base-lib.js?v=1756369731";import{_ as X}from"./index130.js?v=1756369731";import{a as $,f as aa,g as ea,u as sa}from"./column.js?v=1756369731";import{addDbTypes as la,modifyDbTypes as ta,delDbTypes as na,getMysqlRootPwd as oa,getMysqlCloudServer as ia,setAutoConfig as ra,getDbTypes as ua,getMysqlList as ma,getAutoConfig as da}from"./database.js?v=1756369731";import{o as ca,a as pa,b as fa,c as ya,s as va,d as _a,e as ga,f as ba,g as ha,h as xa,i as ka,j as Ca,k as wa,l as qa}from"./useMethod4.js?v=1756369731";import{g as ja}from"./useStore2.js?v=1756369731";import{e as Aa,g as La,p as Ma}from"./validator.js?v=1756369731";import{B as Sa}from"./index131.js?v=1756369731";import{_ as Va}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1756369731";import{_ as Ra}from"./index.vue_vue_type_script_setup_true_lang4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";const Da={class:"inline-flex items-center mr-2rem"},Ea={key:0,class:"text-[12px]"},Ua={class:"flex items-center"},Ia=x({__name:"index",setup(y){const{refs:{isRefreshTable:x,isLoading:Ia,softData:Ta,isHaveServer:Pa,isRefreshClassList:Ba},resetRefresh:Ha,refreshTableList:Na}=ja(),Qa=k(),{payment:za,mainWidth:Fa}=a(),Ja=C(()=>za.value.authType),Oa=w({status:!1,code:""}),Wa=q(!1),Ya=q(""),Ga=w({total:0,page:1,row:10}),Ka=q([]),Za=q([]),Xa=q(null),$a=q("all"),ae=q(""),ee=q([]),se=q([]),le=q([]),te=C(()=>Fa.value>1530?280:Fa.value>1440?200:Fa.value>1200?150:120),ne=C(()=>!Ta.value.setup&&!Pa.value);j(Ba,a=>{a&&(Ba.value=!1,de())});const oe=[{label:"设置权限",value:"permission",event:async(a,e,s,l,t,n)=>ya(s.value,"multlples",{...n,clearBatch:t})},{label:"设置分类",value:"class",event:async(a,e,s,l,t,n)=>{va(s,t,ie,n)}},..._a()],ie=q([]),re=q([]),ue=a=>{ae.value=a,Ga.page=1,Na()},me=()=>{Ga.page=1,Na()},de=async()=>(await e({request:ua({db_type:"mysql"}),data:{msg:Array},success:({msg:a})=>{ie.value=[...a.map(a=>({label:a.ps,value:String(a.id)}))],se.value=[{label:"全部分类",value:"all"},...a.map(a=>({label:a.ps,value:String(a.id)}))],re.value=se.value.map(a=>a.value).filter(a=>Number(a)>=0||"all"===a)}}),Promise.resolve(se.value||[])),ce=async()=>{const a=await e({loading:"正在获取密码，请稍后...",request:oa({table:"config",id:1,key:"mysql_root"}),data:String});ga(a)},pe=a=>{s({title:"高级设置",area:[96,62],compData:a,component:()=>l(()=>import("./index128.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},fe=async()=>(await e({request:ia(),data:[Array,ee]}),ee.value.length||(Pa.value=!1),ee.value),ye=async(a={p:Ga.page,limit:Ga.row,table:"databases",search:ae.value,sid:"all"===$a.value?"":$a.value})=>{""===a.sid&&delete a.sid,Number(a.sid)<0&&(a.type_id=a.sid,delete a.sid),await e({loading:Ia,request:ma(a),data:{data:[Array,Ka],page:v(Ga),search_history:[Array,le],error:String},success:a=>{wa.value=a.data,a.error&&(Oa.status=!0,Oa.code=a.error)}})},ve=async a=>{Wa.value=a;try{await e({loading:"正在设置自动备份数据库...",request:ra({name:"mysql",status:a?1:0}),message:!0,success:e=>{e.status||(Wa.value=!a)}})}catch(s){}finally{undefined.close()}},_e=()=>Qa.push({path:"/crontab/task"}),ge=()=>{localStorage.setItem("MYSQL-RECYCLE","true"),window.location.href="/files"},be=[{name:"企业增量备份",ename:"increment",callback:()=>pe("increment")},{name:"远程数据库",ename:"server",callback:()=>pa()},{name:"关联服务",ename:"service",callback:()=>pe("service")},{name:"容量限制",ename:"capacity",callback:()=>{if(!Ka.value.length)return n.error("暂无数据库，请先添加数据库");if(!Ka.value.some(a=>0===a.sid))return n.error("当前页暂无本地数据库进行容量配额！");(a=>{"ltd"===Ja.value?0===a.sid?s({title:"数据库配额",area:50,component:()=>l(()=>import("./index129.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:a,showFooter:!0}):n.error("仅本地数据库支持设置容量配额"):Ma({sourceId:52})})(Ka.value.filter(a=>0===a.sid)[0])}},{name:"敏感词检测",ename:"sensitive",callback:()=>pe("sensitive")},{name:"Mysql用户管理",ename:"user",callback:()=>pe("user")}],he=()=>[$({type:"page",key:"id"}),...ba(ka),aa({event:(a,e)=>qa(a,e)}),ha(ee.value,"mysql"),ea({table:"databases"}),sa([{isHide:a=>!!a.sid,onClick:a=>(async(a,e)=>{let s=n.success("正在跳转phpMyAdmin，请稍后...");try{const{data:s}=await p({sName:"phpmyadmin"});if("panel"===e){if(null==s?void 0:s.ext.auth)return n.error("当前phpMyAdmin已开启密码访问，请使用【通过公共访问】进行访问");if("false"===(null==s?void 0:s.setup))return n.error("当前phpMyAdmin未安装，请先安装phpMyAdmin");await f(a.username,a.password)}}catch(l){}finally{s.close()}})(a,"panel"),title:"管理"},{onClick:ya,title:"权限"},{onClick:a=>xa(a),title:"工具"},{onClick:a=>ka(a),title:"改密"},{onClick:a=>Ca(a),title:"删除"}])];return j(()=>x.value,async a=>{a&&await ye(),Ha()}),A("serverList",ee),L(async()=>{Za.value=he(),!ne.value&&La({promises:[de],delay:1e3}),(async()=>{try{const{data:a}=await da({name:"mysql"});Wa.value=!!a.status,Ya.value=a.cycle}catch(a){}})(),ye(),await fe(),Za.value=he(),t(Za.value,"database_mysql_column")}),(a,e)=>{const s=X,l=o,t=J,n=O,p=W,f=Y,y=G,v=K,x=Z,k=i,C=h,w=r,q=u,j=b,A=m,L=d,$=c,aa=g,ea=_,sa=M("bt-loading");return S(),V("div",null,[R(ne)?(S(),D(s,{key:0,options:R(Ta)},{content:E(()=>[U(Va,{type:"Mysql"})]),_:1},8,["options"])):I("",!0),R(Oa).status?(S(),D(l,{key:1,options:R(Oa)},null,8,["options"])):I("",!0),U(n,{type:"info",closable:!1,class:"!mb-[12px]","show-icon":""},{title:E(()=>[T("div",Da,[e[8]||(e[8]=T("div",{class:"mr-4 min-w-max text-[#555] text-[12px]"},"自动备份数据库",-1)),U(t,{size:"small",class:"mr-8px",modelValue:R(Wa),"onUpdate:modelValue":e[0]||(e[0]=a=>P(Wa)?Wa.value=a:null),width:36,onChange:ve},null,8,["modelValue"]),R(Wa)?(S(),V(B,{key:1},[T("span",null,H(R(Ya)),1),T("span",{class:"bt-link",onClick:_e},"[前往计划任务]")],64)):(S(),V("div",Ea," 添加数据库后，可开启自动备份，保证数据安全。 "))])]),_:1}),U(ea,null,{"header-left":E(()=>[T("div",Ua,[U(p,{type:"primary",onClick:e[1]||(e[1]=a=>R(ca)(fe))},{default:E(()=>[...e[9]||(e[9]=[N(" 添加数据库 ",-1)])]),_:1}),R(Ta).setup?(S(),D(p,{key:0,onClick:ce},{default:E(()=>[...e[10]||(e[10]=[N("root密码",-1)])]),_:1})):I("",!0),U(p,{onClick:R(pa)},{default:E(()=>[...e[11]||(e[11]=[N("远程数据库",-1)])]),_:1},8,["onClick"]),U(p,{onClick:R(fa)},{default:E(()=>[...e[12]||(e[12]=[N("phpMyAdmin",-1)])]),_:1},8,["onClick"]),U(v,{class:"ml-10px","split-button":"",type:"default",onClick:e[2]||(e[2]=Q(a=>pe("route"),["stop"])),onCommand:pe},{dropdown:E(()=>[U(y,null,{default:E(()=>[U(f,{command:"route"},{default:E(()=>[...e[13]||(e[13]=[N("数据库备份",-1)])]),_:1}),U(f,{command:"user"},{default:E(()=>[...e[14]||(e[14]=[N(" 用户管理 ",-1)])]),_:1}),U(f,{command:"service"},{default:E(()=>[...e[15]||(e[15]=[N("关联服务",-1)])]),_:1}),U(f,{command:"process"},{default:E(()=>[...e[16]||(e[16]=[N(" 守护进程 ",-1)])]),_:1}),U(f,{command:"reinforce"},{default:E(()=>[...e[17]||(e[17]=[N(" 等保加固 ",-1)])]),_:1})]),_:1})]),default:E(()=>[e[18]||(e[18]=N(" 高级设置 ",-1))]),_:1}),U(Ra,{"comp-data":R(ee),class:"mx-[1rem]"},null,8,["comp-data"]),U(x,{content:"点击跳转数据库回收站",placement:"top"},{default:E(()=>[U(p,{type:"default",onClick:ge},{default:E(()=>[...e[19]||(e[19]=[T("i",{class:"svgtofont-el-delete mr-2px"},null,-1),T("span",{class:"<2xl:hidden"},"回收站",-1)])]),_:1})]),_:1}),R(Ta).setup&&R(Fa)>1200?(S(),D(Sa,{key:1,class:"ml-[1rem]","plugin-name":"mysql","is-request":!1,pluginInfo:R(Ta)},null,8,["pluginInfo"])):I("",!0),U(k,{onClick:e[3]||(e[3]=a=>R(Aa)({name:"数据库",type:12,id:17})),icon:"desired",class:"ml-[12px] <2xl:hidden",iconClass:"text-1.6rem"},{default:E(()=>[...e[20]||(e[20]=[N(" 需求反馈 ",-1)])]),_:1})])]),"header-right":E(()=>[U(C,{class:"mr-[10px] !w-[14rem]",modelValue:R($a),"onUpdate:modelValue":e[4]||(e[4]=a=>P($a)?$a.value=a:null),onChange:me,name:"Mysql",options:R(se),config:{getClassList:de,addClass:({ps:a})=>la({ps:a,db_type:"mysql"}),editClass:({ps:a,id:e})=>ta({ps:a,id:e,db_type:"mysql"}),deleteClass:({id:a})=>na({id:a,db_type:"mysql"})},ignore:R(re)},null,8,["modelValue","options","config","ignore"]),U(q,{class:z("!w-[".concat(R(te),"px]")),disabledPopover:!1,modelValue:R(ae),"onUpdate:modelValue":e[5]||(e[5]=a=>P(ae)?ae.value=a:null),clearable:"",placeholder:"请输入数据库名称/备注",onSearch:ue},{default:E(()=>[U(w,{list:{historyList:R(le),recommendList:be},name:"databases",keys:"databases",onUpdate:R(Na),onSearch:ue},null,8,["list","onUpdate"])]),_:1},8,["class","modelValue"]),U(j,{class:"ml-[10px]",onRefresh:R(Na)},null,8,["onRefresh"]),U(A,{name:"database_mysql",class:"ml-[10px]","table-ref":R(Xa),column:R(Za)},null,8,["table-ref","column"])]),content:E(()=>[F(U(L,{ref_key:"mysqlDbTableRef",ref:Xa,column:R(Za),data:R(Ka),total:R(Ga).total},null,8,["column","data","total"]),[[sa,R(Ia)]])]),"footer-left":E(()=>[U($,{options:oe,"table-ref":R(Xa)},null,8,["table-ref"])]),"footer-right":E(()=>[U(aa,{total:R(Ga).total,page:R(Ga).page,"onUpdate:page":e[6]||(e[6]=a=>R(Ga).page=a),row:R(Ga).row,"onUpdate:row":e[7]||(e[7]=a=>R(Ga).row=a),onChange:R(Na)},null,8,["total","page","row","onChange"])]),_:1})])}}});export{Ia as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
