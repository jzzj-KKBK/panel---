import{A as a,l as e,L as t,M as l,o as s,K as o,J as u,k as r,h as n,W as i}from"./utils-lib.js?v=1756369731";import{_ as c}from"./index103.js?v=1756369731";import{c as d,r as m,k as p,aB as h,p as v,G as _,q as f,v as w,e as g,A as x,B as y,x as V,P as b,F as D,a_ as j,M as P,H as C,y as E,z as k,D as A,ai as L,aj as I,au as M,aw as S,ce as U}from"./base-lib.js?v=1756369731";import{u as q}from"./column.js?v=1756369731";import{exportUserData as F,delMysqlUser as R,getUserData as B,getMysqlCloudServer as G}from"./database.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const O={class:"break-words flex items-center justify-center w-full text-[#666]"},T=["title"],H={class:"p-20px"},z={class:"p-20px"},J=d({__name:"index",setup(d,{expose:J}){const K=m(0),W=m(!1),N=m(""),Q=m([]),X=m(!0),Y=m([]),Z=p({associatedPopup:!1,associatedData:[],associatedDataColumn:[{label:"数据库",prop:"database"},{label:"表",prop:"table"},{label:"权限",render:a=>a.access.map(a=>"".concat(a.title,"：").concat(a.access)).join("\n")}]}),$=m({resultMsg:"",resultData:"",resultStatus:!1}),aa=p({authPopup:!1,authData:[],authDataColumn:[{label:"权限",render:a=>a.map(a=>h("div","".concat(a.title,"：").concat(a.access)))}]}),ea=[{content:"说明：此处用户数据为连接mysql直接获取，未与面板数据库连接，建议仅对此处新建的用户进行操作，以防出现意外"},{content:"访问权限：localhost/127.0.0.1:仅限本机访问 %：允许任何人访问 IP地址：仅限此IP地址访问（不含本机）"},{content:"全局权限：全局权限是指对所有数据库拥有的权限 ALL PRIVILEGES即root最高权限，USAGE为普通用户，拥有指定数据库指定权限（关联数据库权限）"}],ta=a=>{e({title:"添加用户",area:60,component:()=>t(()=>import("./add-user2.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{refreshFn:()=>oa(),serverList:Y},showFooter:!0})},la=async()=>{try{let a={sid:K.value};N.value&&(a.search=N.value);const e=await o({loading:X,request:B(a),data:{data:[Array,Q],status:Boolean}});return e.status?(Q.value.forEach(a=>{a.list.forEach(e=>{e.user=a.user})}),e):(Q.value=[],l.error(e.msg||"获取用户数据失败"))}catch(a){}},sa=m([{label:"访问权限",render:a=>h("span","".concat(a.host).concat("%"==a.host?" - 所有人":"localhost"==a.host||"127.0.0.1"==a.host?" - 本地":""))},{prop:"password",label:"密码",width:50},{prop:"password_last_changed",label:"密码修改时间",width:160},q([{onClick:a=>{e({title:"数据库权限",area:80,component:()=>t(()=>import("./user-auth.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{row:a,sid:K.value,refreshEvent:la}})},title:"权限"},{onClick:({user:a,host:s})=>{if("root"===a&&"localhost"===s)return l.error("该用户不允许改密");e({title:"修改密码",area:42,compData:{username:a,host:s,sid:K.value},component:()=>t(()=>import("./user-pwd.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},title:"改密"},{onClick:async({host:a,user:e})=>{try{const t=await F({username:e,host:a,sid:K.value});$.value.resultMsg=t.data,$.value.resultStatus=!0,W.value=!0}catch(t){}},title:"导出"},{onClick:async({host:a,user:e})=>{try{await s({title:"删除用户",content:"删除用户后，该用户将无法访问数据库，是否继续操作？",icon:"warning-filled"}),await o({loading:"正在删除用户，请稍后...",request:R({username:e,host:a,sid:K.value}),message:!0,success:la})}catch(t){}},title:"删除"}])]),oa=async()=>{la(),(async()=>{var a,e;await o({loading:"正在获取服务器数据，请稍后...",request:G(),data:[Array,Y]}),Y.value=null==(a=Y.value)?void 0:a.filter(a=>""!==a.id),K.value=null==(e=Y.value[0])?void 0:e.id})()};return v(oa),J({init:oa}),(e,t)=>{const l=A,s=L,o=I,d=u,m=r,p=M,h=S,v=U,q=n,F=c,R=i,B=_("bt-loading");return f(),w("div",null,[g(F,null,{"header-left":x(()=>[g(l,{type:"primary",onClick:ta},{default:x(()=>[...t[6]||(t[6]=[y("添加用户",-1)])]),_:1})]),"header-right":x(()=>[g(o,{modelValue:V(K),"onUpdate:modelValue":t[0]||(t[0]=a=>b(K)?K.value=a:null),class:"mr-[1.5rem] !w-[16rem]",placeholder:"请选择",onChange:la},{default:x(()=>[(f(!0),w(D,null,j(V(Y),a=>(f(),P(s,{key:a.value,label:a.ps,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),g(d,{modelValue:V(N),"onUpdate:modelValue":t[1]||(t[1]=a=>b(N)?N.value=a:null),placeholder:"请输入用户名",class:"!w-[20rem]",onSearch:la},null,8,["modelValue"])]),content:x(()=>[g(h,{data:V(Q),"max-height":"400"},{default:x(()=>[g(p,{type:"expand"},{default:x(a=>[C(g(m,{column:V(sa),data:a.row.list},null,8,["column","data"]),[[B,V(X)]])]),_:1}),g(p,{label:"用户",prop:"user"})]),_:1},8,["data"])]),popup:x(()=>[g(q,{title:"导出结果",modelValue:V(W),"onUpdate:modelValue":t[3]||(t[3]=a=>b(W)?W.value=a:null),area:38},{default:x(()=>[g(v,{icon:V($).resultStatus?"success":"error",title:V($).resultStatus?"导出成功":"导出失败"},{extra:x(()=>[E("div",O,[E("span",{class:"max-w-[28rem] truncate",title:V($).resultMsg},k(V($).resultMsg),9,T),g(l,{type:"text",onClick:t[2]||(t[2]=e=>{return t=V($).resultMsg,a({value:t});var t})},{default:x(()=>[...t[7]||(t[7]=[y("复制",-1)])]),_:1})])]),_:1},8,["icon","title"])]),_:1},8,["modelValue"]),g(q,{title:"关联数据库",modelValue:V(Z).associatedPopup,"onUpdate:modelValue":t[4]||(t[4]=a=>V(Z).associatedPopup=a),area:80},{default:x(()=>[E("div",H,[g(m,{"max-height":"300",data:V(Z).associatedData,column:V(Z).associatedDataColumn,"default-sort":{prop:"user",order:"descending"}},null,8,["data","column"]),g(m,{"max-height":"300",data:V(Z).associatedData,column:V(Z).associatedDataColumn},null,8,["data","column"])])]),_:1},8,["modelValue"]),g(q,{title:"全局权限",modelValue:V(aa).authPopup,"onUpdate:modelValue":t[5]||(t[5]=a=>V(aa).authPopup=a),area:40},{default:x(()=>[E("div",z,[g(m,{"max-height":"300",data:V(aa).authData,column:V(aa).authDataColumn},null,8,["data","column"])])]),_:1},8,["modelValue"])]),_:1}),g(R,{options:ea,"list-style":"disc",class:"ml-20px mt-12px"})])}}});export{J as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
