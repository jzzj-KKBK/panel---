import{c as a,r as e,U as s,g as l,p as t,q as r,v as d,e as o,A as u,x as i,F as m,a_ as n,M as p,B as c,Q as _,S as v,a9 as f,ai as b,aj as g,a7 as j}from"./base-lib.js?v=1756369731";import{w as h,K as w,M as x,at as y,c as V,e as k}from"./utils-lib.js?v=1756369731";import{addModulesDatabase as M}from"./database.js?v=1756369731";import{g as q}from"./useStore2.js?v=1756369731";import{a as A,m as C}from"./useMethod4.js?v=1756369731";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang9.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./validator.js?v=1756369731";const S={class:"p-[24px]"},U=k(a({__name:"index",props:{compData:{default:()=>({options:[]})}},setup(a,{expose:k}){const U=a,{refs:{tabActive:F},refreshTableList:I}=q(),B=e(),H=s(!1),K=e({name:"",db_user:"",password:h(16),dataAccess:"127.0.0.1",address:"",codeing:"utf8mb4",dtype:"MongoDb",ps:"",sid:0,listen_ip:"0.0.0.0/0",host:""}),L=e([]),Q={name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]}]},R=l(()=>{var a;return(null==(a=L.value.find(a=>a.id===K.value.sid))?void 0:a.db_host)||""}),T=a=>{K.value.db_user=a,K.value.ps=a},z=async()=>{try{H.value=!0;const{db_status:a,msg:e,err_msg:s}=await C(K.value.sid);return a?(H.value=!1,!0):(x.error(s||e),!1)}catch(a){y(a)}};return t(async()=>{var a,e;L.value=await(null==(a=U.compData)?void 0:a.refresh())||[],K.value.sid=null==(e=L.value[0])?void 0:e.id}),k({onConfirm:async a=>{await B.value.validate();if(!(await z()))return!1;await w({loading:"正在添加数据库, 请稍后...",request:M(K.value,F.value),message:!0,success:e=>{e.status&&(a(),I())}})}}),(a,e)=>{const s=v,l=f,t=b,h=g,w=V,x=j;return r(),d("div",S,[o(x,{disabled:i(H),model:i(K),ref_key:"addFormRef",ref:B,rules:Q,onSubmit:e[2]||(e[2]=_(()=>{},["prevent"]))},{default:u(()=>[o(l,{label:"数据库名",prop:"name"},{default:u(()=>[o(s,{class:"w-[38rem]",ref:"data_name",placeholder:"新的数据库名称",modelValue:i(K).name,"onUpdate:modelValue":e[0]||(e[0]=a=>i(K).name=a),onInput:T},null,8,["modelValue"])]),_:1}),o(l,{label:"添加至",prop:"sid",class:"!mb-0"},{default:u(()=>[o(h,{class:"!w-[24rem]",modelValue:i(K).sid,"onUpdate:modelValue":e[1]||(e[1]=a=>i(K).sid=a)},{default:u(()=>[(r(!0),d(m,null,n(i(L),(a,e)=>(r(),p(t,{key:e,label:a.ps+(a.db_host?"（"+a.db_host+"）":""),value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(w,{class:"ml-[8px]",onClick:i(A)},{default:u(()=>[...e[3]||(e[3]=[c("管理远程数据库",-1)])]),_:1},8,["onClick"])]),_:1}),o(l,{label:" ",class:"!mb-0"},{default:u(()=>[o(D,{server:{sid:i(K).sid,ip:i(R)}},null,8,["server"])]),_:1})]),_:1},8,["disabled","model"])])}}}),[["__scopeId","data-v-d25589f5"]]);export{U as default};
