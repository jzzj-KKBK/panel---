import{bU as e,j as a,W as l,h as s,e as r,l as t,K as o,L as d}from"./utils-lib.js?v=1756369731";import{c as u,s as n,q as m,v as p,e as i,A as c,x as f,M as b,C as y,a9 as w,a7 as V,y as _,B as h,z as v,P as g,ai as x,aj as k,b9 as U,b8 as C,T as S,D as F,j,r as R,ay as N,k as q}from"./base-lib.js?v=1756369731";import{_ as D}from"./index101.js?v=1756369731";import{ak as O,al as E,am as I}from"./files.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const L={class:"p-20px"},P=u({__name:"receive",setup(s){const r=H(),{formDisabled:t,rules:o,isSuccess:d,receiveForm:u,receiveFormRef:_}=n(r);return(s,r)=>{const n=a,h=w,v=D,g=V,x=l;return m(),p("div",L,[i(g,{ref_key:"receiveFormRef",ref:_,disabled:f(t),rules:f(o),model:f(u)},{default:c(()=>[i(h,{label:"用户名",prop:"mName"},{default:c(()=>[i(n,{class:"!w-[24rem]",modelValue:f(u).mName,"onUpdate:modelValue":r[0]||(r[0]=e=>f(u).mName=e),disabled:f(d),placeholder:"请填写用户名，不能有中文或特殊符号"},null,8,["modelValue","disabled"])]),_:1}),i(h,{label:"密码",prop:"password"},{default:c(()=>[f(d)?(m(),b(n,{key:1,class:"!w-[24rem]",modelValue:f(u).password,"onUpdate:modelValue":r[3]||(r[3]=e=>f(u).password=e),disabled:""},null,8,["modelValue"])):(m(),b(v,{key:0,class:"!w-[24rem]",icon:"el-refresh",modelValue:f(u).password,"onUpdate:modelValue":r[1]||(r[1]=e=>f(u).password=e),isActive:!0,onIconClick:r[2]||(r[2]=()=>f(u).password=f(e)(16))},null,8,["modelValue"]))]),_:1}),f(d)?y("",!0):(m(),b(h,{key:0,label:"同步到",prop:"path"},{default:c(()=>[i(n,{class:"!w-[24rem]",modelValue:f(u).path,"onUpdate:modelValue":r[4]||(r[4]=e=>f(u).path=e),disabled:""},null,8,["modelValue"])]),_:1}))]),_:1},8,["disabled","rules","model"]),f(d)?(m(),b(x,{key:0,class:"pl-2rem",options:[{content:"使用上面的用户信息，前往发送数据的服务器创建发送端"}]})):y("",!0)])}}}),A={class:"p-20px"},T={class:"flex items-center time-unit"},z={key:1,class:"mt-20px"},B={class:"pt-2rem flex flex-col"},J={class:"text-danger p-2rem text-[1.4rem] leading-10 ml-36px"},K={class:"flex items-center mt-12px ml-4px px-2rem"},W={class:"bg-[#f6f8f8] footer-btn flex items-center justify-end mt-2rem p-12px w-full"},$=r(u({__name:"send",setup(e){const r=H(),{formDisabled:t,sendFormRef:o,rulesSend:d,sendForm:u,alertRsync:j,checkOffRsync:R}=n(r),{helpList:N,handleChangeDelete:q,handleConfirm:D}=r;return(e,r)=>{const n=a,O=w,E=x,I=k,L=U,P=C,$=V,H=l,M=S,Y=F,Z=s;return m(),p("div",A,[i($,{ref_key:"sendFormRef",ref:o,disabled:f(t),rules:f(d),model:f(u)},{default:c(()=>[i(O,{label:"服务器IP",prop:"ip"},{default:c(()=>[i(n,{modelValue:f(u).ip,"onUpdate:modelValue":r[0]||(r[0]=e=>f(u).ip=e),placeholder:"请输入接收服务器IP",width:"34.8rem"},null,8,["modelValue"])]),_:1}),i(O,{label:"同步目录",prop:"path"},{default:c(()=>[i(n,{modelValue:f(u).path,"onUpdate:modelValue":r[1]||(r[1]=e=>f(u).path=e),disabled:"",width:"34.8rem"},null,8,["modelValue"])]),_:1}),i(O,{label:"同步方式",class:"form-row"},{default:c(()=>[i(L,null,{default:c(()=>[i(I,{modelValue:f(u).delete,"onUpdate:modelValue":r[2]||(r[2]=e=>f(u).delete=e),class:"!w-[12rem]",onChange:f(q)},{default:c(()=>[i(E,{label:"增量",value:!1}),i(E,{label:"完全",value:!0})]),_:1},8,["modelValue","onChange"]),i(O,{label:"同步周期"},{default:c(()=>[i(I,{modelValue:f(u).realtime,"onUpdate:modelValue":r[3]||(r[3]=e=>f(u).realtime=e),class:"!w-[12rem]"},{default:c(()=>[i(E,{label:"实时同步",value:!0}),i(E,{label:"定时同步",value:!1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),f(u).realtime?y("",!0):(m(),b(O,{key:0,label:"定时周期",prop:"cron"},{default:c(()=>[i(L,null,{default:c(()=>[i(I,{modelValue:f(u).cron.type,"onUpdate:modelValue":r[4]||(r[4]=e=>f(u).cron.type=e),class:"!w-[10rem] mr-8px"},{default:c(()=>[i(E,{label:"每天",value:"day"}),i(E,{label:"N分钟",value:"minute-n"})]),_:1},8,["modelValue"]),_("div",T,["minute-n"!==f(u).cron.type?(m(),b(n,{key:0,modelValue:f(u).cron.hour,"onUpdate:modelValue":r[5]||(r[5]=e=>f(u).cron.hour=e),type:"number",class:"!w-[11.6rem] mr-8px"},{append:c(()=>[...r[21]||(r[21]=[h(" 小时 ",-1)])]),_:1},8,["modelValue"])):y("",!0),i(n,{modelValue:f(u).cron.minute,"onUpdate:modelValue":r[6]||(r[6]=e=>f(u).cron.minute=e),type:"number",class:"w-[12rem]"},{append:c(()=>[...r[22]||(r[22]=[h(" 分钟 ",-1)])]),_:1},8,["modelValue"])])]),_:1})]),_:1})),i(O,{label:"限速",class:"form-row"},{default:c(()=>[i(L,null,{default:c(()=>[i(P,{span:8},{default:c(()=>[i(n,{modelValue:f(u).bwlimit,"onUpdate:modelValue":r[7]||(r[7]=e=>f(u).bwlimit=e),type:"number",class:"!w-[12rem]"},{append:c(()=>[...r[23]||(r[23]=[h("KB",-1)])]),_:1},8,["modelValue"])]),_:1}),i(P,{span:14},{default:c(()=>[i(O,{label:"延迟"},{default:c(()=>[i(n,{modelValue:f(u).delay,"onUpdate:modelValue":r[8]||(r[8]=e=>f(u).delay=e),type:"number",class:"!w-[12rem]"},{append:c(()=>[...r[24]||(r[24]=[h("秒",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),i(O,{label:"链接方式",class:"form-row"},{default:c(()=>[i(L,null,{default:c(()=>[i(I,{modelValue:f(u).rsync,"onUpdate:modelValue":r[9]||(r[9]=e=>f(u).rsync=e),class:"!w-[12rem]"},{default:c(()=>[i(E,{label:"密钥",value:"key"}),i(E,{label:"账号",value:"user"})]),_:1},8,["modelValue"]),i(O,{label:"压缩传输"},{default:c(()=>[i(I,{modelValue:f(u).compress,"onUpdate:modelValue":r[10]||(r[10]=e=>f(u).compress=e),class:"!w-[12rem]"},{default:c(()=>[i(E,{label:"开启",value:!0}),i(E,{label:"关闭",value:!1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),"user"===f(u).rsync?(m(),p("div",z,[i(O,{label:"用户名",prop:"sname"},{default:c(()=>[i(n,{modelValue:f(u).sname,"onUpdate:modelValue":r[11]||(r[11]=e=>f(u).sname=e),width:"34.8rem",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),i(O,{label:"密码",prop:"password"},{default:c(()=>[i(n,{modelValue:f(u).password,"onUpdate:modelValue":r[12]||(r[12]=e=>f(u).password=e),width:"34.8rem",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),i(O,{label:"端口",prop:"port"},{default:c(()=>[i(n,{modelValue:f(u).port,"onUpdate:modelValue":r[13]||(r[13]=e=>f(u).port=e),width:"34.8rem",type:"number"},null,8,["modelValue"])]),_:1})])):y("",!0),"key"===f(u).rsync?(m(),b(O,{key:2,label:"密钥",prop:"secret_key"},{default:c(()=>[i(n,{modelValue:f(u).secret_key,"onUpdate:modelValue":r[14]||(r[14]=e=>f(u).secret_key=e),width:"34.8rem",type:"textarea",placeholder:"请输入密钥"},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1},8,["disabled","rules","model"]),i(H,{class:"pl-2rem",options:f(N),"list-style":"disc"},null,8,["options"]),i(Z,{title:"数据安全风险警告",area:[40,"auto"],modelValue:f(j),"onUpdate:modelValue":r[18]||(r[18]=e=>g(j)?j.value=e:null),onClose:r[19]||(r[19]=e=>f(D)(!1)),onCancel:r[20]||(r[20]=e=>f(D)(!1))},{default:c(()=>[_("div",B,[r[28]||(r[28]=_("div",{class:"flex items-center px-2rem"},[_("i",{class:"el-icon-warning text-[#e6a23c] text-[3rem] pr-4"}),_("span",{class:"text-[1.4rem] leading-10 text-danger"},"警告：您选择了完全同步，将会使本机同步与目标机器指定目录的文件保持一致， 请确认目录设置是否有误，一但设置错误，可能导致目标机器的目录文件被删除!")],-1)),_("span",J,"注意： 同步程序将本机目录：【"+v(f(u).path)+"】的所有数据同步到目标服务器，若目标服务器的同步目录存在其它文件将被删除!",1),_("div",K,[i(M,{modelValue:f(R),"onUpdate:modelValue":r[15]||(r[15]=e=>g(R)?R.value=e:null),class:"!mr-4px"},null,8,["modelValue"]),r[25]||(r[25]=h(" 我已了解风险，确认关闭 ",-1))]),_("div",W,[i(Y,{type:"warning",onClick:r[16]||(r[16]=e=>f(D)(!1))},{default:c(()=>[...r[26]||(r[26]=[h("取消",-1)])]),_:1}),i(Y,{type:"danger",onClick:r[17]||(r[17]=e=>f(D)(!0)),disabled:!f(R)},{default:c(()=>[...r[27]||(r[27]=[h("确认选择",-1)])]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-dfabae5a"]]),H=j("FILES-RSYNC-STORE",()=>{const e=R(),a=(a,l,o)=>{r.path=e.value.row.path,i.path=e.value.row.path,l&&(s.value=!1,n.value=!1,Object.assign(r,{mName:"",password:"",path:e.value.row.path,comment:""}),f.value=!1,b.value=!1,Object.assign(i,{ip:"",rsync:"user",sname:"",password:"",path:e.value.row.path,port:873,secret_key:"",delete:!1,realtime:!0,bwlimit:1024,delay:3,compress:!0,cron:{type:"day",where1:"",hour:0,minute:1,id:"",port:""}})),t("receive"===a?{title:"创建接收端",area:42,btn:["确认","取消"],showFooter:!n.value,component:P,onConfirm:p}:{title:"创建发送端",area:58,btn:["确认","取消"],component:$,onConfirm:w}),o&&o()},l=async()=>{var a;if("site"===(null==(a=e.value.row)?void 0:a.type))e.value.row.refreshEvent();else{const{default:e}=await d(()=>import("./store.js?v=1756369731").then(e=>e.aW),__vite__mapDeps([]),import.meta.url),{refreshFilesList:a}=e();a()}};N("popupSetFooter",e=>{});const s=R(!1),r=q({mName:"",password:"",path:"",comment:""}),u=R(),n=R(!1),m=q({mName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"},{validator:(e,a,l)=>{/^[a-zA-Z0-9_]{3,20}$/.test(a)?l():l(new Error("用户名不能有中文或特殊符号"))},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]}),p=async t=>{await u.value.validate(),await o({loading:s,request:O({...r,comment:r.mName}),message:!0,success:async s=>{n.value=s.status,s.status&&(await E({path:e.value.row.path,s_type:"recv"}),t.unmount(),l(),a("receive"))}})},i=q({ip:"",rsync:"user",sname:"",password:"",path:"",port:873,secret_key:"",delete:!1,realtime:!0,bwlimit:1024,delay:3,compress:!0,cron:{type:"day",where1:"",hour:0,minute:1,id:"",port:""}}),c=R(),f=R(!1),b=R(!1),y=q({ip:[{required:!0,message:"请输入ip",trigger:"blur"},{validator:(e,a,l)=>{/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/.test(a)?l():l(new Error("请输入正确的ip"))}}],sname:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],secret_key:[{required:!0,message:"请输入密钥",trigger:"blur"}]}),w=async a=>{let r={...i,cron:JSON.stringify({...i.cron,port:String(i.port),hour:String(i.cron.hour),minute:String(i.cron.minute)})};"minute-n"===i.cron.type&&(r.cron=JSON.stringify({...i.cron,hour:String(i.cron.hour),where1:String(i.cron.minute),minute:"",port:String(i.port)})),"key"===i.rsync?(r.sname="",r.password=""):r.secret_key="",delete r.rsync,await c.value.validate();return(await o({loading:s,request:I(r),message:!0,success:async a=>{a.status&&(await o({request:E({path:e.value.row.path,s_type:"send"})}),l())}})).status};return{compData:e,handleClick:a,formDisabled:s,rules:m,isSuccess:n,receiveForm:r,receiveFormRef:u,sendFormRef:c,rulesSend:y,sendForm:i,alertRsync:f,checkOffRsync:b,helpList:[{content:"【同步目录】：若不以/结尾，则表示将数据同步到二级目录，一般情况下目录路径请以/结尾"},{content:"【同步方式】增量： 数据更改/增加时同步，且只追加和替换文件"},{content:"【同步方式】完全： 保持两端的数据与目录结构的一致性，会同步删除、追加和替换文件和目录"},{content:"【限速】：限制数据同步任务的速度，防止因同步数据导致带宽跑高"},{content:"【延迟】：在延迟时间周期内仅记录不同步，到达周期后一次性同步数据，以节省开销"},{content:"【压缩传输】：开启后可减少带宽开销，但会增加CPU开销，如带宽充足，建议关闭此选项"}],handleChangeDelete:async e=>{e?(f.value=!0,i.delete=!e):f.value=!1},handleConfirm:e=>{i.delete=e,f.value=!1,b.value=!1}}});export{H as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
