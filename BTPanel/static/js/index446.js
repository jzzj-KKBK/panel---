import{u as e,o as a,at as t,al as l,c as s,W as r,h as o,b as i,L as n}from"./utils-lib.js?v=1756369731";import{c as m,r as u,k as c,g as p,Z as d,p as v,G as _,H as f,x as y,q as b,v as x,F as g,e as h,P as w,M as j,A as D,B as V,C as k,y as T,a_ as N,D as E,b5 as A,aj as L,a9 as I,a7 as P,d as R,ai as z}from"./base-lib.js?v=1756369731";import{_ as C}from"./index117.js?v=1756369731";import{_ as F}from"./index130.js?v=1756369731";import{o as O}from"./useController6.js?v=1756369731";import{serviceAdmin as S,getPluginInfo as U,getProofFind as H,setConfigSite as M}from"./site.js?v=1756369731";import{u as J}from"./useStore4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./validator.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";const q=""+new URL("../images/soft_ico/tamper_core_service.png",import.meta.url).href,B={class:"relative h-full"},G={class:"flex items-center"},W={key:2,class:"absolute top-0 z-10 h-full w-full bg-[#FAFAFA] text-center flex flex-col items-center justify-center"},Z={class:"p-2rem"},K=m({__name:"index",props:{compData:{default:{}}},setup(m,{expose:K}){const Q=R(()=>n(()=>import("./overview.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)),X=R(()=>n(()=>import("./exclude-protect-ext.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)),Y=R(()=>n(()=>import("./protect-ext.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)),$=R(()=>n(()=>import("./advanced2.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)),ee=R(()=>n(()=>import("./white-list.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)),ae=i(),{payment:te}=e(),{siteInfo:le}=J(),se=u(!1),re=u(),oe=u("pro"===te.value.authType?"tamper_proof_refactored":"tamper_core"),ie=u(!1),ne=u(!1),me=u({}),ue=u(!1),ce=u(),pe=u(!1),de=c({sites:[],list:[]}),ve=c({sites:[{required:!0,message:"请选择同步配置",trigger:"blur"}]}),_e=[{isHtml:!0,content:'【一键应用】将当前网站已配置的<span class="text-danger">排除目录</span>，<span class="text-danger">防护文件</span>，同步配置到其他网站'}],fe=p(()=>{const e="tamper_core"==oe.value;return{title:"".concat(e?"堡塔企业级防篡改":"网站防篡改程序","-功能介绍"),height:36,ps:"".concat(e?"内核版防篡改,用于保护站点内容安全，防止黑客非法修改网页、网站挂马等入侵行为，支持Centos/Debian/Ubuntu，注意：不能与其它防篡改软件同时使用":"事件型防篡改，用于保护站点内容安全，防止黑客非法修改网页、网站挂马等入侵行为"),source:e?180:46,desc:["保护站点内容安全","阻止黑客非法修改网页","阻止网站被挂马","阻止其他入侵行为"],isInstall:ne.value,tabImgs:["https://www.bt.cn/Public/new/plugin/introduce/site/".concat(e?"tamper_core_preview":"tamper_proof_preview",".png")],pluginInfo:me.value}}),ye=u("overview"),be=u(),xe=u(!0),ge=[{content:"启动",event:()=>he("start")},{content:"重启",event:()=>he("restart")},{content:"重载配置",event:()=>he("reload")}],he=async e=>{let l;try{let t="";switch(e){case"start":t="启动";break;case"restart":t="重启";break;case"reload":t="重载"}await a({title:"".concat(t,"防篡改服务"),content:"".concat(t,"项目后，当前服务将").concat(t,"运行，是否继续操作？")}),l=ae.load("正在".concat(t,"防篡改服务，请稍候..."));const s=await S({action:e});ae.msg({customClass:"bt-message-error-html !max-w-[36rem]",dangerouslyUseHTMLString:!0,message:s.msg,type:s.status?"success":"error",showClose:!s.status,duration:s.status?5e3:0}),s.status&&we()}catch(s){t(s)}finally{null==l||l.close()}},we=async()=>{try{se.value=!0;const{data:e}=await U({sName:"tamper_core"}),{data:a}=await U({sName:"tamper_proof_refactored"}),t=e.setup&&e.endtime>0,l=a.setup&&a.endtime>=0;ie.value=!1,ne.value=!0,t?oe.value="tamper_core":l?oe.value="tamper_proof_refactored":(oe.value="pro"===te.value.authType?"tamper_proof_refactored":"tamper_core","free"===te.value.authType?ne.value=!1:ie.value=!0),ie.value=t||l,me.value="tamper_core"==oe.value?e:a;let s={type:oe.value,maskLayer:ie.value};"tamper_core"==oe.value?(s.isVersion=parseFloat(e.version)>=3.2,s.isNewAlarmVersion=parseFloat(e.version)>=5.6,be.value=[{label:"概览",name:"overview",lazy:!0,render:()=>h(Q,{compData:s},null)},{label:"受保护的文件类型",lazy:!0,name:"protect",render:()=>h(Y,{compData:{...s,childType:"protect"}},null)},{label:"白名单",lazy:!0,name:"exclude",render:()=>h(ee,{compData:{...s,childType:"exclude"}},null)},{label:"高级设置",name:"advanced",lazy:!0,render:()=>h($,{compData:{...s,childType:"advanced"}},null)}]):be.value=[{label:"概览",name:"overview",lazy:!0,render:()=>h(Q,{compData:s},null)},{label:"排除目录",name:"exclude",lazy:!0,render:()=>h(X,{compData:{...s,childType:"exclude"}},null)},{label:"保护文件/扩展名",name:"protect",lazy:!0,render:()=>h(X,{compData:{...s,childType:"protect"}},null)}]}catch(e){}finally{se.value=!1}},je=()=>{},De=()=>{var e,a,t;de.list=(null==(t=null==(a=null==(e=re.value)?void 0:e.getRef())?void 0:a.overview)?void 0:t.sitesList)||[],ue.value=!0},Ve=async()=>{var e;await ce.value.validate();try{const{data:a}=await H({siteName:le.value.name});let t={protectExt:JSON.stringify(a.protectExt),excludePath:JSON.stringify(a.excludePath),sites:JSON.stringify(de.sites.map(e=>{var a;return{siteName:e,path:null==(a=de.list)?void 0:a.find(a=>a.siteName==e).path}})),sourceSite:le.value.path};const l=await M(t);return ue.value=!1,void O({title:"批量设置配置",resultData:null==(e=l.data)?void 0:e.map(e=>({name:e.ps,status:e.status,msg:e.msg})),resultTitle:"配置",showMult:!1})}catch(a){t(a)}};return d("kernelModuleStatus",xe),v(we),K({init:we}),(e,a)=>{const t=l,i=E,n=s,m=F,u=A,c=C,p=z,d=L,v=I,R=P,O=r,S=o,U=_("bt-loading");return f((b(),x("div",B,[y(ie)?(b(),x(g,{key:0},[h(t,{ref_key:"tamperRef",ref:re,type:"bg-card",modelValue:y(ye),"onUpdate:modelValue":a[0]||(a[0]=e=>w(ye)?ye.value=e:null),options:y(be)},null,8,["modelValue","options"]),"overview"!==y(ye)&&"tamper_proof_refactored"===y(oe)?(b(),j(i,{key:0,type:"primary",class:"absolute top-0 right-0",onClick:De},{default:D(()=>[...a[3]||(a[3]=[V(" 一键应用 ",-1)])]),_:1})):k("",!0),"tamper_core"==y(oe)&&parseFloat(y(me).version)<3.2?(b(),j(m,{key:1,visible:!0},{content:D(()=>[T("div",G,[a[5]||(a[5]=T("span",null,"版本过低无法使用，请点击更新",-1)),h(n,{onClick:je,class:"!font-bold !text-[1.4rem]"},{default:D(()=>[...a[4]||(a[4]=[V(" 【企业级防篡改】 ",-1)])]),_:1})])]),_:1})):"tamper_core"!=y(oe)||y(xe)?k("",!0):(b(),x("div",W,[a[6]||(a[6]=T("div",{class:"text-[#666] text-[24px] mb-1rem flex items-center"},[T("img",{width:"30",src:q}),V(" 【服务已停止】 ")],-1)),a[7]||(a[7]=T("div",{class:"text-[#999] text-[14px] mb-2rem"},"检测到当前服务未开启，请尝试手动启动！否则无法正常使用防篡改插件功能",-1)),h(u,{options:ge})]))],64)):(b(),j(c,{key:1,data:y(fe),class:"p-20px"},null,8,["data"])),h(S,{title:"一键应用",modelValue:y(ue),"onUpdate:modelValue":a[2]||(a[2]=e=>w(ue)?ue.value=e:null),area:50,"show-footer":"",onConfirm:Ve},{default:D(()=>[T("div",Z,[h(R,{ref_key:"applyFormRef",ref:ce,model:y(de),rules:y(ve),disabled:y(pe)},{default:D(()=>[h(v,{label:"同步配置",prop:"sites"},{default:D(()=>[h(d,{modelValue:y(de).sites,"onUpdate:modelValue":a[1]||(a[1]=e=>y(de).sites=e),multiple:"","collapse-tags":"",class:"!w-30rem",placeholder:"请选择"},{default:D(()=>[(b(!0),x(g,null,N(y(de).list,a=>(b(),x(g,null,[a.siteName!==e.compData.name?(b(),j(p,{key:a.siteName,label:a.siteName,value:a.siteName},null,8,["label","value"])):k("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"]),h(O,{options:_e,"list-style":"disc",class:"mt-2rem ml-2rem"})])]),_:1},8,["modelValue"])])),[[U,y(se)]])}}});export{K as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
