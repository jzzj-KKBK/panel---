import{al as e,at as a,A as t,b as l,c as s}from"./utils-lib.js?v=1756369731";import{c as n,r as u,w as i,p as r,a4 as o,G as p,H as c,x as d,q as v,v as m,y,C as f,M as g,A as h,F as x,a_ as _,P as b,B as j,e as k,I as w,ai as C,aj as V,D as F,aA as S}from"./base-lib.js?v=1756369731";import{B as D}from"./index140.js?v=1756369731";import{_ as U}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1756369731";import{getJavaProjectConfigList as A,getFileBody as H,saveFileBody as q}from"./site.js?v=1756369731";import{u as B,S as E}from"./useStore4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./ace.js?v=1756369731";const I={class:"h-full relative"},L={key:0,class:"bg-[#7F7F7F] flex items-center justify-center h-[72rem]"},M={key:0},O={class:"inline-block text-[#666] items-center flex"},T={class:"max-w-[55rem] truncate leading-[1.3] inline-block"},z=["onClick"],G={class:"my-12px"},P={key:0,class:"flex"},J={key:1,class:"text-[#666]"},K={key:1,class:"bg-[#7F7F7F] flex items-center justify-center h-full"},N={class:"bg-white px-48px py-16px text-[#333] flex items-center"},Q=n({__name:"index",props:{compData:{default:()=>({})}},setup(n,{expose:Q}){const{siteInfo:R}=B(),{jumpTabEvent:W}=E(),X=l(),Y=u(!1),Z=u(""),$=u(!1),ee=u([]),ae=u(""),te=u(!1),le=u(""),se=u(!1);let ne=[],ue={};const ie=u(""),re=async e=>{if($.value)try{if(e.data)return ae.value=e.data;te.value=!0;let a=e.path;if("spring"===e.type&&(a=le.value,se.value=ne.includes(a),ue[a]))return void(ae.value=ue[a]);const{data:t}=await H({path:a});ae.value=t.data,te.value=!1}catch(t){a(t),ae.value=""}finally{te.value=!1}},oe=async e=>{re(ee.value.find(a=>a.path===e))},pe=async()=>{let e=X.load("正在保存内容，请稍候...");try{let e=Z.value.includes("spring")?le.value:ee.value.find(e=>e.path===Z.value).path;const a=await q({data:ae.value,encoding:"utf-8",path:e});X.msg({dangerouslyUseHTMLString:!0,message:"<div>".concat(a.msg,"</div>"),type:a.status?"success":"error",duration:a.status?2e3:0,showClose:!a.status,customClass:"!max-w-[70rem]"})}catch(a){}finally{e.close()}};i(()=>R.value,e=>{var a;(null==(a=R.value.project_config)?void 0:a.bind_extranet)&&($.value=!!R.value.project_config.bind_extranet)},{immediate:!0});const ce=async()=>{let e=R.value.project_type.toLowerCase();ie.value=e,$.value=!0,(async()=>{try{Y.value=!0;const{data:e}=await A({project_name:R.value.name});if(!e.status)return void X.error(e.msg);ne=[],ue={};const a=e.data.filter(e=>"伪静态配置文件"!==e.name&&!e.type.includes("spring")),t=e.data.filter(e=>"伪静态配置文件"!==e.name&&e.type.includes("spring")&&e.status);if(ee.value=[...a,...t.length?[{name:"Spring配置",path:"spring",type:"spring",options:t.map(e=>("local_spring"===e.type?ne.push(e.path):ue[e.path]=e.data,{label:e.path,value:e.path,type:e.type})),status:!0}]:[]],ee.value.length>0){const e=ee.value.find(e=>!0===e.status);e&&(Z.value=e.path,t.length>0&&(le.value=t[0].path)),re(e)}}catch(e){a(e)}finally{Y.value=!1}})()};return r(ce),Q({init:ce}),o(()=>{ee.value=[]}),(a,l)=>{const n=C,u=V,i=D,r=F,o=s,A=S,H=e,q=p("bt-loading");return c((v(),m("div",I,[d(ee).length?f("",!0):(v(),m("div",L,[...l[4]||(l[4]=[y("div",{class:"bg-white px-48px py-16px text-[#333]"},"暂无配置文件",-1)])])),d(ee).length?(v(),g(H,{key:1,type:"card",modelValue:d(Z),"onUpdate:modelValue":l[3]||(l[3]=e=>b(Z)?Z.value=e:null),onChange:oe},{default:h(()=>[(v(!0),m(x,null,_(d(ee),e=>(v(),m(x,null,[e.status?(v(),g(A,{key:e.path,label:e.name,lazy:!0,name:e.path},{default:h(()=>[d($)?(v(),m("div",M,[y("span",O,[l[5]||(l[5]=j(" 文件位置： ",-1)),c(y("div",T,[k(U,{text:e.path},null,8,["text"])],512),[[w,"spring"!==e.type]]),c(k(u,{class:"!w-[26rem]",modelValue:d(le),"onUpdate:modelValue":l[0]||(l[0]=e=>b(le)?le.value=e:null),onChange:a=>re(e)},{default:h(()=>[(v(!0),m(x,null,_(e.options,e=>(v(),g(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onChange"]),[[w,"spring"===e.type]]),y("span",{class:"ml-[2rem] svgtofont-el-document-copy cursor-pointer",onClick:a=>d(t)({value:"spring"===e.type?d(le):e.path})},null,8,z)]),y("div",G,[c(k(i,{class:"!h-[54rem] !w-[64rem] border border-[#DCDFE6] rounded-4px",modelValue:d(ae),"onUpdate:modelValue":l[1]||(l[1]=e=>b(ae)?ae.value=e:null),request:!1,onSave:pe,editorOption:{readonly:"spring"===e.type}},null,8,["modelValue","editorOption"]),[[q,d(te)]])]),"spring"!==e.type||d(se)?(v(),m("div",P,[k(r,{type:"primary",onClick:pe},{default:h(()=>[...l[6]||(l[6]=[j("保存",-1)])]),_:1})])):(v(),m("div",J," 此文件为jar内部文件，不允许编辑 "))])):(v(),m("div",K,[y("div",N,[l[8]||(l[8]=j("请开启 ",-1)),k(o,{onClick:l[2]||(l[2]=e=>d(W)("mapping"))},{default:h(()=>[...l[7]||(l[7]=[j("外网映射",-1)])]),_:1}),l[9]||(l[9]=j(" 后查看配置信息",-1))])]))]),_:2},1032,["label","name"])):f("",!0)],64))),256))]),_:1},8,["modelValue"])):f("",!0)])),[[q,d(Y)],[q,"正在加载配置文件，请稍后...","title"]])}}});export{Q as default};
