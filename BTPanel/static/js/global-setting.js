import{c as e,r as l,k as a,aB as t,p as s,G as o,H as n,x as d,q as r,v as i,y as p,e as u,A as c,B as m,F as _,I as g,C as f,al as x,a9 as h,D as v,a7 as b,a$ as C,c2 as P}from"./base-lib.js?v=1756369731";import{u as I,o as y,at as w,K as V,W as F,b as j,e as X}from"./utils-lib.js?v=1756369731";import{_ as k}from"./index101.js?v=1756369731";import{f as R}from"./validator.js?v=1756369731";import{o as U}from"./useController6.js?v=1756369731";import{getGloalSetting as q,setSitesLogPath as S,setSitesLogStatus as A,openCdnIp as B,getCdnIp as H}from"./site.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./useStore4.js?v=1756369731";const T={class:"flex flex-col site-globa-setting-module"},W={class:"flex items-center"},D={class:"flex items-center"},G={class:"flex items-center"},K={class:"flex items-center"},$={class:"flex items-center"},z={class:"flex items-center"},E=X(e({__name:"global-setting",setup(e){const X=j(),{plugin:E}=I(),{webserver:J}=E.value,L=l(!1),M=l(),N=a({log_split:!1,log_path:""}),O=a({page_index:!1,page_404:!1}),Q=a({cdn_ip:"",header:""});let Y="";const Z=a({log_path:[{required:!0,message:"请选择日志路径",trigger:"change"}]}),ee=l([{label:"名称",prop:"site_name"},{label:"结果",render:e=>t("span",{class:e.status?"text-primary":"text-danger"},e.status?"操作成功":"操作失败")}]),le=[{value:"X-Forwarded-For",label:"X-Forwarded-For"},{value:"X-Real-IP",label:"X-Real-IP"},{value:"X-Forwarded",label:"X-Forwarded"},{value:"Forwarded-For",label:"Forwarded-For"},{value:"Forwarded",label:"Forwarded"},{value:"True-Client-IP",label:"True-Client-IP"},{value:"Client-IP",label:"Client-IP"},{value:"Ali-Cdn-Real-IP",label:"Ali-Cdn-Real-IP"},{value:"Cdn-Src-IP",label:"Cdn-Src-IP"},{value:"Cdn-Real-IP",label:"Cdn-Real-IP"},{value:"Cf-Connecting-IP",label:"Cf-Connecting-IP"},{value:"X-Cluster-Client-IP",label:"X-Cluster-Client-IP"},{value:"Wl-Proxy-Client-IP",label:"Wl-Proxy-Client-IP"},{value:"Proxy-Client-IP",label:"Proxy-Client-IP"}],ae=(e,l)=>{l(le)},te=async()=>{L.value=!0;try{const{data:e}=await q();N.log_path=e.log_path,N.log_split=e.log_split,O.page_index=e.page_index,O.page_404=e.page_404,Q.cdn_ip=e.cdn_ip}catch(e){}finally{L.value=!1}},se=async()=>{await M.value.validate(),await y({title:"修改日志路径",content:"是否修改日志预设路径,继续执行?",type:"check",icon:"warning-filled",check:{content:"更改已有网站日志",value:!0,onConfirm:async e=>{try{const l=await S({mv_log:"1",change_sites:e?"1":"0",log_path:N.log_path});e?U({resultColumn:ee.value,resultData:l.data,resultTitle:"修改日志路径",title:"修改日志路径结果"}):X.request(l)}catch(l){w(l)}}}})},oe=()=>{R({type:"dir",path:N.log_path,change:e=>{N.log_path=e}})},ne=async()=>{V({loading:"正在设置，请稍后...",request:A({log_split:N.log_split,page_index:O.page_index,page_404:O.page_404}),message:!0})},de=async e=>{V({loading:"正在设置，请稍后...",request:B({cdn_ip:e,header_cdn:Q.header}),message:!0,success:te})},re=()=>{Y=Q.header,Q.header=""},ie=()=>{""===Q.header&&(Q.header=Y)};return s(()=>{te(),(async()=>{const{data:e}=await H();Q.header=e.header_cdn||"X-Forwarded-For"})()}),(e,l)=>{const a=x,t=h,s=k,I=v,y=b,w=C,V=F,j=P,X=o("bt-loading");return n((r(),i("div",T,[p("div",null,[u(y,{ref_key:"globalSettingRef",ref:M,model:d(N),rules:d(Z)},{default:c(()=>[u(t,{label:"日志切割"},{default:c(()=>[p("div",W,[u(a,{onChange:ne,modelValue:d(N).log_split,"onUpdate:modelValue":l[0]||(l[0]=e=>d(N).log_split=e)},null,8,["modelValue"]),l[7]||(l[7]=p("span",{class:"text-[#999] ml-[4px]"},"*提示：开启该选项将自动创建网站日志切割任务，当存在所有网站日志切割任务时不会新建",-1))])]),_:1}),u(t,{label:"预设日志路径",prop:"log_path"},{default:c(()=>[p("div",D,[u(s,{modelValue:d(N).log_path,"onUpdate:modelValue":l[1]||(l[1]=e=>d(N).log_path=e),icon:"icon-file_mode",onIconClick:oe},null,8,["modelValue"]),u(I,{type:"primary",class:"!ml-1rem",onClick:se},{default:c(()=>[...l[8]||(l[8]=[m("保存",-1)])]),_:1})])]),_:1})]),_:1},8,["model","rules"])]),u(w),u(y,{model:d(O)},{default:c(()=>[u(t,{label:"默认页面设置"},{default:c(()=>[p("div",G,[u(a,{onChange:ne,modelValue:d(O).page_index,"onUpdate:modelValue":l[2]||(l[2]=e=>d(O).page_index=e)},null,8,["modelValue"]),l[9]||(l[9]=p("span",{class:"ml-[4px] mb-[2px]"},"自动生成index.html(默认首页)",-1))])]),_:1}),u(t,{label:" "},{default:c(()=>[p("div",K,[u(a,{onChange:ne,modelValue:d(O).page_404,"onUpdate:modelValue":l[3]||(l[3]=e=>d(O).page_404=e)},null,8,["modelValue"]),l[10]||(l[10]=p("span",{class:"ml-[4px] mb-[2px]"},"自动生成404.html(默认404页面)",-1))])]),_:1})]),_:1},8,["model"]),u(V,{options:[{content:"请注意，仅对后续创建的PHP网站生效。"}],class:"ml-[20px] mt-[20px]"}),"nginx"===d(J)?(r(),i(_,{key:0},[u(w),u(y,{model:d(Q)},{default:c(()=>[u(t,{label:"cdn来源IP解析"},{default:c(()=>[p("div",$,[u(a,{onChange:de,modelValue:d(Q).cdn_ip,"onUpdate:modelValue":l[4]||(l[4]=e=>d(Q).cdn_ip=e)},null,8,["modelValue"]),l[11]||(l[11]=p("span",{class:"ml-[4px] mb-[2px]"},[m(" * 请确保使用 "),p("span",{class:"text-danger"},"安全可靠"),m(" 的cdn ")],-1))])]),_:1}),n(u(t,{label:"来源的请求头"},{default:c(()=>[p("div",z,[u(j,{modelValue:d(Q).header,"onUpdate:modelValue":l[5]||(l[5]=e=>d(Q).header=e),"fetch-suggestions":ae,placeholder:"请选择或输入来源的请求头",onFocus:re,onBlur:ie},{suffix:c(()=>[...l[12]||(l[12]=[p("span",{class:"svgtofont-el-arrow-down"},null,-1)])]),_:1},8,["modelValue"]),u(I,{type:"primary",class:"!ml-1rem",onClick:l[6]||(l[6]=e=>de(d(Q).cdn_ip))},{default:c(()=>[...l[13]||(l[13]=[m("保存",-1)])]),_:1})])]),_:1},512),[[g,d(Q).cdn_ip]])]),_:1},8,["model"])],64)):f("",!0)])),[[X,d(L)]])}}}),[["__scopeId","data-v-26ddcd85"]]);export{E as default};
