import{K as a,M as e,k as l,j as s,h as t}from"./utils-lib.js?v=1756369731";import{c as n,r as d,e as o,B as u,p as i,G as r,q as p,v as m,H as f,x as c,A as b,y as v,P as y,F as _,a_ as V,M as q,a9 as j,ai as k,aj as w,a7 as g}from"./base-lib.js?v=1756369731";import{getFtpInfo as h,getMysqlInfo as x,getSiteInfo as F,modifyFtpLink as U,modifyMysqlLink as A}from"./site.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const C={class:"p-[20px]"},P=n({__name:"associated-database",setup(n){const P=d(!1),H=d(!1),M=d([]),T=d([]),B=d({pid:"",site:"",id:"",type:"mysql"}),G=d([{prop:"rname",label:"站点名称"},{label:"FTP用户",render:function(a){return o("div",null,[a.ftp.name?a.ftp.name:"--"," ",o("span",{class:"cursor-pointer bt-link",onClick:()=>{K(a,"ftp")}},[u("切换")])])}},{label:"数据库",render:function(a){return o("div",null,[a.mysql.name?a.mysql.name:"--"," ",o("span",{class:"cursor-pointer bt-link",onClick:()=>{K(a,"mysql")}},[u("切换")])])}}]),K=async(e,l)=>{B.value.type=l,await a({request:"ftp"===l?h():x(),data:[Array,M]}),B.value.pid=e[l].id,B.value.site=e.rname,P.value=!0,B.value.id=e.id},R=async()=>{a({loading:H,request:F(),data:[Array,T]})},z=async()=>{const{type:l,pid:s,id:t}=B.value;if(!s)return void e.error("请选择用户");const n={["ftp"===l?"ftp_id":"sql_id"]:s,pid:t},d="ftp"===l?U:A;(await a({loading:"正在切换，请稍后...",request:d(n),message:!0})).status&&(P.value=!1,R())};return i(R),(a,e)=>{const n=l,d=s,u=j,i=k,h=w,x=g,F=t,U=r("bt-loading");return p(),m("div",null,[f(o(n,{"max-height":"560",column:c(G),data:c(T)},null,8,["column","data"]),[[U,c(H)]]),o(F,{title:"ftp"===c(B).type?"切换FTP用户":"切换数据库用户",modelValue:c(P),"onUpdate:modelValue":e[3]||(e[3]=a=>y(P)?P.value=a:null),area:42,"show-footer":"",onConfirm:z},{default:b(()=>[v("div",C,[o(x,{modelValue:c(B),"onUpdate:modelValue":e[2]||(e[2]=a=>y(B)?B.value=a:null),ref:"websiteFormRef"},{default:b(()=>[o(u,{label:"站点名称"},{default:b(()=>[o(d,{class:"!w-[24rem]",disabled:"",modelValue:c(B).site,"onUpdate:modelValue":e[0]||(e[0]=a=>c(B).site=a)},null,8,["modelValue"])]),_:1}),o(u,{label:"ftp"===c(B).type?"ftp用户":"数据库用户",prop:"pid"},{default:b(()=>[o(h,{modelValue:c(B).pid,"onUpdate:modelValue":e[1]||(e[1]=a=>c(B).pid=a),class:"!w-[24rem]"},{default:b(()=>[(p(!0),m(_,null,V(c(M),(a,e)=>(p(),q(i,{key:e,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["modelValue"])])]),_:1},8,["title","modelValue"])])}}});export{P as default};
