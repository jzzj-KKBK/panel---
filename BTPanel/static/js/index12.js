import{_ as a}from"./index117.js?v=1756369731";import{j as e,r as t,k as s,e as l,c as n,s as i,p as d,a4 as r,q as o,v as u,H as m,I as c,x as p,y as v,P as _,F as h,Q as b,K as y,z as g,a_ as w,B as x,M as k,al as f,C as M,A as S,ax as T,av as D}from"./base-lib.js?v=1756369731";import{R as C,K as P,o as j,u as O,ag as q,k as V,e as A}from"./utils-lib.js?v=1756369731";import{e as L,f as H,s as I,g as E}from"./control.js?v=1756369731";import"./validator.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const R=e("CONTROL-STORE",()=>{const a=t("monitor"),e=s({title:"日报-功能介绍",ps:"能够对服务器运行情况进行监测，分析服务器异常的信息进行行为记录，协助管理员进行服务器分析。",source:211,desc:["服务器运行情况监测","异常信息记录","服务器分析"],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/control/daily.png"}]}),n=t(!1),i=t([]),d=t(""),r=t(),o=t(""),u=t(),m=t(),c=t([]),p=t([]),v=t([]),_=async a=>{var e;const{data:t}=await P({request:L({date:a})});r.value=t.evaluate,"正常"===t.evaluate?o.value="#20a53a":"良好"===t.evaluate?o.value="#2034a5":o.value="#ffa700";const s=t.date.toString();if(u.value=s.substr(0,4)+"-"+s.substr(4,2)+"-"+s.substr(6,2)+" 00:00:00 - 23:59:59",m.value=t.summary,i.value=[{name:"资源",value:"过载次数(五分钟内平均使用率超过80%)"},{name:"CPU",is_status:!0,data:t.data.cpu},{name:"内存",is_status:!0,data:t.data.ram},{name:"磁盘",is_status:!0,data:t.data.disk},{name:"常用服务",value:"异常次数(服务出现停止运行的次数)"},{name:"Nginx",is_status:!0,data:t.data.server.nginx},{name:"Mysql",is_status:!0,data:t.data.server.mysql},{name:"Apache",is_status:!0,data:t.data.server.apache},{name:"PHP",is_status:!0,data:t.data.server.php},{name:"Ftpd",is_status:!0,data:t.data.server.ftpd},{name:"Redis",is_status:!0,data:t.data.server.redis},{name:"Tomcat",is_status:!0,data:t.data.server.tomcat},{name:"Memcached",is_status:!0,data:t.data.server.memcached},{name:"备份类型",value:"备份失败",excess:"未开启备份",is_excess:!0},{name:"数据库",is_status:!0,data:t.data.backup.database.backup,data_excess:t.data.backup.database.no_backup,have_data_excess:!0},{name:"网站",is_status:!0,data:t.data.backup.site.backup,data_excess:t.data.backup.site.no_backup,have_data_excess:!0},{name:"异常类型",value:"次数"},{name:"面板异常登录",is_status:!0,data:t.data.exception.panel},{name:"SSH异常登录",is_status:!0,data:t.data.exception.ssh},{name:"安全",value:"次数"},{name:"安全风险",is_status:!0,data:t.data.safe.home_risks},{name:"网站漏洞扫描",is_status:!0,data:t.data.safe.vulnerabilities},{name:"恶意文件检测",is_status:!0,data:t.data.safe.malware}],null==(e=t.data.disk)?void 0:e.app_data){const a=h(t.data.disk.app_data);i.value.push({name:"空间存储状态",is_status:!0,data:a})}},h=a=>{let e=[];const t={sites:"站点",databases:"数据库",plugins:"面板插件",logs:"日志",backup:"备份"};return Object.keys(t).forEach(s=>{e.push({name:"".concat(t[s]),value:a[s]})}),e},b=async()=>{await P({request:H(),data:Array,success:a=>{const e={"正常":"success","良好":"warning","异常":"error"};c.value=null==a?void 0:a.map(a=>({label:a.time_key.toString().substr(0,4)+"-"+a.time_key.toString().substr(4,2)+"-"+a.time_key.toString().substr(6,2),value:a.time_key,isStatus:e[a.evaluate]||"error"})).reverse(),d.value=c.value.length?c.value[0].value:"",d.value&&_(d.value)}})},y=async()=>{await P({request:E(),data:[Boolean,n]})};return{tabActive:a,$reset:()=>{p.value=[],v.value=[],c.value=[],i.value=[]},selectData:c,dataList:v,tableList:i,selectValue:d,topStatus:r,topStatusColor:o,watchTime:u,summary:m,tableColumn:p,productData:e,dailyValue:n,getDailyStatus:y,changeDailyStatus:async a=>{await j({title:"日报",content:"您确定要".concat(a?"开启":"关闭","日报功能吗？")}),await P({request:I({status:a?"start":"stop"}),message:!0,success:async()=>{await y(),n.value&&b()}})},getPanelDailyInfoLists:b,getPanelDailyDatas:_,filterType:a=>{var e,t;return["数据库","网站","空间存储状态","安全风险","网站漏洞扫描","恶意文件检测"].includes(a.name)?"空间存储状态"===a.name||"数据库"===a.name||"网站"===a.name?a.data.length>0:(null==(t=null==(e=a.data.detail)?void 0:e.items)?void 0:t.length)>0:a.data.detail.length>0},goDetail:(a,e)=>{const t={1:"低危",2:"中危",3:"高危",4:"严重"};"数据库"==e||"网站"==e?a[0].target?p.value=[{label:"名称",showOverflowTooltip:!0,prop:"name"},{label:"时间",render:(a,e)=>C(a.time,"yyyy-MM-dd hh:mm:ss")}]:p.value=[{label:"名称",showOverflowTooltip:!0,prop:"name"}]:"面板异常登录"==e||"SSH异常登录"==e?p.value=[{label:"时间",showOverflowTooltip:!0,render:a=>C(a.time,"yyyy-MM-dd hh:mm:ss")},{label:"用户",prop:"username"},{label:"详情",prop:"desc"}]:"空间存储状态"==e?p.value=[{label:"名称",width:130,prop:"name"},{label:"占用空间",prop:"value"}]:"磁盘"==e?p.value=[{label:"路径",showOverflowTooltip:!0,prop:"name"},{label:"占用",render:a=>a.percent+"%"}]:"CPU"==e||"内存"==e?p.value=[{label:"过载时间",width:100,render:a=>l("span",null,[C(a.time,"yyyy-MM-dd hh:mm:ss")])},{label:"PID",prop:"pid",width:60},{label:"进程",prop:"name",showOverflowTooltip:!0},{label:"占用",width:60,render:a=>a.percent+"%"}]:["Nginx","Mysql","Apache","PHP","Ftpd","Redis","Tomcat","Memcached"].includes(e)?p.value=[{label:"停止时间",render:a=>C(a.time,"yyyy-MM-dd hh:mm:ss")}]:"安全风险"==e?p.value=[{label:"名称",prop:"title"},{label:"时间",render:a=>C(a.check_time,"yyyy-MM-dd hh:mm:ss"),width:"140"},{label:"风险级别",render:a=>t[a.level],width:"80"}]:"网站漏洞扫描"==e?p.value=[{label:"名称",prop:"risk_desc"},{label:"站点名称",prop:"site_name",showOverflowTooltip:!0,width:"100"},{label:"风险级别",render:a=>t[a.risk_level],width:"80"}]:"恶意文件检测"===e&&(p.value=[{label:"威胁类型",prop:"threat_type"},{label:"文件路径",prop:"filepath",showOverflowTooltip:!0},{label:"风险级别",render:a=>t[a.risk_level]},{label:"是否隔离",prop:"quarantined",render:a=>a.quarantined?"是":"否"}]),v.value="数据库"==e||"网站"==e||"空间存储状态"==e?a:"安全风险"===e||"网站漏洞扫描"==e||"恶意文件检测"===e?a.detail.items:a.detail,p.value.unshift({width:40,type:"index"})}}}),U={class:"content_box module-ui"},F={class:"relative"},N={class:"monitor mb-1rem"},z={class:"box-select"},B={class:"box-body"},K={class:"body_top"},$={class:"watch_time"},Q={class:"msg_box"},G={class:"w-[95rem] mt-[2rem]"},J={class:"item_name"},W={key:0,class:"!py-[0.8rem] pl-[0.8rem] inline-block border border-[#EAEAEA] border-t-0 w-full"},X=["onMouseover"],Y={key:2,class:"item_excess"},Z={key:3,class:"item_excess"},aa=["onMouseover"],ea=A(n({__name:"index",setup(e){const{payment:t}=O(),s=R(),{selectData:n,dataList:C,tableList:P,selectValue:j,topStatus:A,topStatusColor:L,watchTime:H,summary:I,tableColumn:E,productData:ea,dailyValue:ta}=i(s);return d(async()=>{await s.getDailyStatus(),ta.value&&s.getPanelDailyInfoLists()}),r(s.$reset),(e,i)=>{const d=f,r=q,O=V,R=T,sa=D,la=a;return o(),u("div",U,[m(v("div",F,[v("div",N,[i[3]||(i[3]=v("span",{class:"mr-8px align-middle"},"开启日报",-1)),l(d,{modelValue:p(ta),"onUpdate:modelValue":i[0]||(i[0]=a=>_(ta)?ta.value=a:null),onChange:p(s).changeDailyStatus},null,8,["modelValue","onChange"])]),p(n).length?(o(),u(h,{key:0},[v("div",z,[i[4]||(i[4]=v("span",null,"选择日期：",-1)),l(r,{modelValue:p(j),"onUpdate:modelValue":i[1]||(i[1]=a=>_(j)?j.value=a:null),onClick:i[2]||(i[2]=b(()=>{},["stop"])),options:p(n),class:"!w-[12.02rem]",onChange:p(s).getPanelDailyDatas},null,8,["modelValue","options","onChange"])]),v("div",B,[v("div",K,[v("span",{class:"top_status",style:y({color:p(L)})},g(p(A)),5),v("span",$,"监测时间："+g(p(H)),1),i[5]||(i[5]=v("span",{class:"text-left mb-[1.6rem]"},"健康信息提醒：",-1)),v("div",Q,[(o(!0),u(h,null,w(p(I),(a,e)=>(o(),u("span",{key:e},"●"+g(a),1))),128))])]),v("div",G,[(o(!0),u(h,null,w(p(P),(a,e)=>(o(),u("div",{class:"bottom_item",key:e},[v("div",J,[a.is_status?(o(),u("span",{key:0,class:"mr-[.5rem]",style:y({background:"空间存储状态"==a.name?"#20a53a":"数据库"==a.name||"网站"==a.name?0==a.data.length&&0==a.data_excess.length?"#20a53a":"red":0==a.data.ex?"#20a53a":"red"})},null,4)):M("",!0),x(g(a.name),1)]),a.is_status?(o(),u("div",{key:0,class:"item_value",style:y({width:a.have_data_excess?"24rem":"auto"})},["空间存储状态"!==a.name?(o(),u(h,{key:0},[x(g("数据库"==a.name||"网站"==a.name?0==a.data.length?"未监测到异常":a.data.length+"次":0==a.data.ex?"未监测到异常":a.data.ex+"次"),1)],64)):M("",!0),p(s).filterType(a)?(o(),k(R,{key:1,width:"420",placement:"bottom",trigger:"hover","popper-class":"max_over"},{reference:S(()=>[v("span",{class:"bt-link",onMouseover:e=>p(s).goDetail(a.data,a.name)},"  查看详情",40,X)]),default:S(()=>{var e,t;return[l(O,{ref_for:!0,ref:"menuTable1","max-height":300,data:p(C),column:p(E)},null,8,["data","column"]),(null==(e=a.data.detail)?void 0:e.check_time)?(o(),u("span",W,"检查时间："+g(null==(t=a.data.detail)?void 0:t.check_time),1)):M("",!0)]}),_:2},1024)):M("",!0)],4)):(o(),u("div",{key:1,class:"item_value",style:y({width:a.is_excess?"24rem":"auto"})},g(a.value),5)),a.is_excess?(o(),u("div",Y,g(a.excess),1)):M("",!0),a.is_status&&a.data_excess?(o(),u("div",Z,[x(g(a.have_data_excess&&a.data_excess.length?a.data_excess.length+"次":"未监测到异常")+" ",1),a.have_data_excess&&a.data_excess.length?(o(),k(R,{key:0,width:"350",placement:"bottom",trigger:"hover","popper-class":"max_over"},{reference:S(()=>[v("span",{class:"bt-link",onMouseover:e=>p(s).goDetail(a.data_excess,a.name)},"  查看详情",40,aa)]),default:S(()=>[l(O,{ref_for:!0,ref:"menuTable2","max-height":300,data:p(C),column:p(E)},null,8,["data","column"])]),_:2},1024)):M("",!0)])):M("",!0)]))),128)),i[6]||(i[6]=v("span",{class:"bottom_tips"},[x("更多安全风险详情请到【首页-安全风险】中进行查看 "),v("br"),x("在系统监控开启的情况下，日报会记录服务器每天运行的异常信息，协助管理员分析服务器前一天是否运行正常。")],-1))])])],64)):(o(),k(sa,{key:1,"image-size":200,description:"面板日报暂无数据"}))],512),[[c,"ltd"===p(t).authType]]),m(l(la,{data:p(ea),class:"px-[20%] my-[8rem]"},null,8,["data"]),[[c,"ltd"!==p(t).authType]])])}}}),[["__scopeId","data-v-ba7db77c"]]);export{ea as default};
