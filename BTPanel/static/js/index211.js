import{v as e,af as a,hX as t,c as s,k as l}from"./utils-lib.js?v=1756369731";import{c as r,r as n,k as i,aB as o,p as u,q as p,v as d,y as m,e as c,A as y,F as g,a_ as b,x as f,M as h,P as v,B as _,C as k,bl as j,ai as x,aj as w,ah as P,af as C}from"./base-lib.js?v=1756369731";import{createIpRules as O,removeIpRules as D,getIpFlowsAreasInfo as V,getIpFlowTrend as I}from"./site.js?v=1756369731";import{f as q}from"./useController5.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./useStore4.js?v=1756369731";import"./useController6.js?v=1756369731";import"./validator.js?v=1756369731";import"./useMethod5.js?v=1756369731";const S={class:"p-[2rem]"},A={class:"flex items-center justify-between mb-[8px]"},B={key:1},E=r({__name:"index",props:{compData:{default:()=>({})}},setup(r){var E,M;const N=r,{proxy:H}=j(),J=n("PHPMOD"===(null==(M=null==(E=N.compData)?void 0:E.project_config)?void 0:M.type)),Q=n(),T=n("today"),U=i([{label:"IP地址",prop:"ip",render:e=>o("span",{class:e.deny_status?"line-through text-[#bbb] cursor-pointer":"text-[#20a53a] cursor-pointer",on:{click:async()=>{try{await H.$confirm({title:"IP地址",message:"确定要".concat(e.deny_status?"解封":"封禁","当前ip吗？"),icon:"warning"});let a=null;if(e.deny_status)a=await D({data:JSON.stringify({address:e.ip})});else{let t={choose:"address",address:e.ip,domain:"",types:"drop",brief:"网站流量点击IP手动封禁"};a=await O({data:JSON.stringify(t)})}H.$message.request(a),W()}catch(a){}}}},e.ip)},{label:"归属地",render:e=>o("div",{class:"flex",style:{gap:"4px"}},[o("span",e.country),o("span",e.province),o("span",e.city)])},{label:"造成流量",prop:"flow",render:a=>o("span",e(a.flow))}]),$=n([{title:"今天",key:"today"},{title:"昨天",key:"yesterday"},{title:"近7天",key:"l7"},{title:"近30天",key:"l30"},{title:"近1小时",key:"h1"}]),F=n([]),L=n("流量趋势"),{BtECharts:X,getEChart:z,setOption:G,setQuickOption:K}=a({options:{xAxis:{type:"category",data:[]},yAxis:{type:"value",name:"单位:字节",axisLabel:{margin:2,formatter:function(e,a){return e>=1e4&&e<1e7?e=e/1e4+"万":e>=1e7&&(e=e/1e7+"千万"),e}}},grid:{show:!1,bottom:"20%",right:"5%"},series:[{data:[],type:"line"}]}}),R=async()=>{let e=[],a=[0,0,0,0,0,0,0],t=!1;try{const s=await I({site_name:N.compData.name,query_date:T.value});s&&(a=[]),s.forEach(s=>{"h1"!=T.value&&"today"!=T.value&&"yesterday"!=T.value||(t=!0),e.push(ae(String(s.time),t)),a.push(s.flow)})}catch(s){}K(e,a)},W=async()=>{try{const e=await V({site_name:N.compData.name,query_date:T.value});F.value=e}catch(e){}},Y=e=>{L.value=e,"流量趋势"===e?R():W()},Z=e=>{T.value=e,"流量趋势"===L.value?R():W()},ee=()=>{q({...N.compData,tabName:"flowQuota"},"limit")},ae=(e,a)=>{let t="";return a?(t=e.substring(8,10)+":"+(12===e.length?e.substring(10,12):"00"),t):(12===e.length||10===e.length?t=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)+" "+e.substring(8,10)+":"+(12===e.length?e.substring(10,12):"00"):8===e.length&&(t=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)),t)};return u(()=>{R()}),(e,a)=>{const r=x,n=w,i=P,o=C,u=s,j=l;return p(),d("div",S,[m("div",A,[c(n,{modelValue:f(T),"onUpdate:modelValue":a[0]||(a[0]=e=>v(T)?T.value=e:null),onChange:Z,class:"!w-[10rem]"},{default:y(()=>[(p(!0),d(g,null,b(f($),(e,a)=>(p(),h(r,{key:a,label:e.title,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c(o,{modelValue:f(L),"onUpdate:modelValue":a[1]||(a[1]=e=>v(L)?L.value=e:null),onChange:Y},{default:y(()=>[c(i,{label:"流量趋势"}),c(i,{label:"IP TOP 10"})]),_:1},8,["modelValue"]),f(t)||f(J)?k("",!0):(p(),h(u,{key:0,onClick:ee},{default:y(()=>[...a[2]||(a[2]=[_("流量限额>>",-1)])]),_:1}))]),m("div",null,["流量趋势"===f(L)?(p(),h(f(X),{key:0,ref_key:"totalCharts",ref:Q,class:"h-[32rem]"},null,512)):k("",!0),"IP TOP 10"===f(L)?(p(),d("div",B,[c(j,{column:f(U),data:f(F)},null,8,["column","data"])])):k("",!0)])])}}});export{E as default};
