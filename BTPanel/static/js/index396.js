import{c as e,K as s,fP as a,ag as l,W as t}from"./utils-lib.js?v=1756369731";import{c as o,s as i,r,e as u,B as n,p as m,n as p,a4 as d,G as c,q as v,v as _,A as f,x as g,H as j,M as x,F as b,a_ as k,y,z as h,S as w,a9 as V,a$ as q,ai as C,a7 as S}from"./base-lib.js?v=1756369731";import{T as D,U,A as L,V as M}from"./ssl.js?v=1756369731";import{u as T,o as A}from"./index84.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index103.js?v=1756369731";import"./index145.js?v=1756369731";import"./we-com.js?v=1756369731";import"./validator.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./useController13.js?v=1756369731";import"./site.js?v=1756369731";import"./useStore12.js?v=1756369731";import"./useStore4.js?v=1756369731";import"./useController6.js?v=1756369731";import"./useController5.js?v=1756369731";import"./useMethod5.js?v=1756369731";import"./useController4.js?v=1756369731";import"./useStore10.js?v=1756369731";import"./useMethod11.js?v=1756369731";import"./useStore11.js?v=1756369731";import"./useMethod10.js?v=1756369731";const F={class:"p-[16px]"},H={class:"flex items-center"},R=o({__name:"index",props:{compData:{}},emits:["close"],setup(o,{expose:R,emit:z}){const B=o,E=z,{isEdit:G,row:K}=B.compData,{deployFormData:P,siteList:W,certificateDeployTaskList:$,isRefreshDeployTaskList:I}=i(T()),J=r(),N=r(!1),O=r(!1),Q=[{content:"提示：请先在宝塔官网->SSL模块->自动同步中创建同步任务，请不要泄露同步任务的密钥"},{content:u(e,{class:"inline-block",onClick:A},{default:()=>[u("div",{class:"flex items-center"},[u("span",{class:"text-[1.2rem]"},[">>"]),u("span",null,[n("使用说明")])])]})}],X={task_name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符之间",trigger:"blur"}],cloud_id:[{required:!0,message:"请选择证书部署任务",trigger:["blur","change"]}],private_key:[{required:!0,message:"请输入密钥",trigger:"blur"}],sites:[{required:!0,message:"请选择至少一个网站",trigger:"change"},{type:"array",min:1,message:"请选择至少一个网站",trigger:"change"}]},Y=()=>{window.open("https://www.bt.cn/admin/safe","_blank","noopener,noreferrer")};return m(()=>{(async()=>{N.value=!0,s({request:L(),success:e=>{const{data:s}=e;W.value=s.map(e=>({label:e.name,value:e.name})),N.value=!1}})})(),(async()=>{O.value=!0,s({request:M(),success:e=>{$.value=e.data.map(e=>({label:e.synchron_name,host:e.host,value:e.id})),O.value=!1}})})(),p(()=>{var e;G?(P.value.task_id=K.id,P.value.task_name=K.task_name,P.value.cloud_id=K.cloud_id,P.value.private_key=K.private_key,P.value.sites=null==(e=K.sites)?void 0:e.split(",")):P.value.task_name=a(8)})}),d(()=>{P.value={}}),R({onConfirm:async()=>{if(J.value)try{await J.value.validate();const e={...P.value,sites:P.value.sites.join(",")};s({loading:G?"正在修改同步任务":"正在创建同步任务",message:!0,request:G?D(e):U(e),success:e=>{e.status&&(I.value=!0,E("close"))}})}catch(e){}}}),(s,a)=>{const o=w,i=V,r=q,n=C,m=l,p=e,d=S,D=t,U=c("bt-loading");return v(),_("div",F,[u(d,{ref_key:"formRef",ref:J,model:g(P),rules:X,"label-width":"120px"},{default:f(()=>[u(i,{label:"名称",prop:"task_name"},{default:f(()=>[u(o,{class:"!w-[230px]",placeholder:"请输入名称",disabled:g(G),modelValue:g(P).task_name,"onUpdate:modelValue":a[0]||(a[0]=e=>g(P).task_name=e)},null,8,["disabled","modelValue"])]),_:1}),u(i,{label:"选择证书部署任务",prop:"cloud_id"},{default:f(()=>[j((v(),x(m,{class:"!w-[230px]",placeholder:"请选择证书部署任务",modelValue:g(P).cloud_id,"onUpdate:modelValue":a[1]||(a[1]=e=>g(P).cloud_id=e)},{default:f(()=>[(v(!0),_(b,null,k(g($),e=>(v(),x(n,{key:e.value,label:e.label,value:e.value},{default:f(()=>[y("div",H,[y("span",null,h(e.label),1),u(r,{direction:"vertical"}),y("span",null,h(e.host),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[U,g(O)]]),u(p,{class:"ml-[12px]",onClick:Y},{default:f(()=>[...a[4]||(a[4]=[y("div",{class:"flex items-center"},[y("span",{class:"text-[1.2rem]"},">>"),y("span",null,"去创建")],-1)])]),_:1})]),_:1}),u(i,{label:"密钥",prop:"private_key"},{default:f(()=>[u(o,{class:"!w-[230px]",placeholder:"请输入密钥",modelValue:g(P).private_key,"onUpdate:modelValue":a[2]||(a[2]=e=>g(P).private_key=e)},null,8,["modelValue"]),u(p,{class:"ml-[12px]",onClick:Y},{default:f(()=>[...a[5]||(a[5]=[y("div",{class:"flex items-center"},[y("span",{class:"text-[1.2rem]"},">>"),y("span",null,"去获取")],-1)])]),_:1})]),_:1}),u(i,{label:"选择网站",prop:"sites"},{default:f(()=>[j(u(m,{class:"!w-[230px]",multiple:!0,placeholder:"请选择网站",options:g(W),modelValue:g(P).sites,"onUpdate:modelValue":a[3]||(a[3]=e=>g(P).sites=e)},null,8,["options","modelValue"]),[[U,g(N)]])]),_:1})]),_:1},8,["model"]),u(D,{options:Q,listStyle:"disc",class:"ml-[20px]"})])}}});export{R as default};
