import{ay as e,K as a,h9 as t,G as r,j as o,ha as s,L as l,bj as n,a2 as p}from"./utils-lib.js?v=1756369731";import{j as i,U as u,r as m,s as v,n as c,c as d,ay as g,g as w,e as h,B as b,H as y,bx as O,ax as f,aB as x,p as _,a4 as E,q as k,M as j,x as C,v as P}from"./base-lib.js?v=1756369731";import{h as S,d as q,k as D,b as T,F as N,a as A}from"./form-item.js?v=1756369731";import{f as F}from"./validator.js?v=1756369731";import{D as I,s as R}from"./useController4.js?v=1756369731";import{g as J}from"./useStore3.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./useController5.js?v=1756369731";import"./site.js?v=1756369731";import"./useStore4.js?v=1756369731";import"./useController6.js?v=1756369731";import"./useMethod5.js?v=1756369731";const L=i("DOCKERSITE-CREATE-SITE-BY-ENV-STORE",()=>{const e=u([]),a=u([]),t=m(!1);return{envOptions:e,portOptions:a,popoverFocus:t,getEnvOptions:async(e,a)=>{const{getEnvList:t}=I(),r=await t({runtime_type:e,p:1,row:100});Array.isArray(null==r?void 0:r.data)&&(a.value=r.data.map(e=>{const a=e.ports?JSON.parse(e.ports):{},t=Object.values(a).map(e=>({label:e[0].HostPort,value:e[0].HostPort}));return{label:e.name,value:"".concat(e.name,":").concat(e.version),path:e.path,portList:t}}))},getPortOptions:async(a,t)=>{const r=e.value.find(e=>e.value===a);return r?(t.value=JSON.parse(JSON.stringify(r.portList)),JSON.parse(JSON.stringify(r.portList))):(t.value=[],[])},$reset:()=>{e.value=[],a.value=[],t.value=!1}}}),{getEnvOptions:B,getPortOptions:V}=L(),{envOptions:U,portOptions:$}=v(L()),H=()=>({domain:"",type:"php",port:"9000",env:"",remark:"",path:""}),z=async(e,a)=>{a.value.port="php"===e?"9000":"",await B(e,U),c(()=>{var t,r;U.value.length>0?(a.value.env=U.value[0].value,a.value.path="php"===e?"/www/dk_project/wwwroot/".concat((null==(r=null==(t=a.value.domain)?void 0:t.split("\n")[0])?void 0:r.split(":")[0])||""):U.value[0].path||""):(a.value.env="",a.value.path=""),V(a.value.env,$),c(()=>{$.value.length>0&&(a.value.port=$.value[0].value)})})},K=d({__name:"index",props:{compData:{default:!1}},setup(s,{expose:l}){const n=s,{getEnvOptions:p,getPortOptions:i,$reset:u}=L(),{envOptions:m,portOptions:d,popoverFocus:P}=v(L()),I=g("popupClose",()=>{}),{BtForm:J,submit:B,param:K}=r({data:H,options:e=>(p("php",m),w(()=>[S("域名",()=>h(f,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:P.value,"onUpdate:visible":e=>P.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>h("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[b("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),h("br",null,null),b("IP地址格式：192.168.1.199"),h("br",null,null),b("泛解析添加方法 *.domain.com"),h("br",null,null),b("如另加端口格式为 www.domain.com:88")]),reference:()=>y(h(o,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{P.value=!0},onInput:()=>{var a;"php"===e.value.type&&(e.value.path="/www/dk_project/wwwroot/".concat((null==(a=e.value.domain.split("\n")[0])?void 0:a.split(":")[0])||""))},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[O,"popover"]])}),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),q([D("类型","type",[{label:"PHP",value:"php"},{label:"Java",value:"java"},{label:"Go",value:"go"},{label:"Python",value:"python"}],{attrs:{class:"!w-[17rem]",onChange:async a=>{z(a,e)}},rules:[{required:!0,message:"请选择容器",trigger:"change"}]}),..."php"===e.value.type?[T("PHP-FPM端口","port",{attrs:{class:"!w-[17rem]",placeholder:"请输入端口"},labelAttrs:{class:"ml-[2rem]"},rules:[{required:!0,message:"请输入端口",trigger:"blur"},{validator:(e,a,t)=>{/^\d+$/.test(a)?Number(a)<1||Number(a)>65535?t(new Error("请输入正确的端口号")):t():t(new Error("端口号必须为数字"))},trigger:"blur"}]})]:[D("端口","port",d.value,{attrs:{class:"!w-[22rem]",placeholder:"环境端口"},rules:[{required:!0,message:"请选择端口",filterable:!0}]})]]),q([D("环境","env",m.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择环境",onChange:a=>{(async(e,a)=>{V(e,$),c(()=>{var t,r,o;$.value.length>0&&(a.value.port=$.value[0].value),a.value.path="php"===a.value.type?"/www/dk_project/wwwroot/".concat((null==(r=null==(t=a.value.domain)?void 0:t.split("\n")[0])?void 0:r.split(":")[0])||""):(null==(o=U.value.find(a=>a.value===e))?void 0:o.path)||""})})(a,e)}},rules:[{required:!0,message:"请选择环境",trigger:"change",filterable:!0}]}),N(()=>x("span",{class:"cursor-pointer text-primary h-[3.2rem] leading-[3.2rem] ml-[1.5rem] inline-block",onClick:()=>{R(()=>{p(e.value.type,m)})}},"创建环境"),{key:"jump",rules:{}})]),A("运行目录","path",{attrs:{class:"!w-[320px]",placeholder:"请选择运行目录"},rules:[{required:!0,message:"请选择运行目录",trigger:"change"}],icon:"icon-file_mode",iconClick:()=>{var a;F({type:"dir",path:(a=e).value.path||"/www/dk_project/wwwroot",change:(e,t)=>{a.value.path=e}})}}),T("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})])),submit:async(r,o,s)=>(await o(),await(async(r,o)=>{const{refreshSiteTable:s}=e(),l={domains:r.domain,type:r.type,name:r.env,..."php"===r.type?{port:Number(r.port)}:{},site_path:r.path,remark:r.remark,port:Number(r.port)};await a({loading:"正在创建，请稍后...",request:t(l),message:!0,success:e=>{s(),o&&o(e)}})})(r.value,e=>{e.status&&(u(),I())}))});return _(()=>{n.compData&&c(()=>{K.value.type=n.compData.type,K.value.env=n.compData.env,z(n.compData.type,K)})}),E(()=>{}),l({onConfirm:B}),(e,a)=>(k(),j(C(J)))}}),M=i("DOCKERSITE-CREATE-SITE-BY-PROXY-STORE",()=>{const e=u([]),a=u([]),t=m(!1);return{conOptions:e,portOptions:a,popoverFocus:t,getConOptions:async e=>{const{data:a}=await s({type:"container"});Array.isArray(null==a?void 0:a.data)&&(e.value=a.data.map(e=>{const a=e.ports.map(e=>({label:e,value:e}));return{label:e.name,value:e.id,portList:a}}))},getPortOptions:async(a,t)=>{const r=e.value.find(e=>e.value===a);t.value=r?JSON.parse(JSON.stringify(r.portList)):[]},$reset:()=>{e.value=[],t.value=!1}}}),Y=()=>({domain:"",name:"",container_id:"",port:"",remark:""}),G=d({__name:"index",setup(s,{expose:l}){const n=M(),{popoverFocus:p,conOptions:i,portOptions:u}=v(n),{getConOptions:m,$reset:d}=n,x=g("popupClose",()=>{}),{BtForm:E,submit:P}=r({data:Y,options:e=>w(()=>[S("域名",()=>h(f,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:p.value,"onUpdate:visible":e=>p.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>h("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[b("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),h("br",null,null),b("IP地址格式：192.168.1.199"),h("br",null,null),b("泛解析添加方法 *.domain.com"),h("br",null,null),b("如另加端口格式为 www.domain.com:88")]),reference:()=>y(h(o,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{p.value=!0},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[O,"popover"]])}),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),D("容器","container_id",i.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择容器",onChange:a=>((e,a)=>{var t;const r=M(),{conOptions:o,portOptions:s}=v(r),{getPortOptions:l}=r;a.value.port="",a.value.name=(null==(t=o.value.find(a=>a.value===e))?void 0:t.label)||"",l(e,s),c(()=>{s.value.length>0&&(a.value.port=s.value[0].value)})})(a,e)},rules:[{required:!0,message:"请选择容器",trigger:"change"}]}),D("端口","port",u.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择端口"},rules:[{required:!0,message:"请选择端口"}]}),T("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})]),submit:async(r,o,s)=>(await o(),(async(r,o)=>{const{refreshSiteTable:s}=e(),l={domains:r.domain,type:"proxy",name:r.name,container_id:r.container_id,port:Number(r.port),remark:r.remark};await a({loading:"正在创建，请稍后...",request:t(l),message:!0,success:e=>{s(),o&&o(e)}})})(r.value,e=>{e.status&&(d(),x())}))});return _(()=>{m(i)}),l({onConfirm:P}),(e,a)=>(k(),j(C(E)))}}),X=i("DOCKERSITE-CREATE-SITE-BY-APP-STORE",()=>{const e=u([]),a=u([]),t=m(!1);return{appOptions:e,portOptions:a,popoverFocus:t,getAppOptions:async e=>{const{data:a}=await s({type:"app"});Array.isArray(null==a?void 0:a.data)&&(e.value=a.data.map(e=>{const a=e.port.map(e=>({label:e,value:e}));return{label:"".concat(e.service_name,"(").concat(e.apptitle,")"),value:e.service_name,portList:a}}))},getPortOptions:async(a,t)=>{const r=e.value.find(e=>e.value===a);t.value=r?JSON.parse(JSON.stringify(r.portList)):[]},$reset:()=>{e.value=[],a.value=[],t.value=!1}}}),Q=()=>({domain:"",app:"",remark:""}),W=d({__name:"index",setup(s,{expose:p}){const{refs:{deployMenuData:i}}=J(),u=X(),{popoverFocus:m,appOptions:d,portOptions:E}=v(u),{getAppOptions:P,$reset:A}=u,F=g("popupClose",()=>{}),{BtForm:I,submit:R}=r({data:Q,options:e=>w(()=>[S("域名",()=>h(f,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:m.value,"onUpdate:visible":e=>m.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>h("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[b("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),h("br",null,null),b("IP地址格式：192.168.1.199"),h("br",null,null),b("泛解析添加方法 *.domain.com"),h("br",null,null),b("如另加端口格式为 www.domain.com:88")]),reference:()=>y(h(o,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{m.value=!0},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[O,"popover"]])}),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),q([D("应用","app",d.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择应用",onChange:a=>((e,a)=>{var t;const r=X(),{appOptions:o,portOptions:s}=v(r),{getPortOptions:l}=r;a.value.port="",a.value.app=(null==(t=o.value.find(a=>a.value===e))?void 0:t.value)||"",l(e,s),c(()=>{s.value.length>0&&(a.value.port=s.value[0].value)})})(a,e)},rules:[{required:!0,message:"请选择应用",trigger:"change"}]}),N(()=>x("span",{class:"cursor-pointer text-primary h-[3.2rem] leading-[3.2rem] ml-[1.5rem] inline-block",onClick:async()=>{const{router:e}=await l(()=>import("./utils-lib.js?v=1756369731").then(e=>e.jG),__vite__mapDeps([]),import.meta.url);n(),i.value.app_type="all",e.push({name:"docker-appstore"})}},"安装新应用"),{key:"jump",rules:{}})]),D("端口","port",E.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择端口"},rules:[{required:!0,message:"请选择端口"}]}),T("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})]),submit:async(r,o,s)=>{await o(),(async(r,o)=>{const{refreshSiteTable:s}=e(),l={domains:r.domain,type:"app",name:r.app,port:Number(r.port),remark:r.remark};await a({loading:"正在创建，请稍后...",request:t(l),message:!0,success:e=>{s(),o&&o(e)}})})(r.value,e=>{e.status&&(A(),F())})}});return _(()=>{P(d)}),p({onConfirm:R}),(e,a)=>(k(),j(C(I)))}}),Z={class:"p-[20px]"},ee=d({__name:"index",props:{compData:{default:{}}},setup(e,{expose:a}){const t=e,r=m(t.compData.type||"runEnv"),{BtTabs:o,tabsRefs:s}=p({type:"card",value:r,options:[{label:"运行环境",name:"runEnv",render:()=>h(K,{compData:"runEnv"===t.compData.type&&t.compData.formData},null)},{label:"反代容器",name:"proxyContainer",lazy:!0,render:()=>h(G,null,null)},{label:"从应用创建",name:"addPack",lazy:!0,render:()=>h(W,null,null)}]});return a({onConfirm:async e=>{s()[r.value].onConfirm(e)}}),(e,a)=>(k(),P("div",Z,[h(C(o))]))}});export{ee as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
