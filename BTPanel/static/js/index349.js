import{G as e,j as t,bg as a,aH as o,ag as r,H as l,_ as s,a2 as i}from"./utils-lib.js?v=1756369731";import{c as n,r as p,g as d,e as u,B as m,q as c,M as h,A as y,y as v,x as f,_ as g,P as b,a9 as x,s as w,p as _,v as T}from"./base-lib.js?v=1756369731";import{B as j}from"./index100.js?v=1756369731";import{h as k,f as V,t as U,i as C,S as $}from"./useController12.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./validator.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./useStore4.js?v=1756369731";import"./site.js?v=1756369731";import"./useController6.js?v=1756369731";const E={class:"flex items-center"},H=n({__name:"add-proxy-http",setup(i,{expose:n}){const w=p(!1),_=p(!1),T=async()=>{P.value.proxysite="url"===P.value.targetType?"http://":""},$=e=>{if("object"==typeof e)return;if("unix"===P.value.targetType)return void(P.value.todomain="$http_host");let t=e.replace(/^http[s]?:\/\//,"");t=t.replace(/(:|\?|\/|\\)(.*)$/,""),P.value.todomain=t},{BtForm:H,submit:I,param:P}=e({data:{isEdit:!1,targetType:"url",sitename:"",cache:!1,advanced:!1,cachetime:1,proxysite:"http://",todomain:"$http_host",remark:"",port:80,domains:""},options:e=>d(()=>[{type:"custom",render:()=>u(a,{label:"域名",prop:"domains"},{default:()=>[u(j,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"370",visible:w.value,"onUpdate:visible":e=>w.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>u("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[m("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),u("br",null,null),m("IP地址格式：192.168.1.199"),u("br",null,null),m("泛解析添加方法 *.domain.com"),u("br",null,null),m("如另加端口格式为 www.domain.com:88")]),reference:()=>u(t,{modelValue:e.value.domains,"onUpdate:modelValue":t=>e.value.domains=t,type:"textarea",width:"42rem",rows:6,resize:"none",onInput:t=>{"object"!=typeof t&&(e.value.remark=t.split("\n")[0])},onFocus:()=>w.value=!0,placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null)})]}),rules:{domains:[{required:!0,message:"请输入域名",trigger:"blur"},{trigger:["blur","input","change"],validator:(e,t,a)=>{const r=t.split("\n").filter(e=>e.length),l=r.findIndex(e=>e.split(":")[0].length<3);r.map((e,t)=>{o(e.split(":")[0])||a(new Error("当前域名格式错误，第".concat(t+1,"行，内容:").concat(e)))}),-1!==l?a(new Error("第 ".concat(l+1," 个域名长度不符合要求（必须大于3个字符）"))):a()}}]}},{type:"slots",key:"proxysite",rules:{proxysite:[{required:!0,message:"请输入目标地址",trigger:"blur"},{validator:(t,a,o)=>{if(!a)return void o(new Error("url"===e.value.targetType?"目标地址不能为空":"请选择sock文件"));if("unix"===e.value.targetType)return void o();const r=a.trim();if(/^https?:\/\/$/.test(r))return void o(new Error("请输入目标URL域名"));if(!/^https?:\/\/.+/.test(r))return void o(new Error("目标URL格式不正确，应以http://或https://开头"));let l=a.replace(/^http[s]?:\/\//,"");l=l.replace(/(:|\?|\/|\\)(.*)$/,""),/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(l)?e.value.todomain="$http_host":e.value.todomain=l,o()}}]}},{type:"slots",key:"todomain",rules:{todomain:[{required:!0,message:"请输入发送域名",trigger:["blur","change"]}]}},{type:"input",label:"备注",key:"remark",attrs:{placeholder:"请输入备注，可为空",width:"42rem"}},{type:"help",options:k}]),submit:V});return n({onConfirm:async e=>{await I()&&e("close")}}),(e,a)=>{const o=x;return c(),h(f(H),{class:"p-2rem","label-width":"100px"},{proxysite:y(()=>[u(o,{label:"目标",prop:"proxysite","label-width":"100px"},{default:y(()=>[v("div",E,[u(o,{"label-width":"50px"},{default:y(()=>[u(f(r),{modelValue:f(P).targetType,"onUpdate:modelValue":a[0]||(a[0]=e=>f(P).targetType=e),placeholder:"请选择",options:f(U),style:{width:"16rem","margin-right":"1rem"},onChange:T},null,8,["modelValue","options"])]),_:1}),u(f(t),{modelValue:f(P).proxysite,"onUpdate:modelValue":a[2]||(a[2]=e=>f(P).proxysite=e),placeholder:"url"===f(P).targetType?"请输入目标地址":"请选择sock文件",width:"24rem",iconType:"url"!==f(P).targetType&&"folder",onInput:$},g({_:2},["url"!==f(P).targetType?{name:"append",fn:y(()=>[u(f(l),{onClick:a[1]||(a[1]=e=>f(C)(f(P)))},{default:y(()=>[u(f(s),{icon:"el-folder-opened",class:"cursor-pointer"})]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","iconType"])])]),_:1})]),todomain:y(()=>[u(o,{label:"发送域名(host)",prop:"todomain","label-width":"100px"},{default:y(()=>[u(f(j),{placement:"top-start",effect:"dark",title:"",content:"请求转发到后端服务器时的主机名，一般为$http_host，如果目标URL是域名，则需要改为域名",width:"400",visible:f(_),"onUpdate:visible":a[5]||(a[5]=e=>b(_)?_.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:y(()=>[u(f(t),{onFocus:a[3]||(a[3]=e=>_.value=!0),modelValue:f(P).todomain,"onUpdate:modelValue":a[4]||(a[4]=e=>f(P).todomain=e),placeholder:"请输入发送域名",width:"42rem"},null,8,["modelValue"])]),_:1},8,["visible"])]),_:1})]),_:1})}}}),I=n({__name:"index",emits:["close"],setup(e,{expose:t,emit:a}){const{proxyType:o}=w($()),r=p("http"),l=a,s=p(),{BtTabs:n,tabs:d,tabsRefs:m}=i({type:"card",value:r,options:[{label:"HTTP",name:"http",render:()=>u(H,null,null)}]});return t({onConfirm:()=>{switch(d.value){case"http":s.value.onConfirm(l);break;case"tcp":m().tcp.onConfirm(l)}}}),_(()=>{r.value=o.value}),(e,t)=>(c(),T("div",null,[u(H,{ref_key:"addProxyHttpRef",ref:s},null,512)]))}});export{I as default};
