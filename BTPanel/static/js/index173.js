import{K as e,bT as a,M as l,aX as s,v as t,aL as n,j as i,al as r,e as o}from"./utils-lib.js?v=1756369731";import{_ as u}from"./index116.js?v=1756369731";import{r as c,c as m,s as d,p,G as v,q as f,v as g,e as _,A as x,y as b,H as w,x as y,P as h,B as k,F as V,a_ as C,M as j,z as U,C as q,aA as W,D as S,ai as H,aj as A,au as D,aw as N,a9 as T,a7 as z}from"./base-lib.js?v=1756369731";import{B as E}from"./index140.js?v=1756369731";import{S as M,_ as P}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1756369731";import{S as R,_ as B}from"./index.vue_vue_type_script_setup_true_lang8.js?v=1756369731";import{Z as F,W as I,U as L,m as G,$ as K,a0 as O,V as X}from"./validator.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./ace.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";const Z=R(),$=M(),J=c({}),Q={active:"活动连接(Active connections)",accepts:"总连接次数(accepts)",handled:"总握手次数(handled)",requests:"总请求数(requests)",Reading:"请求数(Reading)",Writing:"响应数(Writing)",Waiting:"驻留进程(Waiting)",worker:"工作进程(Worker)",workercpu:"Nginx占用CPU(Workercpu)",workermen:"Nginx占用内存(Workermen)"},Y=c([]),ee=c("service"),ae=c(""),le=c(!1),se=c(!1),te=c([]),ne=c(""),ie=c(""),re=c(""),oe=c([]),ue=async()=>{let a={};Y.value.forEach(e=>{a[e.name]=e.value}),await e({loading:"正在保存中，请稍后...",request:F(a),message:!0})},ce=async()=>{await e({loading:"正在保存中，请稍后...",request:a({path:"/www/server/nginx/conf/nginx.conf",data:ae.value,encoding:"utf-8"}),message:!0})},me=async()=>{await e({loading:le,request:I({path:"/www/wwwlogs/nginx_error.log"}),data:{msg:[String,ne]}})},de=async()=>{if(ie.value!==re.value)try{await L({sName:"nginx",version:ie.value,min_version:""}),G()}catch(e){}else l.error("当前版本与选择版本一致")},pe=({props:{name:a}})=>{switch(a){case"service":ve();break;case"performance":(async()=>{await e({loading:se,request:K(),data:[Array,Y]})})();break;case"config":(async()=>{await e({loading:le,request:X({path:"/www/server/nginx/conf/nginx.conf"}),data:{data:[String,ae]}})})();break;case"load":(async()=>{await e({loading:le,request:O(),success:e=>{if(s("status",e)&&!e.status)l.msg({message:e.msg||"获取数据失败",type:"error",dangerouslyUseHTMLString:!0,customClass:"bt-message-error-html ",showClose:!0});else{te.value=[];const a=["bytes","bytes_read","bytes_written"];Object.keys(e.data).forEach(l=>{te.value.push({name:l,ps:Q[l],value:a.includes(l)?t(Number(e.data[l])):e.data[l]})});const l=te.value.findIndex(e=>"active"===e.name);if(l>-1){const[e]=te.value.splice(l,1);te.value.unshift(e)}}}})})();break;case"logs":me()}},ve=e=>{ee.value="service",e&&(J.value=e),$.init(J.value),Z.init({name:"nginx"}),ie.value=J.value.version.split(".")[0]+"."+J.value.version.split(".")[1],re.value=J.value.version.split(".")[0]+"."+J.value.version.split(".")[1],oe.value=J.value.versions},fe={class:"my-[12px]"},ge={class:"flex text-[#666] items-center"},_e={class:"flex flex-col text-[#666] performance"},xe={key:0,class:"flex items-center"},be={key:1,class:"flex items-center"},we=o(m({__name:"index",props:{compData:{default:{}}},setup(e){const a=e,{compData:l}=d(M());return p(()=>{ve(a.compData),l.value.refreshEvent=async()=>{const{data:e}=await n({name:"web"});l.value.status=e.s_status}}),(e,a)=>{const l=W,s=E,t=S,n=H,o=A,c=D,m=N,d=i,p=T,M=z,R=u,F=r,I=v("bt-loading");return f(),g("div",null,[_(F,{modelValue:y(ee),"onUpdate:modelValue":a[2]||(a[2]=e=>h(ee)?ee.value=e:null),type:"left-bg-card",class:"h-full",onTabClick:y(pe)},{default:x(()=>[_(l,{label:"服务",name:"service"},{default:x(()=>[_(P),_(B)]),_:1}),_(l,{label:"配置文件",name:"config"},{default:x(()=>[a[4]||(a[4]=b("span",{class:"my-[4px] text-[#666]"},"提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换",-1)),b("div",fe,[w(_(s,{class:"!h-[38rem] !w-[52rem]",modelValue:y(ae),"onUpdate:modelValue":a[0]||(a[0]=e=>h(ae)?ae.value=e:null),id:"configContent",filePath:"/www/server/nginx/conf/nginx.conf"},null,8,["modelValue"]),[[I,y(le)]])]),_(t,{type:"primary",onClick:y(ce)},{default:x(()=>[...a[3]||(a[3]=[k("保存",-1)])]),_:1},8,["onClick"]),a[5]||(a[5]=b("ul",{class:"leading-8 mt-20px text-[1.2rem] list-disc ml-[20px]"},[b("li",null,"此处为nginx主配置文件,若您不了解配置规则,请勿随意修改")],-1))]),_:1}),_(l,{label:"版本切换",name:"version"},{default:x(()=>[b("div",ge,[a[7]||(a[7]=b("span",null,"选择版本",-1)),_(o,{class:"mx-[12px] !w-[18rem]",modelValue:y(ie),"onUpdate:modelValue":a[1]||(a[1]=e=>h(ie)?ie.value=e:null)},{default:x(()=>[(f(!0),g(V,null,C(y(oe),(e,a)=>(f(),j(n,{key:a,label:"nginx "+e.m_version,value:e.m_version},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),_(t,{type:"primary",onClick:y(de)},{default:x(()=>[...a[6]||(a[6]=[k("切换",-1)])]),_:1},8,["onClick"])])]),_:1}),_(l,{label:"负载状态",name:"load"},{default:x(()=>[w((f(),j(m,{maxHeight:"500",data:y(te),border:"",style:{width:"100%"}},{default:x(()=>[_(c,{prop:"ps",label:"字段"}),_(c,{prop:"value",label:"当前值"})]),_:1},8,["data"])),[[I,y(le)]])]),_:1}),w((f(),j(l,{label:"性能调整",name:"performance"},{default:x(()=>[b("div",_e,[_(M,{"label-position":"right","label-width":"186px"},{default:x(()=>[(f(!0),g(V,null,C(y(Y),(e,a)=>(f(),j(p,{label:e.name,key:a},{default:x(()=>["gzip"!=e.name?(f(),g("div",xe,[_(d,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,type:"worker_processes"!==e.name?"number":""},null,8,["modelValue","onUpdate:modelValue","type"]),b("span",null,U(e.ps),1)])):q("",!0),"gzip"==e.name?(f(),g("div",be,[_(o,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"!w-[8rem] mx-8px"},{default:x(()=>[_(n,{label:"开启",value:"on"}),_(n,{label:"关闭",value:"off"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),b("span",null,U(e.ps),1)])):q("",!0)]),_:2},1032,["label"]))),128)),_(p,{label:" "},{default:x(()=>[_(t,{onClick:y(ue),type:"primary"},{default:x(()=>[...a[8]||(a[8]=[k("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1})),[[I,y(se)]]),_(l,{label:"错误日志",name:"logs"},{default:x(()=>[_(R,{content:y(ne),autoScroll:!0,isHtml:!0,"full-screen":{title:"全屏查看日志",onRefresh:y(me)},style:"height:540px"},null,8,["content","full-screen"])]),_:1})]),_:1},8,["modelValue","onTabClick"])])}}}),[["__scopeId","data-v-e14a026d"]]);export{we as default};
