import{bU as e,A as t,M as a,u as n,_ as s,l as o,L as l,o as i,K as r}from"./utils-lib.js?v=1756369731";import{siteRname as c,getNpsQuestion as u,addSiteTypes as p,modifySiteTypes as m,removeSiteType as d,batchPhpType as v,removeProject as _}from"./site.js?v=1756369731";import{b as f,B as y,c as w}from"./column.js?v=1756369731";import{_ as g}from"./index104.js?v=1756369731";import{c as b,r as h,t as j,p as k,a4 as C,e as x,ax as D,B as E,H as S,G as O}from"./base-lib.js?v=1756369731";import{c as T,h as P}from"./validator.js?v=1756369731";import{u as L,S as M}from"./useStore4.js?v=1756369731";const I=new EventTarget,A=b({props:{onClick:{type:Function,default:()=>{}},row:{type:Object,default:()=>({})},refresh:{type:Function,default:()=>{}}},setup(n,s){const o=h(!1),l=h(!1),i=h(!1),{row:r}=j(n),u=h("site-name-".concat(e(5),"-").concat(r.value.id)),p=()=>{o.value=!1},m=()=>{l.value=!0,o.value=!0;const e=document.getElementById(u.value);e&&setTimeout(()=>{e.focus()},100)},d=e=>{"Enter"!==e.key&&13!==e.keyCode||v(e)},v=async e=>{try{if(r.value.rname===e.target.value)return l.value=!1,void(o.value=!1);const t=await c({id:r.value.id,rname:e.target.value});a.request(t),o.value=!1,l.value=!1,t.status&&n.refresh()}catch(t){o.value=!1}};return k(()=>{I.addEventListener("hide-all-popovers",p)}),C(()=>{I.removeEventListener("hide-all-popovers",p)}),()=>x("div",null,[x(D,{placement:"right",width:"220","popper-class":"myPopover",visible:o.value},{default:()=>x("div",{class:"web_name_hover",onMouseenter:()=>{i.value=!0},onMouseleave:()=>{i.value=!1,l.value||(o.value=!1)}},[x("div",{class:"web_name_title"},[E("网站名："),x("span",{class:"web_name_text"},[l.value?"":r.value.rname,x("input",{id:u.value,class:"bt-input ".concat(l.value?"":"hide"),onKeyup:d,onBlur:v,size:"mini",value:r.value.rname,placeholder:"点击编辑内容，按回车或失去焦点自动保存",style:"width: 140px;"},null)])]),x("div",{class:"web_name_setting"},[x("span",{class:"web_name_copy bt-link",onClick:()=>{t({value:r.value.rname})}},[x("i",{class:"svgtofont-icon-copy mr-4x text-[#666] text-[1.6rem]"},null),E("复制网站名")]),x("span",{onClick:m,class:"web_name_rename bt-link"},[x("i",{class:"svgtofont-icon-memo-active mr-4x text-[#666] text-[1.6rem]"},null),E("重命名")])])]),reference:()=>x("span",{onMouseenter:()=>{I.dispatchEvent(new CustomEvent("hide-all-popovers")),o.value=!0},onMouseleave:()=>{setTimeout(()=>{l.value||i.value||(o.value=!1)},500)},onClick:()=>{n.onClick(r)},class:"justify-start bt-link cursor-pointer"},[r.value.rname])})])}}),{plugin:q}=n(),{isRefreshList:R,activeType:V,batchConfig:W,isSiteMult:F}=L(),{delGeneralProjectEvent:G,getClassList:J,setProjectStatusEvent:N}=M(),z=h(),B=h([]),H=e=>({label:(null==e?void 0:e.label)||"项目名称",prop:"name",minWidth:120,sortable:!0,render:t=>{const a=q.value.web,n="java"===(null==e?void 0:e.type)&&!(t.is_file_ok||void 0===t.is_file_ok);return x("div",{class:"flex items-center inline-block truncate"},[(null==t?void 0:t.waf)&&((null==t?void 0:t.isWaf)||void 0===(null==t?void 0:t.isWaf))?x("span",{class:"w-[1.6rem] mr-[4px] cursor-pointer flex items-center",onClick:()=>{e.openPlugin&&e.openPlugin(t,"iconWaf")}},[x(s,{icon:"left-waf",class:"!text-[2rem] ".concat(t.waf.status&&"nginx"===(null==a?void 0:a.type)&&(null==a?void 0:a.status)&&(null==a?void 0:a.setup)?"!text-primary":"!text-[#999]"),size:20},null)]):"",x("span",{class:"!w-full !whitespace-pre-line flex ml-[4px]",title:(null==t?void 0:t.cn_name)&&t.name!==(null==t?void 0:t.cn_name)?null==t?void 0:t.cn_name:""},["php"===(null==e?void 0:e.type)?x(A,{row:t,onClick:()=>e.onClick(t),refresh:()=>{R.value=!0}},null):x("span",{onClick:()=>{n||e.onClick(t)},class:"justify-start cursor-pointer ".concat(n?"":"bt-link"," ")},[t.name])])])}}),K=e=>{const t=null==e?void 0:e.type;return f({prop:"run",event:e.onClick,data:["未启动","运行中"],width:80,function:a=>{let n=null==a?void 0:a.run;return(null==e?void 0:e.prop)&&(n=null!==a[e.prop]),"nodejs"===t&&"pm2"===a.project_config.project_type&&void 0===a.run?S(x("div",{class:"loading h-[2rem]"},null),[[O("bt-loading"),!0]]):x(D,{placement:"right",width:"160","popper-class":"detail-popover",trigger:"hover"},{default:()=>x("div",{class:"flex items-center"},[x("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a)},[n?"停止":"启动"]),x(g,null,null),x("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a,"restart")},[E("重启")]),x(g,null,null),x("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a,"setting")},[E("告警设置")])]),reference:()=>x(y,{modelValue:n?1:0,data:["未启动","运行中"],onClick:()=>e.onClick(a)},null)})}})},U=e=>({label:"到期时间",isCustom:!0,sortable:!0,prop:"edate",minWidth:100,width:100,render:e=>{const t=(new Date).setHours(0,0,0,0),a=Date.now(),n="0000-00-00"!==e.edate?new Date(e.edate).getTime():null,s=n&&n<t;return x("span",{class:"cursor-pointer "+(s?"bt-danger":n&&n-a<6048e5?"bt-warn":"bt-link"),onClick:()=>Q(e)},[s?"已过期":"0000-00-00"===e.edate?"永久":e.edate])}}),Q=(e,t=!1)=>{o({title:"【".concat(e.name,"】到期时间设置"),area:48,component:()=>l(()=>import("./index203.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{rowData:e,isMult:t},showFooter:!0})},X=e=>({label:"SSL证书",prop:"site_ssl",isCustom:!0,sortable:!0,minWidth:100,width:100,render:t=>{var a,n,s;return x("span",{class:"cursor-pointer ".concat(-1===t.ssl?"text-[#f0ad4e]":(null==(a=t.ssl)?void 0:a.endtime)<0?"text-danger":"text-[#20a53a]"),onClick:()=>{e.onClick(t)}},[-1===t.ssl?"未部署":(null==(n=t.ssl)?void 0:n.endtime)>0?"剩余".concat(null==(s=t.ssl)?void 0:s.endtime,"天"):"已过期"])}}),Y=()=>({label:"端口",prop:"port",width:120}),Z=()=>({label:"部署证书",value:"deploy",event:async(e,t,a,n,s,o)=>{W.value=o,F.value=!0,me(a.value,s)}}),$=e=>({label:"设置分类",value:"setClass",event:async(t,a,n,s,o,l)=>{await T({name:"分类",options:e.classList.value.filter(e=>"all"!==e.value&&"-2"!==e.value),selectList:n.value,request:async(t,a)=>{const{exclude:s,enable:i}=l,c=P(n.value,s,i,{params:{project_type:V.value.toUpperCase(),id:t.id}});await r({loading:"正在批量设置分类，请稍后...",request:v(c),message:!0}),o&&o(),R.value=!0,a(),e.callback&&e.callback()}})}}),ee=(e,t)=>{o({title:(null==e?void 0:e.title)||"批量操作结果",area:t||42,component:()=>l(()=>import("./index118.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:e})},te=(e,t)=>{const a="go"===e;o({title:"".concat(a?"Go":"Python","-").concat(a?"SDK":"","版本管理"),area:50,component:()=>l(()=>import("./index216.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{type:e,refresh:t}})},ae=async(e,t=V.value)=>{await i({title:"".concat("删除".concat(t,"项目-").concat(e.name)),content:"".concat("风险操作，此操作不可逆，删除".concat(e.name,"项目后您将无法管理该项目，是否继续操作？")),type:"input",input:{content:"删除项目"}});try{const n={python:{data:JSON.stringify({name:e.name})},default:{data:JSON.stringify({project_name:e.name})}},s=n[t]||n.default,o=await G(s);a.request(o),o.status&&(R.value=!0)}catch(n){return a.error("删除失败"),{status:!1,msg:"删除失败"}}},ne={get:async()=>{const{data:e}=await J();return B.value=e,e},add:e=>p({...e,ps:""},V.value),update:e=>{const{id:t,...a}=e;return m({type_id:t,...a,ps:""},V.value)},delete:e=>{const{id:t}=e;return d({type_id:t},V.value)}},se=async(e,t,n=V.value)=>{try{const s=(new Date).setHours(0,0,0,0);if("0000-00-00"!==e.edate&&new Date(e.edate).getTime()/1e3<s/1e3)return void a.error("项目已过期，请设置站点到期时间后再操作");const o={start:"即将启动项目".concat(e.name,"，确定要启动项目吗？"),stop:"停用项目".concat(e.name,"后，项目将无法访问，确定要停用项目吗？"),restart:"即将重启项目".concat(e.name,"，确定要重启项目吗？")};await i({icon:"warning-filled",title:"设置项目状态",content:o[t]});const l={python:{data:JSON.stringify({name:e.name})},nodejs:{project_name:e.name,project_type:e.project_config.project_type||"nodejs",status:t},java:{project_name:e.name},phpasync:{sitename:e.name,project_action:t},default:{data:JSON.stringify({project_name:e.name})}};let r=l[n]||l.default;"nodejs"===n&&"pm2"===e.project_config.project_type&&(r.pm2_name=e.pm2_name||e.project_config.pm2_name);const c=await N(r,t,n);return R.value=!0,c}catch(s){return{status:!1,msg:"操作失败"}}},oe=e=>o({title:"到期提醒配置",area:50,showFooter:!0,confirmText:"保存配置",component:()=>l(()=>import("./ssl-expire-configure.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:!!e,onCancel:(null==e?void 0:e.onCancel)||(()=>{})}),le=async()=>{var e,t;const{data:n}=await r({request:u({version:-1,product_type:14})});if(!n.status)return a.error("请求失败，请稍候重试");o({component:()=>l(()=>import("./index159.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),area:52,compData:{name:"网站",type:14,id:null==(e=n.msg[0])?void 0:e.id,description:null==(t=n.msg[0])?void 0:t.question}})},ie=(e={readonly:!1,theme:"chrome"})=>({mode:"ace/mode/nginx",theme:"ace/theme/".concat(e.theme),wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:e.readonly,fontSize:"12px"}),re=e=>o({title:e.title,area:68,component:()=>l(()=>import("./log-details.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:e}),ce=async(e,t,a,n)=>{const{label:s,value:o}=n,l=new Map([["delete","批量删除选中的项目后，项目将无法恢复"]]),i=async(e,t)=>{const a=new Map([["delete",_]]),{name:n}=e,s=a.get(o);if("delete"===o)if(s){const t=await s({data:JSON.stringify({project_name:n})},V.value);return{...e,batchStatus:t.status?1:2,message:t.status?t.data.msg:t.data.data}}};await e({title:"批量".concat(s),content:"".concat(l.get(o),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},w()],onConfirm:async()=>(await t(i),R.value=!0,!1)})},ue={create:"创建文件",modify:"编辑文件",unlink:"删除文件",mkdir:"新建文件夹",rmdir:"删除文件夹",rename:"文件重命名",link:"创建软链",chmod:"修改文件权限",chown:"修改所有者"},pe={localhost:"服务器磁盘",alioss:"阿里云OSS",ftp:"FTP",sftp:"SFTP",msonedrive:"微软OneDrive",qiniu:"七牛云",txcos:"腾讯COS",upyun:"又拍云",tianyiyun:"天翼云",jdcloud:"京东云",aws_s3:"亚马逊存储","Google Cloud":"谷歌云","Google Drive":"谷歌网盘",bos:"百度云",obs:"华为云",webdav:"WebDav",minio:"MinIO",dogecloud:"多吉云COS"},me=(e,t)=>o({isAsync:!0,title:"批量设置证书",area:68,component:()=>l(()=>import("./index217.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:e,onCancel:()=>{t&&t()}});export{$ as a,H as b,U as c,X as d,z as e,le as f,K as g,ne as h,ae as i,B as j,te as k,ce as l,oe as m,Y as n,ee as o,pe as p,ie as q,re as r,se as s,ue as t,Z as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
