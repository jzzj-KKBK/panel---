import{ay as e,G as a,K as t,gP as s,gQ as r,b as o,gR as n,gx as m,e as l}from"./utils-lib.js?v=1756369731";import{c as d,r as i,g as c,aB as p,e as v,p as u,G as h,H as f,x as g,q as y,v as w}from"./base-lib.js?v=1756369731";import{b,d as k,l as x,g as j,h as _}from"./form-item.js?v=1756369731";import{f as D}from"./validator.js?v=1756369731";import{B as W}from"./index140.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./ace.js?v=1756369731";const O={class:"flex flex-col lib-box p-2rem"},S=l(d({__name:"add-compose-template",props:{compData:{default:()=>({})}},emits:["close","complate"],setup(l,{expose:d,emit:S}){const q=o(),{refs:{isRefreshTemplateList:C}}=e(),T=l,V=S,B=i(!1),E={mode:"ace/mode/nginx",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"},{BtForm:F,submit:J}=a({data:async()=>{var e;return(null==(e=T.compData.row)?void 0:e.id)?(async()=>{const e={name:"",remark:"",data:"",env:""};e.name=T.compData.row.name,e.remark=T.compData.row.remark;const a=await t({request:n({data:JSON.stringify({template_id:T.compData.row.id})}),loading:B});return a.status?(e.data=a.data.compose_data,e.env=a.data.env_data):q.error(a.msg),e})():{name:"",remark:"",data:"",env:"",path:"",envpath:""}},options:e=>c(()=>[b("创建模板","name",{attrs:{class:"!w-[35rem]",placeholder:"请输入模板名"},rules:[{required:!0,message:"请输入模板名",trigger:"blur"}]}),b("备注","remark",{attrs:{class:"!w-[35rem]",placeholder:"备注"}}),k([x(" ","path",{attrs:{class:"!w-[30rem]",placeholder:"请选择compose文件"}},()=>N(e,"compose")),j("本地上传",{attrs:{class:"!ml-[1rem]",onClick:()=>{z(e,"compose")}}})]),_("compose内容",()=>p(W,{id:"templateEditor",class:"max-h-[30rem] h-[30rem] !w-[43rem]",modelValue:e.value.data,"onUpdate:modelValue":a=>e.value.data=a,editorOption:E}),"data",{rules:[{required:!0,message:"请输入内容",trigger:"blur"}]}),k([x(" ","envpath",{attrs:{class:"!w-[30rem]",placeholder:"请选择.env文件"}},()=>N(e,"env")),j("本地上传",{attrs:{class:"!ml-[1rem]",onClick:()=>{z(e,"env")}}})]),_(".env内容",()=>v(W,{key:"editer2",class:"w-full h-[10rem]",modelValue:e.value.env,"onUpdate:modelValue":a=>e.value.env=a,editorOption:E},null),"data")]),submit:async(e,a,o)=>{var n;await a(),t({request:(null==(n=T.compData.row)?void 0:n.id)?s({data:JSON.stringify({id:T.compData.row.id,name:e.value.name,remark:e.value.remark,data:e.value.data,env:e.value.env})}):r({data:JSON.stringify({name:e.value.name,remark:e.value.remark,data:e.value.data,env:e.value.env})}),loading:"提交中...",message:!0,success:e=>{e.status&&(V("complate",e),C.value=!0,V("close"))}})}}),N=(e,a)=>{D({type:"file",change:t=>{t&&("compose"==a&&(e.value.path=t),"env"==a&&(e.value.envpath=t),t.endsWith(".yml")||t.endsWith(".yaml")||"compose"!=a?t.endsWith(".env")||"env"!=a?R(t,e,a):q.error("请选择.env文件"):q.error("请选择compose文件"))}})},R=async(e,a,t)=>{try{const{data:s}=await m({path:e});"object"==typeof s&&("compose"==t&&(a.value.data=s.data||""),"env"==t&&(a.value.env=s.data||""))}catch(s){}},z=(e,a)=>{const t=document.createElement("input");t.type="file",t.style.display="none","compose"===a&&(t.accept=".yml,.yaml"),t.addEventListener("change",t=>{var s;const r=null==(s=t.target.files)?void 0:s[0];if(!r)return;if("compose"===a&&!r.name.endsWith(".yml")&&!r.name.endsWith(".yaml"))return void q.error("请选择compose文件");if("env"===a&&!r.name.endsWith("env"))return void q.error("请选择env文件");const o=new FileReader;o.onload=t=>{var s;const o=null==(s=t.target)?void 0:s.result;"compose"===a?(e.value.path=r.name,e.value.data=o):"env"===a&&(e.value.envpath=r.name,e.value.env=o)},o.onerror=()=>{q.error("读取文件内容失败")},o.readAsText(r)}),document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t)},0)};return u(async()=>{}),d({onConfirm:J}),(e,a)=>{const t=h("bt-loading");return f((y(),w("div",O,[v(g(F))])),[[t,g(B)],[t,"正在获取模板消息，请稍候...","title"]])}}}),[["__scopeId","data-v-e3d9726b"]]);export{S as default};
