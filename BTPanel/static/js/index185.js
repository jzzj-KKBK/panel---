import{u as e,a6 as a,R as t,K as l,l as s,L as i,o as n,M as r,a8 as c,v as o,bU as d,at as m,cp as u,S as p,k as f,a0 as b,h as _,j as v,N as x,ai as g,e as k,al as w}from"./utils-lib.js?v=1756369731";import{c as h,g as y,k as D,r as C,p as q,q as V,v as j,x as B,M as P,C as T,y as z,z as U,H as M,J as E,e as O,A,B as F,aB as I,a4 as R,b3 as H,aW as L,D as S,b6 as W,ai as Y,aj as G,bq as J,ay as N,G as K,F as $,P as Q,I as X,ap as Z,ao as ee,an as ae,a9 as te,a7 as le,aA as se}from"./base-lib.js?v=1756369731";import{g as ie}from"./useStore2.js?v=1756369731";import{_ as ne}from"./index117.js?v=1756369731";import{_ as re}from"./index103.js?v=1756369731";import{u as ce,c as oe,a as de,h as me,g as ue}from"./column.js?v=1756369731";import{getBinlogBackupFiles as pe,delBinlogBackupTask as fe,getBinlogBackupLogs as be,deleteBinlogBackupFile as _e,clearBinlogBackup as ve,restoreBinlogData as xe,getBinlogBackupTask as ge,getIncrementBackupInfo as ke,getRestoreProgress as we,backDatabase as he,backModuleDatabase as ye,delBackup as De,checkDatabasePass as Ce,restoreModuleBack as qe,restoreBack as Ve}from"./database.js?v=1756369731";import{_ as je}from"./index116.js?v=1756369731";import{_ as Be}from"./index101.js?v=1756369731";import{_ as Pe}from"./index112.js?v=1756369731";import{f as Te}from"./validator.js?v=1756369731";import{t as ze,w as Ue}from"./useMethod4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const Me={key:0},Ee={class:"data-show"},Oe={class:"bg-white rounded-lg border border-gray-200 p-6 mb-4"},Ae={class:"grid grid-cols-1 md:grid-cols-3 gap-6 pb-6 border-b border-gray-100"},Fe={class:"text-center md:text-left"},Ie={class:"text-[1.6rem]"},Re={class:"grid grid-cols-2 col-span-2 gap-6","element-loading-text":"获取中..."},He={class:"text-center md:text-left"},Le={class:"text-[1.6rem]"},Se={class:"text-center md:text-left"},We={class:"text-[1.6rem]"},Ye={class:"pt-6 pb-3"},Ge={class:"flex items-center justify-between"},Je={class:"flex items-center space-x-8"},Ne={class:"pb-3"},Ke={class:"flex items-center space-x-4"},$e={class:"text-[1.2rem] text-[#666]"},Qe={class:"text-[1.2rem] text-[#666]"},Xe={class:"flex items-center justify-between"},Ze={class:"flex items-center space-x-8"},ea={class:"text-[1.2rem] font-medium"},aa={class:"text-[1.2rem] font-medium"},ta={class:"flex items-center gap-4"},la={class:"flex items-center"},sa=h({__name:"index",props:{compData:{default:()=>[]},isRowBackup:{type:Boolean,default:!1}},setup(d,{expose:m}){const{payment:u}=e();y(()=>u.value.authType),ie();const p=d,f=D({name:"",tableCount:0,size:""}),b=C(!1),_=D({database_name:"test_db",full_backup_schedule:{type:"daily",time:"02:30:00",weekday:0,interval_days:0,interval_hours:0},incremental_backup_interval:30,enabled:!0,create_time:"",last_full_backup:"",last_incremental_backup:"",next_full_backup:"",next_incremental_backup:"",space_free:!0}),v=D({time:"",type:"all"}),x=D({disabledDate:e=>{const a=new Date;a.setHours(23,59,59,999);const t=a.getTime();return e.getTime()>t},defaultTime:[new Date,new Date]}),g={title:"企业增量备份",ps:"企业增量备份只定时备份发生变化新增、修改、删除文件和数据，不会每次都备份所有数据",source:54,desc:[],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/database/database_enterprise_backup.png"}]},k={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},w=y(()=>{if(!_.database_name)return"--";switch(_.full_backup_schedule.type){case"daily":return"每天 ".concat(_.full_backup_schedule.time," 备份");case"weekly":return"每周 ".concat(k[_.full_backup_schedule.weekday]," ").concat(_.full_backup_schedule.time," 备份");case"interval":return"每隔 ".concat(_.full_backup_schedule.interval_days," 天后 ").concat(_.full_backup_schedule.time," 备份");case"hours":return"每隔 ".concat(_.full_backup_schedule.interval_hours," 小时 ").concat(_.full_backup_schedule.time||""," 备份")}}),N=y(()=>_.database_name?_.incremental_backup_interval>60?"每 ".concat(Math.floor(_.incremental_backup_interval/60),"小时").concat(_.incremental_backup_interval%60,"分钟备份"):"每 ".concat(_.incremental_backup_interval," 分钟备份"):"--"),K=async()=>{s({title:"配置备份计划",area:85,component:()=>i(()=>import("./add-increment.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),showFooter:!0,compData:{...p.compData,backupPlan:_,refreshEvent:()=>{se()}}})},$=async()=>{_.enabled?(await n({title:"停止备份计划",content:"确定停止数据库【".concat(_.database_name,"】增量备份计划吗？停止后将无法进行增量备份")}),await l({loading:"停止备份计划中...",message:!0,request:fe({id:p.compData.id})}),se()):K()},Q=()=>{s({title:"备份日志",area:56,btns:!1,component:h({setup:()=>{const e=C("");return l({loading:"获取日志中...",request:be({id:p.compData.id}),success:a=>{if(!a.data.status)return r.error(a.data.msg);e.value=a.data.data.join("\n")}}),()=>I("div",{class:"overflow-y-auto"},I(je,{class:"!h-[40rem]",content:e.value,isHtml:!0}))}})})},X=async()=>{await n({title:"清空备份",content:"当前将清空【".concat(p.compData.name,"】下通过备份计划备份的全量与增量备份（不会清除手动备份），请确保当前数据已正常，再清空备份"),type:"calc"}),await l({loading:"清空备份中...",message:!0,request:ve({id:p.compData.id})}),te()},Z=c([{label:"删除备份",value:"delete",event:()=>{}}]),{BtTable:ee,BtPage:ae,refresh:te,BtBatch:le}=a({request:async e=>{const a={id:p.compData.id,page:e.p,limit:e.limit,backup_type:v.type,...v.time?{date:t(v.time,"yyyy-MM-dd")}:{}},{data:s}=await l({loading:"获取备份记录中...",request:pe(a)});return{data:s.data.list,total:s.data.total}},columns:[{label:"备份时间",prop:"backup_time",showOverflowTooltip:!0,minWidth:100},{label:"备份类型",prop:"backup_type",minWidth:100,render:e=>"incremental"===e.backup_type?"增量备份":"全量备份"},{label:"备份大小",prop:"formatted_size",minWidth:100},ce([{onClick:e=>(async e=>{await n({title:"还原备份【".concat(e.backup_time,"】"),content:"此操作将覆盖当前数据库的所有数据，请确保已经备份现有数据！",type:"calc"});const a=await l({loading:"还原备份中...",request:xe({id:p.compData.id,restore_time:e.backup_time})});if(!a.data.status)return r.error(a.data.msg);s({title:"还原进度",area:56,btns:!1,component:h({setup:(e,{emit:t})=>{const s=D({status:"preparing",progress:0,message:"准备还原数据...",restore_time:"",start_time:"",update_time:"",error:null,backup_files:[]}),i=C(null),n=C(!0),c={preparing:{text:"准备还原数据",color:"#20a53a",progress:0},analyzing:{text:"分析备份文件",color:"#20a53a",progress:10},restoring:{text:"正在还原数据",color:"#20a53a",progress:20},finalizing:{text:"完成还原操作",color:"#20a53a",progress:90},completed:{text:"还原完成",color:"#20a53a",progress:100},failed:{text:"还原失败",color:"#f56c6c",progress:0},not_found:{text:"任务不存在",color:"#e6a23c",progress:0}},o=async()=>{var e,t,d,m,u;if(n.value)try{const p=await l({request:we({task_id:a.data.data.task_id})});if(null==(e=null==p?void 0:p.data)?void 0:e.status){const e=p.data.data;s.status=e.status||"preparing",s.message=e.message||(null==(t=c[s.status])?void 0:t.text)||"处理中...",s.restore_time=e.restore_time||"",s.start_time=e.start_time||"",s.update_time=e.update_time||"",s.backup_files=e.backup_files||[],s.error=e.error||null,void 0!==e.progress?s.progress=Math.min(Math.max(e.progress,0),100):s.progress=(null==(d=c[s.status])?void 0:d.progress)||0;const a=["completed","failed","not_found"].includes(s.status);!a&&n.value?i.value=setTimeout(o,1500):a&&("completed"===s.status?(r.success("数据库还原成功"),te()):"failed"===s.status&&r.error(s.error||"还原失败，请查看错误信息"),n.value=!1)}else s.status="failed",s.message=(null==(m=null==p?void 0:p.data)?void 0:m.msg)||"获取进度失败",s.error=(null==(u=null==p?void 0:p.data)?void 0:u.error_msg)||"未知错误",n.value=!1}catch(p){s.status="failed",s.message="获取进度失败，请检查网络连接",s.error="网络连接异常",n.value=!1}};return o(),R(()=>{i.value&&(clearTimeout(i.value),i.value=null),n.value=!1}),()=>{var e,a;return O("div",{class:"p-[2rem]"},[O("div",{class:"flex items-center mb-[2rem]"},[O("i",{class:["!text-[3rem] mr-[1rem]","completed"===s.status?"svgtofont-el-success-filled text-[#20a53a]":"failed"===s.status?"svgtofont-el-circle-close-filled text-[#ef0808]":"svgtofont-el-loading animate-spin text-[#20a53a]"]},null),O("div",{class:"flex-1"},[O("div",{class:"text-[1.6rem] font-medium mb-[4px]"},["completed"===s.status?"还原成功":"failed"===s.status?"还原失败":"正在还原数据库"]),O("div",{class:"text-[1.2rem] text-[#666]"},[F("数据库："),p.compData.name])])]),!["completed","failed"].includes(s.status)&&O("div",{class:"mb-[2rem]"},[O("div",{class:"flex justify-between items-center mb-[8px]"},[O("span",{class:"text-[1.4rem]"},[s.message]),O("span",{class:"text-[1.2rem] text-[#666]"},[s.progress,F("%")])]),O(H,{percentage:s.progress,"stroke-width":8,"show-text":!1,color:(null==(e=c[s.status])?void 0:e.color)||"#20a53a"},null)]),O("div",{class:"bg-[#f5f7fa] rounded-lg p-[1.5rem] mb-[1.5rem]"},[O("div",{class:"text-[1.3rem] font-medium mb-[1rem] text-[#333]"},[F("还原信息")]),O("div",{class:"space-y-[8px] text-[1.2rem] text-[#666]"},[s.restore_time&&O("div",{class:"flex"},[O("span",{class:"w-[8rem] flex-shrink-0"},[F("还原时间点：")]),O("span",null,[s.restore_time])]),s.start_time&&O("div",{class:"flex"},[O("span",{class:"w-[8rem] flex-shrink-0"},[F("开始时间：")]),O("span",null,[s.start_time])]),s.update_time&&O("div",{class:"flex"},[O("span",{class:"w-[8rem] flex-shrink-0"},[F("更新时间：")]),O("span",null,[s.update_time])]),O("div",{class:"flex"},[O("span",{class:"w-[8rem] flex-shrink-0"},[F("当前状态：")]),O("span",{class:"flex items-center"},[O("span",{class:["w-[8px] h-[8px] rounded-full mr-[6px]","completed"===s.status?"bg-[#20a53a]":"failed"===s.status?"bg-[#ef0808]":"hidden"]},null),(null==(a=c[s.status])?void 0:a.text)||s.message])])])]),s.backup_files&&s.backup_files.length>0&&O("div",{class:"bg-[#f5f7fa] rounded-lg p-[1.5rem] mb-[1.5rem]"},[O("div",{class:"text-[1.3rem] font-medium mb-[1rem] text-[#333]"},[F("相关备份文件 ("),s.backup_files.length,F("个)")]),O("div",{class:"space-y-[4px] max-h-[8rem] overflow-y-auto"},[s.backup_files.map((e,a)=>O("div",{key:a,class:"text-[1.1rem] text-[#666] bg-white px-[8px] py-[4px] rounded"},[e]))])]),"failed"===s.status&&s.error&&O("div",{class:"bg-[#fef0f0] border border-[#fbc4c4] rounded-lg p-[1.5rem] mb-[1.5rem]"},[O("div",{class:"text-[1.3rem] font-medium mb-[1rem] text-[#f56c6c] flex items-center"},[O("i",{class:"svgtofont-el-warning-filled mr-[6px]"},null),F("错误详情")]),O("div",{class:"text-[1.2rem] text-[#666] whitespace-pre-wrap"},[s.error])])])}}})})})(e),title:"还原"},{onClick:e=>(async e=>{window.open("/download?filename="+e,"_blank")})(e.file_path),title:"下载"},{onClick:e=>(async e=>{await n({title:"删除备份",content:"确定删除该备份吗？删除后将无法恢复!"}),await l({loading:"删除备份中...",message:!0,request:_e({backup_id:e})}),te()})(e.backup_id),title:"删除"}])],extension:[Z]}),se=async()=>{const{data:e}=await l({loading:"获取备份计划信息中...",request:ge({id:p.compData.id})});e.status?(_.database_name=e.data.database_name,_.full_backup_schedule=e.data.full_backup_schedule,_.incremental_backup_interval=e.data.incremental_backup_interval,_.enabled=e.data.enabled,_.create_time=e.data.create_time,_.last_full_backup=e.data.last_full_backup,_.last_incremental_backup=e.data.last_incremental_backup,_.next_full_backup=e.data.next_full_backup,_.next_incremental_backup=e.data.next_incremental_backup,_.space_free=e.data.space_free):_.database_name=""},oe=async()=>{f.name=p.compData.name,se();const{data:e}=await l({loading:b,request:ke({id:p.compData.id})});e.status&&(f.tableCount=e.data.table_count||0,f.size=o(e.data.db_size)||"--")};return q(oe),m({init:oe}),(e,a)=>{const t=L,l=S,s=W,i=Y,n=G,r=re,c=ne,o=J;return V(),j("div",null,["ltd"===B(u).authType?(V(),j("div",Me,[B(_).space_free?T("",!0):(V(),P(t,{key:0,title:"当前磁盘空间不足1GB，已自动停止增量备份，如需继续请释放磁盘空间",type:"warning","show-icon":"",class:"!mb-4"})),z("div",Ee,[z("div",Oe,[z("div",Ae,[z("div",Fe,[a[2]||(a[2]=z("div",{class:"text-[1.2rem] text-[#666] mb-1"},"数据库名称",-1)),z("div",Ie,U(B(f).name||"--"),1)]),M((V(),j("div",Re,[z("div",He,[a[3]||(a[3]=z("div",{class:"text-[1.2rem] text-[#666] mb-1"},"表数量",-1)),z("div",Le,U(B(f).tableCount||0),1)]),z("div",Se,[a[4]||(a[4]=z("div",{class:"text-[1.2rem] text-[#666] mb-1"},"数据库大小",-1)),z("div",We,U(B(f).size||"--"),1)])])),[[o,B(b)]])]),z("div",Ye,[z("div",Ge,[z("div",Je,[a[5]||(a[5]=z("h3",{class:"text-[1.4rem] font-medium text-[#666]"},"备份计划",-1)),z("span",{class:E(["px-3 py-1 rounded-full text-[1.2rem] font-medium cursor-pointer",B(_).enabled?"bg-[#e9f8ec] text-[#20a53a]":"bg-red-100 text-red-700"]),onClick:$},U((d=B(_).enabled,d?"运行中":"已停止")),3)])])]),z("div",Ne,[z("div",Ke,[z("span",$e,"全量: "+U(B(w)),1),a[7]||(a[7]=z("span",{class:"text-gray-300"},"|",-1)),z("span",Qe,"增量: "+U(B(N)),1),O(l,{type:"primary",class:"ml-[1rem]",size:"small",text:"",onClick:Q},{default:A(()=>[...a[6]||(a[6]=[F(" 查看日志 ",-1)])]),_:1})])]),z("div",null,[z("div",Xe,[z("div",Ze,[a[8]||(a[8]=z("div",{class:"text-[1.2rem] text-[#666]"},"最近执行时间",-1)),z("div",ea,U(B(_).last_incremental_backup||"--"),1),a[9]||(a[9]=z("div",{class:"text-[1.2rem] text-[#666]"},"下次执行时间",-1)),z("div",aa,U(B(_).next_incremental_backup||"--"),1)]),a[10]||(a[10]=z("div",null,null,-1))])])])]),O(r,null,{"header-left":A(()=>[z("div",ta,[O(l,{type:"primary",onClick:K},{default:A(()=>[...a[11]||(a[11]=[F("编辑计划 ",-1)])]),_:1}),O(l,{type:"default",onClick:X},{default:A(()=>[...a[12]||(a[12]=[F("清空备份 ",-1)])]),_:1})])]),"header-right":A(()=>[z("div",la,[O(s,{type:"date",modelValue:B(v).time,"onUpdate:modelValue":a[0]||(a[0]=e=>B(v).time=e),"show-after":100,class:"!w-[24rem] !h-[30px]","disabled-date":B(x).disabledDate,placeholder:"请选择日期",format:"YYYY-MM-DD","value-format":"x",onChange:B(te)},null,8,["modelValue","disabled-date","onChange"]),O(n,{modelValue:B(v).type,"onUpdate:modelValue":a[1]||(a[1]=e=>B(v).type=e),class:"rounded-none !w-[12rem] ml-[1rem]",onChange:B(te)},{default:A(()=>[O(i,{label:"全部类型",value:"all"}),O(i,{label:"增量备份",value:"incremental"}),O(i,{label:"全量备份",value:"full"})]),_:1},8,["modelValue","onChange"])])]),content:A(()=>[O(B(ee),{"max-height":221})]),"footer-left":A(()=>[...a[13]||(a[13]=[])]),"footer-right":A(()=>[O(B(ae))]),popup:A(()=>[...a[14]||(a[14]=[])]),_:1}),a[15]||(a[15]=z("ul",{class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-[20px]"},[z("li",null,"还原数据等操作将会被增量备份记录，导致备份大小增大"),z("li",null,"建议确认数据正常后，手动备份并【清空备份】，重置为干净状态")],-1))])):(V(),P(c,{key:1,data:g,class:"p-20px"}))]);var d}}}),ia={class:"p-20px"},na={class:"p-20px"},ra={class:"mt-4px leading-8 text-[1.2rem] list-disc ml-[20px]"},ca=k(h({__name:"route-back",props:{compData:{default:()=>({id:0,name:""})}},setup(a){const t=a,{refs:{tabActive:c},refreshTableList:o}=ie(),{panel:k}=e(),w=N("popupClose"),h=C(),y=C(),T=C(),U=C([]),E=C(!1),I=C(!1),{id:R,name:H}=t.compData,L=D({search:R,type:1,table:"backup",total:0,p:1,limit:10}),W=C(!1),Y=D({backupPath:""}),G=C(),J=C(!1),se=D({pwd:""}),ne=[{label:"删除",value:"delete",event:async(e,a,t,l)=>{await e({title:"批量删除备份文件",content:"批量删除已选备份文件，是否继续操作？",column:[{prop:"filename",label:"文件名"},oe()],onConfirm:async()=>(await a(ge),Oe(),o(),!1)})}}],pe=()=>{Te({type:"dir",path:Y.backupPath,change:e=>{Y.backupPath=e}})},fe=async()=>{await n({title:"提示",content:"修改默认备份目录，会导致网站和站点默认备份会备份到该目录下，是否继续操作？"}),k.value.backupPath=Y.backupPath},be=({filename:e})=>(x(e)||g(e))&&-1!==e.indexOf("|"),_e=()=>{s({title:"表备份",area:60,component:()=>i(()=>import("./table-back.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{...t.compData,refreshFn:Oe},showFooter:!0})},ve=async()=>{const{router:e}=await i(()=>import("./utils-lib.js?v=1756369731").then(e=>e.jG),__vite__mapDeps([]),import.meta.url);w(),e.push({name:"crontab"})},xe=async e=>{let a=null;"mysql"===c.value&&(a=ze({type:"backup",config:{path:"/tmp/import_sql.log",id:t.compData.id,name:t.compData.name}}));let s={id:t.compData.id};e&&(s.password=se.pwd),await l({loading:"mysql"===c.value?void 0:"正在备份数据库，请稍后...",request:"mysql"===c.value?he(s):ye({data:JSON.stringify(s)},c.value),message:!0,success:async e=>{const t=await a;null==t||t.unmount(),e.status&&(Oe(),o())}})},ge=async(e,a=!1)=>{try{a&&await n({title:"删除备份",content:'<p>删除备份后，<span class="text-danger">备份数据将无法恢复</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0});const t=await De({id:e.id});return a&&(r.request(t),Oe()),t}catch(t){m(t,"delBackEvent")}finally{I.value&&I.value.close()}},ke=async(e,a=!1)=>{y.value=e,await n({title:"恢复数据库",content:"恢复备份文件将会覆盖当前数据库[".concat(t.compData.name,"]，是否继续？"),type:"calc",icon:"warning-filled"});let s={file:e.localexist?e.local:e.filename,name:t.compData.name};if(a&&(s.disk_check=!0),"mysql"===c.value){const{data:a}=await Ce({file:e.localexist?e.local:e.filename});if(a)return h.value=!0,void(J.value=!0);we(s,e)}else s.file=e.local,l({loading:"正在恢复数据库,请稍后...",request:qe({data:JSON.stringify(s)},c.value),message:!0})},we=async(e,a)=>{const s=ze({type:"import",config:{path:"/tmp/import_sql.log",id:a.id,name:t.compData.name}});await l({request:Ve(e),message:!0,success:async e=>{var t;if(-1!==(null==(t=e.msg)?void 0:t.indexOf("警告")))return await je(e.msg,"恢复"),void ke(a,!0)}});const i=await s;null==i||i.unmount()},je=(e,a)=>n({title:"提示",isHtml:!0,width:"50rem",confirmText:"继续".concat(a),content:'<div class="flex"><i class="svgtofont-el-warning-filled text-[4rem] text-warning mr-4"></i><div><div>'.concat(e,"</div><div>\n\t\t\t<p>如继续").concat(a,"可能会有以下影响：</p>\n\t\t\t<p>1.").concat(a,"数据不完整</p>\n\t\t\t<p>2.系统运行缓慢</p>\n\t\t\t<p>3.面板无法正常工作</p>\n\t\t\t<p>4.mysql无法正常运行</p></div></div></div>")}),Me=e=>{switch(e){case"databaseBack":xe(!1);break;case"backPath":break;case"databasePwdBack":J.value=!0;break;case"tableBack":_e()}},Ee=async()=>{if(await G.value.validate(),h.value){const e={file:y.value.localexist?y.value.local:y.value.filename,name:t.compData.name,password:se.pwd};we(e,y.value),J.value=!1,h.value=!1}else xe(!0),J.value=!1},Oe=async()=>{l({request:u({...L}),loading:E,data:{data:[Array,U],page:p(L)}})},Ae=[de(),{label:"文件名称",prop:"name",width:220,showOverflowTooltip:!0},{label:"存储对象",render:e=>{let a=!1,t="";return be(e)&&(a=!0,t=e.filename.match(/\|(.+)\|/,"$1")),O("span",null,[a?Ue[t[1]]:"本地"])}},me({prop:"size",width:100}),{width:160,prop:"addtime",label:"备份时间"},ue({table:"backup"}),ce([{isHide:e=>be(e),onClick:e=>ke(e),title:"恢复"},{onClick:e=>(async e=>{if("mysql"!==c.value||e.localexist)window.open("/download?filename="+e.local,"_blank");else{if(be(e))return void r.error("不支持从此处下载云存储备份，如需下载请在备份时勾选同时保留本地备份");r.error("备份文件不存在")}})(e),title:"下载"},{onClick:e=>ge(e,!0),title:"删除"}])];return q(Oe),(e,a)=>{const t=Z,l=ee,s=ae,i=S,n=f,r=b,o=Pe,m=Be,u=te,p=le,x=_,g=v,k=re,w=K("bt-loading");return V(),j("div",null,[O(k,null,{"header-left":A(()=>["mysql"==B(c)?(V(),P(s,{key:0,"split-button":"",class:"active-route",onCommand:Me,onClick:a[0]||(a[0]=e=>Me("databaseBack"))},{dropdown:A(()=>[O(l,null,{default:A(()=>[O(t,{command:"databaseBack"},{default:A(()=>[...a[12]||(a[12]=[F(" 备份数据库 ",-1)])]),_:1}),O(t,{command:"databasePwdBack"},{default:A(()=>[...a[13]||(a[13]=[F(" 加密备份数据库 ",-1)])]),_:1}),O(t,{command:"tableBack"},{default:A(()=>[...a[14]||(a[14]=[F("表备份",-1)])]),_:1})]),_:1})]),default:A(()=>[a[15]||(a[15]=z("span",{class:"text-white"},"备份数据库",-1))]),_:1})):(V(),j($,{key:1},[O(i,{type:"primary",onClick:a[1]||(a[1]=e=>xe(!1))},{default:A(()=>[...a[16]||(a[16]=[F(" 备份数据库 ",-1)])]),_:1}),O(i,{type:"default",onClick:a[2]||(a[2]=e=>_e())},{default:A(()=>[...a[17]||(a[17]=[F(" 表备份 ",-1)])]),_:1})],64))]),"header-right":A(()=>[...a[18]||(a[18]=[])]),content:A(()=>[M(O(n,{ref_key:"routeBackupRef",ref:T,data:B(U),description:"暂无数据","max-height":460,column:B(Ae)},null,8,["data","column"]),[[w,B(E)],[w,"正在加载中，请稍后...","title"]])]),"footer-left":A(()=>[O(r,{options:ne,"table-ref":B(T)},null,8,["table-ref"])]),"footer-right":A(()=>[O(o,{total:B(L).total,page:B(L).p,"onUpdate:page":a[3]||(a[3]=e=>B(L).p=e),row:B(L).limit,"onUpdate:row":a[4]||(a[4]=e=>B(L).limit=e),onChange:Oe},null,8,["total","page","row"])]),popup:A(()=>[O(x,{title:"更换默认备份目录",modelValue:B(W),"onUpdate:modelValue":a[6]||(a[6]=e=>Q(W)?W.value=e:null),area:42,onConfirm:fe,showFooter:""},{default:A(()=>[z("div",ia,[O(p,{ref:"ruleFormData",class:"mr-[16px] w-[80%]",model:B(Y),rule:{backupPath:[{required:!0,message:"请输入默认备份目录",trigger:"blur"}]}},{default:A(()=>[O(u,{label:"默认备份目录",prop:"backupPath"},{default:A(()=>[O(m,{icon:"icon-file_mode",modelValue:B(Y).backupPath,"onUpdate:modelValue":a[5]||(a[5]=e=>B(Y).backupPath=e),onIconClick:pe,width:"26rem"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),O(x,{title:B(h)?"数据库加密密码":"加密备份数据库",modelValue:B(J),"onUpdate:modelValue":a[10]||(a[10]=e=>Q(J)?J.value=e:null),area:42,onConfirm:Ee,showFooter:"",onCancel:a[11]||(a[11]=()=>B(se).pwd="")},{default:A(()=>[z("div",na,[O(p,{ref_key:"pwdBackFormRef",ref:G,class:"mr-[16px] w-[80%]",model:B(se),rules:{pwd:[{required:!0,message:"请输入压缩密码",trigger:"blur"}]}},{default:A(()=>[O(u,{label:"压缩密码",prop:"pwd"},{default:A(()=>[B(h)?(V(),P(g,{key:1,modelValue:B(se).pwd,"onUpdate:modelValue":a[9]||(a[9]=e=>B(se).pwd=e),width:"26rem"},null,8,["modelValue"])):(V(),P(m,{key:0,modelValue:B(se).pwd,"onUpdate:modelValue":a[7]||(a[7]=e=>B(se).pwd=e),icon:"el-refresh",width:"26rem",onIconClick:a[8]||(a[8]=()=>B(se).pwd=B(d)(16)),"is-active":!0},null,8,["modelValue"]))]),_:1})]),_:1},8,["model"]),M(z("ul",ra,[...a[19]||(a[19]=[z("li",{class:"text-warning"},"设置密码后请注意保存密码，以防忘记密码导致无法恢复备份数据",-1)])],512),[[X,B(h)]])])]),_:1},8,["title","modelValue"])]),_:1}),z("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-20px"},[z("li",null,[a[20]||(a[20]=F(" 定时备份请前往【 ",-1)),z("span",{title:"点击前往【计划任务】",class:"bt-link",onClick:ve}," 计划任务 "),a[21]||(a[21]=F(" 】增加【备份数据库】 ",-1))])])])}}}),[["__scopeId","data-v-9970ea25"]]),oa={class:"p-[20px] h-full"},da=h({__name:"index",props:{compData:{default:()=>({row:{}})}},emits:["close"],setup(e,{emit:a}){const{refs:{tabActive:t}}=ie(),l=C("routeBackup");return q(()=>{}),(e,a)=>{const s=se,i=w;return V(),j("div",oa,[O(i,{type:"card",modelValue:B(l),"onUpdate:modelValue":a[0]||(a[0]=e=>Q(l)?l.value=e:null),class:"bt-tabs bt-tabs-card"},{default:A(()=>[O(s,{name:"routeBackup",label:"常规备份",lazy:!0},{default:A(()=>[O(ca,{compData:e.compData.row},null,8,["compData"])]),_:1}),"mysql"==B(t)?(V(),P(s,{key:0,name:"increment",class:"mt-4",lazy:!0},{label:A(()=>[...a[1]||(a[1]=[z("span",{class:"flex items-center"},[z("i",{class:"mr-[4px] svgtofont-icon-ltd text-[1.8rem] text-[#9B7E48]"}),z("span",null,"增量备份")],-1)])]),default:A(()=>[O(sa,{compData:e.compData.row,isRowBackup:!0},null,8,["compData"])]),_:1})):T("",!0)]),_:1},8,["modelValue"])])}}});export{da as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
