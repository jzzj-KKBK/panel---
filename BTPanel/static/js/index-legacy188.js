!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}System.register(["./base-lib-legacy.js?v=1756369731","./utils-lib-legacy.js?v=1756369731","./useStore-legacy2.js?v=1756369731","./__commonjsHelpers__-legacy.js?v=1756369731"],function(t,n){"use strict";var r,a,o,u,i,l,s,c,f,p,d,m,v,g,y,b,h,w,_,z,k,x,j,A,S,q,E,I,D;return{setters:[function(e){r=e.c,a=e.ay,o=e.r,u=e.U,i=e.g,l=e.k,s=e.w,c=e.q,f=e.v,p=e.e,d=e.A,m=e.B,v=e.x,g=e.y,y=e.z,b=e.F,h=e.M,w=e.H,_=e.I,z=e.D,k=e.b0,x=e.au,j=e.b3,A=e.av,S=e.aw},function(e){q=e.u,E=e.v,I=e.b},function(e){D=e.u},null],execute:function(){var n={class:"p-[2rem]"},O={class:"h-[40rem] border border-[#EBEEF5] mt-[1rem]"},C={class:"ml-[0.5rem]"};t("default",r({__name:"index",props:{compData:{default:function(){return{path:"",refreshEvent:function(){}}}}},setup:function(t,r){var F=r.expose,M=I(),B=q().panel;D();var H=t,T=a("popupSetFooter"),U=a("buttonText"),P=!0,$=o(),G=o([]),J=u([".sql",".zip",".bak",".gz"].join(",")),K={"x-http-token":window.vite_public_request_token},L=window.location.protocol+"//"+window.location.host+"/files?action=upload",N=i(function(){var e;return H.compData.path?H.compData.path:null===(e=B.value.backupPath+"/database")||void 0===e?void 0:e.replace(/\/\//g,"/")}),Q=l({f_size:0,f_path:N.value,f_name:"",f_start:0}),R=function(){M.success("导入成功"),H.compData.refreshEvent()},V=function(e,t,n){n.push(t),M.error("导入失败")},W=function(e){Q.f_size=e.size,Q.f_name=e.name,Q.f_start=0},X=function(e,t){var n=e.name.substring(e.name.lastIndexOf(".")+1),r=["sql","zip","bak","gz"];if(-1===r.indexOf(n))return!1;G.value=t.filter(function(e){var t=e.name.substring(e.name.lastIndexOf(".")+1);return-1!==r.indexOf(t)})||[]},Y=function(e,t,n){Q.f_start=e.percent,G.value=n.map(function(n){return n.uid===t.uid&&(n.percentage=e.percent),n})};return s(function(){return G.value.length},function(e){if(0!==e){for(var t=["success","fail","ready"],n=0;n<G.value.length;n++)if(!t.includes(G.value[n].status))return void T(!1);G.value.some(function(e){return"success"!==e.status})&&(U.value=P?"开始上传":"重新上传",T(!0))}else T(!1)}),F({onConfirm:function(){G.value.map(function(e){"success"!==e.status&&(e.status="ready")}),P=!1,$.value.submit(),T(!1)}}),function(t,r){var a=z,o=k,u=x,i=j,l=A,s=S;return c(),f("div",n,[p(o,{class:"upload-demo",ref_key:"upload",ref:$,name:"blob",data:v(Q),action:L,headers:K,accept:v(J),multiple:!0,"show-file-list":!1,"auto-upload":!1,"file-list":v(G),"on-error":V,"on-success":R,"on-progress":Y,"on-change":X,"before-upload":W},{default:d(function(){return[p(a,{type:"primary"},{default:d(function(){return e(r[0]||(r[0]=[m("导入",-1)]))}),_:1})]}),_:1},8,["data","accept","file-list"]),g("div",O,[p(s,{height:"400",data:v(G)},{empty:d(function(){return[p(l,{description:"只支持'.sql', '.zip', '.bak', '.gz'文件格式导入"})]}),default:d(function(){return[p(u,{prop:"name","show-overflow-tooltip":!0,label:"名称"},{default:d(function(e){return[r[1]||(r[1]=g("i",{style:{color:"#409eff"},class:"svgtofont-el-document"},null,-1)),g("span",C,y(e.row.name),1)]}),_:1}),p(u,{prop:"name",label:"是否成功",width:"300"},{default:d(function(e){return["success"===e.row.status?(c(),f(b,{key:0},[m("上传成功！")],64)):"fail"===e.row.status?(c(),f(b,{key:1},[m("上传失败!")],64)):"ready"===e.row.status?(c(),f(b,{key:2},[m("等待上传")],64)):(c(),h(i,{key:3,percentage:Math.floor(e.row.percentage)},null,8,["percentage"]))]}),_:1}),p(u,{width:"120",prop:"size",label:"大小"},{default:d(function(e){return[m(y(v(E)(e.row.size)),1)]}),_:1}),p(u,{prop:"name",width:"180",align:"right","show-overflow-tooltip":!0,label:"操作"},{default:d(function(t){return[w(p(a,{type:"text",size:"small",onClick:function(e){return n=t.row,void(G.value=G.value.filter(function(e){return e.name!==n.name}));var n}},{default:d(function(){return e(r[2]||(r[2]=[m("删除",-1)]))}),_:2},1032,["onClick"]),[[_,"ready"===t.row.status||"fail"===t.row.status]])]}),_:1})]}),_:1},8,["data"])]),r[3]||(r[3]=g("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-2rem"},[g("li",null,"仅支持sql、zip、sql.gz、(tar.gz|gz|tgz)")],-1))])}}}))}}})}();
