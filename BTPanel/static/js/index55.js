import{d6 as e,a3 as a,R as t,d7 as l,N as n,u as o,e as s,af as i,d8 as r,c as u,d9 as c,K as d,da as p,db as m,dc as v,l as f,dd as y,de as b,df as h,L as g,M as _,dg as x,o as w,dh as k,di as C,a6 as V,dj as E,aj as j,dk as D,dl as T,dm as B,dn as R,G as M,dp as S,dq as O,dr as U,ds as A,dt as H,du as L,dv as q,dw as I,a8 as $,dx as z,A as P,dy as F,dz as N,dA as W,dB as J,dC as K,dD as G,dE as Q,dF as X,al as Y}from"./utils-lib.js?v=1756369731";import{r as Z,bH as ee,c as ae,W as te,X as le,q as ne,M as oe,A as se,B as ie,z as re,v as ue,F as ce,a_ as de,x as pe,ai as me,aj as ve,e as fe,y as ye,ah as be,af as he,b6 as ge,s as _e,P as xe,k as we,b4 as ke,p as Ce,b8 as Ve,b9 as Ee,w as je,n as De,g as Te,J as Be,L as Re,D as Me,aM as Se,S as Oe,a9 as Ue,a7 as Ae,ar as He,bI as Le,a4 as qe,K as Ie,H as $e,I as ze,d as Pe,al as Fe,ag as Ne,R as We,j as Je,C as Ke,m as Ge,ay as Qe,a5 as Xe}from"./base-lib.js?v=1756369731";import{u as Ye,o as Ze,g as ea}from"./useMethod7.js?v=1756369731";import{_ as aa}from"./header-nav-tools.vue_vue_type_script_setup_true_lang.js?v=1756369731";import{a as ta,s as la,e as na,b as oa,t as sa,c as ia,d as ra,f as ua,m as ca}from"./useMethod8.js?v=1756369731";import{o as da}from"./validator.js?v=1756369731";import{_ as pa}from"./index103.js?v=1756369731";import{u as ma,a as va,c as fa}from"./column.js?v=1756369731";import{_ as ya}from"./index104.js?v=1756369731";import{b as ba}from"./form-item.js?v=1756369731";class ha{constructor(){}static getInstance(){return ha.instance||(ha.instance=ee()),ha.instance}}const ga=Z(!1),_a=Z("value"),xa=Z({type:"today",data:function(){const{start:e,end:a}=function(e){const a=new Date(e);a.setHours(0,0,0,0);const t=new Date(e);return t.setHours(23,59,59,999),{start:a,end:t}}(new Date);return[e.getTime(),a.getTime()]}()});function wa(){const l=ha.getInstance();return{getRate:e=>e>=0?"".concat(e,"%"):"--",getChartTime:(e,a)=>{let l=new Date;return"hourly"===e?(l.setMinutes(0),l.setSeconds(0),l.setHours(a)):"daily"===e&&(l=new Date(1e3*a)),t(l)},getOverview:async function(){try{ga.value=!0;const{data:t}=await e({..."value"!==_a.value?{domain:_a.value}:{},start_time:Math.floor(xa.value.data[0]/1e3),end_time:Math.floor(xa.value.data[1]/1e3)});a(t)&&l.trigger(t)}finally{ga.value=!1}},onResult:l.on}}const ka=ae({__name:"domain-select",props:te({all:{type:Boolean,default:!0},showTag:{type:Boolean,default:!0}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,t=le(e,"value"),o=Z([]),s=e=>a.showTag?"域名：".concat(e):e,{loading:i,setLoading:r}=Ye();return(async()=>{try{r(!0);const{data:{data:e}}=await l();n(e)&&(o.value=e.map(e=>({label:e,value:e})),a.all?o.value.unshift({label:"全部",value:"value"}):t.value=e[0]||"")}finally{r(!1)}})(),(e,a)=>{const l=me,n=ve;return ne(),oe(n,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),loading:pe(i),filterable:!0},{label:se(({label:e,value:a})=>[ie(re(s(e)),1)]),default:se(()=>[(ne(!0),ue(ce,null,de(pe(o),e=>(ne(),oe(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])}}}),Ca={class:"ml-8px"},Va=ae({__name:"date",props:{type:{},typeModifiers:{},value:{default:()=>[]},valueModifiers:{}},emits:["update:type","update:value"],setup(e){const a=le(e,"type"),t=le(e,"value");function l(e=new Date){const a=la(e),t=na(e);return[a.getTime(),t.getTime()]}const n=e=>{switch(e){case"today":t.value=l();break;case"yesterday":t.value=l(ta(new Date,-1));break;case"7day":t.value=(()=>{const e=new Date,a=na(e);return[la(ta(e,-6)).getTime(),a.getTime()]})()}},o=e=>{const a=new Date,t=ta(a,-30);return la(t).getTime()>e||na(a).getTime()<e},s=e=>{a.value="custom",t.value=[la(e[0]).getTime(),na(e[1]).getTime()]};return(e,l)=>{const i=be,r=he,u=ge;return ne(),ue(ce,null,[fe(r,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),onChange:n},{default:se(()=>[fe(i,{label:"今日",value:"today"}),fe(i,{label:"昨日",value:"yesterday"}),fe(i,{label:"最近7天",value:"7day"})]),_:1},8,["modelValue"]),ye("div",Ca,[fe(u,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),type:"daterange","disabled-date":o,onChange:s},null,8,["modelValue"])])],64)}}}),Ea={class:"flex items-center justify-between"},ja={class:"flex items-center gap-16px"},Da={class:"w-240px"},Ta={class:"flex items-center"},Ba=ae({__name:"index",setup(e){const a=o(),{getOverview:t}=wa();_e(a);const l=()=>{t()},n=()=>{t()};return(e,a)=>(ne(),ue("div",Ea,[ye("div",ja,[ye("div",Da,[fe(ka,{value:pe(_a),"onUpdate:value":[a[0]||(a[0]=e=>xe(_a)?_a.value=e:null),l]},null,8,["value"])]),fe(aa)]),ye("div",Ta,[fe(Va,{type:pe(xa).type,"onUpdate:type":a[1]||(a[1]=e=>pe(xa).type=e),value:pe(xa).data,"onUpdate:value":[a[2]||(a[2]=e=>pe(xa).data=e),n]},null,8,["type","value"])])]))}}),Ra={class:"rate-box"},Ma={class:"rate-list"},Sa={class:"rate-text"},Oa={class:"rate-list"},Ua={class:"rate-text"},Aa=s(ae({__name:"index",setup(e){const{onResult:a,getRate:t}=wa(),l=we({delivery:0,open:0,click:0,bounce:0});return a(e=>{l.delivery=e.dashboard.delivery_rate,l.open=e.dashboard.open_rate,l.click=e.dashboard.click_rate,l.bounce=e.dashboard.bounce_rate}),(e,a)=>(ne(),ue("div",Ra,[ye("div",Ma,[a[0]||(a[0]=ye("div",{class:"rate-title"},"送达率",-1)),ye("div",Sa,re("".concat(pe(l).delivery,"%")),1)]),ye("div",Oa,[a[1]||(a[1]=ye("div",{class:"rate-title"},"退信率",-1)),ye("div",Ua,re(pe(t)(pe(l).bounce)),1)])]))}}),[["__scopeId","data-v-25e48e14"]]),Ha={class:"total-list"},La={class:"total-item"},qa={class:"total-value text-primary text-22px"},Ia={class:"total-item"},$a={class:"total-value text-17px"},za={class:"total-item"},Pa={class:"total-value text-17px"},Fa={class:"w-100% h-300px"},Na=s(ae({__name:"index",setup(e){const{onResult:a,getChartTime:t,getOverview:l}=wa(),o=Z(null),s=Z({delivered:0,delivery_rate:0,failed:0,failure_rate:0,sends:0}),{BtECharts:r,getEChart:u,setOption:c,setQuickOption:d}=i({options:{}}),p=ke({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},legend:{top:0,itemGap:16,icon:"circle",itemWidth:10,itemHeight:10,data:["发件成功","发件失败"],textStyle:{lineHeight:12,padding:[0,0,-2,0],rich:{a:{verticalAlign:"middle"}}}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},yAxis:{type:"value",boundaryGap:[0,"6%"],splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#ebeef5"}}},xAxis:m(),series:[{type:"bar",name:"发件成功",data:[]},{type:"bar",name:"发件失败",data:[]}],events:{click:e=>{if("bar"===e.componentSubType&&n(e.value)&&"daily"===e.value[2]){const a=new Date(e.value[0]);xa.value.type="custom",xa.value.data=[la(a).getTime(),na(a).getTime()],l()}}}});function m(e="HH:mm"){return{type:"category",axisLabel:{formatter:a=>"HH:mm"===e?a.match(/\d{2}:\d{2}/)[0]:a.split(" ")[0]}}}return Ce(()=>{a(e=>{e.send_mail_chart&&(s.value=e.send_mail_chart.dashboard,(e=>{const a=[],l=[];e.data.forEach(n=>{a.push([t(e.column_type,n.x),n.failed,e.column_type]),l.push([t(e.column_type,n.x),n.delivered,e.column_type])}),p.series=[{type:"bar",name:"发件失败",data:a,stack:"total",itemStyle:{color:"#1A519B"}},{type:"bar",name:"发件成功",data:l,stack:"total",itemStyle:{color:"#91CC75"}}],p.xAxis=m("hourly"===e.column_type?"HH:mm":"yyyy-MM-dd")})(e.send_mail_chart),o.value=u(),c(p))})}),(e,a)=>(ne(),ue(ce,null,[a[3]||(a[3]=ye("div",{class:"mb-16px font-bold text-16px text-default"},"今日发送",-1)),ye("div",Ha,[ye("div",La,[a[0]||(a[0]=ye("div",{class:"total-label"},"发件成功率",-1)),ye("div",qa,re(pe(s).delivery_rate)+"%",1)]),ye("div",Ia,[a[1]||(a[1]=ye("div",{class:"total-label"},"发件成功",-1)),ye("div",$a,re(pe(s).delivered),1)]),ye("div",za,[a[2]||(a[2]=ye("div",{class:"total-label"}," 发件失败 ",-1)),ye("div",Pa,re(pe(s).failed),1)])]),ye("div",Fa,[fe(pe(r),{style:{height:"300px"}})])],64))}}),[["__scopeId","data-v-08d72c14"]]),Wa={class:"flex-center !h-370px"},Ja=ae({__name:"bounce",setup(e){const{onResult:a,getChartTime:t}=wa(),l=ke({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"2%",containLabel:!0},yAxis:{name:"%",type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#ebeef5"}},max:({max:e})=>e>100?100:e},xAxis:n(),series:o()});function n(e="HH:mm"){return{type:"category",axisLabel:{formatter:a=>"HH:mm"===e?a.match(/\d{2}:\d{2}/)[0]:a.split(" ")[0]}}}function o(e=[]){return[{name:"退信率",type:"line",data:e,itemStyle:{color:"#20a53a"},smooth:!1,showSymbol:!1,sampling:"average"}]}const{BtECharts:s,getEChart:r,setOption:u,setQuickOption:c}=i({options:{}});return a(e=>{const{bounce_rate_chart:a}=e;if(a){const e=a.data.map(e=>[t(a.column_type,e.x),e.bounce_rate]);l.series=o(e),l.xAxis=n("hourly"===a.column_type?"HH:mm":"yyyy-MM-dd"),u(l)}}),(e,a)=>(ne(),ue(ce,null,[a[0]||(a[0]=ye("div",{class:"mb-16px font-bold text-16px text-default"},"退信率%",-1)),ye("div",Wa,[fe(pe(s),{style:{height:"370px"}})])],64))}}),Ka={class:"overview-card"},Ga={class:"overview-card"},Qa=s(ae({__name:"index",setup(e){const{getOverview:a}=wa();return a(),(e,a)=>{const t=Ve,l=Ee;return ne(),ue("div",null,[fe(Ba),fe(Aa),fe(l,{gutter:16},{default:se(()=>[fe(t,{span:12},{default:se(()=>[ye("div",Ka,[fe(Na)])]),_:1}),fe(t,{span:12},{default:se(()=>[ye("div",Ga,[fe(Ja)])]),_:1})]),_:1})])}}}),[["__scopeId","data-v-0393543f"]]);const Xa={class:"flex items-center"},Ya={class:"w-260px"},Za={class:"ml-10px"},et=ae({__name:"template",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e,{expose:a}){const t=le(e,"value"),l=Z([]),{loading:o,setLoading:s}=Ye(),i=()=>{oa("template")},c=async()=>{try{s(!0);const{data:e}=await r();n(e)&&e.length>0&&(l.value=e.map(e=>({label:e.name,value:e.id})),t.value||(t.value=e[0].id))}finally{s(!1)}};return c(),a({getList:c}),(e,a)=>{const n=me,s=ve,r=u;return ne(),ue("div",Xa,[ye("div",Ya,[fe(s,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),loading:pe(o),filterable:!0},{default:se(()=>[(ne(!0),ue(ce,null,de(pe(l),e=>(ne(),oe(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),ye("div",Za,[fe(r,{onClick:i},{default:se(()=>[...a[1]||(a[1]=[ie("创建",-1)])]),_:1})])])}}}),at={class:"w-170px mr-10px"},tt={class:"w-180px"},lt=ae({__name:"sender",props:{value:{},valueModifiers:{}},emits:te(["change"],["update:value"]),setup(e,{emit:t}){const o=t,s=Z(null),i=le(e,"value"),r=Z([]),u=Z([]),d=Z([]),p=e=>{const a=d.value.find(a=>a.username===e);a&&o("change",a.full_name)},m=Z(!1),v=Z(!1),f=async()=>{try{m.value=!0;const{data:{data:e}}=await l();n(e)&&(r.value=e.map(e=>({label:e,value:e})),s.value=e[0]||null)}finally{m.value=!1}},y=async()=>{try{v.value=!0;const{data:{data:e}}=await c();n(e)&&e.length>0&&(d.value=e)}finally{v.value=!1}},b=()=>{u.value=d.value.filter(e=>e.domain===s.value).map(e=>({data:e,label:e.username,value:e.username}))},h=()=>{if(u.value[0]){const{data:e}=u.value[0];i.value="".concat(u.value[0].value),a(e)&&o("change",e.full_name)}else i.value=null,o("change","")},g=()=>{b(),h()};return(async()=>{if(await Promise.all([f(),y()]),b(),i.value){for(const e of d.value)if(e.username===i.value){s.value=e.domain;break}}else h()})(),(e,a)=>{const t=me,l=ve;return ne(),ue(ce,null,[ye("div",at,[fe(l,{modelValue:pe(s),"onUpdate:modelValue":a[0]||(a[0]=e=>xe(s)?s.value=e:null),loading:pe(m),onChange:g},{default:se(()=>[(ne(!0),ue(ce,null,de(pe(r),e=>(ne(),oe(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),ye("div",tt,[fe(l,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),loading:pe(v),onChange:p},{default:se(()=>[(ne(!0),ue(ce,null,de(pe(u),e=>(ne(),oe(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])])],64)}}}),nt={class:"flex"},ot={class:"ml-40px"},st=ae({__name:"import",props:te({path:{default:""},accept:{default:()=>[]}},{value:{},valueModifiers:{}}),emits:te(["change"],["update:value"]),setup(e,{emit:a}){const t=e,{path:l,accept:n}=t,o=le(e,"value");je(o,e=>{s("change",e)});const s=a,i=()=>{Ze({path:l,size:5,uploadData:{accept:n.map(e=>".".concat(e)).join(","),multiple:!1,limit:1},refreshEvent:(e,a)=>{o.value=e[0].name,a()}})};return(e,a)=>{const t=Me;return ne(),ue("div",null,[ye("div",nt,[fe(t,{type:"primary",onClick:i},{default:se(()=>[...a[0]||(a[0]=[ie("导入",-1)])]),_:1}),ye("div",ot,[a[1]||(a[1]=ie(" 文件名: ",-1)),ye("span",{class:Be(o.value?"text-primary":"text-[#dc2626]")},re(o.value||"未选择任何文件"),3)])]),Re(e.$slots,"default")])}}}),it={class:"p-20px"},rt={class:"w-250px"},ut=ae({__name:"type-create",props:{compData:{}},setup(e,{expose:a}){const t=e,{compData:l}=t,n=Z(null),o=we({mail_type:"",file:""}),s={mail_type:{required:!0,message:"请输入分组名称",trigger:["blur","input"]},file:{required:!0,message:"请上传文件",trigger:["blur","change"]}};return a({onConfirm:async e=>{var a;await(null==(a=n.value)?void 0:a.validate()),d({loading:"正在导入...",message:!0,request:p({...o}),success:a=>{var t;a.status&&(null==(t=l.refresh)||t.call(l),e())}})}}),(e,a)=>{const t=Oe,l=Ue,i=Ae,r=Se("bt-tips");return ne(),ue("div",it,[fe(i,{ref_key:"formRef",ref:n,model:pe(o),rules:s},{default:se(()=>[fe(l,{label:"分组名称",prop:"mail_type"},{default:se(()=>[ye("div",rt,[fe(t,{modelValue:pe(o).mail_type,"onUpdate:modelValue":a[0]||(a[0]=e=>pe(o).mail_type=e),placeholder:"请输入分组名称"},null,8,["modelValue"])])]),_:1}),fe(l,{label:"邮箱",prop:"file"},{default:se(()=>[fe(st,{value:pe(o).file,"onUpdate:value":a[1]||(a[1]=e=>pe(o).file=e),path:"/www/server/panel/data/mail/in_bulk/recipient",accept:["txt","json"]},null,8,["value"])]),_:1})]),_:1},8,["model"]),fe(r,{class:"mt-4px"},{default:se(()=>[...a[2]||(a[2]=[ye("li",null," 文件类型: txt/json 每行一个邮箱 不超过5 MB ",-1)])]),_:1})])}}}),ct={class:"flex-1"},dt={class:"flex items-center"},pt={class:"w-260px"},mt={class:"ml-10px"},vt={class:"mt-8px"},ft=ae({__name:"type",props:{value:{},valueModifiers:{},name:{},nameModifiers:{}},emits:["update:value","update:name"],setup(e,{expose:t}){const l=le(e,"value"),o=le(e,"name"),s=Z([]),i=Z([]),r=Z(0),{loading:c,setLoading:d}=Ye(),p=async()=>{try{d(!0);const{data:e}=await m({});n(e)&&(i.value=e,s.value=e.map(e=>({label:e.mail_type,value:e.id})),l.value&&l.value.length>0&&y(l.value))}finally{d(!1)}},y=async e=>{o.value=i.value.filter(a=>e.includes(a.id)).map(e=>e.mail_type);const{data:t}=await v({etypes:e.join(",")});a(t)&&(r.value=t.data)},b=()=>{f({title:"创建新的分组",area:48,showFooter:!0,compData:{refresh:p},component:ut})};return p(),t({getType:p}),(e,a)=>{const t=me,n=ve,o=u;return ne(),ue("div",ct,[ye("div",dt,[ye("div",pt,[fe(n,{class:"bt-multiple-select",modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),loading:pe(c),multiple:"",filterable:"",placeholder:"请选择分组",onChange:y},{default:se(()=>[(ne(!0),ue(ce,null,de(pe(s),e=>(ne(),oe(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),ye("div",mt,[fe(o,{onClick:b},{default:se(()=>[...a[1]||(a[1]=[ie("创建",-1)])]),_:1})])]),ye("div",vt,[a[2]||(a[2]=ie("发送邮件 (",-1)),ye("b",null,re(pe(r)),1),a[3]||(a[3]=ie(" 个收件人)",-1))])])}}});var yt=(e=>(e.Columns="columns",e.Button="button",e.Divider="divider",e.Header="header",e.Text="text",e.Image="image",e.Menu="menu",e.Html="html",e.commonComp="commonComp",e))(yt||{});const bt=["button","divider","header","text","image","menu","html","commonComp"];function ht(e){return"border"==e||"padding"==e||"borderRadius"==e}function gt(e,...a){if(null==e||"object"!=typeof e)return e;for(const t of a)if(null!=t)for(const a in t){const l=e[a],n=t[a];void 0!==l?null===l||null===n||"object"!=typeof l||"object"!=typeof n||Array.isArray(l)||Array.isArray(n)||l instanceof Date||l instanceof RegExp||l instanceof Map||l instanceof Set||gt(l,n):e[a]=nl(n)}return e}const _t={comp_type:{button:()=>Pt}};function xt(){const e=Object.keys(_t.comp_type);Object.entries(Bt.value).forEach(([,a])=>{e.includes(a.type)&&Object.entries(St.value).forEach(([e,t])=>{if(e===a.key){const e=_t.comp_type[a.type]();t.style=gt(t.style,e)}})})}const wt=Z(!1),kt=Z(""),Ct=Z(""),Vt=Z("");Z("bottom");const Et=Z(""),jt=Z([]),Dt=Z({}),Tt=Z({}),Bt=Z({}),Rt=Z({}),Mt=Z({}),St=Z({}),Ot=Z({}),Ut=Z({backgroundColor:"#ffffff",maxWidth:"500px"}),At=Z(),Ht=Te(()=>({version:1.5,columns_source:jt.value,column_map:Dt.value,cell_map:Tt.value,cell_style_map:Rt.value,column_row_style_map:Mt.value,comp_style_map:St.value,compOptions:Ot.value,comp_map:Bt.value,page_style:Ut.value})),Lt=Z(!0),qt=Z(async()=>!1),It=Z([{type:"columns",name:"行",icon:"el-semi-select",key:"0",children:[]},{type:"button",icon:"el-empty",name:"按钮",key:"0"},{type:"divider",name:"分割线",icon:"icon-drag",key:"0"},{type:"header",name:"标题",icon:"el-info-filled",key:"0"},{type:"text",name:"文本",icon:"file-text",key:"0"},{type:"image",name:"图片",icon:"el-folder-opened",key:"0"},{type:"menu",name:"菜单",icon:"menu-setting",key:"0"}]),$t={style:{backgroundColor:"transparent",padding:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""},border:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""}}},zt={style:{backgroundColor:"transparent",padding:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""}}},Pt={border:{more:!1,all:"",top:"",right:"",bottom:"",left:""},padding:{more:!0,all:"",top:"10px",left:"20px",right:"20px",bottom:"10px"},borderRadius:{more:!1,all:"4px",top:"",left:"",right:"",bottom:""},width:"auto",lineHeight:"120%",color:"#ffffff",display:"inline-block",backgroundColor:"#3AAEE0",FontWeight:"normal",fontSize:"14px",textAlign:"center",LetterSpacing:"0px"},Ft={button:{style:Pt,general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{href:"",target:"_blank"},content:"按钮"},divider:{style:{borderTop:"1px solid #bbbbbb",width:"100%",display:"inline-block",lineHeight:"1px",height:"0px",verticalAlign:"middle"},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{}},header:{style:{position:"relative",display:"block",lineHeight:"140%",fontWeight:"normal",fontSize:"22px",letterSpacing:"0px",color:"#333333"},general:{textAlign:"left",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{},content:"标题"},text:{style:{fontSize:"14px",fontWeight:"normal",color:"#333",textAlign:"left",lineHeight:"140%",letterSpacing:"0px"},general:{padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{},content:"文本"},image:{style:{display:"inline-block",width:"100%"},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{href:"",target:"_blank",src:"",alt:""}},menu:{style:{fontWeight:"normal",fontSize:"14px",letterSpacing:"0px",color:"#444444",linkColor:"#0068A5",padding:{more:!0,all:"",top:"5px",left:"15px",right:"15px",bottom:"5px"}},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{layout:"horizontal"},links:[{id:jl(6),label:"菜单 1",href:""},{id:jl(6),label:"菜单 2",href:""}]}},Nt={events:{makeDom:[function(){let e=null;return()=>{clearTimeout(e),e=setTimeout(()=>{At.value=Kt().outerHTML,Wt()},300)}}()]},$emit(e,a){this.events[e]&&this.events[e].forEach(e=>e(a))}};const Wt=function(){let e=null;return()=>{Lt.value&&(Lt.value=!1,clearTimeout(e),e=setTimeout(async()=>{await qt.value(),Lt.value=!0},1e3))}}();function Jt(){const e=function(){var e,a,t,l,n,o,s;const i={};for(const r in Bt.value){const u=document.createElement("div");Gt(u,St.value[r]);let c=null;switch(Bt.value[r].type){case"button":c=document.createElement("a"),Qt(c,St.value[r]);break;case"divider":c=document.createElement("div"),Xt(c,St.value[r]);break;case"header":c=document.createElement("div"),Yt(c,St.value[r]);break;case"text":c=document.createElement("div"),Zt(c,St.value[r]);break;case"image":if(null==(e=St.value[r].info)?void 0:e.href){c=document.createElement("a"),c.href=null==(a=St.value[r].info)?void 0:a.href,c.target=null==(t=St.value[r].info)?void 0:t.target;const e=document.createElement("img");e.src=(null==(l=St.value[r].info)?void 0:l.src)||"",e.alt=(null==(n=St.value[r].info)?void 0:n.alt)||"",e.style.display="block",e.style.width="100%",c.appendChild(e)}else c=document.createElement("img"),c.src=(null==(o=St.value[r].info)?void 0:o.src)||"",c.alt=(null==(s=St.value[r].info)?void 0:s.alt)||"";el(c,St.value[r]);break;case"menu":c=document.createElement("div"),al(c,St.value[r])}c&&u.appendChild(c),i[r]={dom:u,general:{},info:St.value[r].info}}return i}(),a={};for(const t in Tt.value){const l=document.createElement("td");l.style.width=Tt.value[t].width,ll(l,Rt.value[t]),Tt.value[t].children.forEach(a=>{if(e[a]){l.appendChild(e[a].dom);for(const t in e[a].general)l.style[t]=e[a].general[t]}}),a[t]={dom:l}}return a}function Kt(){const e=function(){const e=Jt(),a={};for(const t in Dt.value){const l=document.createElement("tr"),n=document.createElement("td"),o=document.createElement("div");tl(o,Mt.value[t]);const s=document.createElement("table");s.style.width="100%";const i=document.createElement("tr");Dt.value[t].children.forEach(a=>{i.appendChild(e[a].dom)}),s.appendChild(i),o.appendChild(s),n.appendChild(o),l.appendChild(n),a[t]={dom:l}}return a}(),a=document.createElement("table");a.setAttribute("width",Ut.value.maxWidth),a.style.margin="0 auto",a.style.backgroundColor=Ut.value.backgroundColor;for(const t of jt.value)a.appendChild(e[t].dom);return a}function Gt(e,a){const t=Tl(a,"general");t&&Object.entries(t).forEach(([a,t])=>{e.style[a]=t})}function Qt(e,a){const t=Tl(a),l=Tl(a,"general");for(const o in t)e.style[o]=t[o];e.innerText=a.content;const{info:n}=a;return n&&(e.href=n.href,e.target=n.target),{generalStyle:l}}function Xt(e,a){const t=Tl(a),l=Tl(a,"general");for(const n in t)e.style[n]=t[n];return{generalStyle:l}}function Yt(e,a){const t=Tl(a),l=Tl(a,"general");for(const n in t)e.style[n]=t[n];return e.innerText=a.content,{generalStyle:l}}function Zt(e,a){const t=Tl(a),l=Tl(a,"general");for(const n in t)e.style[n]=t[n];return e.innerText=a.content,{generalStyle:l}}function el(e,a){const t=Tl(a);for(const l in t)e.style[l]=t[l]}function al(e,a){const{links:t,info:l}=a;t.forEach(t=>{const n=document.createElement("a");!function(e,a){const t=Tl(a);for(const l in t)e.style[l]=t[l]}(n,a),n.style.display="vertical"===(null==l?void 0:l.layout)?"block":"inline-block",n.href=t.href,n.target="_blank",n.innerText=t.label,e.appendChild(n)})}function tl(e,a){const t=Tl(a);for(const l in t)e.style[l]=t[l]}function ll(e,a){const t=Tl(a);for(const l in t)e.style[l]=t[l]}function nl(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source,e.flags);if(e instanceof Map){const a=new Map;return e.forEach((e,t)=>{a.set(nl(t),nl(e))}),a}if(e instanceof Set){const a=new Set;return e.forEach(e=>{a.add(nl(e))}),a}if(Array.isArray(e))return e.map(e=>nl(e));const a=Object.create(Object.getPrototypeOf(e));return[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)].forEach(t=>{const l=Object.getOwnPropertyDescriptor(e,t);if(l){const e={...l};void 0!==l.value&&(e.value=nl(l.value)),Object.defineProperty(a,t,e)}}),a}function ol(e,a){if("0"==e.key){const e=jl();!function(e,a){jt.value.splice(a,0,e),Nt.$emit("makeDom")}(e,a),function(e){const a=jl();Dt.value[e]={type:yt.Columns,name:"列",key:e,children:[a]},il(a),function(e){Mt.value[e]=nl(zt)}(e),Nt.$emit("makeDom")}(e),dl(e,"columns")}Nt.$emit("makeDom")}function sl(e,a){Dt.value[e].children.push(a),il(a),Nt.$emit("makeDom")}function il(e){Tt.value[e]={width:"100%",key:e,children:[]},function(e){Rt.value[e]=nl($t)}(e),Nt.$emit("makeDom")}function rl(e,a,t){Tt.value[e].children.push(a),cl(a,t),Nt.$emit("makeDom")}function ul(e,a,t,l){Tt.value[e].children.splice(l,0,a),cl(a,t),Nt.$emit("makeDom")}function cl(e,a){Bt.value[e]={key:e,type:a},dl(e,a),Nt.$emit("makeDom")}function dl(e,a){St.value[e]=nl(Ft[a]),Nt.$emit("makeDom")}function pl(e,a){!function(e){delete St.value[e],Nt.$emit("makeDom")}(e),delete Bt.value[e],Tt.value[a].children=Tt.value[a].children.filter(a=>a!==e),Nt.$emit("makeDom")}function ml(e,a){Tt.value[e].children.forEach(a=>{pl(a,e)}),delete Tt.value[e],Dt.value[a].children=Dt.value[a].children.filter(a=>a!==e),Nt.$emit("makeDom")}function vl(e){kt.value="",Ct.value="",Dt.value[e].children.forEach(a=>{ml(a,e)}),delete Dt.value[e],jt.value=jt.value.filter(a=>a!==e),Nt.$emit("makeDom")}function fl(e,a,t){const l=Tt.value[e].children.findIndex(e=>e==a),n=Tt.value[e].children.findIndex(e=>e==t);-1!==l&&-1!==n&&l>n&&(Tt.value[e].children.splice(l,1),Tt.value[e].children.splice(n,0,a)),Nt.$emit("makeDom")}function yl(e,a,t){const l=Tt.value[e].children.findIndex(e=>e==a),n=Tt.value[e].children.findIndex(e=>e==t);-1!==l&&-1!==n&&l<n&&(Tt.value[e].children.splice(n,1),Tt.value[e].children.splice(l,0,t)),Nt.$emit("makeDom")}function bl(e,a){const t=jt.value.findIndex(a=>a==e),l=jt.value.findIndex(e=>e==a);-1!==t&&-1!==l&&t<l&&(jt.value[t]=a,jt.value[l]=e),Nt.$emit("makeDom")}function hl(e,a){const t=jt.value.findIndex(a=>a==e),l=jt.value.findIndex(e=>e==a);-1!==t&&-1!==l&&t>l&&(jt.value[t]=a,jt.value[l]=e),Nt.$emit("makeDom")}function gl(e,a){const t=Dt.value[a].children;if(t.length<e.length){const l=e.length-t.length;for(let e=0;e<l;e++){const e=jl();sl(a,e)}}else{t.splice(e.length).forEach(e=>{ml(e,a)})}t.forEach((a,t)=>{Tt.value[a].width=e[t]+"%"}),Nt.$emit("makeDom")}function _l(e){const a=[];Dt.value[e].children.forEach(e=>{a.push(Number(Tt.value[e].width.split("%")[0]))});const t=100/(a.length+1),l=a.reduce((e,a)=>e+a,0),n=(100-(l+t))/l;a.push(t);for(let o=0;o<a.length-1;o++)a[o]+=a[o]*n;gl(a,e),Nt.$emit("makeDom")}function xl(e,a){const t=Dt.value[a].children.reduce((a,t)=>{const l=Number(Tt.value[e].width.split("%")[0]);return{...a,[t]:l}},{});delete t[e];let l=Object.values(t);const n=l.reduce((e,a)=>e+a,0),o=(100-n)/n;l=l.map(e=>parseFloat((e*(1+o)).toFixed(2)));const s=100-l.reduce((e,a)=>e+a,0);0!==s&&(l[l.length-1]+=s),ml(e,a),gl(l,a),Nt.$emit("makeDom")}function wl(e,a){const t=Tt.value[a],l=Bt.value[e],n=St.value[e];if(t&&l&&n){const a=nl(n),o=nl(l),s=jl(),i=t.children.findIndex(a=>a===e);-1!==i&&t.children.splice(i+1,0,s),o.key=s,Bt.value[s]=o,St.value[s]=a}}function kl(e){const a=JSON.parse(e);Ot.value=a.compOptions,Rt.value=a.cell_style_map,Mt.value=a.column_row_style_map,Dt.value=a.column_map,Bt.value=a.comp_map,Tt.value=a.cell_map,St.value=a.comp_style_map,jt.value=a.columns_source,a.page_style&&(Ut.value=a.page_style)}function Cl(e){e&&(kl(e),xt(),Nt.$emit("makeDom"))}function Vl(){jt.value=[],Dt.value={},Tt.value={},Bt.value={},Rt.value={},Mt.value={},St.value={},Ot.value={}}function El(e){if(!e)return;return 1.5!==JSON.parse(e).version?(kl(e),xt(),{content:Kt().outerHTML,render:Ht.value}):null}function jl(e=10){return Math.random().toString(16).slice(2,2+e)}function Dl(e,a){let t="",l="",n="",o="",s="";return"border"==a&&(t="border",l="borderTop",n="borderRight",o="borderBottom",s="borderLeft"),"padding"==a&&(t="padding",l="paddingTop",n="paddingRight",o="paddingBottom",s="paddingLeft"),"borderRadius"==a&&(t="borderRadius",l="borderTopLeftRadius",n="borderTopRightRadius",o="borderBottomRightRadius",s="borderBottomLeftRadius"),e.more?{[l]:e.top,[n]:e.right,[o]:e.bottom,[s]:e.left}:{[t]:e.all}}function Tl(e,a="style"){if(!e)return;const t={};for(const l in e[a])ht(l)?Object.assign(t,Dl(e[a][l],l)):t[l]=e[a][l];return t}function Bl(e,a=0,t={}){let l,n,o,s,i,r,u=0,c=!1,d=!1,p=!0;function m(a){const t=l,o=n;return l=n=void 0,u=a,s=e.apply(o,t),s}function v(e,a){return setTimeout(e,a)}function f(e){const t=e-(r||0);return void 0===r||t>=a||t<0||d&&e-u>=(o||0)}function y(){const e=Date.now();if(f(e))return b(e);i=v(y,function(e){const t=e-u,l=a-(e-(r||0));return d?Math.min(l,(o||0)-t):l}(e))}function b(e){return i=void 0,p&&l?m(e):(l=n=void 0,s)}function h(...e){const t=Date.now(),o=f(t);if(l=e,n=this,r=t,o){if(void 0===i)return function(e){return u=e,i=v(y,a),c?m(e):s}(r);if(d)return i=v(y,a),m(r)}return void 0===i&&(i=v(y,a)),s}return a=Number(a)||0,t&&(c=!!t.leading,d="maxWait"in t,o=d?Math.max(Number(t.maxWait)||0,a):void 0,p="trailing"in t?!!t.trailing:p),h.cancel=function(){void 0!==i&&clearTimeout(i),u=0,l=r=n=i=void 0},h.flush=function(){return void 0===i?s:b(Date.now())},h.pending=function(){return void 0!==i},h}const Rl=["innerHTML"],Ml=ae({__name:"preview",props:{id:{}},setup(e){const t=He(e,"id"),l=Z(""),n=async()=>{if(!t.value)return;const{data:e}=await y({id:t.value});if(a(e)){const a=El(e.render);a&&1===e.type?(l.value=a.content,await b({id:t.value,type:e.type,temp_name:e.name,render:JSON.stringify(a.render),content:a.content},!1)):l.value=e.content}};return je(()=>t.value,()=>{n()}),n(),(e,a)=>(ne(),ue("div",{class:"flex-1 min-w-[520px] overflow-auto border-#ebebeb border-1 border-solid rounded-[4px] p-[12px]",innerHTML:pe(l)},null,8,Rl))}}),Sl={class:"mb-12px font-bold text-15px text-default leading-28px"},Ol={class:"flex flex-col w-550px"},Ul={class:"form-card mb-16px pt-20px"},Al={class:"w-360px"},Hl={class:"w-360px"},Ll={class:"w-[60px] ml-[24px]"},ql={class:"form-card flex-1 py-[10px]"},Il={class:"w-360px"},$l={class:"flex w-360px"},zl={class:"flex-1 mr-10px"},Pl={class:"form-card flex flex-col items-center w-640px ml-16px pt-12px p-16px overflow-hidden"},Fl={class:"mb-12px"},Nl={class:"min-w-260px text-[12px]"},Wl={class:"min-w-260px text-[12px]"},Jl={class:"min-w-260px text-[12px]"},Kl={class:"mt-[16px]"},Gl=s(ae({__name:"index",props:te({row:{},isEdit:{type:Boolean,default:!1},refresh:{type:Function,default:()=>{}}},{show:{type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const a=e,{refresh:t}=a,l=le(e,"show");o();const n=Le("formRef"),s=Le("containerRef"),{height:i}=function(e){const a=Z(0),{mainHeight:t}=_e(o());return je(()=>t.value,t=>{De(()=>{if(!e.value)return;const{top:l}=e.value.getBoundingClientRect();a.value=t-l-16-16-52})},{immediate:!0}),{height:Te(()=>0===a.value?"auto":a.value+"px")}}(s),r=we({task_name:h(12),addresser:null,full_name:"",subject:"",temp_id:sa.value,is_record:0,etypes:[],unsubscribe:1,threadsType:0,threads:1,start_time:null,pause:0,remark:"",mail_to:""}),u=Z([]),c={full_name:{trigger:["blur","input"],validator:()=>""!==r.full_name||new Error("请输入显示名称")},subject:{trigger:["blur","input"],validator:()=>""!==r.subject||new Error("请输入邮件主题")},etypes:{trigger:"change",validator:()=>0!==r.etypes.length||new Error("请选择联系人")},temp_id:{trigger:"change",validator:()=>null!==r.temp_id||new Error("请选择邮件模板")},start_time:{validator:()=>1!==r.pause||null!==r.start_time||new Error("请选择发送时间")}},p=e=>{r.full_name=e||""},m=Le("startTimeRef"),v=()=>{De(()=>{var e;null==(e=m.value)||e.restoreValidation()})},y=()=>{var e;null==(e=m.value)||e.validate()},b=()=>{f({title:"退订设置",area:45,component:Pe(()=>g(()=>import("./unsubscribe.js?v=1756369731"),__vite__mapDeps([]),import.meta.url))})},V=Le("subjectRef"),E=Le("mailToRef"),j=async()=>{var e,a;return""===r.subject?(null==(e=V.value)||e.focus(),void _.error("请输入邮件主题")):""===r.mail_to?(null==(a=E.value)||a.focus(),void _.error("请输入测试邮箱")):void(null!==r.temp_id?d({loading:"正在发送...",request:x({mail_from:r.addresser||"",subject:r.subject,mail_to:r.mail_to,temp_id:r.temp_id||0}),message:!0}):_.error("请选择邮件模板"))},D=()=>{r.subject||r.etypes.length>0?w({title:"提示",content:"确定放弃当前编辑吗？",onConfirm:()=>{l.value=!1}}):l.value=!1},T=async()=>{var e;await(null==(e=n.value)?void 0:e.validate());const o={task_name:r.task_name,addresser:r.addresser||"",full_name:r.full_name,subject:r.subject,temp_id:r.temp_id||0,is_record:r.is_record,unsubscribe:r.unsubscribe,threads:0===r.threadsType?0:r.threads,etypes:r.etypes.join(","),start_time:0===r.pause?Math.floor((new Date).getTime()/1e3):Math.floor((r.start_time||0)/1e3),remark:r.remark},{isEdit:s,row:i}=a;d({loading:"正在保存...",request:s&&i?k({...o,id:i.id}):C(o),message:!0,success:e=>{e.status&&(l.value=!1,null==t||t())}})};return qe(()=>{sa.value=null,ia.value=!1}),(()=>{const{row:e,isEdit:t}=a;e&&(r.task_name=t?e.task_name:"".concat(e.task_name,"_").concat(h(4)),r.addresser=e.addresser,r.full_name=e.full_name,r.subject=e.subject,r.is_record=e.is_record,r.unsubscribe=e.unsubscribe,r.threadsType=0===e.threads?0:1,r.threads=e.threads,r.etypes=e.etypes.split(",").map(e=>ea(e)),1e3*e.start_time>(new Date).getTime()&&(r.pause=1,r.start_time=1e3*e.start_time),r.temp_id=e.temp_id,r.remark=e.remark)})(),(e,a)=>{const t=Ue,l=Oe,o=Fe,d=Me,f=Ne,h=he,g=We,_=ge,x=Ae;return ne(),oe(x,{ref_key:"formRef",ref:n,model:pe(r),rules:c,"label-width":"150px"},{default:se(()=>[ye("div",Sl,re(e.isEdit?"编辑发送任务":"添加发送任务"),1),ye("div",{ref_key:"containerRef",ref:s,class:"flex min-h-654px",style:Ie({height:pe(i)})},[ye("div",Ol,[ye("div",Ul,[fe(t,{label:"发件人",prop:"addresser"},{default:se(()=>[fe(lt,{value:pe(r).addresser,"onUpdate:value":a[0]||(a[0]=e=>pe(r).addresser=e),onChange:p},null,8,["value"])]),_:1}),fe(t,{label:"显示名称",prop:"full_name"},{default:se(()=>[ye("div",Al,[fe(l,{modelValue:pe(r).full_name,"onUpdate:modelValue":a[1]||(a[1]=e=>pe(r).full_name=e),placeholder:"请输入显示名称"},null,8,["modelValue"])])]),_:1}),fe(t,{label:"邮件主题",prop:"subject"},{default:se(()=>[ye("div",Hl,[fe(l,{ref_key:"subjectRef",ref:V,modelValue:pe(r).subject,"onUpdate:modelValue":a[2]||(a[2]=e=>pe(r).subject=e),placeholder:"请输入邮件主题"},null,8,["modelValue"])])]),_:1}),fe(t,{label:"收件人",prop:"etypes"},{default:se(()=>[fe(ft,{value:pe(r).etypes,"onUpdate:value":a[3]||(a[3]=e=>pe(r).etypes=e),name:pe(u),"onUpdate:name":a[4]||(a[4]=e=>xe(u)?u.value=e:null)},null,8,["value","name"])]),_:1}),fe(t,{label:"邮件模板",prop:"temp_id"},{default:se(()=>[fe(et,{value:pe(r).temp_id,"onUpdate:value":a[5]||(a[5]=e=>pe(r).temp_id=e)},null,8,["value"])]),_:1}),fe(t,{label:"保存到发件箱"},{default:se(()=>[fe(o,{modelValue:pe(r).is_record,"onUpdate:modelValue":a[6]||(a[6]=e=>pe(r).is_record=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),fe(t,{label:"退订链接"},{default:se(()=>[fe(o,{modelValue:pe(r).unsubscribe,"onUpdate:modelValue":a[7]||(a[7]=e=>pe(r).unsubscribe=e),"active-value":1,"inactive-value":0},null,8,["modelValue"]),fe(d,{class:"ml-16px",size:"small",onClick:b},{default:se(()=>[...a[14]||(a[14]=[ie("设置",-1)])]),_:1})]),_:1}),fe(t,{label:"线程数",prop:"threads"},{default:se(()=>[fe(h,{modelValue:pe(r).threadsType,"onUpdate:modelValue":a[8]||(a[8]=e=>pe(r).threadsType=e)},{default:se(()=>[fe(f,{label:0},{default:se(()=>[...a[15]||(a[15]=[ie("自动",-1)])]),_:1}),fe(f,{label:1},{default:se(()=>[...a[16]||(a[16]=[ie("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),$e(ye("div",Ll,[fe(g,{class:"!w-[60px]",modelValue:pe(r).threads,"onUpdate:modelValue":a[9]||(a[9]=e=>pe(r).threads=e),min:1,max:5,controls:!1,placeholder:"输入线程数"},null,8,["modelValue"])],512),[[ze,1===pe(r).threadsType]])]),_:1})]),ye("div",ql,[fe(t,{ref_key:"startTimeRef",ref:m,label:"发送时间",prop:"start_time"},{default:se(()=>[fe(h,{modelValue:pe(r).pause,"onUpdate:modelValue":a[11]||(a[11]=e=>pe(r).pause=e),class:"flex items-center",onChange:v},{default:se(()=>[fe(f,{label:0},{default:se(()=>[...a[17]||(a[17]=[ie("立即发送",-1)])]),_:1}),fe(f,{label:1},{default:se(()=>[fe(_,{modelValue:pe(r).start_time,"onUpdate:modelValue":a[10]||(a[10]=e=>pe(r).start_time=e),type:"datetime",disabled:0===pe(r).pause,clearable:"",onChange:y},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1},512),fe(t,{label:"备注"},{default:se(()=>[ye("div",Il,[fe(l,{modelValue:pe(r).remark,"onUpdate:modelValue":a[12]||(a[12]=e=>pe(r).remark=e),placeholder:"请输入备注"},null,8,["modelValue"])])]),_:1}),fe(t,{label:"发送测试邮件"},{default:se(()=>[ye("div",$l,[ye("div",zl,[fe(l,{ref_key:"mailToRef",ref:E,modelValue:pe(r).mail_to,"onUpdate:modelValue":a[13]||(a[13]=e=>pe(r).mail_to=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),fe(d,{onClick:j},{default:se(()=>[...a[18]||(a[18]=[ie("发送测试邮件",-1)])]),_:1})])]),_:1})])]),ye("div",Pl,[ye("div",Fl,[fe(t,{label:"From: ","show-feedback":!1,class:"!mb-[0]","label-style":{fontWeight:"bold"}},{default:se(()=>[ye("div",Nl,re(pe(r).addresser),1)]),_:1}),fe(t,{label:"To: ","show-feedback":!1,class:"!mb-[0]","label-style":{fontWeight:"bold"}},{default:se(()=>[ye("div",Wl,re(pe(u).length>0?pe(u).join(", "):"--"),1)]),_:1}),fe(t,{label:"Subject: ","show-feedback":!1,class:"!mb-[0]","label-style":{fontWeight:"bold"}},{default:se(()=>[ye("div",Jl,re(pe(r).subject||"--"),1)]),_:1})]),fe(Ml,{id:pe(r).temp_id},null,8,["id"])])],4),ye("div",Kl,[fe(d,{onClick:D},{default:se(()=>[...a[19]||(a[19]=[ie("取消",-1)])]),_:1}),fe(d,{type:"primary",onClick:T},{default:se(()=>[...a[20]||(a[20]=[ie("确定",-1)])]),_:1})])]),_:1},8,["model"])}}}),[["__scopeId","data-v-ef0d129c"]]),Ql=Je("MAIL_MARKET_TASK",()=>({formModal:we({row:null,isEdit:!1,title:""})})),{formModal:Xl}=_e(Ql()),Yl=e=>{Xl.value.row=e,Xl.value.isEdit=!1,ia.value=!0},Zl=ae({__name:"index",setup(e){const{mainHeight:a}=o(),l=Z({isEdit:!1,title:"",row:void 0}),{BtTable:n,BtPage:s,BtRefresh:i,BtTableCategory:r,BtRecommendSearch:u,BtColumn:c,BtBatch:p,BtErrorMask:m,refresh:v}=V({request:async e=>{let a={p:e.p,size:e.limit};const{data:t}=await E(a);return{data:t.data||[],total:j(t.page)||0}},columns:[{prop:"created",label:"时间",width:180,render:e=>t(e.created)},{prop:"subject",label:"邮件主题",showOverflowTooltip:!0},{prop:"addresser",label:"发件人",width:160,showOverflowTooltip:!0},{prop:"recipient_count",label:"收件人",width:160},{prop:"success_count",label:"成功",width:90,render:e=>2===e.task_process?e.recipient_count-e.count.error_count:"--"},{prop:"error_count",label:"失败",width:90,render:e=>2===e.task_process?fe("a",{class:"bt-link !text-[#f00]",href:"javascript:;",onClick:()=>{b(e)}},[e.count.error_count]):"--"},{prop:"task_process",label:"状态",width:90,render:e=>0===e.task_process?fe("span",{class:"text-#fcb040"},[ie(" 待处理 ")]):1===e.task_process?fe("span",{class:"text-#fcb040"},[ie(" 执行中 ")]):"完成"},{prop:"remark",label:"备注",showOverflowTooltip:!0},ma(e=>[{title:"编辑",onClick:()=>{h(e)}},{title:"查看",onClick:()=>{y(e)}},{title:e.task_process?"暂停":"发送",isHide:e=>2===e.task_process,onClick:()=>{x(e)}},{title:"删除",onClick:()=>{_(e)}}])]}),y=e=>{f({title:"查看【".concat(e.subject||"","】"),area:64,compData:{row:e,onAdd:Yl},component:()=>g(()=>import("./index325.js?v=1756369731").then(e=>e.i),__vite__mapDeps([]),import.meta.url)})},b=e=>{f({title:"错误日志【".concat(e.subject,"】"),area:70,compData:{row:e},component:()=>g(()=>import("./index326.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},h=e=>{l.value.row=e,l.value.isEdit=!0,ia.value=!0},_=async e=>{w({title:"删除任务",content:"是否删除【".concat(e.subject,"】任务？"),onConfirm:async()=>{d({loading:"正在删除任务，请稍候...",message:!0,request:D({task_id:e.id}),success:()=>{v()}})}})},x=e=>{w({title:"更改任务状态【".concat(e.subject,"】"),content:e.task_process?"暂停任务后，可以继续发送任务！":"立即开始发送任务吗？",onConfirm:async()=>{d({loading:"正在处理，请稍候...",message:!0,request:T({task_id:e.id,pause:e.task_process?1:0}),success:()=>{v()}})}})};return je(ia,e=>{e||(l.value.row=void 0,l.value.isEdit=!1,l.value.title="")}),(e,t)=>{const o=Me,i=pa;return ne(),ue("div",null,[$e(fe(i,null,{"header-left":se(()=>[fe(o,{type:"primary",onClick:t[0]||(t[0]=e=>pe(Yl)())},{default:se(()=>[...t[2]||(t[2]=[ie(" 添加发送任务 ",-1)])]),_:1}),fe(aa,{class:"ml-16px"})]),content:se(()=>[fe(pe(n),{"min-height":pe(a)},null,8,["min-height"])]),"footer-right":se(()=>[fe(pe(s))]),_:1},512),[[ze,!pe(ia)]]),pe(ia)?(ne(),oe(Gl,{key:0,show:pe(ia),"onUpdate:show":t[1]||(t[1]=e=>xe(ia)?ia.value=e:null),"is-edit":pe(l).isEdit,title:pe(l).title,row:pe(l).row,refresh:pe(v)},null,8,["show","is-edit","title","row","refresh"])):Ke("",!0)])}}}),en=ae({__name:"type-select",props:{value:{default:()=>[]},valueModifiers:{}},emits:["update:value"],setup(e,{expose:a}){const t=le(e,"value"),l=Z([]),{loading:o,setLoading:s}=Ye(),i=async()=>{try{s(!0);const{data:e}=await m({});n(e)&&(l.value=e.map(e=>({label:e.mail_type,value:e.id})))}finally{s(!1)}};return i(),Ce(()=>{}),a({getType:i}),(e,a)=>{const n=me,s=ve;return ne(),oe(s,Ge(e.$attrs,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),loading:pe(o)}),{default:se(()=>[(ne(!0),ue(ce,null,de(pe(l),e=>(ne(),oe(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},16,["modelValue","loading"])}}}),an={class:"px-[20px] pt-[24px] pb-[8px]"},tn={class:"w-300px"},ln={class:"w-300px"},nn=ae({__name:"index",props:{compData:{}},setup(e,{expose:a}){const t=e,{compData:l}=t,n=Z(null),o=we({etypes:[]}),s={etypes:{trigger:"change",validator:()=>!!o.etypes.length||new Error("请选择邮件类型")}};return Ce(()=>{De(()=>{o.etypes=l.row.mail_type.map(e=>Number(Object.keys(e)[0])).filter(e=>!Number.isNaN(e))})}),a({onConfirm:async e=>{d({request:B({etypes:o.etypes.join(","),recipients:l.row.recipient,active:l.row.active}),loading:"更改中...",message:!0,success:()=>{l.onRefresh(),e()}})}}),(e,a)=>{const t=Oe,i=Ue,r=Ae;return ne(),ue("div",an,[fe(r,{ref_key:"formRef",ref:n,model:pe(o),rules:s},{default:se(()=>[fe(i,{label:"邮箱"},{default:se(()=>[ye("div",tn,[fe(t,{value:pe(l).row.recipient,"onUpdate:value":a[0]||(a[0]=e=>pe(l).row.recipient=e),disabled:!0},null,8,["value"])])]),_:1}),fe(i,{label:"分组",prop:"etypes"},{default:se(()=>[ye("div",ln,[fe(en,{ref:"typeSelect",modelValue:pe(o).etypes,"onUpdate:modelValue":a[1]||(a[1]=e=>pe(o).etypes=e),multiple:"",filterable:""},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])])}}}),on={class:"flex items-center"},sn={class:"ml-40px"},rn=ae({__name:"import",props:te({path:{default:""},accept:{default:()=>[]}},{value:{},valueModifiers:{}}),emits:te(["change"],["update:value"]),setup(e,{emit:a}){const t=e,{path:l,accept:n}=t,o=le(e,"value");je(o,e=>{s("change",e)});const s=a,i=()=>{Ze({path:l,size:5,uploadData:{accept:n.map(e=>".".concat(e)).join(","),multiple:!1,limit:1},refreshEvent:(e,a)=>{o.value=e[0].name,a()}})};return(e,a)=>{const t=Me;return ne(),ue("div",null,[ye("div",on,[fe(t,{type:"primary",onClick:i},{default:se(()=>[...a[0]||(a[0]=[ie("导入",-1)])]),_:1}),ye("div",sn,[a[1]||(a[1]=ie(" 文件名: ",-1)),ye("span",{class:Be(o.value?"text-primary":"text-[#dc2626]")},re(o.value||"未选择任何文件"),3)])]),Re(e.$slots,"default")])}}}),un={class:"p-20px"},cn={class:"w-260px"},dn=ae({__name:"index",props:{compData:{}},setup(e,{expose:a}){const t=Qe("popupClose"),l=e,{compData:n}=l,o=Z(null),s=we({etypes:-1!==n.group&&void 0!==n.group?[n.group]:[],file:""}),i={etypes:{trigger:"change",validator:()=>!!s.etypes.length||new Error("请选择邮件类型")},file:{required:!0,message:"请上传文件",trigger:["blur","change"]}};return a({onConfirm:async()=>{var e;await(null==(e=o.value)?void 0:e.validate()),d({request:R({etypes:s.etypes.join(","),file:s.file,active:n.active}),loading:"导入中...",message:!0,success:()=>{n.refresh(),null==t||t()}})}}),(e,a)=>{const t=Ue,l=Ae,n=Se("bt-tips");return ne(),ue("div",un,[fe(l,{ref_key:"formRef",ref:o,model:pe(s),rules:i},{default:se(()=>[fe(t,{label:"分组",prop:"etypes"},{default:se(()=>[ye("div",cn,[fe(en,{ref:"typeSelect",class:"bt-multiple-select",value:pe(s).etypes,"onUpdate:value":a[0]||(a[0]=e=>pe(s).etypes=e),multiple:"",filterable:""},null,8,["value"])])]),_:1}),fe(t,{label:"文件",prop:"file"},{default:se(()=>[fe(rn,{value:pe(s).file,"onUpdate:value":a[1]||(a[1]=e=>pe(s).file=e),path:"/www/server/panel/data/mail/in_bulk/recipient",accept:["txt","json"]},null,8,["value"])]),_:1})]),_:1},8,["model"]),fe(n,{class:"mt-4px"},{default:se(()=>[...a[2]||(a[2]=[ye("li",null," 文件类型: txt/json 每行一个邮箱 不超过5 MB ",-1)])]),_:1})])}}}),pn=Z([]),mn=async()=>{const{data:e}=await m({});pn.value=n(e)?e:[]},vn={class:"p-20px"},fn={class:"mt-12px"},yn=ae({__name:"set",setup(e){const a=Z(""),{BtTable:t,refresh:l}=V({request:async e=>(await mn(),{data:pn.value||[],total:pn.value.length||0}),columns:[{prop:"mail_type",label:"分组名称"},ma(e=>[{render:e=>fe("span",{class:""},[fe("span",{class:"bt-link ".concat(0===e.id?"!cursor-not-allowed !opacity-50":""),onClick:()=>{0!==e.id&&o(e)}},[ie("编辑")]),fe(ya,null,null)])},{render:e=>fe("span",{class:"bt-link ".concat(0===e.id?"!cursor-not-allowed !opacity-50":""),onClick:()=>{0!==e.id&&s(e)}},[ie("删除")])}])]}),n=async()=>{const e=a.value.trim();""!==e?(await U({mail_type:e}),l(),a.value=""):_.error("请输入分组名称")},o=e=>{i.id=e.id,i.mail_type=e.mail_type;const{BtForm:a,submit:t}=M({data:()=>i,options:e=>Te(()=>[ba("分组名称","mail_type",{attrs:{placeholder:"请输入分组名称"},rules:[{required:!0,message:"请输入分组名称",trigger:"blur"}]})]),submit:async(e,a)=>(await a(),d({request:S(Xe(i)),loading:"编辑中...",message:!0,success:()=>{l()}}))});f({title:"编辑分组",component:()=>fe(a,{class:"pt-[14px]"},null),area:35,showFooter:!0,onConfirm:t})},s=e=>{w({title:"删除分组【".concat(e.mail_type,"】"),content:"确定要删除该分组吗？",onConfirm:async()=>{d({request:O({ids:"".concat(e.id)}),loading:"删除中...",message:!0,success:()=>{l()}})}})};Z(null);const i=we({id:-1,mail_type:""});return(e,l)=>{const o=Oe,s=Ve,i=Me,r=Ee;return ne(),ue("div",vn,[fe(r,{gutter:10},{default:se(()=>[fe(s,{span:20},{default:se(()=>[fe(o,{modelValue:pe(a),"onUpdate:modelValue":l[0]||(l[0]=e=>xe(a)?a.value=e:null),placeholder:"请输入分组名称"},null,8,["modelValue"])]),_:1}),fe(s,{span:4},{default:se(()=>[fe(i,{type:"primary",onClick:n},{default:se(()=>[...l[1]||(l[1]=[ie("添加",-1)])]),_:1})]),_:1})]),_:1}),ye("div",fn,[fe(pe(t),{"max-height":300})])])}}}),bn={class:"w-200px"},hn={class:"px-[12px] py-[8px]"},gn=ae({__name:"index",props:{value:{default:()=>-1},valueModifiers:{}},emits:["update:value"],setup(e){const a=le(e,"value"),t=Te(()=>{const e=pn.value.map(e=>({label:e.mail_type,value:e.id}));return e.unshift({label:"全部",value:-1}),e}),l=e=>"分组: ".concat(e),n=()=>{f({title:"分组管理",area:36,component:yn})},{loading:o,setLoading:s}=Ye();return(async()=>{try{s(!0),await mn()}finally{s(!1)}})(),qe(()=>{pn.value=[]}),(e,s)=>{const i=Me,r=me,u=ve;return ne(),ue("div",bn,[fe(u,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),loading:pe(o)},{label:se(({label:e,value:a})=>[ie(re(l(e)),1)]),footer:se(()=>[ye("div",hn,[fe(i,{class:"!w-full",onClick:n},{default:se(()=>[...s[1]||(s[1]=[ie("分组管理",-1)])]),_:1})])]),default:se(()=>[(ne(!0),ue(ce,null,de(pe(t),e=>(ne(),oe(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])])}}}),_n={class:"px-20px pt-24px pb-8px"},xn={class:"w-240px"},wn=ae({__name:"batch",props:{compData:{}},setup(e,{expose:a}){const t=e,{compData:l}=t,n=Le("formRef"),o=we({type:null}),s={type:{trigger:"change",validator:()=>null!==o.type||new Error("请选择邮件类型")}},i=Te(()=>pn.value.map(e=>({label:e.mail_type,value:e.id}))),{loading:r,setLoading:u}=Ye();(async()=>{try{u(!0),await mn()}finally{u(!1)}})();return a({onConfirm:async e=>{var a;await(null==(a=n.value)?void 0:a.validate()),d({loading:"修改中...",message:!0,request:A({etypes:"".concat(o.type||0),recipients:l.rows.map(e=>e.recipient).join(","),active:l.rows[0].active}),success:()=>{null==l||l.onRefresh(),e()}})}}),(e,a)=>{const t=me,l=ve,u=Ue,c=Ae;return ne(),ue("div",_n,[fe(c,{ref_key:"formRef",ref:n,model:pe(o),rules:s},{default:se(()=>[fe(u,{label:"分组",prop:"type"},{default:se(()=>[ye("div",xn,[fe(l,{modelValue:pe(o).type,"onUpdate:modelValue":a[0]||(a[0]=e=>pe(o).type=e),loading:pe(r),multiple:"",filterable:""},{default:se(()=>[(ne(!0),ue(ce,null,de(pe(i),e=>(ne(),oe(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])])]),_:1})]),_:1},8,["model"])])}}}),kn=["show"],Cn={class:"text-center fw-bold text-18px color-#666"},Vn={class:"w-96% mx-auto"},En=ae({__name:"index",props:{active:{default:0}},setup(e){const a=He(e,"active"),t=(e=["1月","2月","3月","4月","5月","6月"])=>[{data:e}],l=(e=[0,0,0,0,0,0])=>[{name:"Count",type:"line",data:e,itemStyle:{color:"#20a53a"},smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,global:!1,colorStops:[{offset:0,color:"rgba(32, 164, 58, 0.4)"},{offset:.7,color:"rgba(32, 164, 58, 0)"}]}}}],o=ke({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},xAxis:t(),yAxis:{type:"value"},series:l()}),{loading:s,setLoading:r}=Ye(),{BtECharts:u,getEChart:c,setOption:d,setQuickOption:p}=i({options:{}}),m=async()=>{try{r(!0);const{data:{data:e}}=await H({active:a.value});if(n(e)){const a=e.map(e=>e.month),n=e.map(e=>e.count);o.xAxis=t(a),o.series=l(n)}d(o)}finally{r(!1)}};return m(),je(()=>a.value,()=>{m()}),(e,t)=>(ne(),ue("div",{class:"mb-16px",show:pe(s)},[ye("div",Cn,re(pe(a)?"订阅":"取消订阅")+" 趋势 ",1),ye("div",Vn,[fe(pe(u),{style:{height:"200px"}})])],8,kn))}}),jn=ae({__name:"index",setup(e){const a=we({p:1,size:10,active:1,keyword:""}),l=async(e,a,t,l)=>{const{label:n,value:o}=l,s={del:"删除",subscribe:"订阅",unsubscribe:"取消订阅"};w({title:"批量".concat(s[o]),content:"确定".concat(s[o],"选定项吗？"),onConfirm:async()=>{let e=[],t=_.load("批量".concat(s[o],"中..."));await a(async a=>{const l=await(async e=>{const a=new Map([["subscribe",q],["unsubscribe",q],["del",I]]).get(o);switch(o){case"subscribe":case"unsubscribe":const t="subscribe"===o?1:0;if(a)return await a({recipient:e.recipient,active:t});break;case"del":if(a)return await a({ids:e.id,active:e.active})}})(a);e.push({name:a.recipient,status:l.status,message:l.msg,msg:l.msg}),t.close()}),da(e,{title:"".concat(s[o])}),b()}})},n=$([{label:"删除",value:"del",event:l},{label:"订阅",value:"subscribe",event:l},{label:"取消订阅",value:"unsubscribe",event:l},{label:"设置分组",value:"category",event:(e,a,t,l)=>{f({title:"设置分组",area:45,showFooter:!0,compData:{rows:t.value,onRefresh:b},component:wn})}}]),{BtTable:o,BtPage:s,BtSearch:i,BtRefresh:r,BtColumn:u,BtBatch:c,BtTableCategory:p,BtErrorMask:m,tableRef:v,classList:y,refresh:b}=V({request:async e=>{let t={etype:ra.value,search:e.search,p:e.p,size:e.limit,active:a.active};-1===t.etype&&delete t.etype;const{data:{data:l,total:n}}=await L(t);return{data:l,total:n}},columns:[va(),{prop:"recipient",label:"邮箱",showOverflowTooltip:!0},{prop:"mail_type",label:"分组",render:e=>e.mail_type.map(e=>Object.values(e)[0]).join(", ")},{prop:"created",label:"添加时间",width:140,render:e=>t(e.created)},ma(e=>[{title:"更改列表",onClick:async()=>{f({title:"更改列表",area:50,showFooter:!0,compData:{row:e,onRefresh:()=>{b()}},component:nn})}},{title:e.active?"取消订阅":"订阅",onClick:async()=>{w({title:"".concat(e.active?"取消订阅":"订阅"," [").concat(e.recipient,"]"),content:"您确定要从此邮箱".concat(e.active?"取消订阅":"订阅","吗？"),onConfirm:async()=>{d({request:q({recipient:e.recipient,active:0===e.active?1:0}),loading:"更改中...",message:!0,success:()=>{b()}})}})}},{title:"删除",onClick:async()=>{w({title:"删除 [".concat(e.recipient,"]"),content:"您确定要删除此".concat(e.active?"订阅":"取消订阅","邮件吗？"),onConfirm:async()=>{d({request:I({ids:e.id,active:e.active}),loading:"删除中...",message:!0,success:()=>{b()}})}})}}])],extension:[n]}),h=()=>{f({title:"导入联系人",area:45,showFooter:!0,compData:{active:a.active,group:ra.value,refresh:()=>{b()}},component:dn})},g=e=>{a.active=e,a.p=1,b()},x=()=>{a.p=1,b()};return qe(()=>{ra.value=-1}),(e,t)=>{const l=Me,n=be,r=he,u=pa;return ne(),ue("div",null,[fe(En,{active:pe(a).active},null,8,["active"]),fe(u,null,{"header-left":se(()=>[fe(l,{type:"primary",onClick:h},{default:se(()=>[...t[3]||(t[3]=[ie("导入",-1)])]),_:1}),fe(aa,{class:"ml-16px"})]),"header-right":se(()=>[fe(r,{modelValue:pe(a).active,"onUpdate:modelValue":t[0]||(t[0]=e=>pe(a).active=e),onChange:g,class:"w-[120px] mr-[12px]"},{default:se(()=>[fe(n,{label:"订阅",value:1}),fe(n,{label:"取消订阅",value:0})]),_:1},8,["modelValue"]),fe(gn,{value:pe(ra),"onUpdate:value":[t[1]||(t[1]=e=>xe(ra)?ra.value=e:null),pe(b)],class:"mr-[12px]"},null,8,["value","onUpdate:value"]),fe(pe(i),{modelValue:pe(a).keyword,"onUpdate:modelValue":t[2]||(t[2]=e=>pe(a).keyword=e),class:"!w-[240px]",placeholder:"请输入邮箱",onSearch:x},null,8,["modelValue"])]),content:se(()=>[fe(pe(o),{ref_key:"tableRef",ref:v},null,512)]),"footer-left":se(()=>[fe(pe(c),{ref:"batchRef"},null,512)]),"footer-right":se(()=>[fe(pe(s),{ref:"pageRef"},null,512)]),_:1})])}}}),Dn={class:"p-[20px] pt-[24px] pb-[8px]"},Tn={class:"w-[200px]"},Bn=ae({__name:"form",props:{compData:{}},setup(e,{expose:a}){const t=Qe("popupClose"),l=e,{row:n,isEdit:o,refresh:s}=l.compData,i=Z(null),r=we({mail_type:""}),u={mail_type:{required:!0,trigger:"blur",message:"请输入分组名"}};return a({onConfirm:async()=>{var e;await(null==(e=i.value)?void 0:e.validate()),d({loading:"正在".concat(o?"编辑":"添加","分组"),message:!0,request:o&&n?S({...Xe(r),id:n.id}):U(Xe(r)),success:e=>{e.status&&(null==t||t(),null==s||s())}})}}),(e,a)=>{const t=Oe,l=Ue,n=Ae;return ne(),ue("div",Dn,[fe(n,{ref_key:"formRef",ref:i,model:pe(r),rules:u},{default:se(()=>[fe(l,{label:"分组名",prop:"mail_type"},{default:se(()=>[ye("div",Tn,[fe(t,{modelValue:pe(r).mail_type,"onUpdate:modelValue":a[0]||(a[0]=e=>pe(r).mail_type=e),placeholder:"请输入组名"},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])])}}}),Rn=ae({__name:"index",setup(e,{expose:a}){const l=we({show:!1,title:"",data:{isEdit:!1,row:null,refresh:()=>{p()}}}),n=()=>{l.data.row=null,l.data.isEdit=!1,l.title="添加分组",f({title:"添加分组",component:Bn,compData:l.data,area:40,showFooter:!0})},o=$([{label:"删除",value:"delete",event:async(e,a,t,l)=>{await e({title:"批量删除",content:"确定删除选定项吗？",column:[{label:"群组名称",prop:"mail_type"},fa()],onConfirm:async()=>{let e=[];await a(async a=>{const t=await F({ids:a.id});e.push({name:a.mail_type,status:t.status,message:t.msg,msg:t.msg})}),da(e,{title:"删除"}),p()}})}}]),{BtTable:s,BtPage:i,BtRefresh:r,BtColumn:u,BtBatch:c,refresh:p,BtSearch:m}=V({request:async e=>{const{data:a}=await z(e);return{data:a.data||[],total:a.total||0}},columns:[va(),{prop:"mail_type",label:"群组名称",render:e=>fe("a",{class:"bt-link",href:"javascript:;",onClick:()=>{ua(e.id)}},[e.mail_type])},{prop:"subscribers",label:"订阅",align:"center"},{prop:"unsubscribers",label:"取消订阅",align:"center"},{prop:"created",label:"添加时间",render:e=>t(e.created)},ma(e=>[{title:"复制链接",isHide:e=>!0,onClick:()=>{P(e.subscribe_url)}},{title:"重命名",onClick:()=>{(e=>{l.data.row=e,l.data.isEdit=!0,l.title="编辑分组",f({title:"编辑分组",component:Bn,compData:l.data,area:40,showFooter:!0})})(e)}},{title:"删除",onClick:()=>{e.subscribers||e.unsubscribers?_.error("请先修改或删除此类型下的取消订阅或订阅者，才能继续删除\t"):w({title:"删除",content:"确定删除【".concat(e.mail_type,"】分组吗？"),onConfirm:async()=>{d({loading:"正在删除",message:!0,request:F({ids:e.id}),success:()=>{p()}})}})}}])],extension:[o]});return a({init:p}),(e,a)=>{const t=Me,l=pa;return ne(),ue("div",null,[fe(l,null,{"header-left":se(()=>[fe(t,{type:"primary",onClick:n},{default:se(()=>[...a[0]||(a[0]=[ie("添加",-1)])]),_:1}),fe(aa,{class:"ml-16px"})]),"header-right":se(()=>[fe(pe(m),{class:"!w-[240px]",placeholder:"请输入名称",onSearch:pe(p)},null,8,["onSearch"])]),content:se(()=>[fe(pe(s))]),"footer-left":se(()=>[fe(pe(c))]),"footer-right":se(()=>[fe(pe(i))]),_:1})])}}}),Mn=ae({__name:"index",setup(e,{expose:a}){const l=we({p:1,size:10,status:"bounced",search:""}),o=$([{label:"删除",value:"del",event:async(e,a,t,l)=>{await e({title:"批量删除",content:"您确定要删除选定项吗？",column:[{label:"邮箱",prop:"recipient"},fa()],onConfirm:async()=>{let e=[];await a(async a=>{const t=await W({ids:a.id});e.push({name:a.recipient,status:t.status,msg:t.msg})}),da(e,{title:"批量删除"}),p()}})}}]),{BtTable:s,BtPage:i,BtRefresh:r,BtColumn:u,BtBatch:c,refresh:p,BtSearch:m}=V({request:async e=>{const{data:a}=await N(e);return{data:a.data||[],total:a.total||0}},columns:[va(),{prop:"recipient",label:"邮箱"},{prop:"task_name",label:"邮件主题"},{prop:"status",label:"类型"},{prop:"state",label:"状态",render:e=>e.state||e.count>=3?"无效":"观察"},{prop:"created",label:"添加时间",render:e=>t(e.created)},ma(e=>[{title:"删除",onClick:async()=>{w({title:"删除",content:"您确定要删除".concat(e.recipient,"吗？"),onConfirm:async()=>{d({loading:"正在删除，请稍候...",message:!0,request:W({ids:e.id}),success:()=>{p()}})}})}}])],extension:[o]}),v=Z([]),f=()=>{l.p=1,p()},y=()=>{w({title:"清空无效列表",content:"这将清除该类型下的所有数据，您确定要继续吗？",onConfirm:async()=>{await J({status:l.status}),p()}})},b=async()=>{await(async()=>{try{const{data:{data:e}}=await K();n(e)&&(v.value=e.map(e=>({label:e.status,value:e.status})),v.value.length&&(l.status=v.value[0].value))}catch(e){}})(),p()};return b(),a({init:b}),(e,a)=>{const t=Me,n=me,o=ve,r=pa;return ne(),ue("div",null,[fe(r,null,{"header-left":se(()=>[fe(t,{type:"primary",onClick:pe(p)},{default:se(()=>[...a[1]||(a[1]=[ie("刷新",-1)])]),_:1},8,["onClick"]),fe(t,{onClick:y},{default:se(()=>[...a[2]||(a[2]=[ie("清空",-1)])]),_:1}),fe(aa,{class:"ml-16px"})]),"header-right":se(()=>[fe(o,{class:"!w-[200px] mr-[10px]",modelValue:pe(l).status,"onUpdate:modelValue":a[0]||(a[0]=e=>pe(l).status=e),onUpdate:f},{default:se(()=>[(ne(!0),ue(ce,null,de(pe(v),e=>(ne(),oe(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),fe(pe(m),{class:"!w-[240px]",placeholder:"请输入名称",onSearch:pe(p)},null,8,["onSearch"])]),content:se(()=>[fe(pe(s))]),"footer-left":se(()=>[fe(pe(c))]),"footer-right":se(()=>[fe(pe(i))]),_:1})])}}}),Sn=e=>{var a;a="task",ca.value=a,sa.value=e,De(()=>{ia.value=!0})},On={class:"mb-20px"},Un={class:"w-320px"},An={class:"flex items-center"},Hn=s(ae({__name:"form",props:te({data:{default:null},refresh:{}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:["update:show"],setup(e){const t=e,l=Pe(()=>g(()=>import("./index327.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)),n=He(t,"data"),o=le(e,"show"),s=Le("editorRef"),i=Z(1),r=Z(""),u=()=>{o.value=!1},c=Z(!1),d=async(e=!1)=>{var a,t;if(n.value)try{e||(c.value=!0),await b({id:n.value.id,type:i.value,temp_name:r.value,render:JSON.stringify(null==(a=s.value)?void 0:a.getEmailData()),content:(null==(t=s.value)?void 0:t.getEmailHTML())||""},e)}finally{e||(c.value=!1)}},p=async()=>{await d(!0),u(),t.refresh()};return Ce(()=>{(async()=>{c.value=!0,await De(),setTimeout(async()=>{var e;if(n.value)try{r.value=n.value.name;const{data:t}=await y({id:n.value.id});a(t)&&(null==(e=s.value)||e.setEmailData(t.render))}finally{setTimeout(()=>{c.value=!1},500)}},500)})()}),(e,a)=>{const t=Ue,n=Oe,o=Ae,i=Me;return ne(),ue("div",null,[a[6]||(a[6]=ye("div",{class:"mb-14px font-bold text-18px text-default leading-28px"},"邮件模板编辑",-1)),fe(o,{"label-position":"left"},{default:se(()=>[Ke("",!0),ye("div",On,[fe(pe(l),{ref_key:"editorRef",ref:s,save:d},null,512)]),fe(t,{label:"模板名称","label-width":"50px"},{default:se(()=>[ye("div",Un,[fe(n,{modelValue:pe(r),"onUpdate:modelValue":a[1]||(a[1]=e=>xe(r)?r.value=e:null)},null,8,["modelValue"])])]),_:1})]),_:1}),ye("div",An,[fe(i,{onClick:u},{default:se(()=>[...a[4]||(a[4]=[ie("返回",-1)])]),_:1}),fe(i,{type:"primary",loading:pe(c),disabled:pe(c),class:"ml-12px",onClick:p},{default:se(()=>[...a[5]||(a[5]=[ie(" 保存 ",-1)])]),_:1},8,["loading","disabled"])])])}}}),[["__scopeId","data-v-17a146e9"]]),Ln=["innerHTML"],qn=ae({__name:"preview",props:{compData:{}},setup(e){const t=He(e.compData,"row"),l=Z("");return(async()=>{const{data:e}=await y({id:t.value.id});if(a(e)){const a=El(e.render);a&&1===e.type?(l.value=a.content,await b({id:t.value.id,type:e.type,temp_name:e.name,render:JSON.stringify(a.render),content:a.content},!1)):l.value=e.content}})(),(e,a)=>(ne(),ue("div",{class:"min-h-600px overflow-auto",innerHTML:pe(l)},null,8,Ln))}}),In={class:"relative"},$n=ae({__name:"index",setup(e){const l=Z(!1),n=Z(null),o=async()=>{const e="template_".concat(t(new Date,"yyyyMMddHHmmss")),{data:{data:o}}=await X({temp_name:e,type:1});m(),a(o)&&(n.value=o,l.value=!0)},s=$([{label:"删除",value:"delete",event:async(e,a,t,l)=>{await e({title:"批量删除",content:"确定删除选定项吗？",column:[{label:"模板名称",prop:"name"},fa()],onConfirm:async()=>{d({loading:"删除中...",message:!0,request:Q({id:t.value.map(e=>e.id)}),success:()=>{m()}})}})}}]),{BtTable:i,BtPage:r,BtRefresh:u,BtColumn:c,BtBatch:p,refresh:m,BtSearch:v}=V({request:async e=>{const{data:a}=await G({p:e.p,size:e.limit});return{data:a.data||[],total:a.total||0}},columns:[va(),{prop:"name",label:"名称"},{prop:"created",label:"创建时间",render:e=>t(e.created)},ma(e=>[{title:"创建任务",onClick:()=>{Sn(e.id)}},{title:"查看",onClick:()=>{y(e)}},{title:"编辑",onClick:()=>{b(e)}},{title:"删除",onClick:()=>{h(e)}}])],extension:[s]}),y=e=>{f({title:"查看【".concat(e.name,"】"),area:80,compData:{row:e},component:qn})},b=e=>{n.value=e,l.value=!0},h=e=>{w({title:"删除【".concat(e.name,"】"),content:"确定删除该模板吗？",onConfirm:async()=>{d({loading:"删除中...",message:!0,request:Q({id:e.id}),success:()=>{m()}})}})};return(e,a)=>{const t=Me,s=pa;return ne(),ue("div",In,[$e(fe(s,null,{"header-left":se(()=>[fe(t,{type:"primary",onClick:o},{default:se(()=>[...a[1]||(a[1]=[ie("添加模板",-1)])]),_:1}),fe(aa,{class:"ml-16px"})]),content:se(()=>[fe(pe(i))]),"footer-left":se(()=>[fe(pe(p))]),"footer-right":se(()=>[fe(pe(r))]),_:1},512),[[ze,!pe(l)]]),pe(l)?(ne(),oe(Hn,{key:0,show:pe(l),"onUpdate:show":a[0]||(a[0]=e=>xe(l)?l.value=e:null),data:pe(n),refresh:pe(m)},null,8,["show","data","refresh"])):Ke("",!0)])}}}),zn=ae({__name:"index",setup(e){const a=Z([{label:"概览",name:"overview",lazy:!0,render:()=>fe(Qa,null,null)},{label:"发送任务",name:"task",lazy:!0,render:()=>fe(Zl,null,null)},{label:"模板",name:"template",lazy:!0,render:()=>fe($n,null,null)},{label:"订阅者",name:"contact",lazy:!0,render:()=>fe(jn,null,null)},{label:"群组",name:"mail",lazy:!0,render:()=>fe(Rn,null,null)},{label:"无效列表",name:"invalid",lazy:!0,render:()=>fe(Mn,null,null)}]),t=e=>{ia.value=!1,sa.value=null};return(e,l)=>{const n=Y;return ne(),ue("div",null,[fe(n,{type:"card",options:pe(a),modelValue:pe(ca),"onUpdate:modelValue":l[0]||(l[0]=e=>xe(ca)?ca.value=e:null),onChange:t},null,8,["options","modelValue"])])}}}),Pn=Object.freeze(Object.defineProperty({__proto__:null,default:zn},Symbol.toStringTag,{value:"Module"}));export{bl as A,hl as B,Bl as C,yt as D,jt as E,gl as F,_l as G,xl as H,qt as I,Vl as J,Cl as K,Ht as L,ol as M,Pn as N,Tt as a,It as b,nl as c,bt as d,At as e,fl as f,jl as g,yl as h,rl as i,Tl as j,St as k,Bt as l,wl as m,Ct as n,wt as o,kt as p,Dt as q,Vt as r,pl as s,Rt as t,Nt as u,Et as v,ul as w,Mt as x,Ut as y,vl as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
