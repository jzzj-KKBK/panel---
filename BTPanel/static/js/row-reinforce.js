import{K as e,k as a,j as l,h as t,W as o}from"./utils-lib.js?v=1756369731";import{_ as r}from"./index103.js?v=1756369731";import{c as s,U as d,r as m,e as n,p,G as i,q as u,v as c,A as _,B as h,H as f,x as b,P as w,D as g,a9 as y,ai as v,aj as j,a7 as V}from"./base-lib.js?v=1756369731";import{_ as x}from"./index101.js?v=1756369731";import{bC as k,bD as q,bE as C}from"./firewall.js?v=1756369731";import{u as U}from"./column.js?v=1756369731";import{f as D}from"./validator.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const A={class:"px-[1.6rem] py-[1.6rem]"},F=s({__name:"row-reinforce",props:{compData:{default:()=>({})}},setup(s){const F=s.compData.key,H=d(!1),R={a:"追加",i:"只读"},T=d([]),B=m(),E=d(!1),G=m({path:"",chattr:"i",d_mode:""}),I=[{content:"【只读】无法修改、创建、删除文件和目录"},{content:"【追加】只能追加内容，不能删除或修改原有内容"},{content:"【权限】设置文件或目录在受保护状态下的权限(非继承),关闭保护后权限自动还原"},{content:"【如何填写权限】请填写Linux权限代号,如:644、755、600、555等,如果不填写,则使用文件原来的权限"}],K={path:[{required:!0,message:"请输入被保护的文件或路径",trigger:["blur","change"]}],d_mode:[{required:!0,message:"请输入权限",trigger:["blur","change"]}]},L=async()=>{await e({loading:H,request:k({s_key:F}),data:{paths:[Array,T]}})},O=()=>{D({type:"all",path:"/www/wwwroot",change:e=>{G.value.path=e}})},P=async()=>{await B.value.validate(),await e({loading:"正在添加保护文件/目录，请稍后...",request:C({...G.value,s_key:F}),message:!0}),E.value=!1,L(),G.value={path:"",chattr:"i",d_mode:""}},W=[{label:"路径",prop:"path",showOverflowTooltip:!0},{label:"模式",prop:"chattr",render:e=>R[e.chattr]},{label:"权限",prop:"s_mode",render:(e,a)=>n("span",null,[e.s_mode+(e.s_mode===e.d_mode?"":" >> "+e.d_mode)])},{label:"状态",prop:"state",render:e=>n("span",{class:"text-".concat(e.state?"primary":"danger")},[e.state?"已保护":"未保护"])},U([{title:"删除",onClick:async a=>{await e({request:q({s_key:F,path:a.path}),loading:"正在删除保护配置，请稍后...",message:!0}),L()}}])];return p(()=>L()),(e,s)=>{const d=g,m=a,p=x,k=y,q=v,C=j,U=l,D=V,F=t,R=r,L=o,z=i("bt-loading");return u(),c("div",A,[n(R,null,{"header-left":_(()=>[n(d,{type:"primary",onClick:s[0]||(s[0]=e=>E.value=!0)},{default:_(()=>[...s[5]||(s[5]=[h(" 添加保护文件/目录 ",-1)])]),_:1})]),content:_(()=>[f(n(m,{"max-height":"400",column:W,data:b(T)},null,8,["data"]),[[z,b(H)],[z,"正在加载中，请稍后...","title"]])]),popup:_(()=>[n(F,{title:"添加保护文件/目录",modelValue:b(E),"onUpdate:modelValue":s[4]||(s[4]=e=>w(E)?E.value=e:null),area:42,onConfirm:P,showFooter:""},{default:_(()=>[n(D,{class:"p-2rem",ref_key:"addReinforceFormRef",ref:B,model:b(G),rules:K},{default:_(()=>[n(k,{label:"路径",prop:"path"},{default:_(()=>[n(p,{icon:"icon-file_mode",modelValue:b(G).path,"onUpdate:modelValue":s[1]||(s[1]=e=>b(G).path=e),width:"24rem",placeholder:"被保护的文件或路径",onIconClick:O,iconType:"folder"},null,8,["modelValue"])]),_:1}),n(k,{label:"模式"},{default:_(()=>[n(C,{modelValue:b(G).chattr,"onUpdate:modelValue":s[2]||(s[2]=e=>b(G).chattr=e),class:"!w-[24rem]"},{default:_(()=>[n(q,{label:"只读",value:"i"}),n(q,{label:"追加",value:"a"})]),_:1},8,["modelValue"])]),_:1}),n(k,{label:"权限",prop:"d_mode"},{default:_(()=>[n(U,{modelValue:b(G).d_mode,"onUpdate:modelValue":s[3]||(s[3]=e=>b(G).d_mode=e),width:"24rem",placeholder:"请输入权限",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1}),n(L,{options:I,class:"mx-[1.6rem] mt-[1.6rem]"})])}}});export{F as default};
