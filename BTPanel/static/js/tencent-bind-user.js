import{c as e,r as a,k as t,p as l,aD as s,q as o,M as r,A as n,H as c,I as i,x as d,y as u,e as m,z as v,J as p,O as f,v as w,B as g,C as h,K as b,ax as y,a9 as x,S as k,D as _,a$ as D,a7 as V}from"./base-lib.js?v=1756369731";import{_ as C}from"./index104.js?v=1756369731";import{M as z,br as j,bn as I,q as E,bo as M,bp as q,c as B,bs as H,e as S}from"./utils-lib.js?v=1756369731";import{_ as U}from"./bt_logo_new.js?v=1756369731";import{b as L,f as T}from"./useController.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const K={class:"flex !justify-center !w-full items-center"},N={class:"text-[2rem] text-dark inline-block mr-2 font-bold mt-12x"},O={key:0,class:"absolute el-form-item__error"},J={class:"flex justify-end items-centertext-[1.2rem] mt-[1rem]"},$={key:0,class:"view-con",style:{background:"#fff"}},R={class:"w-full mt-[1.5rem]"},A={class:"w-full mt-[1.5rem]"},P={class:"w-[100%] mt-[1.2rem] flex items-center justify-center text-[#20a53a]",size:"default"},X={key:3,class:"flex justify-end items-centertext-[1.2rem] mt-[1rem] h-[1.68rem]"},Y={key:0},F={class:"more-bind"},G=S(e({__name:"tencent-bind-user",props:{compData:{default:()=>({})}},setup(e,{expose:S}){const G=e,Q=a(!1),W=a("获取验证码"),Z=t({username:"",password:"",code:""}),ee=t({username:!1,password:!1,code:!1}),ae=a(""),te=a(0),le=a(),se=a(!1),oe=a(G.compData.authData),re=a(1),ne=t({order:"",uin:""}),ce=a({username:[{validator:(e,a,t)=>{var l,s;if((null==(l=G.compData)?void 0:l.title)&&(se.value=!1),/^1[3456789]\d{9}$/.test(a))t();else if(""===a)t(new Error("请输入宝塔官网账号"));else{if(null==(s=G.compData)?void 0:s.title)return se.value=!0,void t(new Error(" "));t(new Error("请输入正确的手机号"))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,a,t)=>{a.length>=8?t():t(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,a,t)=>{Q.value||t(),6===a.length?t():t(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),ie=()=>{le.value.validate(async e=>{e&&L({isCheck:Q,userInfo:Z,userToken:ae})})},de=a(3);let ue=null,me=null;const ve=e=>{"string"==typeof e.data&&JSON.parse(e.data).code&&(async e=>{const a=JSON.parse(e.data);let t;try{t=z.load("正在绑定中......");const{data:e}=await j({...a,client:1});e.success||e.status?(window.removeEventListener("message",ve),T(G.compData.redirect)):(t.close(),z.error(e.res||String(e.msg)),me.parent.postMessage({msg:e.res||e.msg,success:!1},"*"))}catch(l){null==t||t.close()}})(e)},pe=async()=>{if(ne.order){const e={client:1,order_no:ne.order,uin:ne.uin},a=await H(e);a.status&&(a.data.success||a.data.status)?fe(a.data.data||a.data.res):z.error(a.data.res||a.data.msg||a.data.data)}else ne.uin?z.error("请输入订单号"):z.error("请输入腾讯云账号ID")},fe=e=>{const a=(window.screen.width-600)/2,t=(window.screen.height-800)/2;window.removeEventListener("message",ve),window.addEventListener("message",ve),me&&me.close(),me=window.open(e,"popup","width=600,height=800,left=".concat(a,",top=").concat(t,",noopener,noreferrer")),me||z.error("授权弹窗被浏览器阻止，请允许弹窗以继续操作。")},we=async()=>{var e;if(ye.value)return void pe();let a;try{de.value=3,ue&&clearInterval(ue),a=z.load("正在绑定中......");const{data:t}=await j({client:1});if(t.status||t.success)window.location.href=G.compData.redirect||"/";else{a.close();const l=t.msg||t.res,s=document.querySelector(".location-con");let o=16;if(s){const e=s.getBoundingClientRect();o=e.top+window.scrollY-50}z.msg({customClass:(null==(e=G.compData)?void 0:e.title)?"customMsgDiv":"",type:"warning",dangerouslyUseHTMLString:!0,duration:3e3,offset:o,message:"".concat(l,'<div style="align-items:center;"><span style="display:inline-block;color:#ef0808;" class="loginErrorNum">').concat(de.value,"</span>秒后切换到宝塔账号登录</div>")}),setTimeout(()=>{if(s){const e=s.getBoundingClientRect().left+window.scrollX,a=document.querySelector(".customMsgDiv");a&&(a.style.left="".concat(e+143,"px"),a.style.opacity="1")}},0),ue=setInterval(()=>{if(de.value<=1)return clearInterval(ue),void he(1);de.value-=1;const e=document.querySelector(".loginErrorNum");e&&(e.innerHTML="".concat(de.value))},1e3)}}catch(t){null==a||a.close()}},ge=async()=>{if(!Z.username||!Z.password)return void z.error("请先输入手机号和密码");ee.username=!0,ee.password=!0,(e=>{te.value&&clearInterval(te.value);const a=()=>{if(--e<=0)return clearInterval(te.value),W.value="获取验证码",void(ee.code=!1);W.value="重新获取验证码(".concat(e,"s)")};a(),te.value=setInterval(a,1e3),ee.code=!0})(60);const e=await I({username:Z.username,token:ae.value});z.request(e)},he=e=>{var a;re.value=e,(null==(a=G.compData)?void 0:a.onChangeType)&&G.compData.onChangeType(1===e?"bind":"other")},be=a(!1),ye=a(!1),xe=async e=>{try{if(1===e)return void he(1);if(2===e)return void he(2);be.value=1===oe.value.client&&1===oe.value.login,1===oe.value.client&&1===oe.value.login?he(2):1===oe.value.client&&0!==oe.value.login?(he(2),ye.value=!0):he(1)}catch(a){he(1)}},ke=a(!1),_e=a(null),De=a(null),Ve=async()=>{ke.value=!0;try{const e=await M();if(e.status){const a=600,t=500,l=window.screen.width/2-a/2,s=window.screen.height/2-t/2;_e.value=window.open(e.msg.replace("login.html","new/wxBindPanel.html"),"_blank","width=".concat(a,",height=").concat(t,",left=").concat(l,",top=").concat(s)),window.addEventListener("message",e=>{var a,t;switch(e.data.type){case"wechat_auth_error":z.error(e.data.msg);try{null==(a=_e.value)||a.close(),Ve()}catch(l){}break;case"wechat_auth_complete":const{code:s,state:o}=e.data.data;null==(t=_e.value)||t.close(),Ce(s,o)}})}}catch(e){}finally{ke.value=!1}},Ce=async(e,a)=>{var t;const l=z.load("正在配置面板用户信息，请稍后...");try{const l=await q({code:e,state:a});l.status?(z.success("微信绑定成功"),window.location.href=(null==(t=G.compData)?void 0:t.redirect)||"/"):z.error(l.msg||"微信绑定失败")}catch(s){z.error("微信绑定失败")}finally{l.close()}};return xe(),S({onOpen:()=>{E(le.value.$el,"username")},onCancel:()=>{le.value.clearValidate(),De.value&&(clearInterval(De.value),De.value=null),_e.value&&!_e.value.closed&&(_e.value.close(),_e.value=null)}}),l(()=>{var e;null==(e=le.value)||e.clearValidate()}),s(()=>{De.value&&(clearInterval(De.value),De.value=null),_e.value&&!_e.value.closed&&(_e.value.close(),_e.value=null)}),(e,a)=>{var t;const l=y,s=x,z=k,j=B,I=_,E=B,M=C,q=D,H=k,S=V;return o(),r(S,{ref_key:"bindUserInfo",ref:le,size:"medium",rules:d(ce),model:d(Z),autocomplete:"off",class:p(["bind-user-info",{"bind-form":!!(null==(t=e.compData)?void 0:t.title)}])},{default:n(()=>{var t,y,x,k,_,D,V,C,B,S,L,T,G,ae,te;return[c(u("div",null,[m(s,{class:"text-center !mb-5 flex justify-center"},{default:n(()=>{var t;return[u("div",K,[u("h3",N,v((null==(t=e.compData)?void 0:t.title)||"切换宝塔官网账号"),1),m(l,{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:n(()=>[...a[11]||(a[11]=[u("a",{class:"bt-ico-ask align-middle",href:"javascript:;"},"?",-1)])]),_:1})])]}),_:1}),(o(),r(s,{key:1,prop:"username",class:p({"!mb-[3rem]":!!(null==(t=e.compData)?void 0:t.title)})},{default:n(()=>{var t;return[m(z,{modelValue:d(Z).username,"onUpdate:modelValue":a[0]||(a[0]=e=>d(Z).username=e),clearable:"",required:"",class:"!leading-[4rem] !h-[4rem]",name:"username",autocomplete:"off",placeholder:"宝塔官网账号",disabled:d(ee).username,onKeyup:a[1]||(a[1]=f(e=>ie(),["enter"]))},null,8,["modelValue","disabled"]),(null==(t=e.compData)?void 0:t.title)&&d(se)?(o(),w("span",O,[a[13]||(a[13]=u("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),m(j,{class:"!text-[12px]",href:"https://www.bt.cn/register"},{default:n(()=>[...a[12]||(a[12]=[g(" 免费注册 ",-1)])]),_:1})])):h("",!0)]}),_:1},8,["class"])),(o(),r(s,{key:2,prop:"password"},{default:n(()=>[m(z,{modelValue:d(Z).password,"onUpdate:modelValue":a[2]||(a[2]=e=>d(Z).password=e),clearable:"",required:"",type:"password",class:"!leading-[4rem] !h-[4rem]",name:"password",autocomplete:"off",placeholder:"密码","show-password":!0,disabled:d(ee).password,onKeyup:a[3]||(a[3]=f(e=>ie(),["enter","native"]))},null,8,["modelValue","disabled"])]),_:1})),c(m(s,{prop:"code"},{default:n(()=>[m(z,{modelValue:d(Z).code,"onUpdate:modelValue":a[4]||(a[4]=e=>d(Z).code=e),clearable:"",autocomplete:"off",placeholder:"验证码",type:"text",onKeyup:a[5]||(a[5]=f(e=>ie(),["enter","native"]))},{append:n(()=>[m(I,{class:"relative top-0 rounded-none rounded-r-[3px]",type:"primary",size:"default",disabled:d(ee).code,plain:"",onClick:ge},{default:n(()=>[g(v(d(W)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},512),[[i,d(Q)]]),m(I,{class:"w-[100%] mt-[1.2rem]",type:"primary",size:"default",onClick:a[6]||(a[6]=e=>ie())},{default:n(()=>{var a,t;return[g(v((null==(a=e.compData)?void 0:a.btn)||((null==(t=e.compData)?void 0:t.title)?"绑定账号":"切换账号")),1)]}),_:1}),u("div",J,[m(E,{href:"https://www.bt.cn/register"},{default:n(()=>[...a[14]||(a[14]=[g("注册账号",-1)])]),_:1}),m(M),m(E,{href:"https://www.bt.cn/login.html?page=reset"},{default:n(()=>[...a[15]||(a[15]=[g("忘记密码",-1)])]),_:1}),m(M),m(E,{href:"https://www.bt.cn/bbs"},{default:n(()=>[...a[16]||(a[16]=[g("问题反馈",-1)])]),_:1})])],512),[[i,1===d(re)]]),c(u("div",null,[(null==(y=e.compData)?void 0:y.title)?h("",!0):(o(),w("div",{key:0,class:"view-con",style:b((null==(x=e.compData)?void 0:x.title)?"":"background:#fff;")},[u("div",{class:"app-box",style:b((null==(k=e.compData)?void 0:k.title)?"":"background:#fff;")},[...a[17]||(a[17]=[u("img",{alt:"",src:U},null,-1)])],4),a[19]||(a[19]=u("div",{class:"change-icon"},[u("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[u("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1)),u("div",{class:"app-box",style:b((null==(_=e.compData)?void 0:_.title)?"":"background:#fff;")},[...a[18]||(a[18]=[u("div",{class:"tencent-icon"},null,-1)])],4)],4)),u("div",{class:p({"bg-white":null==(D=e.compData)?void 0:D.title,"rounded-[4px]":null==(V=e.compData)?void 0:V.title}),style:b({border:(null==(C=e.compData)?void 0:C.title)?"1px solid #ddd":"none","padding-top":(null==(B=e.compData)?void 0:B.title)?"2rem":"0"})},[(null==(S=e.compData)?void 0:S.title)?(o(),w("div",$,[...a[20]||(a[20]=[u("div",{class:"app-box",style:{background:"#fff"}},[u("img",{alt:"",src:U})],-1),u("div",{class:"change-icon"},[u("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[u("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1),u("div",{class:"app-box",style:{background:"#fff"}},[u("div",{class:"tencent-icon"})],-1)])])):h("",!0),d(ye)?h("",!0):(o(),r(s,{key:1,class:p(["!mb-5 flex justify-center",{"p-[2.5rem]":null==(L=e.compData)?void 0:L.title,"!pt-0":null==(T=e.compData)?void 0:T.title}])},{default:n(()=>[m(q),a[21]||(a[21]=u("h3",{class:"text-[1.4rem] w-full text-[#666] inline-block font-bold"},"腾讯云用户专享特权：",-1)),a[22]||(a[22]=u("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] flex items-center"},[u("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),g(" 免费使用原本需要付费的功能： ")],-1)),a[23]||(a[23]=u("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] ml-[1.9rem] flex items-center location-con"},[u("img",{src:"/static/img/soft_ico/ico-msg_push.png",class:"w-[2rem] mr-[1rem]"}),g(" 异常监控推送 ")],-1)),a[24]||(a[24]=u("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1.5rem] flex items-center"},[u("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),g(" 宝塔官方付费软件均享额外折扣 ")],-1))]),_:1},8,["class"])),d(ye)?(o(),r(s,{key:2,class:p(["!mb-0 flex justify-center",{"p-[2.5rem]":null==(G=e.compData)?void 0:G.title,"!pt-0":null==(ae=e.compData)?void 0:ae.title}])},{default:n(()=>[m(q),a[25]||(a[25]=u("h3",{class:"text-[1.4rem] w-full text-[#666] inline-block font-bold text-center"},"腾讯云账号绑定",-1)),u("div",R,[m(H,{modelValue:d(ne).uin,"onUpdate:modelValue":a[7]||(a[7]=e=>d(ne).uin=e),size:"large",clearable:"",name:"uin",autocomplete:"off",placeholder:"请输入腾讯云账号ID"},null,8,["modelValue"])]),u("div",A,[m(H,{modelValue:d(ne).order,"onUpdate:modelValue":a[8]||(a[8]=e=>d(ne).order=e),size:"large",clearable:"",name:"order",autocomplete:"off",placeholder:"请输入腾讯云市场订单号",onKeyup:f(pe,["enter","native"])},null,8,["modelValue"])])]),_:1},8,["class"])):h("",!0),m(I,{type:"primary",class:"w-[85%] mt-[4rem] relative left-[7.5%]",style:{margin:"1rem auto 0"},size:"default",onClick:we},{default:n(()=>[g(v(d(be)?"一键激活专享特权":"绑定腾讯云账号"),1)]),_:1}),u("div",P,[u("span",{class:"cursor-pointer hover:text-[#1d9534]",onClick:a[9]||(a[9]=e=>he(1))},"已有宝塔账号登录")]),(null==(te=e.compData)?void 0:te.title)?(o(),w("div",X)):h("",!0)],6)],512),[[i,2===d(re)]]),1===d(re)?(o(),w("div",Y,[a[28]||(a[28]=u("div",{class:"more-title"},[u("span",null,"更多绑定方式")],-1)),u("div",F,[c(u("div",{class:"wechat-login-container",onClick:a[10]||(a[10]=e=>xe(2))},[...a[26]||(a[26]=[u("div",{class:"wechat-icon-circle"},[u("i",{class:"wechat-icon tencent_ico"})],-1),u("div",{class:"wechat-text"},"腾讯云",-1)])],512),[[i,1===d(re)&&(d(be)||d(ye))]]),c(u("div",{class:p(["wechat-login-container",{"ml-[1.4rem]":d(be)||d(ye)}]),onClick:Ve},[...a[27]||(a[27]=[u("div",{class:"wechat-icon-circle"},[u("i",{class:"wechat-icon"},[u("svg",{t:"1749545795651",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"9096",width:"20",height:"20"},[u("path",{d:"M391.95 175.27c-159.03 0-289.29 108.4-289.29 246.04 0 79.45 43.35 144.67 115.74 195.2l-28.93 87.05 101.12-50.74c36.19 7.19 65.22 14.54 101.33 14.54 9.08 0 18.09-0.45 27.01-1.16-5.64-19.37-8.92-39.61-8.92-60.62 0-126.32 108.54-228.89 245.97-228.89 9.37 0 18.64 0.69 27.86 1.71C658.8 261.87 534.2 175.27 391.95 175.27z m-93.97 195.31c-21.67 0-43.56-14.52-43.56-36.21 0-21.77 21.89-36.09 43.56-36.09s36.12 14.33 36.12 36.09c-0.02 21.69-14.45 36.21-36.12 36.21z m202.46 0c-21.69 0-43.45-14.52-43.45-36.21 0-21.77 21.76-36.09 43.45-36.09 21.79 0 36.21 14.33 36.21 36.09 0 21.69-14.43 36.21-36.21 36.21z m0 0",fill:"#3CB034","p-id":"9097"}),u("path",{d:"M920.01 602.12c0-115.59-115.74-209.86-245.72-209.86-137.64 0-246.05 94.27-246.05 209.86 0 115.84 108.41 209.92 246.05 209.92 28.81 0 57.85-7.25 86.79-14.51l79.36 43.44-21.76-72.3c58.06-43.53 101.33-101.3 101.33-166.55z m-325.5-36.14c-14.41 0-28.95-14.31-28.95-28.92 0-14.44 14.54-28.96 28.95-28.96 21.89 0 36.21 14.52 36.21 28.96 0 14.61-14.33 28.92-36.21 28.92z m159.13 0c-14.31 0-28.74-14.31-28.74-28.92 0-14.44 14.43-28.96 28.74-28.96 21.67 0 36.21 14.52 36.21 28.96 0 14.61-14.54 28.92-36.21 28.92z m0 0",fill:"#3CB034","p-id":"9098"})])])],-1),u("div",{class:"wechat-text"},"微信",-1)])],2),[[i,1===d(re)]])])])):h("",!0)]}),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-d1eb9458"]]);export{G as default};
