import{_ as e}from"./index103.js?v=1756369731";import{r as a,U as t,g as n,e as s,ag as r,B as l,c as o,a4 as i,q as c,v as u,A as p,x as d,H as m,I as v,D as h,aQ as _,F as f}from"./base-lib.js?v=1756369731";import{o as y,G as b,l as g,K as w,a6 as C,M as x,fj as k,a7 as j}from"./utils-lib.js?v=1756369731";import{o as q}from"./column.js?v=1756369731";import{createPythonEnvironment as P,addPythonEnvironment as B,setPythonEnvironment as O,getPythonEnvironment as W,deletePythonEnvironment as F}from"./site.js?v=1756369731";import{f as H}from"./validator.js?v=1756369731";import{b as S,h as A,e as T,l as U,f as V}from"./form-item.js?v=1756369731";import{k as D}from"./useController6.js?v=1756369731";import{_ as E}from"./index104.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./useStore4.js?v=1756369731";a("");const G=a(!1),I=t([]),K=a(null),M=async()=>{try{const e=await w({request:W({sort_not_use:0})});if(!e.status)return x.error(e.msg),I.value=[],{data:[],total:0};if(e.data.now_env){K.value=e.data.now_env;for(let a=0;a<e.data.env_list.length;a++)if(e.data.env_list[a].bin_path===e.data.now_env.bin_path)return e.data.env_list[a].isCurrent=!0,I.value=e.data.env_list,{data:e.data.env_list,total:e.data.env_list.length}}return I.value=e.data.env_list,{data:e.data.env_list,total:e.data.env_list.length}}catch(e){return{data:[],total:0}}},Q=async e=>{await w({loading:"正在设置，请稍后...",request:O({path:e}),message:!0,success:()=>{G.value=!0}})},z=async()=>{var e;try{await y({title:"取消应用命令行",content:"确定取消命令行环境【".concat((null==(e=K.value)?void 0:e.name)||"","】吗？"),onConfirm:async()=>{await Q(""),K.value=null}})}catch(a){}},J=async e=>{const{BtTable:t,getCurrentSelect:o,handleCurrentChange:i}=((e="apply")=>{const t=a(null),n=a(null);return{...C({request:async()=>{const a=I.value.filter(a=>"apply"===e?(a.isCurrent&&(n.value=a),a.can_set_default):a.can_create);return{data:a,total:a.length}},columns:[{label:" ",prop:"select",width:50,render:e=>s(r,{value:e.bin_path,modelValue:t.value,"onUpdate:modelValue":e=>t.value=e},null)},{label:"名称",prop:"name",render:a=>s("div",{class:"truncate",title:"".concat(a.name).concat(a.isCurrent&&"apply"===e?"【当前使用】":"")},[a.name,a.isCurrent&&"apply"===e?s("span",{class:"font-bold text-[#333]"},[l("【当前使用】")]):""])},{label:"类型",prop:"type",width:100,render:e=>{if(e.bin_path.includes("/www/server/panel/pyenv"))return"宝塔面板环境";switch(e.type){case"venv":return"虚拟环境";case"system":return e.from_panel?"面板安装":"系统级环境";case"conda":return"Conda环境";default:return"未知"}}},{label:"Python版本",prop:"version",width:100}]}),getCurrentSelect:()=>I.value.find(e=>e.bin_path===t.value),handleCurrentChange:e=>{t.value=e.bin_path},currentApply:n}})("create"),{BtForm:c,submit:u}=b({data:()=>({venv_name:"",python_bin:"",ps:""}),options:e=>n(()=>[S("名称","venv_name",{attrs:{class:"!w-[24rem]",placeholder:"虚拟环境名称"},rules:[{required:!0,message:"虚拟环境名称不可为空",trigger:["blur","change"]}]}),A("环境来源",()=>s("div",{class:"w-[90%]"},[s(t,{"highlight-current-row":!0,maxHeight:400,onCurrentChange:i},null)]),"python_bin",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(a,t,n)=>{const s=o();s?(e.value.python_bin=s.bin_path,n()):n(new Error("请选择需要创建虚拟环境的环境来源"))}}]}),S("备注","ps",{attrs:{class:"!w-[24rem]",placeholder:"备注"},rules:[{required:!1,message:"备注不可为空",trigger:["blur","change"]}]})]),submit:async(e,a)=>(await a(),await L(e.value))});g({title:"创建虚拟环境",area:65,btn:"创建",component:()=>s("div",{class:"p-[1.6rem]"},[s(c,null,null)]),onConfirm:async()=>{try{return!!(await u())}catch(e){return!1}}})},L=async e=>!!(await w({request:P({venv_name:e.venv_name,python_bin:e.python_bin,ps:e.ps}),message:!0,loading:"正在创建，请稍后..."})).status&&(G.value=!0,!0),N=()=>{const e={venv:"添加虚拟环境需要指定到虚拟环境目录",conda:"添加Conda环境需要指定到Conda可执行文件",system:"添加系统级环境需要指定到Python解释器文件"},{BtForm:a,submit:t}=b({data:()=>({add_type:"venv",path:""}),options:a=>n(()=>[T("环境类型","add_type",[{label:"虚拟环境",value:"venv"},{label:"Conda环境",value:"conda"},{label:"系统级环境",value:"system"}]),U("环境位置","path",{attrs:{class:"!w-[42rem]",placeholder:e[a.value.add_type]},rules:[{required:!0,message:"环境位置不可为空",trigger:["blur","change"]}]},()=>{let e="dir";switch(a.value.add_type){case"system":case"conda":e="file";break;case"venv":e="dir"}((e,a="dir")=>{H({type:a,path:e.value.path,change:a=>{e.value.path=a}})})(a,e)}),V(" ",[{content:e[a.value.add_type]}])]),submit:async(e,a)=>(await a(),await w({loading:"正在添加，请稍后...",request:B(e.value),message:!0,success:()=>{G.value=!0}}))});g({area:65,title:"添加已存在的Python环境",btn:"添加",component:()=>s("div",{class:"p-[1.6rem]"},[s(a,null,null)]),onConfirm:async()=>!!(await t()).status})},R={class:"p-2rem"},X=o({__name:"index",setup(a){const{BtTable:t,refresh:n}=k({request:M,empty:()=>s("div",{class:"text-[#666] text-[1.4rem]"},[l("暂无数据,"),s("span",{class:"bt-link",onClick:()=>D("py",n)},[l("点击安装Python")])]),columns:[{label:"名称",prop:"name",render:e=>s("div",{class:"truncate flex items-center gap-2",title:"".concat(e.name).concat(e.isCurrent?"【命令行使用】":"")},[s("span",{class:"truncate"},[e.name]),s("span",{class:"shrink-0 px-2 py-1 bg-gray-100 text-gray-600 rounded"},[(a=>{if(e.bin_path.includes("/www/server/panel/pyenv"))return"宝塔面板环境";switch(a){case"venv":return"虚拟环境";case"system":return e.from_panel?"面板安装":"系统级环境";case"conda":return"Conda环境";default:return"未知"}})(e.type)])])},{label:"Python版本",prop:"version",width:130},{label:"解释器位置",prop:"bin_path",width:80,render:e=>s("span",{class:"flex"},[s("i",{title:"跳转解释器目录",class:"text-[#efc566] cursor-pointer svgtofont-folder-open !text-[1.8rem]",onClick:()=>q({path:e.bin_path})},null)])},{label:"使用项目",prop:"project_name",render:e=>{let a="--";return e.project_name&&e.project_name.length>0&&(a=e.project_name.join("、")),s(_,{effect:"dark",content:a,"popper-class":"w-[35rem]","show-after":500,placement:"top-start",disabled:!e._isOverflow},{default:()=>[s("div",{class:"max-w-[30rem] truncate",ref:a=>{a&&(e._isOverflow=a.scrollWidth>a.clientWidth)}},[a])]})}},{label:"备注",prop:"ps",render:e=>s(_,{effect:"dark",content:"".concat(e.ps).concat("venv"===e.type?"【来自".concat(e.system_data.name,"】"):""),"popper-class":"w-[35rem]","show-after":500,placement:"top-start",disabled:!e._isPsOverflow},{default:()=>[s("div",{class:"max-w-[30rem] truncate",ref:a=>{a&&(e._isPsOverflow=a.scrollWidth>a.clientWidth)}},["".concat(e.ps).concat("venv"===e.type?"【来自".concat(e.system_data.name,"】"):"")])]})},{label:"操作",align:"right",width:150,render:e=>{const a=[];return e.isCurrent&&a.push(s("span",{class:"shrink-0 text-[#666]"},[l("当前命令行使用")])),e.can_set_default&&a.push(s("span",{class:"cursor-pointer bt-link",onClick:()=>Q(e.bin_path)},[l("应用命令行")])),e.can_remove&&a.push(s("span",{class:"cursor-pointer bt-link",onClick:()=>(async(e,a)=>{await y({title:"确定删除环境【".concat(a,"】吗？"),content:"删除后无法恢复，请谨慎操作",onConfirm:async()=>{await w({request:F({path_data:e}),loading:"正在删除，请稍后...",success:e=>{var a,t;e.status&&e.data.data[0].status?(x.success("删除成功"),G.value=!0):x.error((null==(t=null==(a=e.data.data)?void 0:a[0])?void 0:t.msg)||e.msg)}})}})})(e.bin_path,e.name)},[l("删除")])),s("div",{class:"flex items-center"},[a.map((e,t)=>a[t+1]?s(f,null,[e,s(E,null,null)]):e)])}}],extension:[j(G)]});return i(()=>{I.value=[]}),(a,n)=>{const r=h,o=e;return c(),u("div",R,[s(o,null,{"header-left":p(()=>{var e;return[s(r,{type:"primary",onClick:d(J)},{default:p(()=>[...n[1]||(n[1]=[l("创建虚拟环境",-1)])]),_:1},8,["onClick"]),s(r,{class:"ml-[2rem]",type:"default",onClick:d(N)},{default:p(()=>[...n[2]||(n[2]=[l("添加",-1)])]),_:1},8,["onClick"]),s(r,{class:"ml-[2rem]",type:"default",onClick:n[0]||(n[0]=e=>d(D)("py"))},{default:p(()=>[...n[3]||(n[3]=[l("版本管理",-1)])]),_:1}),m(s(r,{class:"ml-[2rem]",type:"default",onClick:d(z)},{default:p(()=>[...n[4]||(n[4]=[l("取消当前命令行应用",-1)])]),_:1},8,["onClick"]),[[v,null==(e=d(K))?void 0:e.name]])]}),content:p(()=>[s(d(t),{"max-height":400})]),_:1})])}}});export{X as default};
