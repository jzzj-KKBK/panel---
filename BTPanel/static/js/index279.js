import{dG as s,R as t,at as a,d as e,c as r,ah as o,e as c}from"./utils-lib.js?v=1756369731";import{c as l,r as i,k as n,g as d,p as u,G as p,H as g,x as f,q as m,v,y,J as _,M as k,F as w,e as h,B as b,z as S,C as x,A as E,a_ as C,b3 as T,D as j}from"./base-lib.js?v=1756369731";import{a1 as A}from"./firewall.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const D={id:"safeDetectList"},M={class:"progress-header"},H={class:"progress-header-cot"},G={key:0,class:"relative"},I={class:"absolute top-[1.6rem] left-[2.6rem] flex flex-col"},J={class:"progress-header-cot"},O={class:"scanning-progress-title"},q={class:"color-org"},z={class:"color-red"},B={class:"scanning-progress-cont"},F={class:"progress-header-cot"},L={class:"progress-cont-list"},N=["onClick"],P={class:"progress_type"},R={class:"progress_status"},K={key:0,class:"text-danger"},Q={key:1,class:"text-warning"},U={key:1},V={key:2,class:"text-[#666]"},W={key:0},X={class:"progress_fold"},Y={class:"progress_item_body"},Z={class:"info_cont"},$={class:"info_cont_desc"},ss=c(l({__name:"index",setup(c){const l=i(!1),ss=[{color:"#888",text:"未安装"},{color:"#666",text:"良好"},{color:"#e6a23c",text:"警告"},{color:"red",text:"危险"}],ts={system_account:"系统账户",sshd_service:"SSHD远程服务",file_mode:"重要文件权限及属性",software:"重点软件检测",other:"其他项目检测",backdoor:"后门检测",proc:"恶意进程",history:"历史命令",log:"日志排查",rootkit:"rootkit检测"},as=i({}),es=n({scanStatus:!1,isEnd:!1,error:0,warn:0,time:0,progress:0,progressColor:"#20a53a",progressConfig:{system_account:[],sshd_service:[],file_mode:[],software:[],other:[],backdoor:[],proc:[],history:[],log:[],rootkit:[]},statusTotal:{},allArr:[],result:{},progressStatus:{},active:{system_account:!1,sshd_service:!1,file_mode:!1,software:!1,other:!1,backdoor:!1,proc:!1,history:!1,log:!1,rootkit:!1}}),rs=s=>s+" 分";let os=null;const cs=d(()=>es.scanStatus&&!es.isEnd?"正在扫描":as.value.status?"上次检测时间 "+("刚刚"===s(as.value.msg.time)?"一分钟内":s(as.value.msg.time)):"当前未进行安全检测"),ls=i(""),is=i(""),ns=d(()=>es.scanStatus&&!es.isEnd?"正在扫描-".concat(ls.value):es.isEnd?"检测时间："+t(es.time/1e3,"yyyy-MM-dd"):as.value.status?"若长时间未检测，服务器可能存在安全风险，建议立即检测":"当前安全风险未知，请立即检测"),ds=(s,t)=>{if(t.data){const s=JSON.parse(t.data.replace(/'/g,'"'));s.hasOwnProperty("callback")?(null==os||os.close(),es.scanStatus=!1,es.isEnd=!0,es.time=(new Date).getTime()):(ls.value=s.name,is.value=s.topic,es.progress=parseInt(s.progress),es.progressConfig[s.topic].push(s),es.statusTotal[s.topic]=us(es.progressConfig[s.topic]),es.allArr.push(s),3===s.status?es.error++:2===s.status&&es.warn++,1!==s.status&&(es.progressColor="#fc6d26"))}},us=s=>{const t={};return s.forEach(s=>{t[s.status]?t[s.status]++:t[s.status]=1}),t},ps=()=>{if(es.scanStatus&&!es.isEnd||es.isEnd,es.scanStatus&&!es.isEnd)return null==os||os.close(),void gs();es.isEnd&&gs(),es.scanStatus=!0,os=o({route:"/ws_project",onMessage:ds}),null==os||os.send({mod_name:"safe_detect",def_name:"get_safe_scan",ws_callback:""})},gs=()=>{es.scanStatus=!1,es.isEnd=!1,es.error=0,es.warn=0,es.time=0,es.progress=0,es.progressColor="#20a53a",es.progressConfig={system_account:[],sshd_service:[],file_mode:[],software:[],other:[],backdoor:[],proc:[],history:[],log:[],rootkit:[]},es.statusTotal={},es.allArr=[],es.result={},es.progressStatus={},es.active={system_account:!1,sshd_service:!1,file_mode:!1,software:!1,other:!1,backdoor:!1,proc:!1,history:!1,log:!1,rootkit:!1}};return u(()=>{(async()=>{try{const s=await A();as.value=s.data}catch(s){a(s)}})()}),(s,t)=>{var a,o,c;const i=e,n=T,d=j,u=r,A=p("bt-loading");return g((m(),v("div",D,[y("div",M,[y("div",H,[y("div",{class:_("progresscirclebar "+(f(as).status?"security ":"")+"text-["+(100===(null==(a=f(as).msg)?void 0:a.security_count)?" #20a53a ":" #fc6d26 ")+"]")},[f(as).status?(m(),v(w,{key:1},[f(es).scanStatus&&!f(es).isEnd?(m(),v("div",G,[h(n,{class:"animate-spin",type:"circle",percentage:70,"show-text":!1,"stroke-width":4,"define-back-color":"#fff",color:f(es).warn||f(es).error?"#fc6d26":"#20a53a",width:100},null,8,["color"]),y("div",I,[h(i,{class:"w-[full] px-[.4rem]",src:"/firewall/icon-safe-detect".concat(f(es).warn||f(es).error?"-org":"",".svg")},null,8,["src"]),t[0]||(t[0]=y("span",{class:"text-[1.2rem] font-bold py-[.4rem] leading-none"}," 安全检测 ",-1))])])):(m(),k(n,{key:1,type:"circle",percentage:null==(o=f(as).msg)?void 0:o.security_count,format:rs,color:100===(null==(c=f(as).msg)?void 0:c.security_count)?"#20a53a":"#fc6d26",width:100},null,8,["percentage","color"]))],64)):(m(),k(i,{key:0,class:"w-[10rem]",src:"/firewall/icon-safe-detect.svg"}))],2)]),y("div",J,[y("div",O,[f(es).isEnd?(m(),v(w,{key:1},[t[5]||(t[5]=b(" 检测已完成 ",-1)),f(es).error>0||f(es).warn>0?(m(),v(w,{key:0},[t[4]||(t[4]=b(" ，一共发现 ",-1)),f(es).warn>0?(m(),v(w,{key:0},[y("span",q,S(f(es).warn),1),t[1]||(t[1]=b(" 项风险项 ",-1))],64)):x("",!0),f(es).error>0?(m(),v(w,{key:1},[t[2]||(t[2]=b(" （包含 ",-1)),y("span",z,S(f(es).error),1),t[3]||(t[3]=b(" 项危险项，请立即处理） ",-1))],64)):x("",!0)],64)):x("",!0)],64)):(m(),v(w,{key:0},[b(S(f(cs)),1)],64))]),f(es).scanStatus?(m(),k(n,{key:0,percentage:f(es).progress,color:f(es).warn||f(es).error?"#fc6d26":"#20a53a","stroke-width":10},null,8,["percentage","color"])):x("",!0),y("div",B,S(f(ns)),1)]),y("div",F,[h(d,{type:f(es).scanStatus&&!f(es).isEnd?"warning":"primary",onClick:ps,plain:!(!f(es).scanStatus||f(es).isEnd)},{default:E(()=>[b(S(f(es).scanStatus&&!f(es).isEnd?"取消扫描":f(es).isEnd?"重新检测":"立即检测"),1)]),_:1},8,["type","plain"]),h(u,{class:"!absolute -bottom-[2.5rem] right-[1.4rem]",href:"https://www.bt.cn/bbs/thread-126643-1-1.html"},{default:E(()=>[...t[6]||(t[6]=[b(" 需求反馈>> ",-1)])]),_:1})])]),y("div",L,[(m(),v(w,null,C(ts,(s,t)=>y("div",{key:t,class:_([t+"_item "+(f(es).active[t]?"active":""),"progress_item"])},[y("div",{class:"progress_item_header",onClick:s=>(s=>{es.active[s]=!es.active[s]})(t)},[y("div",P,[h(i,{class:"title-icon",src:"/firewall/icon-"+t+".svg"},null,8,["src"]),y("span",null,S(s),1)]),y("div",R,[f(es).statusTotal[t]?(m(),v(w,{key:0},[f(es).statusTotal[t][3]||f(es).statusTotal[t][2]?(m(),v(w,{key:0},[f(es).statusTotal[t][3]?(m(),v("span",K," 发现"+S(f(es).statusTotal[t][3])+"项危险 ",1)):x("",!0),f(es).statusTotal[t][2]?(m(),v("span",Q,S((f(es).statusTotal[t][3]?"":"发现")+f(es).statusTotal[t][2])+"项警告 ",1)):x("",!0)],64)):f(es).scanStatus&&f(is)==t?(m(),v("span",U," 正在扫描... ")):(m(),v("span",V,"无风险项"))],64)):(m(),v(w,{key:1},[f(es).scanStatus&&!f(es).statusTotal[t]?(m(),v("span",W," 等待扫描 ")):x("",!0)],64))]),y("div",X,[h(i,{src:"/firewall/arrow-down.svg"})])],8,N),y("div",Y,[f(es).progressConfig[t]&&f(es).progressConfig[t].length?(m(!0),v(w,{key:0},C(f(es).progressConfig[t],(s,t)=>(m(),v("div",{key:t,class:_([s.info?"active":"","progress_item_info"])},[y("div",Z,[y("div",null,S(s.name.replace("分析网站","")),1),y("div",{class:_("text-["+ss[s.status<0?0:s.status].color+"]")},S(ss[s.status<0?0:s.status].text),3)]),y("div",$,S(s.info||""),1)],2))),128)):x("",!0)])],2)),64))])])),[[A,f(l)]])}}}),[["__scopeId","data-v-3a1d5614"]]);export{ss as default};
