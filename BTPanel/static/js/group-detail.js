import{l as a,L as t,o as e,b as o,k as s,h as l,cE as r,e as n}from"./utils-lib.js?v=1756369731";import{_ as i}from"./index103.js?v=1756369731";import{r as c,c as u,e as p,k as m,p as d,a4 as _,G as f,q as v,v as y,A as g,B as h,z as D,x as w,H as b,I as k,y as j,M as E,C as x,P as T,n as C,D as q}from"./base-lib.js?v=1756369731";import{delGroupProject as I,getJavaGroupDetail as P,groupProjectOperation as A,editGroupProject as O,groupProjectType as V,getGroupLog as L}from"./site.js?v=1756369731";import{u as S}from"./column.js?v=1756369731";const R=c({}),z={class:"p-[2rem]"},M={class:"flex items-center"},B={key:2,class:"ml-[1rem]"},F={class:"p-[2rem]"},G=n(u({__name:"group-detail",props:{compData:{}},setup(n){const u=n,G=o();let H=0,J=null;const N=c([{name:"test",status:"test",pid:"test",listen:[]}]),U=c([]),K=c("simultaneous"),Q=c(!1),W=c(!0),X=[{prop:"name",label:"项目名称"},{prop:"pid",label:"PID"},{prop:"status",label:"项目状态",render:a=>{let t="--",e="#20a53a";switch(a.project_status){case"succeeded":t="运行中";break;case"failed":t="未运行或运行异常",e="#ef0808";break;case"not_run":t="未运行",e="#ef0808";break;default:t="--",e="#555"}return p("span",{style:"color: ".concat(e,";")},[t])}},{prop:"listen",label:"端口",render(a){var t;return p("span",null,[(null==(t=a.listen)?void 0:t.join(","))||"--"])}},S([{onClick:e=>{a({isAsync:!0,title:"项目【".concat(u.compData.group_name,"】检查策略"),area:50,btn:"确定",component:()=>t(()=>import("./project-check.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{...e,group_id:u.compData.group_id,refreshEvent:na}})},title:"检测策略"},{onClick:async(a,t)=>{try{await e({title:"移除项目【".concat(a.name,"】"),width:"35rem",icon:"warning",content:"您真的要将项目【".concat(a.name,"】从本项目组移除吗？")});const t=await I({group_id:u.compData.group_id,project_id:a.id});G.request(t),t.status&&(na(),u.compData.refreshEvent&&u.compData.refreshEvent())}catch(o){}},title:"从项目组中移除",width:140}])],Y=[{label:"",width:50,render:a=>p("i",{class:"svgtofont-icon-drag cursor-move mover iconfont align-middle",title:"拖拽排序"},null)},{prop:"name",label:"项目名称"},{prop:"pid",label:"PID"},{prop:"port",label:"端口"}],Z=m({start:!1,stop:!1,termination:!1,statusText:""}),$=async()=>{a({title:"【".concat(u.compData.group_name,"】添加项目"),area:50,showFooter:!0,component:()=>t(()=>import("./group-add-projects.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{group_id:u.compData.group_id,refreshEvent:()=>{na(),u.compData.refreshEvent&&u.compData.refreshEvent()},projectList:N.value}})},aa=(a,t)=>(t||u.compData).operation_info.includes(a),ta=async a=>{try{const t=await A({group_id:u.compData.group_id},a);G.request(t),na()}catch(t){}},ea=async()=>{N.value.length?(U.value=[],U.value=N.value.map(a=>({id:a.id,name:a.name,check_info:a.check_info,level:a.level})),Q.value=!0,Q.value&&C(()=>{(()=>{const a=document.querySelector(".level-table .el-table__body-wrapper tbody");r.create(a,{animation:500,onEnd:async a=>{const t=U.value.splice(a.oldIndex,1)[0];U.value.splice(a.newIndex,0,t)}})})()})):G.error("暂无项目数据")},oa=async()=>{try{U.value.forEach((a,t)=>{a.level=t+1});const a=await O({group_id:u.compData.group_id,project_datas:JSON.stringify(U.value)});G.request(a),a.status&&(Q.value=!1,na())}catch(a){}},sa=async()=>{try{const a=await V({group_id:u.compData.group_id,sort_type:"simultaneous"===K.value?"sequence":"simultaneous"});G.request(a),a.status&&(K.value="simultaneous"===K.value?"sequence":"simultaneous")}catch(a){}},la=async()=>{a({isAsync:!0,title:"项目组【".concat(u.compData.group_name,"】日志"),area:84,component:()=>t(()=>import("./group-logs.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:u.compData,cancel:()=>{na()}})},ra=async()=>{try{const a=await L({group_id:u.compData.group_id,last_write_time:H});if(a.status){if(R.value=a.data,!a.data.running)return J&&clearTimeout(J),J=null,H=0,void na();if(a.data.last_write_time!=H){const a=await P({group_id:u.compData.group_id});a.status&&ia(a.data)}J=setTimeout(()=>{ra()},2e3),H=a.data.last_write_time}else J&&clearTimeout(J),J=null,H=0,na()}catch(a){}},na=async()=>{try{W.value=!0;const a=await P({group_id:u.compData.group_id});a.status?(ia(a.data),""!==a.data.now_operation&&a.data.now_operation&&!J?ra():(J&&clearTimeout(J),J=null,H=0)):G.error(a.msg)}catch(a){}finally{W.value=!1}},ia=a=>{N.value=a.projects,K.value=a.sort_type,Z.start=aa("start",a),Z.stop=aa("stop",a),Z.termination=aa("termination",a),Z.statusText="start"===a.now_operation?"状态：启动运行中":"状态：停止运行中"};return d(async()=>{await na()}),_(()=>{J&&clearTimeout(J),J=null,R.value={},u.compData.refreshEvent&&u.compData.refreshEvent()}),(a,t)=>{const e=q,o=s,r=i,n=l,c=f("bt-loading");return v(),y("div",z,[p(r,null,{"header-left":g(()=>[p(e,{type:"primary",onClick:$},{default:g(()=>[...t[4]||(t[4]=[h("添加新项目",-1)])]),_:1}),p(e,{type:"default",class:"ml-1rem",onClick:sa},{default:g(()=>[h("启动方式："+D("simultaneous"==w(K)?"同时启动":"依次启动"),1)]),_:1}),b(p(e,{type:"default",class:"ml-[1rem]",onClick:ea},{default:g(()=>[...t[5]||(t[5]=[h("修改项目启动顺序",-1)])]),_:1},512),[[k,"sequence"==w(K)]])]),"header-right":g(()=>[j("div",M,[w(Z).start?(v(),E(e,{key:0,type:"default",class:"ml-[1rem]",onClick:t[0]||(t[0]=a=>ta("start"))},{default:g(()=>[...t[6]||(t[6]=[h("启动",-1)])]),_:1})):x("",!0),w(Z).stop?(v(),E(e,{key:1,type:"default",class:"ml-[1rem]",onClick:t[1]||(t[1]=a=>ta("stop"))},{default:g(()=>[...t[7]||(t[7]=[h("停止",-1)])]),_:1})):x("",!0),w(Z).termination?(v(),y("span",B,D(w(Z).statusText),1)):x("",!0),w(Z).termination?(v(),E(e,{key:3,type:"default",class:"ml-[1rem]",onClick:t[2]||(t[2]=a=>ta("termination"))},{default:g(()=>[...t[8]||(t[8]=[h("终止",-1)])]),_:1})):x("",!0),w(Z).termination?(v(),y("span",{key:4,class:"ml-[1rem] text-primary cursor-pointer",onClick:la},"日志")):x("",!0)])]),content:g(()=>[b(p(o,{"max-height":300,column:X,data:w(N)},null,8,["data"]),[[c,w(W)]])]),"footer-left":g(()=>[...t[9]||(t[9]=[])]),popup:g(()=>[p(n,{title:"启动优先级排序",class:"overflow-hidden",modelValue:w(Q),"onUpdate:modelValue":t[3]||(t[3]=a=>T(Q)?Q.value=a:null),area:65,"show-footer":!0,onConfirm:oa},{default:g(()=>[j("div",F,[p(r,null,{content:g(()=>[b(p(o,{"max-height":300,class:"level-table","row-key":"name",column:Y,data:w(U)},null,8,["data"]),[[c,w(W)]])]),_:1}),t[10]||(t[10]=j("ul",{class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-[2rem]"},[j("li",null,"拖拽排序，项目启动顺序将按照从上到下依次进行启动")],-1))])]),_:1},8,["modelValue"])]),_:1}),t[11]||(t[11]=j("ul",{class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-[2rem]"},[j("li",null,"启动顺序为依次启动时,项目将按照从上到下依次进行启动")],-1))])}}}),[["__scopeId","data-v-02d260ec"]]),H=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{H as g,R as j};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
