import{_ as e}from"./index120.js?v=1756369731";import{c as s,r as a,k as n,g as t,p as l,G as i,H as r,x as c,q as o,v as d,y as u,C as m,e as p,F as v,M as f,B as g,z as b,A as y,J as x,b0 as w,K as k,I as _,D as h,b1 as S,bx as E,by as T}from"./base-lib.js?v=1756369731";import{u as C,q as j,R as M,c as F,e as H,d as L,b as I,ah as D,_ as q}from"./utils-lib.js?v=1756369731";import{j as z,p as B}from"./validator.js?v=1756369731";import{scanSingleSite as J}from"./site.js?v=1756369731";import{u as O}from"./useStore4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index105.js?v=1756369731";import"./column.js?v=1756369731";const P={id:"safeDetectList"},N={key:0},R={class:"progress-header"},A={class:"progress-header-cot"},G={class:"flex items-center"},K={key:0,class:"scan-icon relative h-[8rem] w-[8rem] flex"},U={class:"progress-header-cot"},Q={class:"scanning-progress-title"},V={class:"text-danger"},W={class:"scanning-progress-cont"},X={class:"progress-header-cot"},Y={class:"progress-cont-list"},Z={key:0},$={class:"inline-grid grid-cols-4 w-full mt-20px"},ee=["onClick"],se={class:"progress_type"},ae={class:"flex-1"},ne={key:0,class:"text-danger mr-4px"},te={key:1},le={key:2,class:"text-primary"},ie={key:3},re={class:"progress_fold text-[1.2rem] flex items-center"},ce={class:"mr-4px"},oe={class:"progress_item_body"},de={class:"flex items-center justify-between w-full"},ue={class:"flex items-center ml-12px"},me=["innerHTML"],pe={class:"flex flex-col py-[1rem] px-[1.6rem] text-[1.2rem] progress_item_info"},ve={class:"flex items-center"},fe=["innerHTML"],ge={class:"flex"},be=["innerHTML"],ye=q(s({__name:"index",setup(s,{expose:q}){const ye=I(),{siteInfo:xe}=O(),{payment:we}=C(),{authType:ke}=we.value,_e=a(!1),he=a([{name:"webscan",title:"网站配置安全性"},{name:"filescan",title:"文件泄露"},{name:"backup",title:"备份文件"},{name:"index",title:"首页内容风险"},{name:"webhorse",title:"挂马排查"},{name:"deadchain",title:"坏链检测"},{name:"database",title:"数据库安全"},{name:"ftps",title:"网站FTP风险"},{name:"backend",title:"网站后台安全"}]),Se=a(0),Ee=a(""),Te=a(""),Ce=n({scanStatus:!1,isEnd:!1,error:0,warn:0,time:0,progress:0,progressColor:"#20a53a",progressConfig:{},statusTotal:{},result:{},progressStatus:{},active:{}});let je=null;const Me=n({0:{text:"警告",bg:"rgba(252, 109, 38, 0.1)",color:"#fc6d26"},1:{text:"低危",bg:"rgba(232, 213, 68, 0.1)",color:"#D4BB00"},2:{text:"中危",bg:"rgba(240, 173, 78, 0.14)",color:"#f0ad4e"},3:{text:"高危",bg:"rgba(239, 8, 8, 0.1)",color:"#EF0808"}}),Fe=n({title:"安全扫描-功能介绍",height:36,ps:"扫描服务器系统的漏洞，异常用户，已安装软件的安全问题并提供修复方案.",source:66,desc:["漏洞扫描","网站配置安全性","文件泄露","备份文件","木马程序"],tabImgs:["https://www.bt.cn/Public/new/plugin/introduce/site/security-Introduction.png"]}),He=e=>{"free"==ke&&B({sourceId:65})},Le=t((()=>Ce.scanStatus&&!Ce.isEnd?"正在扫描":"定期扫描网站，提升网站安全性")),Ie=t((()=>Ce.scanStatus&&!Ce.isEnd?"".concat(Ee.value||""):Ce.time?"上次检测时间：".concat(Ce.time):"当前安全风险未知，请立即检测")),De=(e,s)=>{var a,n;if(s.data){const e=JSON.parse(s.data.replace(/'/g,'"'));if(e.hasOwnProperty("end")&&e.end){if((null==(n=null==(a=e.webinfo)?void 0:a.result)?void 0:n[e.type].length)>0?(Ce.progressConfig[e.type]=e.webinfo.result[e.type],Ce.statusTotal[e.type]=e.webinfo.result[e.type].length):Ce.statusTotal[e.type]=0,Ee.value=e.info,Se.value===he.value.length-1)return null==je||je.close(),Se.value=0,Ce.scanStatus=!1,void(Ce.isEnd=!0);let s=(new Date).getTime();Se.value++,null==je||je.send({mod_name:"webscanning",def_name:"ScanSingleSite",ws_callback:s,name:xe.value.name,scan_list:[he.value[Se.value].name]})}else Ee.value=e.info,Te.value=e.type,e.is_error&&Ce.error++}},qe=async()=>{if(Ce.scanStatus&&!Ce.isEnd||Ce.isEnd,Ce.scanStatus&&!Ce.isEnd)return await j({title:"取消扫描",content:"确定取消扫描吗?",icon:"warning"}),null==je||je.close(),Se.value=0,void ze();Ce.isEnd&&(await(null==je?void 0:je.close()),Se.value=0,await ze()),Ce.scanStatus=!0,je=D({route:"/ws_project",onMessage:De});let e=(new Date).getTime();null==je||je.send({"x-http-token":window.vite_public_request_token}),null==je||je.send({mod_name:"webscanning",def_name:"ScanSingleSite",ws_callback:e,name:xe.value.name,scan_list:[he.value[Se.value].name]})},ze=()=>{Ce.scanStatus=!1,Ce.isEnd=!1,Ce.error=0,Ce.warn=0,Ce.time=0,Ce.progress=0,Ce.progressConfig={vulscan:[],webscan:[],filescan:[],backup:[],webshell:[],index:[],webhorse:[],deadchain:[],database:[],ftps:[],backend:[]},Ce.statusTotal={},Ce.result={},Ce.progressStatus={},Ce.active={vulscan:!1,webscan:!1,filescan:!1,backup:!1,webshell:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1}},Be=async()=>{if("ltd"===we.value.authType){_e.value=!0;try{const e=await J({data:JSON.stringify({name:xe.value.name})});if(!e.status)return void ye.request(e);Ce.isEnd=Ce.time||!1,Ce.time=M(e.data.time,"yyyy-MM-dd")}catch(e){}finally{_e.value=!1}}};return l((()=>{Be(),ze()})),q({onRefresh:async()=>{Be(),ze()}}),(s,a)=>{const n=F,t=h,l=S,C=H,j=L,M=E,I=T,D=e,q=i("bt-loading");return r((o(),d("div",P,["ltd"===c(we).authType?(o(),d("div",N,[u("div",R,[u("div",A,[u("div",G,[m(" 扫描中转圈图标 "),c(Ce).scanStatus&&!c(Ce).isEnd?(o(),d("div",K,[a[0]||(a[0]=u("div",{class:"animate-spin absolute top-0 border-[#F39C12] border-b-2 rounded-full h-full w-full bg-#cccccc00"},null,-1)),p(n,{icon:"scanning-danger",size:60,color:"#F39C12",class:"m-auto"})])):(o(),d(v,{key:1},[m(" 扫描结果+扫描前图标 "),u("div",null,[c(Ce).warn||c(Ce).error?(o(),f(n,{key:0,icon:"scanning-danger",size:70,color:"#ef0808"})):(o(),f(n,{key:1,icon:"scanning-"+(c(Ce).isEnd?"success":"danger"),size:72,color:c(Ce).isEnd?"#20a53a":"#F39C12"},null,8,["icon","color"]))])],2112))])]),m(" 检测结果文字 "),u("div",U,[u("div",Q,[c(Ce).isEnd?(o(),d(v,{key:1},[a[3]||(a[3]=g(" 检测完成 ")),c(Ce).error>0||c(Ce).warn>0?(o(),d(v,{key:0},[a[2]||(a[2]=g(" ，共发现 ")),c(Ce).error>0?(o(),d(v,{key:0},[u("span",V,b(c(Ce).error),1),a[1]||(a[1]=g(" 项风险 "))],64)):m("v-if",!0)],64)):m("v-if",!0)],64)):(o(),d(v,{key:0},[g(b(c(Le)),1)],64))]),u("div",W,b(c(Ie)),1)]),m(" 检测按钮组 "),u("div",X,[p(t,{class:x({"warning-hover":c(Ce).scanStatus&&!c(Ce).isEnd}),type:c(Ce).scanStatus&&!c(Ce).isEnd?"warning":"primary",onClick:qe,plain:!(!c(Ce).scanStatus||c(Ce).isEnd)},{default:y((()=>[g(b(c(Ce).scanStatus&&!c(Ce).isEnd?"取消扫描":c(Ce).isEnd?"重新检测":"立即检测"),1)])),_:1},8,["class","type","plain"]),c(Ce).isEnd?(o(),f(t,{key:0,type:"default",onClick:c(z)},{default:y((()=>a[4]||(a[4]=[g(" 立即修复 ")]))),_:1},8,["onClick"])):m("v-if",!0)])]),p(l,{class:"!mt-0 !mb-20px !bg-[#F1F1F1]"}),u("div",Y,[m(" 网站可扫描介绍 "),c(Ce).scanStatus||c(Ce).isEnd?m("v-if",!0):(o(),d("div",Z,[a[5]||(a[5]=u("div",{class:"font-bold text-[1.6rem] text-[#666] mb-[2rem]"},"支持网站以下安全扫描项:",-1)),u("div",$,[(o(!0),d(v,null,w(c(he),((e,s)=>(o(),d("div",{key:s,class:"flex flex-col inline-block items-center mb-[20px]"},[p(C,{class:"w-[4rem] inline-block mb-8px opacity-90",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),g(" "+b(e.title),1)])))),128))])])),m(" 结果展示 "),c(Ce).scanStatus||c(Ce).isEnd?(o(!0),d(v,{key:1},w(c(he),((e,s)=>(o(),d("div",{key:s,class:x([e.name+"_item "+(c(Ce).active[e.name]?"active":""),"progress_item"])},[u("div",{class:"progress_item_header",onClick:s=>(e=>{Ce.active[e]=!Ce.active[e]})(e.name)},[u("div",se,[m(" <bt-image class=\"mr-12px w-[2rem]\" :src=\"'scan/scanning-' + value.name + '-ico.svg'\" /> "),u("span",null,b(e.title),1)]),u("div",ae,[c(Ce).statusTotal[e.name]?(o(),d("span",ne," 发现"+b(c(Ce).statusTotal[e.name])+"项危险 ",1)):m("v-if",!0),c(Ce).scanStatus&&c(Te)==e.name?(o(),d("span",te," 正在扫描... ")):m("v-if",!0),c(Ce).scanStatus||c(Ce).statusTotal[e.name]?m("v-if",!0):(o(),d("span",le," 无风险项 ")),c(Ce).scanStatus&&c(Te)!=e.name&&!c(Ce).statusTotal[e.name]?(o(),d("span",ie," 等待扫描 ")):m("v-if",!0)]),u("div",re,[u("span",ce,b(c(Ce).active[e.name]?"收起":"展开"),1),u("i",{class:x(c(Ce).active[e.name]?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down")},null,2)])],8,ee),r(u("div",oe,[p(I,{accordion:""},{default:y((()=>[(o(!0),d(v,null,w(c(Ce).progressConfig[e.name],((e,s)=>(o(),f(M,{key:s,disabled:"free"==c(ke)},{title:y((()=>[u("div",de,[u("div",ue,[u("span",{class:"text-[1.2rem] h-[2.2rem] flex items-center px-[8px] rounded-[0.2rem] mr-[1rem]",style:k({color:c(Me)[e.dangerous||0].color,backgroundColor:c(Me)[e.dangerous||0].bg})},b(c(Me)[e.dangerous||0].text),5),u("span",{innerHTML:e.name},null,8,me)]),p(j,{class:"mb-2px mr-4px",onClick:He},{default:y((()=>[...a[6]||(a[6]=[g(" 详情 ")])])),_:1})])])),default:y((()=>[u("div",pe,[u("div",ve,[a[7]||(a[7]=u("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 详情： ",-1)),u("span",{class:"leading-[1.6rem]",innerHTML:e.name},null,8,fe)]),p(l,{class:"!my-8px"}),u("div",ge,[a[8]||(a[8]=u("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 修复方案： ",-1)),u("span",{innerHTML:e.repair},null,8,be)])])])),_:2},1032,["disabled"])))),128))])),_:2},1024)],512),[[_,c(Ce).active[e.name]]])],2)))),128)):m("v-if",!0)])])):(o(),f(D,{key:1,data:c(Fe)},null,8,["data"]))])),[[q,c(_e)]])}}}),[["__scopeId","data-v-34882151"],["__file","/Users/chudong/project/linux-10/src/views/site/views/php-model/site-safe/safe-scan/index.vue"]]);export{ye as default};
