import{u as e,fj as l,a7 as a,G as t,j as s,ag as r,bg as u,l as n,R as o,_ as i,c as m,W as c,al as d}from"./utils-lib.js?v=1756369731";import{c as p,t as f,p as v,G as y,q as _,v as b,x,M as g,A as w,y as h,e as V,B as q,C as j,H as k,z as C,D as U,g as F,aW as A,a$ as B,r as W,P as z,aA as M}from"./base-lib.js?v=1756369731";import{u as G}from"./useStore4.js?v=1756369731";import{_ as H}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1756369731";import{_ as I}from"./index103.js?v=1756369731";import{_ as L}from"./index130.js?v=1756369731";import{b as N,u as D}from"./column.js?v=1756369731";import{aI as P}from"./validator.js?v=1756369731";import{g as Q,c as R,d as S,e as T,f as X,v as $,j as E,k as J,l as K,n as O,r as Y,q as Z,s as ee,t as le,u as ae}from"./useController14.js?v=1756369731";import{B as te}from"./index398.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./site.js?v=1756369731";import"./index104.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";import"./useController6.js?v=1756369731";import"./config.js?v=1756369731";const se={class:"flex items-center"},re={class:"whitespace-normal leading-1.8rem ml-[4px]"},ue={key:0,class:"flex items-center"},ne={class:"bg-[#FAFAFA] mb-[12px] flex items-center border border-[#ddd] justify-evenly p-[8px] py-[12px]"},oe={class:"flex flex-col justify-center items-center"},ie={class:"flex flex-col justify-center items-center"},me=p({__name:"index",setup(d){const{payment:p}=e();f(p.value);const{BtTable:W}=l({request:Q,columns:[{label:"类型",width:80,render:e=>({monitor_traffic_attack:"动态检查",monitor_traffic_total:"累计限制",monitor_http_flood:"动态检查"}[e.source])},{label:"描述",prop:"view_msg"},N({minWidth:100,event:J,data:["停用","正常"]}),D([{title:"删除",onClick:K}])],extension:[a(le)]}),z=()=>{const{BtForm:e,submit:l,param:a}=t({data:{cycle:5,cycle_unit:"m",traffic:1,traffic_unit:"mb",request:10,request_unit:"kc",type:"total",sender:[],total:3},options:e=>F(()=>[{type:"custom",render:()=>V(A,{title:"实时检查近一段时间内的资源消耗情况，当出现超过阀值的高资源占用时，发出告警信息",type:"warning",closable:!1,"show-icon":!0,class:"!mb-[12px]"},null)},{type:"custom",render:()=>V(u,{label:"周期",prop:"cycle"},{default:()=>[V("div",{class:"flex items-center"},[V(s,{width:"7rem",type:"number",min:"1",modelValue:e.value.cycle,"onUpdate:modelValue":l=>e.value.cycle=l},null),V(r,{class:"!w-[7rem] !ml-[.4rem] !mt-[2px]",modelValue:e.value.cycle_unit,"onUpdate:modelValue":l=>e.value.cycle_unit=l,options:[{label:"分钟",value:"m"},{label:"小时",value:"h"}]},null)])]})},{type:"custom",render:()=>V(u,{label:"阈值信息",prop:"total"===e.value.type?"traffic":"request"},{default:()=>{var l,a;return[V("div",{class:"flex items-center"},[V(r,{class:"!w-[10rem] !mr-[.4rem] !mt-[2px]",modelValue:e.value.type,"onUpdate:modelValue":l=>e.value.type=l,options:[{value:"total",label:"流量"},{value:"request",label:"请求数"}],onChange:l=>{"total"===l?(e.value.cycle_unit="m",e.value.traffic=1,e.value.traffic_unit="mb"):(e.value.cycle_unit="h",e.value.request=10,e.value.request_unit="kc")}},null),"total"===e.value.type?V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"1",modelValue:e.value.traffic,"onUpdate:modelValue":l=>e.value.traffic=l},null),V(r,{class:"!w-[8rem] !ml-[.4rem] !mt-[2px]",modelValue:e.value.traffic_unit,"onUpdate:modelValue":l=>e.value.traffic_unit=l,options:O},null)]):V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"1",modelValue:e.value.request,"onUpdate:modelValue":l=>e.value.request=l},null),V(r,{class:"!w-[8rem] !ml-[.4rem] !mt-[2px]",modelValue:e.value.request_unit,"onUpdate:modelValue":l=>e.value.request_unit=l,options:Y},null)])]),V("span",{class:"text-[1.2rem] text-[#666]"},["近".concat(e.value.cycle).concat("m"===e.value.cycle_unit?"分钟":"小时","内的").concat("total"===e.value.type?"流量":"请求数","超过").concat("total"===e.value.type?e.value.traffic:e.value.request).concat("total"===e.value.type?null==(l=O.find(l=>l.value===e.value.traffic_unit))?void 0:l.label:null==(a=Y.find(l=>l.value===e.value.request_unit))?void 0:a.label,"就触发告警")])]}}),rules:{traffic:[{required:!0,message:"请输入流量阈值",trigger:"blur"}],request:[{required:!0,message:"请输入请求数阈值",trigger:"blur"}]}},P("告警方式","sender",{attrs:{class:"!w-24rem",limit:["sms"]},rules:{sender:[{required:!0,message:"请选择告警方式",trigger:"blur"}]}}),{type:"custom",render:()=>V(u,{label:"发送次数",prop:"total"},{default:()=>[V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"0",modelValue:e.value.total,"onUpdate:modelValue":l=>e.value.total=l},{append:"次"}),V("span",{class:"text-[1.2rem] text-[#666] ml-[12px]"},[q("后将不再发送告警信息，无需限制次数可填0次表示不限制")])])]}),rules:{total:[{required:!0,message:"请输入发送次数",trigger:"blur"}]}}]),submit:async(e,l)=>(await l(),await Z(e.value))});n({title:"添加动态异常告警",area:60,component:()=>V("div",{class:"p-[2rem]"},[V(e,null,null)]),showFooter:!0,onConfirm:l})},M=()=>{const e=100,{BtForm:l,submit:a,param:i}=t({data:{cycle:0,traffic:1,traffic_unit:"mb",sender:[],total:3},options:l=>F(()=>[{type:"custom",render:()=>V(A,{title:"监控某段时间内的流量累计使用情况，当使用量超过当前规则设置的阀值，则发出告警信息",type:"warning",closable:!1,"show-icon":!0,class:"!mb-[12px]"},null)},{type:"custom",render:()=>V(u,{label:"时间段",prop:"cycle","label-width":e},{default:()=>[V("div",null,[V(te,{modelValue:l.value.cycle,"onUpdate:modelValue":e=>l.value.cycle=e,"value-format":"X",class:"date",type:"date",placeholder:0===l.value.cycle?"每个自然月":"请选择时间",onChange:e=>l.value.cycle=Number(e)},null),V(U,{type:"default",class:"!ml-[.4rem]",onClick:()=>l.value.cycle=0},{default:()=>[q("设为每个自然月")]}),0!==l.value.cycle&&V("span",{class:"block text-[1.2rem] text-[#666]"},[q("自"),o(l.value.cycle,"yyyy-MM-dd"),q("日起(包含该日)")])])]})},{type:"custom",render:()=>V(u,{label:"流量使用量阈值",prop:"traffic","label-width":e},{default:()=>{var e;return[V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"1",modelValue:l.value.traffic,"onUpdate:modelValue":e=>l.value.traffic=e},null),V(r,{class:"!w-[8rem] !ml-[.4rem] !mt-[2px] !mr-[12px]",modelValue:l.value.traffic_unit,"onUpdate:modelValue":e=>l.value.traffic_unit=e,options:O},null)]),V("span",{class:"block text-[1.2rem] text-[#666]"},["每个自然月的流量累计超过".concat(l.value.traffic).concat(null==(e=O.find(e=>e.value===l.value.traffic_unit))?void 0:e.label,"就触发告警")])]}}),rules:{traffic:[{required:!0,message:"请输入流量阈值",trigger:"blur"}]}},P("告警方式","sender",{attrs:{class:"!w-24rem",limit:["sms"],labelWidth:e},rules:{sender:[{required:!0,message:"请选择告警方式",trigger:"blur"}]}}),{type:"custom",render:()=>V(u,{label:"发送次数",prop:"total","label-width":e},{default:()=>[V("div",{class:"flex items-center"},[V(s,{width:"12rem",type:"number",min:"0",modelValue:l.value.total,"onUpdate:modelValue":e=>l.value.total=e},{append:"次"}),V("span",{class:"text-[1.2rem] text-[#666] ml-[12px]"},[q("后将不再发送告警信息，无需限制次数可填0次表示不限制")])])]}),rules:{total:[{required:!0,message:"请输入发送次数",trigger:"blur"}]}}]),submit:async(e,l)=>(await l(),await ee(e.value))});n({title:"添加流量使用提醒",area:60,component:()=>V("div",{class:"p-[2rem]"},[V(l,null,null)]),showFooter:!0,onConfirm:a})};return v(()=>{R()}),(e,l)=>{const a=i,t=m,s=L,r=B,u=I,n=c,o=y("bt-loading");return _(),b("div",null,[x(S)?(_(),g(s,{key:0,showConfig:{width:"44rem"}},{content:w(()=>[h("div",se,[V(a,{icon:"el-warning",color:"#fc6d26",size:18}),h("div",re,[x(T).total_status?j("",!0):(_(),b("span",ue,[l[2]||(l[2]=q(" 当前尚未安装监控报表插件 ",-1)),V(t,{onClick:l[0]||(l[0]=e=>x(X)("install")),class:"!text-[1.2rem] ml-4px"},{default:w(()=>[...l[1]||(l[1]=[q("点击安装",-1)])]),_:1})]))])])]),_:1})):j("",!0),h("div",null,[k((_(),b("div",ne,[h("div",oe,[l[3]||(l[3]=h("span",null,"当前流量",-1)),h("span",null,C(x(E).traffic),1)]),V(r,{direction:"vertical"}),h("div",ie,[l[4]||(l[4]=h("span",null,"当前请求数",-1)),h("span",null,C(x(E).request),1)])])),[[o,x($)]]),V(u,null,{"header-left":w(()=>[V(x(U),{type:"primary",onClick:z},{default:w(()=>[...l[5]||(l[5]=[q("添加动态检查告警",-1)])]),_:1}),V(x(U),{onClick:M},{default:w(()=>[...l[6]||(l[6]=[q("添加流量使用提醒",-1)])]),_:1})]),content:w(()=>[V(x(W),{"max-height":400})]),_:1}),V(n,{options:[{content:"流量限额可设置多条规则，统计周期产生的流量/请求超过限额会告警"}]})])])}}}),ce=p({__name:"index",setup(e){var l;const{siteInfo:a}=G(),t=W((null==(l=a.value)?void 0:l.tabName)||"flowLimit");return v(()=>{ae()}),(e,l)=>{const a=M,s=d;return _(),g(s,{type:"card",modelValue:x(t),"onUpdate:modelValue":l[0]||(l[0]=e=>z(t)?t.value=e:null)},{default:w(()=>[V(a,{label:"流量限制",name:"flowLimit"},{default:w(()=>[V(H)]),_:1}),V(a,{label:"流量限额",name:"flowQuota",lazy:!0},{default:w(()=>[V(me)]),_:1})]),_:1},8,["modelValue"])}}});export{ce as default};
