!function(){function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}var n=["status","data","msg"];function t(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o,u,l=[],i=!0,c=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;i=!1}else for(;!(i=(r=o.call(t)).done)&&(l.push(r.value),l.length!==n);i=!0);}catch(e){c=!0,a=e}finally{try{if(!i&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(c)throw a}}return l}}(e,n)||function(e,n){if(e){if("string"==typeof e)return r(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function a(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function l(t,r,a,o){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return u(s,"_invoke",function(t,r,a){var o,u,l,c=0,s=a||[],f=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,t){return o=n,u=0,l=e,p.n=t,i}};function m(t,r){for(u=t,l=r,n=0;!f&&c&&!a&&n<s.length;n++){var a,o=s[n],m=p.p,d=o[2];t>3?(a=d===r)&&(l=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=e):o[0]<=m&&((a=t<2&&m<o[1])?(u=0,p.v=r,p.n=o[1]):m<d&&(a=t<3||o[0]>r||r>d)&&(o[4]=t,o[5]=r,p.n=d,u=0))}if(a||t>1)return i;throw f=!0,r}return function(a,s,d){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&m(s,d),u=s,l=d;(n=u<2?e:l)||!f;){o||(u?u<3?(u>1&&(p.n=-1),m(u,l)):p.n=l:p.v=l);try{if(c=2,o){if(u||(a="next"),n=o[a]){if(!(n=n.call(o,l)))throw TypeError("iterator result is not an object");if(!n.done)return n;l=n.value,u<2&&(u=0)}else 1===u&&(n=o.return)&&n.call(o),u<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=e}else if((n=(f=p.n<0)?l:t.call(r,p))!==i)break}catch(n){o=e,u=1,l=n}finally{c=1}}return{value:n,done:f}}}(t,a,o),!0),s}var i={};function c(){}function s(){}function f(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(u(n={},r,function(){return this}),n),m=f.prototype=c.prototype=Object.create(p);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=f,u(m,"constructor",f),u(f,"constructor",s),s.displayName="GeneratorFunction",u(f,a,"GeneratorFunction"),u(m),u(m,a,"Generator"),u(m,r,function(){return this}),u(m,"toString",function(){return"[object Generator]"}),(o=function(){return{w:l,m:d}})()}function u(e,n,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}u=function(e,n,t,r){function o(n,t){u(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(o("next",0),o("throw",1),o("return",2))},u(e,n,t,r)}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach(function(n){c(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function c(n,t,r){return(t=function(n){var t=function(n,t){if("object"!=e(n)||!n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var a=r.call(n,t||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(n)}(n,"string");return"symbol"==e(t)?t:t+""}(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function s(e,n,t,r,a,o,u){try{var l=e[o](u),i=l.value}catch(e){return void t(e)}l.done?n(i):Promise.resolve(i).then(r,a)}function f(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var o=e.apply(n,t);function u(e){s(o,r,a,u,l,"next",e)}function l(e){s(o,r,a,u,l,"throw",e)}u(void 0)})}}System.register(["./utils-lib-legacy.js?v=1756369731","./base-lib-legacy.js?v=1756369731","./index-legacy104.js?v=1756369731","./index-legacy103.js?v=1756369731"],function(e,r){"use strict";var u,l,c,s,p,m,d,v,y,b,g,h,w,k,j,O,x,_,P,S,D,I,z,N,T,G,C,q,E,A,M,B,U,L,W,F,V,H,K,Y,Z,$,J,Q,R,X,ee,ne;return{setters:[function(e){u=e.K,l=e.gY,c=e.gZ,s=e.v,p=e.b,m=e.g_,d=e.aj,v=e.g$,y=e.l,b=e.L,g=e.h0,h=e.o,w=e.h1,k=e.ah,j=e.a6,O=e.e,x=e.al,_=e.W,P=e.a2,S=e.I},function(e){D=e.r,I=e.e,z=e.aQ,N=e.B,T=e.ao,G=e.ap,C=e.an,q=e.i,E=e.a4,A=e.c,M=e.q,B=e.v,U=e.y,L=e.z,W=e.x,F=e.A,V=e.F,H=e.a_,K=e.P,Y=e.av,Z=e.M,$=e.aA,J=e.N,Q=e.b3,R=e.p,X=e.Z},function(e){ee=e._},function(e){ne=e._}],execute:function(){var te=p(),re=D("all"),ae=null,oe=function(e){return{request:(n=f(o().m(function n(t){var r;return o().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,ce(i(i({},t),{},{service_name:e.value.serviceName}),re.value);case 1:return r=n.v,n.a(2,r)}},n)})),function(e){return n.apply(this,arguments)}),columns:[{label:"名称",prop:"name",align:"center",width:200},{label:"描述",prop:"description",render:function(e){return I(z,{effect:"dark",content:e.description,"popper-class":"w-[35rem]","show-after":500,placement:"top-start",disabled:!e._isOverflow},{default:function(){return[I("div",{class:"w-[95%] truncate",ref:function(n){n&&(e._isOverflow=n.scrollWidth>n.clientWidth)}},[e.description])]}})}},{label:"版本",prop:"version",align:"center",width:100},{label:"大小",prop:"size",align:"center",width:100},{label:"状态",prop:"status",align:"center",width:100,renderHeader:function(){return I(C,{onCommand:function(n){return ie(n,re,e.value)}},{default:function(){return I("div",{class:"flex items-center"},[I("span",null,[N("状态")]),I("span",null,["all"===re.value?"":"(".concat(le(re.value),")")]),I("span",{class:"svgtofont-el-arrow-down"},null)])},dropdown:function(){var e,n;return I(T,null,"function"==typeof(n=e=ue.map(function(e){return I(G,{command:e.value},{default:function(){return[e.label]}})}))||"[object Object]"===Object.prototype.toString.call(n)&&!q(n)?e:{default:function(){return[e]}})}})},render:function(n){var t="",r="",a="";switch(n.status){case"installed":t="已安装",r="primary";break;case"downloading":t="下载中",r="warning",a="cursor-pointer flex items-center";break;case"failed":t="失败",r="danger",a="cursor-pointer";break;default:t="未安装",r="#666"}return I("span",{class:"text-".concat(r," ").concat(a),onClick:function(){return fe(n,e.value)}},[t,"downloading"===n.status&&I("span",{class:"inline-block svgtofont-el-loading"},null)])}},{label:"操作",prop:"operate",fixed:"right",width:140,align:"right",render:function(n){return I("div",{class:"w-full flex items-center justify-end"},["installed"===n.status&&I("span",{class:"bt-link",onClick:function(){return se(n,e.value)}},[N("查看详情")]),"downloading"===n.status&&I("span",null,[N("--")]),"installed"!==n.status&&"downloading"!==n.status&&I("span",{class:"bt-link",onClick:function(){return pe(n,e.value)}},[N("下载")]),"installed"===n.status&&I("span",null,[I(ee,null,null),I("span",{class:"bt-link",onClick:function(){return me(n,e.value)}},[N("删除")])])])}}]};var n},ue=[{label:"全部",value:"all"},{label:"已安装",value:"installed"},{label:"下载中",value:"downloading"},{label:"失败",value:"failed"},{label:"未安装",value:"uninstall"}],le=function(e){return{all:"",installed:"已安装",downloading:"下载中",failed:"失败",uninstall:"未安装"}[e]},ie=function(e,n,t){n.value=e,1===t.param.p?t.refresh():t.param.p=1},ce=(e("e",{mode:"ace/mode/json",theme:"ace/theme/monokai",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!0,fontSize:"12px"}),function(){var e=f(o().m(function e(n,t){var r,a;return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,u({request:m(i(i({},n),{},{status:t})),loading:"正在获取模型列表"});case 1:if(r=e.v,!(a=r.data).status){e.n=2;break}return e.a(2,{total:d(a.page),data:a.data});case 2:return te.error(a.msg),e.a(2,{total:0,data:[]});case 3:return e.a(2)}},e)}));return function(n,t){return e.apply(this,arguments)}}()),se=function(){var e=f(o().m(function e(n,t){return o().w(function(e){for(;;)switch(e.n){case 0:u({request:v({model_name:n.name,model_version:n.version,service_name:t.serviceName}),loading:"正在获取模型详情",success:function(e){e.status&&y({title:"模型详情-".concat(n.name),area:75,component:function(){return b(function(){return r.import("./model-detail-popup-legacy.js?v=1756369731")},void 0,r.meta.url)},compData:JSON.stringify(e.data,null,2),btns:!1})}});case 1:return e.a(2)}},e)}));return function(n,t){return e.apply(this,arguments)}}(),fe=function(){var e=f(o().m(function e(n,t){var a,u,l;return o().w(function(e){for(;;)switch(e.n){case 0:if("downloading"===n.status){e.n=1;break}return e.a(2);case 1:return a=[],u=D("正在获取日志"),l=null,function(){var e,n,r;null===(e=ae)||void 0===e||e.close(),null===(n=ae=k({route:"/sock_shell",onMessage:function(e,n){var r=n.data;a.push(r),a.length>50?u.value=a.slice(a.length-50).join("\n"):u.value=a.join("\n"),r.includes("bt_successful")&&(l&&l.unmount(),l=null,t.refresh())}}))||void 0===n||n.send({}),null===(r=ae)||void 0===r||r.send("tail -f /tmp/".concat(t.serviceName,".log"))}(),e.n=2,y({title:"模型安装日志-".concat(n.name),area:75,component:function(){return b(function(){return r.import("./model-install-log-legacy.js?v=1756369731")},void 0,r.meta.url)},compData:u,onCancel:function(){var e;null===(e=ae)||void 0===e||e.close(),l=null},btns:!1});case 2:return l=e.v,e.a(2,l)}},e)}));return function(n,t){return e.apply(this,arguments)}}(),pe=function(){var e=f(o().m(function e(n,t){return o().w(function(e){for(;;)switch(e.n){case 0:if(n.can_down){e.n=1;break}return e.a(2,te.error("当前已存在下载任务，请等待下载完成"));case 1:u({request:g({model_name:n.name,service_name:t.serviceName,model_version:n.version}),loading:"正在下载模型",success:function(e){e.status?(te.success("开始下载"),t.refresh(),fe({name:n.name,status:"downloading"},t)):te.error(e.msg)},error:function(){te.error("下载失败")}});case 2:return e.a(2)}},e)}));return function(n,t){return e.apply(this,arguments)}}(),me=function(){var e=f(o().m(function e(n,t){return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,h({title:"删除模型-".concat(n.name),content:"确定删除该模型吗？"});case 1:u({request:w({service_name:t.serviceName,model_name:n.name,model_version:n.version}),loading:"正在删除模型",success:function(e){e.status?(t.refresh(),te.success("删除成功")):te.error(e.msg)}}),e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(n,t){return e.apply(this,arguments)}}(),de=D({}),ve=function(e){var n,t,r;return null!=(n=e.power)&&n.current&&(n.current/=1e3),null!=n&&n.max&&(n.max/=1e3),t=e.memory,r=function(e){return s(e*Math.pow(1024,3))},null!=t&&t.free&&(t.free=r(t.free)),null!=t&&t.used&&(t.used=r(t.used)),null!=t&&t.size&&(t.size=r(t.size)),e},ye=function(){var e=f(o().m(function e(r){var i,f,p,m,d,v,y;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,i=Number.isInteger(Number(r)),e.n=1,u({request:i?l({index:Number(r)}):c()});case 1:if(f=e.v,p=f.status,m=f.data,d=f.msg,a(f,n),!1!==p){e.n=2;break}return te.error(d),e.a(2,i?void 0:de.value={system:!1,list:[],tableList:[]});case 2:if(!i){e.n=3;break}return de.value.list[Number(r)]={key:r,value:ve(m)},e.a(2);case 3:return v=[],y=Object.entries(m).filter(function(e){return"system"!==t(e,1)[0]}).map(function(e){var n,r=t(e,2),a=r[0],o=r[1],u=ve(o);return null===(n=u.processes)||void 0===n||n.forEach(function(e){return v.push({gpu:a,pid:e.pid,type:e.type,name:e.name,memory:s(e.usedGpuMemory)})}),{key:a,value:u}}),m.system.version.cuda="".concat(m.system.version.cuda).split("0").filter(Boolean).join("."),de.value={system:m.system,list:y,tableList:v},e.a(2,{data:v,total:m.system.count});case 4:e.p=4,e.v,de.value={system:!1,list:[],tableList:[]};case 5:return e.a(2)}},e,null,[[0,4]])}));return function(n){return e.apply(this,arguments)}}(),be=O({name:"ollama",props:["compData"],setup:function(e){var n=D(),t=j(oe(n)),r=t.BtTable,a=t.BtPage,o=t.BtSearch,u=t.BtRefresh,l=t.refresh,i=t.param;return n.value={refresh:l,serviceName:e.compData.service_name,param:i},E(function(){re.value="all",de.value={}}),function(){return I("div",{class:"relative"},[I(ne,null,{"header-left":function(){return I("div",{class:"flex items-center"},[I(o,{class:"!w-[47rem]",placeholder:"请输入模型名称/描述"},null)])},"header-right":function(){return I(u,null,null)},content:function(){return I("div",null,[I(r,{key:"ollamaTable","max-height":410,class:"!min-h-[350px]"},null)])},"footer-right":function(){return I(a,null,null)}})])}}},[["__scopeId","data-v-20353357"]]),ge={key:0},he={class:"flex items-center mb-[2rem]"},we={class:"text-[1.4rem] leading-[2.1rem]"},ke={class:"text-[1.4rem] leading-[2.1rem] ml-[2rem]"},je={key:1},Oe=A({__name:"gpu-info",props:{compData:{}},setup:function(e){var n,t=A({props:{data:{type:Object,required:!0},cpuIndex:{type:Number,required:!0}},setup:function(e){var n=function(n){var t;return"cpuIndex"===n?e.cpuIndex:null!==(t=n.split(".").reduce(function(e,n){return e&&e[n]},e.data))&&void 0!==t?t:"null"},t=[{name:"GPU",key:"cpuIndex"},{name:"型号",key:"name"},{name:"核心频率",key:"clock.graphics",unit:"MHz"},{name:"内存频率",key:"clock.memory",unit:"MHz"},{name:"显存大小",key:"memory.size"},{name:"已使用显存",key:"memory.used"},{name:"剩余显存",key:"memory.free"},{name:"当前功耗",key:"power.current",unit:"W"},{name:"最大功耗",key:"power.max",unit:"W"},{name:"风扇转速",key:"fan",unit:"%"}],r=[{content:"显示null说明可能因驱动版本过低或显卡版本过低无法获取对应数据"}],a=[{name:"GPU使用率",key:"utilization.gpu",unit:"%"},{name:"GPU温度",key:"temperature",unit:"°C"}];return function(){return I("div",{class:"flex h-[41.5rem]"},[I("div",{class:"flex flex-1 justify-evenly"},[a.map(function(e){return I("div",null,[I("div",{class:"flex justify-center mb-[2rem]"},[e.name]),I("div",{class:"p-[12px] flex flex-col items-start"},[I(Q,{width:170,type:"circle",percentage:n(e.key),"stroke-width":12,color:"#20a53a"},{default:function(){return I("div",null,[I("div",{class:"font-bold text-[1.6rem]"},[n(e.key)+(e.unit||"")]),I("div",{class:"mt-[1rem] text-[1.4rem]"},[e.name])])}})])])})]),I("div",{class:"flex flex-col items-center justify-start max-w-[20rem]"},[t.map(function(e){return I("div",{class:"flex items-center justify-start w-full text-[1.4rem] leading-[2.6rem]"},[I("span",null,[e.name,N("：")]),I("span",null,[n(e.key)]),I("span",null,[e.unit||""])])}),I(_,{class:"mt-[2.2rem]",options:r},null)])])}}}),r=D("".concat(null===(n=e.compData.value.list[0])||void 0===n?void 0:n.key)||"");return function(e,n){var a,o,u=x,l=Y;return M(),B("div",null,[e.compData.value.list&&e.compData.value.list.length>0?(M(),B("div",ge,[U("div",he,[U("span",we,"驱动版本："+L(null===(a=W(de))||void 0===a||null===(a=a.system)||void 0===a?void 0:a.version.driver),1),U("span",ke,"Cuda版本："+L(null===(o=W(de))||void 0===o||null===(o=o.system)||void 0===o?void 0:o.version.cuda),1)]),I(u,{modelValue:W(r),"onUpdate:modelValue":n[0]||(n[0]=function(e){return K(r)?r.value=e:null}),onChange:W(ye)},{default:F(function(){return[(M(!0),B(V,null,H(e.compData.value.list,function(e){return M(),Z(W($),{key:e.key,name:e.key,label:"gpu".concat(e.key)},{default:F(function(){return[(M(),Z(J(W(t)),{data:e.value,cpuIndex:e.key},null,8,["data","cpuIndex"]))]}),_:2},1032,["name","label"])}),128))]}),_:1},8,["modelValue","onChange"])])):(M(),B("div",je,[I(l,{description:"未找到GPU设备或未安装GPU驱动"})]))])}}}),xe={name:"ProcessInfo",props:["compData"],setup:function(e){var n,t=j({request:(n=f(o().m(function n(t){return o().w(function(n){for(;;)if(0===n.n)return n.a(2,{data:e.compData.value.tableList,total:e.compData.value.tableList.length})},n)})),function(e){return n.apply(this,arguments)}),columns:[{label:"GPU",prop:"gpu"},{label:"PID",prop:"pid"},{label:"TYPE",prop:"type"},{label:"进程名称",prop:"name"},{label:"显存占用",prop:"memory"}]}),r=t.BtTable,a=t.refresh,u=null;return R(function(){u=setInterval(function(){a()},2e3)}),E(function(){clearInterval(u)}),function(){return I("div",null,[I(ne,null,{content:function(){return I(r,{"max-height":500},null)}})])}}},_e=A({__name:"index",props:{compData:{type:Object,default:function(){return{}}}},setup:function(e){var n=e,t=D(!1),r=D(n.compData.tabActive||"manager");X("gpuOpenStatus",t);var a=P({type:"left-bg-card",value:r,options:[{label:"模型管理",name:"manager",lazy:!0,render:function(){return I(be,{compData:n.compData},null)}},{label:"显卡信息",name:"gpu",lazy:!0,render:function(){return I(Oe,{compData:de},null)}},{label:"进程信息",name:"process",lazy:!0,render:function(){return I(xe,{compData:de},null)}}]}).BtTabs,o=null;return R(function(){if(n.compData.appinfo&&n.compData.appinfo.length>0){var e=n.compData.appinfo.find(function(e){return"gpu"===e.fieldKey});e&&e.fieldValue&&(t.value=!0)}t.value?(ye(),o=setInterval(function(){S(["/mod/docker/gpu/get_all_device_info"]),ye()},3e3)):de.value={system:!1,list:[],tableList:[]}}),E(function(){o&&clearInterval(o)}),function(e,n){return M(),Z(W(a))}}}),Pe=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));e("i",Pe)}}})}();
