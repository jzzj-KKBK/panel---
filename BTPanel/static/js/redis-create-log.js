import{_ as t}from"./index116.js?v=1756369731";import{c as s,r as e,p as a,a4 as l,q as i,v as o,e as r,A as n,F as m,a_ as u,x as c,M as d,cc as p,cd as v,y as f}from"./base-lib.js?v=1756369731";import{iX as x,M as _,e as g}from"./utils-lib.js?v=1756369731";import{u as j}from"./index63.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index103.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./useController6.js?v=1756369731";import"./site.js?v=1756369731";import"./validator.js?v=1756369731";import"./useStore4.js?v=1756369731";const b={class:"p-[2rem] master-redis-create-log"},w=g(s({__name:"redis-create-log",props:{compData:{default:()=>({task_id:""})}},setup(s){const{isRedisRefreshList:g}=j(),w=s,k=e(""),h=["配置主Redis节点","配置从Redis节点","验证复制状态","主从配置完成"],y=e(h.map(t=>({name:t,status:"wait"}))),R=e(0);let D=null;const I={wait:()=>r("span",{class:"svgtofont-el-more-filled text-[#ccc] mr-2px !text-[1.8rem]"},null),completed:()=>r("span",{class:"svgtofont-el-circle-check text-[#22c55e] mr-2px !text-[1.8rem]"},null),failed:()=>r("span",{class:"svgtofont-el-circle-close text-[#ef0808] mr-2px !text-[1.8rem]"},null),running:()=>r("span",{class:"svgtofont-el-loading animate-spin text-[#2563eb] mr-2px !text-[1.8rem]"},null)},T={wait:"",completed:"完成",failed:"失败",running:"进行中"},H=async()=>{if(!w.compData.task_id)return;const{data:t}=await x({task_id:w.compData.task_id});if(!t.status)return void _.error(t.msg);const s=t.data;var e;k.value=s.logs||"",e=s.steps||[],y.value=h.map((t,s)=>{const a=e[s];return{name:t,status:(null==a?void 0:a.status)||"wait",start_time:null==a?void 0:a.start_time,completed_time:null==a?void 0:a.completed_time,updated_time:null==a?void 0:a.updated_time}});const a=y.value.findIndex(t=>"running"===t.status),l=y.value.map(t=>t.status).lastIndexOf("completed");R.value=-1!==a?a:-1!==l?l:0;const i=y.value.some(t=>"failed"===t.status);"completed"===s.status||"failed"===s.status||i?D&&(clearTimeout(D),g.value=!0,D=null):D=setTimeout(H,2e3)};return a(()=>{H()}),l(()=>{k.value="",D&&(clearTimeout(D),D=null)}),(s,e)=>{const a=t;return i(),o("div",b,[r(c(v),{direction:"vertical",space:"4rem",active:c(R)},{default:n(()=>[(i(!0),o(m,null,u(c(y),(t,s)=>{var e;return i(),d(c(p),{key:s,title:t.name,icon:I[t.status]?I[t.status]():I.wait(),description:null!=(e=T[t.status])?e:"",status:"completed"===t.status?"success":"running"===t.status?"process":"failed"===t.status?"error":"wait"},null,8,["title","icon","description","status"])}),128))]),_:1},8,["active"]),e[0]||(e[0]=f("h3",{class:"text-[1.4rem] mb-[1rem] mt-[1rem] color-[#666]"},"实时日志",-1)),r(a,{content:c(k),isHtml:!0,autoScroll:!0,style:{height:"14rem"}},null,8,["content"])])}}}),[["__scopeId","data-v-1425bb88"]]);export{w as default};
