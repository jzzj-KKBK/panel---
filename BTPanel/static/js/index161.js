import{_ as a}from"./index103.js?v=1756369731";import{G as e,c as t,K as s,f_ as l,ai as r,b as n,aX as c,e as i,ab as o,f$ as u,u as d,fj as p,l as m,H as v,o as w,g0 as b,g1 as h,g2 as g,g3 as _,g4 as y}from"./utils-lib.js?v=1756369731";import{c as f,t as x,r as q,g as k,e as S,B as T,p as j,q as D,v as C,x as P,k as R,G as L,A as M,y as z,b7 as O,H as A,Q as U,M as H}from"./base-lib.js?v=1756369731";import{u as J}from"./column.js?v=1756369731";import{g as N}from"./useStore.js?v=1756369731";import{_ as B}from"./index104.js?v=1756369731";import{b as F,c as I,f as W,d as G,k as E}from"./form-item.js?v=1756369731";import{_ as K}from"./index413.js?v=1756369731";import{_ as Q}from"./index107.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./config.js?v=1756369731";const X={class:"w-[460px] px-16px py-24px input_autofill"},$="w-[320px]",V=i(f({__name:"mail",props:{compData:{default:()=>({title:"",type:"",row:{},callback:()=>{}})}},setup(a,{expose:i}){const o=a,{type:u,row:d}=x(o.compData),p="https://www.bt.cn/bbs/thread-108097-1-1.html",m=q({title:"",qq_mail:"",qq_stmp_pwd:"",hosts:"",port:"465",receiveMail:""}),{BtForm:v,submit:w}=e({data:()=>m.value,options:()=>k(()=>[F("名称","title",{attrs:{placeholder:"请输入邮箱名称",class:$},rules:[{required:!0,message:"请输入名称",trigger:["blur","change"]},{max:15,message:"名称不能超过15个字符",trigger:["blur","change"]}]}),F("发送人邮箱","qq_mail",{attrs:{placeholder:"请输入发送人邮箱",class:$,autocomplete:"new-password"},rules:[{required:!0,message:"请输入发送人邮箱",trigger:["blur","change"]}]}),F("SMTP密码","qq_stmp_pwd",{attrs:{placeholder:"请输入SMTP密码",showPassword:!0,class:$},rules:[{required:!0,message:"请输入SMTP密码",trigger:["blur","change"]}]}),F("SMTP服务器","hosts",{attrs:{placeholder:"请输入SMTP服务器",class:$},rules:[{required:!0,message:"请输入SMTP服务器",trigger:["blur","change"]}]}),F("端口","port",{attrs:{placeholder:"请输入端口",class:$},rules:[{required:!0,message:"请输入端口",trigger:["blur","change"]}]}),I("邮箱","receiveMail",{attrs:{placeholder:"接收者邮箱，每行1个",rows:6,class:$},rules:[{required:!0,message:"请输入接收者邮箱",trigger:["blur","change"]}]}),W(" ",[{content:"推荐使用465端口，协议为SSL/TLS"},{content:"25端口为SMTP协议，587端口为STARTTLS协议"},{content:S(t,{href:p,target:"_blank"},{default:()=>[T("配置教程")]})}])]),submit:async(a,e)=>(await e(),b())}),b=async a=>{try{const a=(()=>{const a={qq_mail:m.value.qq_mail,qq_stmp_pwd:m.value.qq_stmp_pwd,hosts:m.value.hosts,port:m.value.port},e=m.value.receiveMail.split("\n").filter(a=>""!==a&&" "!==a),t={sender_type:u.value,sender_data:JSON.stringify({send:a,receive:e,title:m.value.title})};return c("id",d.value)&&(t.sender_id=d.value.id),t})();return(await s({loading:"正在设置,请稍候...",request:l(a),success:a=>{a.status&&o.compData.callback(!0),r(a.data.data)&&!a.status?n().error("".concat(a.msg,"【").concat(a.data.data,"】")):n().request(a)}})).status}catch(e){}};return j(()=>{if(!d.value||!("id"in d.value))return;const{send:a,receive:e=[],title:t=""}=d.value.data||{},{hosts:s,port:l,qq_mail:r,qq_stmp_pwd:n}=a||{};m.value.hosts=s,m.value.port=l,m.value.qq_mail=r,m.value.qq_stmp_pwd=n,m.value.receiveMail=Array.isArray(e)?e.join("\n"):"",m.value.title=t}),i({onConfirm:async a=>await w()&&a()}),(a,e)=>(D(),C("div",X,[S(P(v),{size:"small"})]))}}),[["__scopeId","data-v-4e68025d"]]),Y={class:"w-[90%] px-16px py-24px"},Z=f({__name:"web-hook",props:{compData:{default:()=>({title:"",type:"",row:{},callback:()=>{}})}},setup(a,{expose:c}){const i=a,{type:u,row:d}=x(i.compData),p="自定义webhook",m="https://www.bt.cn/bbs/thread-143326-1-1.html",v=q({title:"",url:"",atall:"True",method:"POST",body_type:"json",custom_parameter:"",headers:""}),w=[{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],b=[{label:"application/json",value:"json"},{label:"x-www-form-urlencoded",value:"form_data"}],h={class:"!w-[140px]"},g=a=>({placeholder:"非必填，可输入JSON格式的字符串，例如：{aa:bb}",autosize:{minRows:a,maxRows:a},resize:"none"}),_=k(()=>[F("名称","title",{attrs:{placeholder:"机器人名称或备注",class:"w-[320px]"},rules:[{required:!0,message:"请输入机器人名称或备注",trigger:["blur","change"]}]}),I("URL","url",{attrs:{placeholder:"请输入".concat(p,"机器人URL"),autosize:{minRows:5,maxRows:5},resize:"none",class:"w-[320px]"},rules:[{required:!0,message:"请输入".concat(p,"机器人URL"),trigger:["blur","change"]}]}),G([E("请求方式","method",w,{attrs:h}),E("参数格式","body_type",b,{attrs:h,labelAttrs:{labelWidth:"w-[120px]"}})]),I("自定义参数","custom_parameter",{attrs:{...g(4),class:"w-[320px]"}}),I("请求头","headers",{attrs:{...g(2),class:"w-[320px]"}}),W(" ",[{content:S(t,{href:m},{default:()=>["如何使配置并使用自定义消息通道"]})}])]),{BtForm:y,submit:f}=e({data:()=>v.value,options:_,submit:async(a,e)=>(await e(),T())}),T=async()=>{try{const a=(()=>{var a,e;const t=o(v.value);["custom_parameter","query","headers"].forEach(a=>{t[a]=""===t[a]?{}:new Function("return ".concat(t[a]))()});const s=(null==(a=d.value)?void 0:a.data)||{},l={sender_type:u.value,sender_data:JSON.stringify({...s,...t})};return(null==(e=d.value)?void 0:e.id)&&(l.sender_id=d.value.id),l})();return(await s({loading:"正在设置,请稍候...",request:l(a),success:a=>{a.status&&i.compData.callback(!0),r(a.data.data)&&!a.status?n().error(a.msg+"【"+a.data.data+"】"):n().request(a)}})).status}catch(a){}};return j(()=>{if(!d.value||!("id"in d.value))return;const{title:a,url:e,method:t,body_type:s,custom_parameter:l,headers:r}=d.value.data;v.value.title=a,v.value.url=e,v.value.method=t,v.value.body_type=s,v.value.custom_parameter=l?JSON.stringify(l):"",v.value.headers=r?JSON.stringify(r):"",v.value.atall="True"}),c({onConfirm:async a=>await f()&&a()}),(a,e)=>(D(),C("div",Y,[S(P(y))]))}}),aa={class:"p-[16px]"},ea={class:"flex items-center justify-around mt-[1.6rem]"},ta={class:"bind"},sa={class:"code p-[1rem]"},la=i(f({__name:"wx-account",props:{compData:{default:()=>({title:"",type:"",data:{},callback:()=>{}})}},setup(a,{expose:e}){const t=a,l=q(!1),r=R({bindCode:"www.bt.cn"});return j(async()=>{try{await s({loading:l,request:u(),success:a=>{a.status?r.bindCode=a.data.res:r.bindCode="二维码失效，请重新获取"}})}catch(a){}}),e({onCancel:()=>t.compData.callback(!0)}),(a,e)=>{const t=Q,s=K,n=L("bt-loading");return D(),C("div",aa,[S(t,{closable:!1,"show-icon":!0,type:"warning"},{title:M(()=>[...e[0]||(e[0]=[z("div",null,"没有绑定微信公众号无法接收面板告警信息",-1),z("div",null,"当前为体验版，限制每个宝塔账号发送频率100条/天",-1)])]),_:1}),z("div",ea,[e[2]||(e[2]=O('<div class="bind" data-v-87a165f9><div class="title" data-v-87a165f9><span class="steps" data-v-87a165f9>1</span>关注堡塔公众号</div><div class="code" data-v-87a165f9><img src="https://www.bt.cn/Public/img/bt_wx.jpg" alt="堡塔公众号" class="w-[160px]" data-v-87a165f9></div></div>',1)),z("div",ta,[e[1]||(e[1]=z("div",{class:"title"},[z("span",{class:"steps"},"2"),T("绑定微信账号")],-1)),A((D(),C("div",sa,[S(s,{value:P(r).bindCode,logo:"/static/images/config/wx_logo.png",level:"L",size:140},null,8,["value"])])),[[n,P(l)],[n,"正在获取二维码，请稍候...","title"]])])])])}}}),[["__scopeId","data-v-87a165f9"]]),ra={class:"w-[470px] px-16px py-24px"},na=f({__name:"common",props:{compData:{default:()=>({title:"",type:"",row:{},callback:()=>{}})}},setup(a,{expose:c}){const i=a,{title:o,type:u,row:d}=x(i.compData),p=q({title:"",url:"",send_type:"markdown"}),m=k(()=>[{name:"dingding",ps:"如何创建钉钉机器人",help:"https://www.bt.cn/bbs/thread-108081-1-1.html"},{name:"feishu",ps:"如何创建飞书机器人",help:"https://www.bt.cn/bbs/thread-108274-1-1.html"},{name:"weixin",ps:"如何创建企业微信机器人",help:"https://www.bt.cn/bbs/thread-108116-1-1.html"}].find(a=>a.name===u.value)),v=k(()=>{var a;const e=[F("名称","title",{attrs:{placeholder:"机器人名称或备注",class:"w-[320px]"},rules:[{required:!0,message:"请输入机器人名称或备注",trigger:["change","blur"]}]}),I("URL","url",{attrs:{placeholder:"请输入".concat(o.value,"机器人URL"),autosize:{minRows:5,maxRows:5},resize:"none",class:"w-[320px]"},rules:[{required:!0,message:"请输入".concat(o.value,"机器人URL"),trigger:["change","blur"]}]})];return"weixin"===u.value&&e.push(E("发送类型","send_type",[{label:"文本",value:"text"},{label:"markdown",value:"markdown"}],{attrs:{placeholder:"请选择发送类型",class:"!w-[320px]"},rules:[{required:!0,message:"请选择发送类型",trigger:["change","blur"]}]})),e.push(W(" ",[{content:S(t,{href:null==(a=m.value)?void 0:a.help},{default:()=>{var a;return[null==(a=m.value)?void 0:a.ps]}})}])),e}),{BtForm:w,submit:b}=e({data:()=>p.value,options:v,submit:async(a,e)=>{try{return await e(),h(a)}catch(t){}}}),h=async a=>{try{"weixin"!==u.value&&delete a.value.send_type;const e={sender_type:u.value,sender_data:JSON.stringify({...a.value,atall:"True"})};d.value&&"id"in d.value&&(e.sender_id=d.value.id);return(await s({loading:"正在设置,请稍候...",request:l(e),success:a=>{a.status&&i.compData.callback(!0),r(a.data.data)&&!a.status?n().error("".concat(a.msg,"【").concat(a.data.data,"】")):n().request(a)}})).status}catch(e){}};return j(()=>{if(!d.value||!("id"in d.value))return;const{data:{title:a,url:e,send_type:t}}=d.value;p.value.title=a,p.value.url=e,p.value.send_type=t}),c({onConfirm:async a=>await b()&&a()}),(a,e)=>(D(),C("div",ra,[S(P(w),{size:"small",onSubmit:e[0]||(e[0]=U(()=>{},["prevent"]))})]))}}),ca=f({__name:"index",props:{compData:{default:()=>({type:"",title:"",callback:()=>{}})}},setup(e,{expose:t}){const{refs:{isRefreshList:l}}=N(),c=e,{compData:i}=x(c),{getSenderAlarmListInfo:o,push:u}=d(),f=async a=>{const e=(a=>{switch(a){case"mail":return V;case"webhook":return Z;case"wx_account":return la;default:return na}})(i.value.type);await m({title:"".concat(c.compData.title,"配置"),area:"webhook"===c.compData.type?60:50,compData:{row:a,...i.value,callback:()=>{j(),l.value=!0}},showFooter:"wx_account"!==c.compData.type,component:e})},q=async a=>{try{await w({title:"设置默认配置",content:"设置【".concat(a.data.title,"】为默认配置后，将会覆盖原有默认配置，是否继续操作？")}),await s({loading:"正在设置，请稍后...",message:!0,request:b({sender_id:a.id,sender_type:a.sender_type}),success:a=>{a.status&&j()}})}catch(e){}},{BtTable:k,refresh:j}=p({request:async()=>{const a=await(async(a=!1)=>{try{await o(a)}catch(e){}return u.value.config})(),e=a.filter(a=>a.sender_type===i.value.type)||[];return{data:e,total:e.length,other:a}},columns:(()=>{var a;const e=(null==(a=[{label:"邮箱",name:"mail"},{label:"公众号",name:"wx_account"},{label:"钉钉机器人",name:"dingding"},{label:"飞书机器人",name:"feishu"},{label:"企业微信机器人",name:"weixin"},{label:"自定义Webhook",name:"webhook"}].find(a=>a.name===i.value.type))?void 0:a.label)||"自定义Webhook";return[{label:e,prop:"data.title",render:a=>{var e;return S("div",null,[null==(e=a.data)?void 0:e.title,a.original?"【默认配置】":""])}},{label:"状态",width:65,render:a=>S("span",{class:"".concat(a.used?"bt-link":"bt-link !text-danger"),onClick:()=>(async(a,e)=>{try{await w({title:"".concat(a.used?"禁用":"启用").concat(e,"【").concat(a.data.title,"】"),content:"您真的要".concat(a.used?"禁用":"启用").concat(e,"【").concat(a.data.title,"】吗？")}),await s({loading:"正在设置，请稍后...",message:!0,request:h({sender_id:a.id}),success:a=>{a.status&&j()}})}catch(t){}})(a,e)},[a.used?"已启用":"未启用"])},J([{onClick:q,isHide:a=>a.original,title:"设置默认",width:60},{onClick:f,isHide:a=>"wx_account"===a.sender_type,title:"编辑"},{title:"测试",render:a=>S("div",{class:"item-center inline-flex"},[S("span",{class:"bt-link",onClick:async()=>{a.load||(a.load=!0,await(async a=>{try{await s({loading:"正在测试，请稍后...",request:g({sender_id:a.id}),success:a=>{r(a.data.data)&&!a.status?n().error("".concat(a.msg,"【").concat(a.data.data,"】")):n().request(a)}})}catch(e){}})(a),a.load=!1)}},[a.load?"测试中":"测试"]),S(B,{class:"mt-[4px]"},null)])},{onClick:a=>(async(a,e)=>{try{await w({title:"解绑【".concat(a.data.title,"】").concat(e),content:"您真的要解绑".concat(e,"【").concat(a.data.title,"】吗？")});const t={sender_id:a.id},r="wx_account"===a.sender_type;await s({loading:"正在解绑，请稍后...",message:!0,request:r?_(t):y(t),success:a=>{a.status&&(j(),l.value=!0)}})}catch(t){}})(a,e),title:"解绑"}])]})()});return t({onCancel:c.compData.callback}),(e,t)=>{const s=v,l=a;return D(),H(l,{class:"p-[2rem]"},{"header-left":M(()=>[S(s,{type:"primary",onClick:t[0]||(t[0]=a=>f())},{default:M(()=>[...t[1]||(t[1]=[T("添加",-1)])]),_:1})]),content:M(()=>[S(P(k),{"max-height":350})]),_:1})}}});export{ca as default};
