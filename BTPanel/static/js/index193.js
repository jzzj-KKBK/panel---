import{c as e,r as a,U as l,g as s,p as r,q as d,v as o,e as t,A as i,x as u,M as m,C as p,F as n,a_ as _,B as c,Q as v,a9 as b,ai as f,aj as h,a7 as w}from"./base-lib.js?v=1756369731";import{w as g,K as V,M as j,j as x,c as y,e as U}from"./utils-lib.js?v=1756369731";import{_ as k}from"./index101.js?v=1756369731";import{addModulesDatabase as q}from"./database.js?v=1756369731";import{a as C,m as A}from"./useMethod4.js?v=1756369731";import{g as M}from"./useStore2.js?v=1756369731";import{_ as I}from"./index.vue_vue_type_script_setup_true_lang9.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./validator.js?v=1756369731";const S={class:"p-[24px]"},D=U(e({__name:"index",props:{compData:{default:()=>({options:[]})}},setup(e,{expose:U}){const{refs:{tabActive:D},refreshTableList:F}=M(),B=e,E=a(),H=l(!1),K=a([]),L=a({name:"",db_user:"",password:g(16),ps:"",sid:0,listen_ip:"0.0.0.0/0",host:""}),Q={name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]}],db_user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]},R=s(()=>{var e;return(null==(e=K.value.find(e=>e.id===L.value.sid))?void 0:e.db_host)||""}),T=e=>{L.value.db_user=L.value.name,L.value.ps=L.value.name},z=async()=>{try{H.value=!0;const{status:e,msg:a,err_msg:l}=await A(L.value.sid);if(!e)throw j.error(l||a),new Error(l||a);H.value=!1}catch(e){}};return r(async()=>{var e,a;K.value=await(null==(e=B.compData)?void 0:e.refresh()),L.value.sid=null==(a=K.value[0])?void 0:a.id}),U({onConfirm:async e=>{await E.value.validate(),H.value=!0,await z();let a={...L.value,sid:String(L.value.sid)};a.listen_ip="ip"===a.listen_ip?a.host:a.listen_ip,await V({loading:"正在添加数据库,请稍后...",request:q(a,D.value),message:!0}),F(),e()}}),(e,a)=>{const l=x,s=b,r=k,V=f,j=h,U=y,q=w;return d(),o("div",S,[t(q,{disabled:u(H),model:u(L),ref_key:"addFormRef",ref:E,rules:Q,onSubmit:a[7]||(a[7]=v(()=>{},["prevent"]))},{default:i(()=>[t(s,{label:"数据库名",prop:"name"},{default:i(()=>[t(l,{width:"38rem",ref:"data_name",placeholder:"新的数据库名称",modelValue:u(L).name,"onUpdate:modelValue":a[0]||(a[0]=e=>u(L).name=e),onInput:T},null,8,["modelValue"])]),_:1}),t(s,{label:"用户名",prop:"db_user"},{default:i(()=>[t(l,{width:"38rem",placeholder:"数据库用户",modelValue:u(L).db_user,"onUpdate:modelValue":a[1]||(a[1]=e=>u(L).db_user=e)},null,8,["modelValue"])]),_:1}),t(s,{label:"密码",prop:"password"},{default:i(()=>[t(r,{width:"38rem",icon:"el-refresh",modelValue:u(L).password,"onUpdate:modelValue":a[2]||(a[2]=e=>u(L).password=e),modelModifiers:{sync:!0},onIconClick:a[3]||(a[3]=()=>u(L).password=u(g)(16)),isActive:!0},null,8,["modelValue"])]),_:1}),t(s,{label:"访问权限",prop:"dataAccess"},{default:i(()=>[t(j,{class:"!w-[38rem]",modelValue:u(L).listen_ip,"onUpdate:modelValue":a[4]||(a[4]=e=>u(L).listen_ip=e)},{default:i(()=>[t(V,{label:"所有人",value:"0.0.0.0/0"}),t(V,{label:"本地服务器",value:"127.0.0.1/32"}),t(V,{label:"指定ip",value:"ip"})]),_:1},8,["modelValue"]),t(s,{prop:"host"},{default:i(()=>["ip"===u(L).listen_ip?(d(),m(l,{key:0,placeholder:"填写格式如：192.168.69.11/24",modelValue:u(L).host,"onUpdate:modelValue":a[5]||(a[5]=e=>u(L).host=e),width:"38rem",class:"mt-8px w-full"},null,8,["modelValue"])):p("",!0)]),_:1})]),_:1}),t(s,{label:"添加至",prop:"sid",class:"!mb-0"},{default:i(()=>[t(j,{class:"!w-[24rem]",modelValue:u(L).sid,"onUpdate:modelValue":a[6]||(a[6]=e=>u(L).sid=e)},{default:i(()=>[(d(!0),o(n,null,_(u(K),(e,a)=>(d(),m(V,{key:a,label:e.ps+(e.db_host?"（"+e.db_host+"）":""),value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(U,{class:"ml-[8px]",onClick:u(C)},{default:i(()=>[...a[8]||(a[8]=[c(" 管理远程数据库 ",-1)])]),_:1},8,["onClick"])]),_:1}),t(s,{label:" ",class:"!mb-0"},{default:i(()=>[t(I,{server:{sid:u(L).sid,ip:u(R)}},null,8,["server"])]),_:1})]),_:1},8,["disabled","model"])])}}}),[["__scopeId","data-v-1c688efe"]]);export{D as default};
