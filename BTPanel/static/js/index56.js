import{_ as t}from"./index103.js?v=1756369731";import{_ as a}from"./index112.js?v=1756369731";import{L as e,_ as o,dG as n,v as s,bm as l,c as i,dH as r,dI as c,M as _,dJ as m,dK as d,a3 as u,N as p,aj as h,l as v,dL as g,r as f,o as w,dM as y,K as E,dN as b,dO as x,dP as D,dQ as P,dR as C,k as L}from"./utils-lib.js?v=1756369731";import{j as O,k as I,e as A,ax as R,m as k,bK as S,B as T,r as j,s as V,c as M,x as q,q as N,M as z,A as B,C as G,D as F,aW as H,G as K,v as U,H as J}from"./base-lib.js?v=1756369731";import{a as Q,b as W,g as $}from"./useMethod7.js?v=1756369731";import{u as X}from"./column.js?v=1756369731";import{o as Y}from"./validator.js?v=1756369731";import{m as Z}from"./useMethod9.js?v=1756369731";import{_ as tt}from"./header-nav-tools.vue_vue_type_script_setup_true_lang.js?v=1756369731";const at=O("MAIL_DOMAIN",()=>{const t=I({p:1,size:10}),a=Q("添加域名",{isEdit:!1,onRefresh:async()=>{const{getList:t}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);t()}}),r=Q("DNS 记录",{onRefresh:async()=>{const{getList:t}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);t()}}),c=Q("添加SSL",{onRefresh:async()=>{const{getList:t}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);t()}}),_=Q("捕捉电子邮件",{onRefresh:async()=>{const{getList:t}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);t()}}),{table:m,columns:d}=W([{prop:"domain",label:"域名",showOverflowTooltip:!0},{prop:"domain",width:160,label:"封锁名单检查",render:t=>{const{blacklisted:a}=t.domain_black_count,s=a?"el-circle-close-filled":"el-circle-check-filled",l=a?"#E85445":"#20a53a";return A(S,{class:"flex items-center cursor-pointer",size:5},{default:()=>[A("span",{class:"flex items-center",title:"查看",onClick:()=>(async t=>{if(!t||0===Object.keys(t).length)return;const{onShowCheck:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)})(t.domain_black_count)},[A(o,{class:"mr-[2px]",icon:s,size:18,color:l},null),t.domain_black_count&&t.domain_black_count.time&&A("span",null,[n(t.domain_black_count.time)])]),A(R,{trigger:"hover",content:"立即检查","popper-class":"!min-w-0 !w-[80px] text-center"},{reference:()=>A(o,k({"aria-hidden":!1,class:"mr-[2px]",icon:"el-search",size:18,color:"#20a53a"},{onClick:()=>(async t=>{const{onCheck:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)})(t.a_record)}),null)}),A(R,{trigger:"hover",content:"日志","popper-class":"!min-w-0 !w-[55px] text-center"},{reference:()=>A(o,k({"aria-hidden":!1,icon:"icon-ftp-log",size:18},{onClick:()=>(async t=>{const{onShowCheckLog:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)})(t.domain_check_log)}),null)})]})}},{prop:"quota",label:"域名配额",render:t=>s(t.quota)},{prop:"mailboxes",label:"最大邮箱数量"},{prop:"domain",label:"邮件捕获",render:t=>A(l,{size:"small",modelValue:t.catch_all,"onUpdate:modelValue":a=>t.catch_all=a,onChange:async a=>{if(a){const{onOpenCatch:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}else{const{onCloseCatch:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}}},null)},{prop:"dns_id",label:"DNS",render:t=>A("div",{class:"flex items-center"},[(null==t?void 0:t.dns_name)?A("span",null,[t.dns_name]):A("span",{class:""},[T("--")])])},{prop:"ip_tag",label:"多IP设置",width:240,render:t=>{const a=t.ip_tag.find(t=>!0===t.status);return A("div",null,[a?A("div",{class:"flex items-center"},[A(R,{placement:"top",trigger:"hover",content:a.tag,"popper-class":"!min-w-0 !w-[200px] text-center"},{reference:()=>A("span",{class:"text-[#777]"},[a.tag]),default:()=>A("div",null,[A("span",null,[T("IP: "),a.ip])])}),t.ip_rotate&&A("span",{onClick:()=>{(async t=>{const{onShowIpRotate:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)})(t)},class:"\n\t\t\t\t\t\t\t\t\t\t\tml-3 px-2 py-0.5 \n\t\t\t\t\t\t\t\t\t\t\trounded-full text-[12px]\n\t\t\t\t\t\t\t\t\t\t\ttransition-all duration-300 ease-in-out\n\t\t\t\t\t\t\t\t\t\t\tcursor-pointer\n\t\t\t\t\t\t\t\t\t\t\tflex items-center gap-1\n\t\t\t\t\t\t\t\t\t\t\thover:opacity-80\n\t\t\t\t\t\t\t\t\t\t\t".concat(t.ip_rotate.status?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500")},[A(o,{icon:t.ip_rotate.status?"el-refresh":"el-close",class:t.ip_rotate.status?"animate-spin ![animation-iteration-count:2] !text-[#20a53a]":""},null),t.ip_rotate.status?"定时轮换":"未开启轮换"])]):A("span",{class:""},[T("--")])])}},{prop:"domain",label:"SSL",render:t=>A(i,{type:t.ssl_status?"primary":"warning",onClick:async()=>{const{onShowSSL:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}},{default:()=>[t.ssl_status?"到期时间: ".concat(t.ssl_info.notAfter):"未设置"]})},X([{title:"一键解析",isHide:t=>t.mx_status&&t.a_status&&t.spf_status&&t.dkim_status&&t.dmarc_status||!t.dns_id,onClick:async t=>{const{onParseAll:a,getList:o}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t.domain,t.mx_record,(t,a)=>{t.status&&(o(),Y(a,{title:"一键解析"}))})}},{title:"DNS记录",onClick:async t=>{const{onShowDNS:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}},{title:"编辑",onClick:async t=>{const{onShowEdit:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}},{title:"删除",onClick:async t=>{const{onDel:a}=await e(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url);a(t)}}],{width:250,fixed:"right",label:"操作"})]);return{search:t,table:m,columns:d,formModal:a,dnsModal:r,sslModal:c,catchModal:_}}),et=O("MAIL_DOMAIN_ADD",()=>{const t=j(null),a=j({}),e=I({domain:"",a_record:"",quota:5,quota_unit:"GB",mailboxes:50,email:"",dns_id:null,auto_create_record:1,catch_type:"none",ip_tag:[]}),o=()=>{let t={domain:e.domain,a_record:e.a_record,quota:e.quota+" "+e.quota_unit,mailboxes:e.mailboxes,email:e.email,dns_id:e.dns_id,catch_type:e.catch_type,ip_tag:e.ip_tag};return e.dns_id&&(t.auto_create_record=e.auto_create_record),t},n=()=>{Object.assign(e,{domain:"",a_record:"",quota:5,quota_unit:"GB",mailboxes:50,email:"",dns_id:null,auto_create_record:1,ip_tag:"",catch_type:"none"})};return{form:e,formRef:t,unitOptions:[{label:"GB",value:"GB"},{label:"MB",value:"MB"}],rules:{domain:[{trigger:["blur","input"],validator:(t,a,e)=>{if(!a||""===a.trim())return e(new Error("收件箱域名不能为空!"));e()}}],mailboxes:[{trigger:["blur","input"],validator:(t,a,e)=>{/^[1-9]\d*$/.test(a)?e():e(new Error("请输入大于0的正整数")),e()}}]},onConfirm:async()=>{var e;let s;await(null==(e=t.value)?void 0:e.validate());const{isEdit:l}=a.value;s=l?await r(o()):await c(o());const{data:i}=s;if(_.request(i),!i.status)return!1;a.value.onRefresh&&a.value.onRefresh(),n()},initForm:t=>{a.value=t,n();const{isEdit:o,row:l}=t;if(o&&l){e.domain=l.domain,e.a_record=l.a_record;const t=s(l.quota);e.quota=$(t.split(" ")[0]),e.quota_unit=t.split(" ")[1],e.mailboxes=l.mailboxes,e.email=l.email,e.ip_tag=l.ip_tag.map(t=>t.tag)||[],e.catch_type=l.catch_type,l.dns_id&&(e.dns_id=l.dns_id,e.auto_create_record=1)}},propsData:a}}),ot=O("MAIL_DOMAIN_CATCH",()=>{const t=I({email:"",catch_type:"none"}),a=j(null),e=j({});return{form:t,init:t=>{e.value=t},rules:{email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]},formRef:a,onConfirm:async()=>{var o;await(null==(o=a.value)?void 0:o.validate());const{row:n,onRefresh:s}=e.value,{data:l}=await m({domain:n.domain,email:t.email,catch_type:t.catch_type});if(_.request(l),!l.status)return!1;s&&s()}}}),nt=at(),{search:st,table:lt,formModal:it,dnsModal:rt,sslModal:ct,catchModal:_t}=V(nt),{onConfirm:mt}=et(),{onConfirm:dt}=ot(),ut=async()=>{try{lt.value.loading=!0;const{data:t}=await d(st.value);u(t)&&(lt.value.data=p(t.data)?t.data:[],lt.value.total=h(t.page))}finally{lt.value.loading=!1}},pt=()=>{it.value.data.isEdit=!1,it.value.title="添加域名",v({title:it.value.title,area:54,showFooter:!0,component:()=>e(()=>import("./index328.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:it.value.data,onConfirm:mt})},ht=async()=>{try{lt.value.loading=!0,await g({domain:"all"}),st.value.p=1,ut()}finally{lt.value.loading=!1}},vt=async(t,a,e)=>{let o=_.load("解析中...");try{let o=[];const{data:n}=await x({domain:t,a_record:a});n.data.forEach(t=>{o.push({name:t.name,status:t.status,msg:t.msg})}),null==e||e(n,o)}catch(n){}finally{o.close()}},gt=j([]),ft=async()=>{const{data:{data:t}}=await D();gt.value=t.map(t=>({label:t.tag,value:t.tag,ip:t.ip}))},wt=()=>{Z.value="ip",f.push("/mail/setting")},yt=Object.freeze(Object.defineProperty({__proto__:null,addIpTag:wt,getIpTagOptions:ft,getList:ut,ipTagOptions:gt,onCheck:async t=>{E({request:b({a_record:t}),loading:"检查中...",message:!0,success:()=>{ut()}})},onCloseCatch:async t=>{await w({title:"捕获电子邮件",content:"确认关闭捕获功能?",onCancel:()=>{t.catch_all=!t.catch_all}});const{data:a}=await m({domain:t.domain,email:""});_.request(a),ut()},onDel:async t=>{await w({title:"删除域名",content:"是否删除【".concat(t.domain,"】域名"),onConfirm:async()=>{const{data:a}=await y({domain:t.domain});_.request(a),ut()}})},onOpenCatch:t=>{_t.value.data.row=t,v({title:_t.value.title,area:46,component:()=>e(()=>import("./index329.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:_t.value.data,showFooter:!0,onConfirm:dt,onCancel:()=>{t.catch_all=!t.catch_all}})},onParseAll:vt,onRefresh:ht,onShowAdd:pt,onShowCheck:t=>{v({title:"黑名单检查",area:65,compData:{row:t},component:()=>e(()=>import("./index332.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},onShowCheckLog:t=>{v({title:"黑名单检查日志",area:65,component:()=>e(()=>import("./index333.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{log:t}})},onShowDNS:async t=>{rt.value.data.row=t,rt.value.title="DNS记录 【".concat(t.domain,"】"),v({title:rt.value.title,area:75,component:()=>e(()=>import("./index331.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:rt.value.data})},onShowEdit:t=>{it.value.data.row=t,it.value.data.isEdit=!0,it.value.title="编辑域名 【".concat(t.domain,"】"),v({title:it.value.title,area:54,showFooter:!0,component:()=>e(()=>import("./index328.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:it.value.data,onConfirm:mt})},onShowIpRotate:t=>{v({title:"设置IP轮换 【".concat(t.domain,"】"),area:47,component:()=>e(()=>import("./index334.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{row:t},btn:!0})},onShowSSL:t=>{ct.value.data.row=t,v({title:ct.value.title,area:65,component:()=>e(()=>import("./index330.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:ct.value.data})}},Symbol.toStringTag,{value:"Module"})),Et=M({__name:"index",setup(t){const a=j(),e=j(0),o=async t=>{E({loading:"正在处理...",message:!0,request:P({operation:t}),success:()=>n()})},n=async()=>{const{data:t}=await C();u(t)&&(a.value=t.status,e.value=t.count)};return n(),(t,n)=>{const s=F,l=H;return 0===q(a)&&q(e)?(N(),z(l,{key:0,type:"warning",class:"!mb-[16px]",closable:!1},{default:B(()=>[n[4]||(n[4]=T(" 宝塔面板发现您的域名已进入邮件垃圾邮件列表 ",-1)),A(s,{type:"primary",class:"ml-16px",onClick:n[0]||(n[0]=t=>o(1))},{default:B(()=>[...n[2]||(n[2]=[T(" 我已处理 ",-1)])]),_:1}),A(s,{link:"",type:"primary",onClick:n[1]||(n[1]=t=>o(-1))},{default:B(()=>[...n[3]||(n[3]=[T(" 忽略 ",-1)])]),_:1})]),_:1})):G("",!0)}}}),bt=M({__name:"index",setup(e){const{search:o,table:n,columns:s}=V(at());return ut(),(e,l)=>{const i=F,r=L,c=a,_=t,m=K("bt-loading");return N(),U("div",null,[A(Et),A(_,null,{"header-left":B(()=>[A(i,{type:"primary",onClick:q(pt)},{default:B(()=>[...l[2]||(l[2]=[T("添加域名",-1)])]),_:1},8,["onClick"]),A(tt,{class:"ml-16px"})]),"header-right":B(()=>[A(i,{onClick:q(ht)},{default:B(()=>[...l[3]||(l[3]=[T("刷新域名记录",-1)])]),_:1},8,["onClick"])]),content:B(()=>[J(A(r,{data:q(n).data,column:q(s)},null,8,["data","column"]),[[m,q(n).loading]])]),"footer-right":B(()=>[A(c,{page:q(o).p,"onUpdate:page":l[0]||(l[0]=t=>q(o).p=t),row:q(o).size,"onUpdate:row":l[1]||(l[1]=t=>q(o).size=t),total:q(n).total,onChange:q(ut)},null,8,["page","row","total","onChange"])]),_:1})])}}}),xt=Object.freeze(Object.defineProperty({__proto__:null,default:bt},Symbol.toStringTag,{value:"Module"}));export{et as M,wt as a,ot as b,ut as c,xt as d,ft as g,gt as i,vt as o};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
