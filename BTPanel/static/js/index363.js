import{_ as a}from"./index103.js?v=1756369731";import{c as e,r as t,p as l,G as s,q as r,v as n,e as i,A as o,B as d,H as p,x as u,y as c,P as m,F as b,a_ as v,M as f,z as _,D as w,bN as y,bM as h}from"./base-lib.js?v=1756369731";import{K as k,a5 as x,R as g,ai as j,v as C,k as V,h as H,b as q,o as A,e as D}from"./utils-lib.js?v=1756369731";import{_ as I}from"./index116.js?v=1756369731";import{u as M}from"./column.js?v=1756369731";import{getPM2Monit as N,getPM2Logs as O,setPM2Status as S}from"./site.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const U={class:"p-2rem"},z={class:"p-2rem"},B={class:"p-2rem w-full relative"},F=["title"],G=D(e({__name:"index",setup(e){const D=q(),G=t([]),J=t(!1),K=t(!1),P=t(""),R=t(!1),E=t({}),L=t({}),Q=t(""),T=t(!1),W=async(a=!1)=>{const e=await k({loading:J,request:N(),data:{data:[Array,a=>a.map(a=>{var e;return a.id=null!=(e=a.id)?e:a.name+"(集群)",a})]}});G.value=e.data,a&&D.success("刷新成功")},X=async(a,e)=>{try{R.value=!0;let t={mode:a.mode,log_type:e};x(a.id)?t.id=a.id:t.name=a.name;const{data:l}=await O(t);P.value=l.data}catch(t){}finally{R.value=!1}},Y=async(a,e=!1)=>{let t="online"===a.status?"stop":"start",l=e?"重启":"stop"===t?"停止":"启动";await A({title:"修改集群状态",content:"即将".concat(l,"集群，是否继续？")});let s={mode:a.mode,status:e?"restart":t,name:a.name};x(a.id)?s.id=a.id:s.name=a.name;(await k({loading:"正在".concat(l,"集群，请稍后..."),request:S(s)})).status&&W()},Z=(a,e)=>{P.value="",K.value=!0,E.value=a,Q.value=e,X(a,e)},$=[{label:"ID",prop:"id",width:100},{label:"服务名称",prop:"name",width:110,render:a=>a.data?a.name:i("span",{class:"text-primary cursor-pointer",onClick:()=>(a=>{E.value=a,L.value=a.pm2_env,T.value=!0})(a)},[a.name])},{label:"pid",prop:"pid",render:a=>{var e;return null!=(e=a.pid)?e:"--"}},{label:"运行用户",prop:"user",width:75},{label:"重启次数",prop:"restart",width:75,render:a=>a.restart||"--"},{label:"创建时间",prop:"addtime",width:150,render:a=>g(a.uptime)},{label:"cpu使用率",prop:"cpu",render:a=>j(a.cpu)?a.cpu+"%":"--"},{label:"内存占用",prop:"memory",render:a=>void 0!==a.memory?C(a.memory):"--"},{label:"日志",prop:"log",width:120,render:a=>i("div",null,[i("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"all")},[d("全部/")]),i("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"err")},[d("错误/")]),i("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"out")},[d("运行")])])},{label:"自动重载",width:75,prop:"auto_restart",render:a=>a.data?"--":a.auto_restart?"是":"否"},{label:"状态",prop:"status",render:a=>{let e="online"===a.status;return i("span",{class:"text-".concat(e?"primary":"danger")},[e?"运行中":"已停止"])}},M([{onClick:a=>Y(a),isHide:a=>!("online"===a.status),title:"停止",width:26},{onClick:a=>Y(a),isHide:a=>"online"===a.status,title:"启动",width:26},{onClick:a=>Y(a,!0),title:"重启",width:26}])];return l(()=>{W()}),(e,t)=>{const l=w,k=V,x=I,g=H,j=y,C=h,q=a,A=s("bt-loading");return r(),n("div",U,[i(q,null,{"header-left":o(()=>[i(l,{onClick:t[0]||(t[0]=a=>W(!0)),type:"default"},{default:o(()=>[...t[4]||(t[4]=[d("刷新数据",-1)])]),_:1})]),content:o(()=>[p(i(k,{column:u($),data:u(G),"row-key":"id","max-height":500,"tree-props":{children:"data"}},null,8,["column","data"]),[[A,u(J)]])]),"footer-left":o(()=>[...t[5]||(t[5]=[c("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-20px"},[c("li",null,"如果pm2项目无法加载监控信息，可修改node命令行版本号再试")],-1)])]),popup:o(()=>[i(g,{title:"日志展示",modelValue:u(K),"onUpdate:modelValue":t[2]||(t[2]=a=>m(K)?K.value=a:null),area:[60]},{default:o(()=>[c("div",z,[i(l,{loading:u(R),type:"primary",onClick:t[1]||(t[1]=a=>X(u(E),u(Q)))},{default:o(()=>[...t[6]||(t[6]=[d("刷新日志",-1)])]),_:1},8,["loading"]),p(i(x,{title:"全屏查看日志",class:"h-[40rem] mt-12px",content:u(P)},null,8,["content"]),[[A,u(R)]])])]),_:1},8,["modelValue"]),i(g,{title:"详情展示【".concat(u(E).name,"】"),modelValue:u(T),"onUpdate:modelValue":t[3]||(t[3]=a=>m(T)?T.value=a:null),area:70},{default:o(()=>[c("div",B,[i(C,{column:1,border:"",class:"max-h-[46rem] w-full overflow-auto table-descriptions"},{default:o(()=>[(r(!0),n(b,null,v(Object.entries(u(L)),(a,e)=>(r(),f(j,{key:e},{label:o(()=>[d(_(a[0]),1)]),default:o(()=>[c("span",{title:String(JSON.stringify(a[1])),class:"w-340px truncate inline-block"},_(a[1]),9,F)]),_:2},1024))),128))]),_:1})])]),_:1},8,["title","modelValue"])]),_:1})])}}}),[["__scopeId","data-v-ff66eccd"]]);export{G as default};
