import{u as e,l as a,L as l,M as t,it as s,at as r,aA as n,iu as i,ck as o,al as c,c as u,e as v}from"./utils-lib.js?v=1756369731";import{j as m,aE as p,t as d,r as g,k as f,e as _,B as h,c as w,s as y,F as b,bs as S,a4 as x,q as I,v as T,x as k,P as D,A as E,y as A,aQ as O}from"./base-lib.js?v=1756369731";import{j,p as M}from"./validator.js?v=1756369731";import{f as P,h as V,j as R,l as C,m as J,n as N,o as F,p as L,q as z}from"./store5.js?v=1756369731";const q=m("HOME-SECURITY-RISKS-STORE",()=>{p();const{payment:c}=e(),{authType:u}=d(c.value),v=g(""),m=g(""),w=g("正在扫描中，请耐心等待..."),y=g(!1),b=g(!1),S=g(""),x=g(!1),I=g(!1),T=g(!1),k=g(!1),D=g(),E=g(!0),A=g(!1),O=g("primary"),q=g(100),H=g("!text-[#20a53A]"),B=g("safe"),G=g(),K=g("当前服务器未进行安全扫描，可能存在风险"),Q=g(""),Y=g(),U=g([]),X=g([]),$=g([]),Z=g(!0),W=g([]),ee=g([]),ae=g(!0),le=g(!1),te=g(!0),se=g({autoIntercept:!1,ossConfig:{status:!1,isHasMounts:!1},exclude_dirs:[],monitor_dirs:[]}),re=f({progress:1,repairProgress:!1,repairText:"修复中.."}),ne=f({processPercentage:0,processColor:"#20a53a"}),ie={risk:{type:"danger",label:"风险项",list:[]},security:{type:"primary",label:"无风险项",list:[]},ignore:{type:"warning",label:"已忽略项",list:[]}},oe=f({cannot_automatically:0,failed:0,success:0}),ce=g(0),ue=g([{label:"风险项",prop:"m_name",width:150,render:e=>_("span",null,[e.m_name])},{label:"修复内容",prop:"msg",width:150},{label:"相关信息",prop:"type",align:"center",render:e=>Array.isArray(e.type)&&e.type.length>0?_("span",{class:"h-[3.2rem] inline-block whitespace-pre-wrap"},[e.type.join("，")]):"无"},{label:"操作结果",align:"right",render:e=>e.status?_("span",{class:"text-[#20a53a]"},[h("修复成功")]):_("span",{class:"text-[red]"},[h("修复失败")])}]),ve=f({1:{text:"低危",bg:"rgba(232, 213, 68, 0.1)",color:"#D4BB00"},2:{text:"中危",bg:"rgba(240, 173, 78, 0.14)",color:"#f0ad4e"},3:{text:"高危",bg:"rgba(239, 8, 8, 0.1)",color:"#EF0808"}}),me=g("overview"),pe=f({risk:0,malware:0,web:0,baseline:0}),de=async()=>{const{data:e}=await R(),a=e.data;se.value.autoIntercept=a.auto_intercept,se.value.ossConfig.status=a.scan_oss,se.value.ossConfig.isHasMounts=a.has_oss_mounts,se.value.exclude_dirs=ge(a.exclude_dirs),se.value.monitor_dirs=ge(a.monitor_dirs)},ge=e=>e&&Array.isArray(e)?e.map(e=>({name:e})):[],fe=()=>{q.value>=80&&q.value<=99?(H.value="!text-[#E8D544]",B.value="risk",ne.processColor="#E8D544"):q.value>=60&&q.value<=79?(H.value="!text-[#F0AD4E]",ne.processColor="#F0AD4E",B.value="warn"):q.value<60&&(H.value="!text-[#EF0808]",ne.processColor="#EF0808",B.value="danger")},_e=e=>{$.value=e.is_autofix,te.value=!1,localStorage.setItem("isAutoFix",JSON.stringify($.value));for(const a in ie){const l=e[a];if(Array.isArray(l)){for(let e=0;e<l.length;e++){const t=ie[a].list.find(a=>a.m_name==l[e].m_name);l[e].show=(null==t?void 0:t.show)||!1,l[e].selection=(null==t?void 0:t.selection)||!1}Object.keys(ie).includes(a)&&"risk"==a&&(X.value=[...X.value,...l]),ie[a].list=l}}S.value=e.check_time,O.value="primary",x.value=!0,A.value=!0,we(!0),D.value=" !animate-none",localStorage.setItem("scanData",JSON.stringify(X.value)),localStorage.setItem("ignoreData",JSON.stringify(ie.ignore.list)),n("lastScanTime",S.value)},he=async(e=!1)=>{y.value=!0,w.value="正在扫描中，请稍等...";try{const a={};e&&(a.force=1);const{data:l}=await z(a);X.value=[],l.interrupt||(X.value=[],_e(l),q.value=l.score,ce.value=X.value.length,K.value="已完成安全扫描，",ee.value=l.ignore)}catch(a){}y.value=!1},we=e=>{let a=!1;W.value=[],X.value.forEach(e=>{$.value.includes(e.m_name)?(e.selection=!0,W.value.push(e),a=!0):e.selection=!1}),a&&e?(Z.value=!1,b.value=W.value.every(e=>1==e.selection)):a&&!e&&(b.value||(W.value=[],X.value.forEach(e=>{$.value.includes(e.m_name)&&(e.selection=!1)})))},ye=async e=>{Y.value=[],I.value=!0,oe.cannot_automatically=e.cannot_automatically.length,oe.failed=e.failed.length,oe.success=e.success.length,U.value=[];for(const a in e)for(const l of e[a])U.value.push({m_name:l.m_name,type:l.result.type,msg:l.result.msg,status:l.result.status,name:a});Y.value=U.value,y.value=!1,X.value=X.value.filter(a=>!e.success.some(e=>e.m_name===a.m_name)),ce.value=X.value.length,localStorage.setItem("scanData",JSON.stringify(X.value))},be=()=>{M({sourceId:68})};return{showAnimation:k,scanScore:q,scanTextClass:H,scanOuterClass:B,animateFlag:D,scanPreText:K,riskNum:ce,scanButtonType:O,repairAutoRiskButton:x,cookieRepair:E,scanItemText:Q,processData:ne,lastScanTime:S,scanSelectShow:A,allSelect:b,allSelectionDis:Z,isFirst:te,isIgnoreAll:le,ignoreData:ee,emptyDetail:T,loading:y,loadingText:w,isShow:ae,activeMent:v,activeMentIgnore:m,is_autofix:$,levelData:ve,allData:X,repairData:re,resultConfirm:I,resultItemLength:oe,resultTable:Y,resultColumn:ue,handleIgnore:async(e,a)=>{try{y.value=!0,w.value="正在忽略风险项,请耐心等候...";const{data:l}=await i({m_name:e.m_name});t.request(l),l.status&&(a?ee.value=ee.value.filter(a=>a.m_name!==e.m_name):X.value=X.value.filter(a=>a.m_name!==e.m_name),he(!0))}catch(l){}finally{y.value=!1}},scanningProcess:async()=>{if(ae.value=!1,T.value=!1,q.value=100,B.value="safe",H.value="!text-[#20a53A]","info"==O.value){clearInterval(G.value),await J();const e=await N();_e(e.data),q.value="?",H.value="!text-[#EF0808]",B.value="danger",y.value=!1,ce.value=e.data.risk.length,K.value="扫描中断，"}else{ne.processPercentage=0,k.value=!0,K.value="正在进行安全扫描...",ce.value=0,Q.value="正在检测...",D.value="",O.value="info",E.value=!0,x.value=!1,he(!0);try{clearInterval(G.value),G.value=setInterval(async function(){const e=await F();ne.processPercentage=e.data.percentage,ce.value=e.data.count,Q.value=e.data.status,q.value=e.data.score,e.data.count&&"100"!=e.data.percentage&&(H.value="!text-[#EF0808]",B.value="danger",K.value="正在进行安全扫描，"),"100"==e.data.percentage&&clearInterval(G.value),fe()},1e3)}catch(e){}}},handleRepairAutoRisk:()=>{if("ltd"!==u.value)return be();try{let e=X.value.filter(e=>1==e.selection).map(e=>e.m_name);if(0==e.length)return y.value=!1,void t.error("暂无可自动修复的风险项！");y.value=!0,w.value="正在修复中,可能耗时较长,请耐心等候...",re.progress=0;const a=s({data:JSON.stringify({m_name:e})});re.repairProgress=!0;let l=setInterval(async()=>{const{data:e}=await L();if(re.progress=e.percentage,re.repairText=e.status,100===e.percentage){re.repairText="修复完成",re.repairProgress=!1,re.progress=100,clearInterval(l);let e=await a;ye(e.data),he(!0)}},800)}catch(e){r(e)}finally{y.value=!1}},handleDownloadReport:()=>{window.open("/project/security/report/html","_blank","noopener,noreferrer")},changeSelectValue:e=>{e.selection=!e.selection,b.value=W.value.every(e=>1==e.selection)},handelAllSelection:we,handleRepair:async(e,a)=>{if("ltd"!==u.value)return void be();let l=X.value.filter(e=>1==e.selection).map(e=>e.m_name);try{if(!e&&0==l.length)return void t.error("请选择需要修复的风险项！");W.value.length,y.value=!0,w.value="正在修复中,可能耗时较长,请耐心等候...";const{data:r}=await s({data:JSON.stringify({m_name:e?[a.m_name]:l})});e&&r.success.length>0?(t.success("修复成功"),ce.value--,X.value=X.value.filter(e=>e.m_name!==a.m_name),ye(r)):ye(r)}catch(n){r(n)}finally{y.value=!1}},vulnerabilityInvolvesSoftware:e=>{let a=Object.keys(e.soft_name),l="";return a.forEach((t,s)=>{s===a.length-1?l+="".concat(a,":").concat(e.soft_name[t]):l+="".concat(a,":").concat(e.soft_name[t],"\n")}),l},onlineServiceDialog:j,onToggle:(e,a)=>{e.show||a.forEach(e=>e.show=!1),e.show=!e.show},onOpen:()=>{const e=localStorage.getItem("scanData"),a=localStorage.getItem("isAutoFix"),l=localStorage.getItem("ignoreData");a&&($.value=JSON.parse(a)),l&&JSON.parse(l).length&&(ee.value=JSON.parse(l)),e&&JSON.parse(e).length?(X.value=JSON.parse(e).map(e=>({...e,selection:!1})),A.value=!0,x.value=!0,ae.value=!1):(T.value=!0,x.value=!1),E.value=!1,S.value=o("lastScanTime")||""},$reset:()=>{U.value=[],X.value=[],W.value=[],ee.value=[],$.value=[],me.value="overview",pe.risk=0,pe.malware=0,pe.web=0,pe.baseline=0,clearInterval(G.value)},repairTypeActive:me,tootipTotal:pe,getScanTotal:async()=>{const{data:e}=await P(),{vulnerability:a,malware:l,security:t,baseline:s}=e.data;if(pe.malware=l,pe.risk=t,pe.web=a,pe.baseline=s,te.value&&pe.risk){K.value="已检测到<span class='text-danger'>".concat(pe.risk,"</span>个风险,请及时修复");const{data:e}=await V();X.value=e.risk,S.value=e.check_time,A.value=!0,x.value=!0,ae.value=!1,T.value=!1,k.value=!0,q.value=e.score,fe()}},openPayView:be,getMalwareList:de,convertDataStructure:ge,malwareData:se,malwareAdvanced:async()=>a({isAsync:!0,title:"高级设置",area:[80,54],component:()=>l(()=>import("./index467.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)}),setMalwareConfig:async e=>{const a=await C(e);t.request(a),a.status&&await de()}}}),H={class:"h-full"},B={class:"box-item flex items-center"},G=v(w({__name:"index",setup(e,{expose:a}){const t=q(),{repairTypeActive:s}=y(t),{tootipTotal:r,getScanTotal:n}=t,i=g([{label:()=>_(b,null,[_("img",{class:"overviewLogo".concat("overview"===s.value?"-active":""),alt:"",src:"/static/icons/logo-white.svg"},null)]),name:"overview",render:()=>l(()=>import("./index468.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)},{label:()=>_(b,null,[_(S,{value:r.risk,color:"#ff0000",hidden:0===r.risk},{default:()=>[_("img",{alt:"",src:"/static/images/home/risk".concat("risk"===s.value?"-active":"",".svg")},null)]})]),name:"risk",render:()=>l(()=>import("./risk.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)},{label:()=>_(b,null,[_(S,{value:r.malware,color:"#ff0000",hidden:0===r.malware},{default:()=>[_("img",{alt:"",src:"/static/images/home/ware".concat("malware"===s.value?"-active":"",".svg")},null)]})]),name:"malware",render:()=>l(()=>import("./malware.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)},{label:()=>_(b,null,[_(S,{value:r.web,color:"#ff0000",hidden:0===r.web},{default:()=>[_("img",{alt:"",src:"/static/images/home/web".concat("web"===s.value?"-active":"",".svg")},null)]})]),name:"web",render:()=>l(()=>import("./web.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)},{label:()=>_(b,null,[_(S,{value:r.baseline,color:"#ff0000",hidden:0===r.baseline},{default:()=>[_("img",{alt:"",src:"/static/images/home/safeDetect".concat("safeDetect"===s.value?"-active":"",".svg")},null)]})]),name:"safeDetect",render:()=>l(()=>import("./safeDetect.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)},{label:()=>_("img",{alt:"",src:"/static/images/home/alarm".concat("alarm"===s.value?"-active":"",".svg")},null),name:"alarm",render:()=>l(()=>import("./alarm2.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)}]),o=async e=>{};return n(),x(t.$reset),a({onOpen:t.onOpen}),(e,a)=>{const l=c,t=u,r=O;return I(),T("div",H,[_(l,{class:"h-full scanning-style",type:"left-bg-card",modelValue:k(s),"onUpdate:modelValue":a[0]||(a[0]=e=>D(s)?s.value=e:null),onTabClick:o,options:k(i)},null,8,["modelValue","options"]),_(r,{effect:"dark",content:"点击加入“宝塔云安全中心交流群”",placement:"bottom"},{default:E(()=>[A("div",B,[a[2]||(a[2]=A("span",{class:"w-[1.4rem] h-[1.4rem] mr-1"},[A("svg",{t:"1741419396670",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4968",width:"16",height:"16"},[A("path",{d:"M506.88 139.776c-96.768 0-175.104 78.848-175.104 175.104 0 53.76 24.576 103.936 67.072 137.728l13.824 10.752-16.384 6.656C281.6 515.584 207.872 624.64 207.872 747.52v61.952c0 11.264 9.216 20.48 20.48 20.48h556.544c11.264 0 20.48-9.216 20.48-20.48V747.52c0-122.88-73.728-231.936-188.416-277.504l-16.384-6.656 13.824-10.752c43.008-33.792 67.072-83.968 67.072-137.728 1.024-96.256-77.824-175.104-174.592-175.104z m257.536 608.256v40.96H249.344v-40.96c0-141.824 115.712-257.536 257.536-257.536 142.336 0 257.536 115.712 257.536 257.536zM506.88 449.024c-73.728 0-134.144-59.904-134.144-134.144 0-73.728 59.904-134.144 134.144-134.144 73.728 0 134.144 59.904 134.144 134.144S581.12 449.024 506.88 449.024z",fill:"#888888","p-id":"4969"}),A("path",{d:"M292.352 205.312c-1.536 0-3.072 0-4.608 0.512-65.024 15.872-110.592 73.216-110.592 140.288 0 35.84 13.312 70.144 37.376 96.768l8.704 9.728-11.776 6.144c-78.848 40.96-127.488 121.344-127.488 210.432V716.8c0 11.264 9.216 20.48 20.48 20.48s20.48-9.216 20.48-20.48v-47.616c0-89.6 60.928-167.936 147.968-189.44h1.024c7.168-1.024 13.312-5.632 15.872-11.776v-1.024c0-1.024 0.512-1.536 0.512-2.56l0.512-1.024c0-0.512 0.512-1.024 0.512-1.536V454.656c0-0.512-0.512-1.024-0.512-1.536s-0.512-1.024-1.024-1.536l-0.512-0.512c-1.024-2.048-1.536-3.584-2.56-4.608-0.512 0-0.512-0.512-1.024-0.512-2.048-2.048-4.096-3.584-6.656-4.608-37.376-16.384-61.44-53.76-61.44-94.208 0-47.616 32.256-89.088 78.848-100.352 11.264-2.56 17.92-13.824 15.36-25.088-1.536-10.24-10.24-16.384-19.456-16.384z",fill:"#888888","p-id":"4970"}),A("path",{d:"M320.512 256c8.704-8.192 13.312-19.456 13.312-31.232-5.632 9.728-9.728 20.48-13.312 31.232z",fill:"#888888","p-id":"4971"}),A("path",{d:"M802.304 458.752l-11.776-6.144 8.704-9.728c24.064-26.624 37.376-60.928 37.376-96.768 0-65.024-44.032-122.368-107.008-139.264-10.752-3.072-22.528 3.584-25.6 14.848-3.072 10.752 3.584 22.528 14.848 25.088 45.056 12.288 76.288 52.736 76.288 99.328 0 40.448-24.064 77.312-60.928 94.208-2.56 1.024-4.608 2.56-6.656 4.608l-1.024 1.024c-1.024 1.024-1.536 2.56-2.56 4.608l-0.512 1.024c0 0.512-0.512 1.024-0.512 1.536s-0.512 1.024-0.512 1.024v2.048c-0.512 2.56-0.512 3.584 0 5.12 0 0.512 0 1.024 0.512 1.536v0.512c0.512 1.024 0.512 2.048 0.512 3.072v1.536c2.56 6.144 8.704 10.752 15.872 11.776h1.024c87.04 22.016 147.968 99.84 147.968 189.44V716.8c0 11.264 9.216 20.48 20.48 20.48s20.48-9.216 20.48-20.48v-47.616c0.512-89.088-48.64-169.472-126.976-210.432z",fill:"#888888","p-id":"4972"}),A("path",{d:"M692.224 251.904c-2.56-7.168-5.12-14.336-8.704-20.992 1.024 7.68 4.096 14.848 8.704 20.992z m114.688 198.144z",fill:"#888888","p-id":"4973"})])],-1)),_(t,{href:"https://qm.qq.com/cgi-bin/qm/qr?k=hN4oLX6_LMvjYhtXQZEnTx_c6sGPQ_t3&jump_from=webapi&authKey=zeeFfBmcTI0YGllM0/owNJJrfGm/dd2J0fTjKxVMIeIikJlOeMHz/TsxqjHgO/Hb"},{default:E(()=>[...a[1]||(a[1]=[h("云安全交流群",-1)])]),_:1})])]),_:1})])}}}),[["__scopeId","data-v-42dd32e6"]]),K=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{q as H,K as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
