import{_ as e}from"./index103.js?v=1756369731";import{u as a,fq as t,N as s,fr as l,v as n,fs as i,G as r,ft as o,ai as c,fu as p,fv as d,b as u,bU as m,$ as _,bg as h,ag as x,fw as b,o as k,fx as f,a3 as g,A as v,fy as y,fz as w,fA as C,l as j,fB as T,aM as q,cY as O,fk as B,fC as D,c as V}from"./utils-lib.js?v=1756369731";import{_ as L}from"./we-com.js?v=1756369731";import{_ as A}from"./version-compare.vue_vue_type_script_setup_true_lang.js?v=1756369731";import{s as M,j as Y,r as P,k as W,g as z,c as E,bP as U,p as F,G as H,q as N,v as S,e as G,A as I,x as R,M as $,C as J,H as K,y as Q,z as X,B as Z,w as ee}from"./base-lib.js?v=1756369731";import{u as ae}from"./column.js?v=1756369731";import{u as te}from"./index141.js?v=1756369731";import{e as se}from"./validator.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";import{B as le}from"./index100.js?v=1756369731";import{B as ne}from"./index398.js?v=1756369731";import{b as ie,j as re}from"./form-item.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./index124.js?v=1756369731";const oe=Y("VHOST-ACCOUNT-STORE",()=>{const{payment:e}=a(),r=P(!1),o=W({number:0,limit:0}),c=P({accunt_id:0,username:"",password:"",email:"",expireType:0,package_id:0,mountpoint:"",expire_date:"",remark:""}),p=P({}),d=P(0),u=z(()=>{switch(e.value.authType){case"pro":return o.limit=10,"当前为专业版，可创建子用户为 ".concat(o.number,"/").concat(o.limit);case"ltd":return o.limit=30,"当前为企业版，可创建子用户为 ".concat(o.number,"/").concat(o.limit)}}),m=P([]),_=P(!1),h=P([]),x=P(!1),b=P([]),k=P(!1),f=P({});return{isEdit:r,formData:c,editorForm:p,resetFormData:()=>{c.value={username:"",password:"",email:"",expireType:0,package_id:0,mountpoint:"",expire_date:"",remark:""},r.value=!1},packageOptions:m,packageLoading:_,renderPackageOptions:async()=>{try{_.value=!0;const{data:{list:e}}=await t();if(s(e)){if(r.value){const a=e.find(e=>e.package_id===c.value.package_id);f.value=a}else c.value.package_id=e[0].package_id,f.value=e[0];m.value=e.map(e=>({label:e.package_name+(e.remark?"(".concat(e.remark,")"):""),value:e.package_id,data:e}))}}catch(e){}finally{_.value=!1}},accountTypeLoading:k,renderAccountTypeOptions:async()=>{const{data:e}=await i();if(s(e))return b.value=e.map(e=>({label:e.type_name,value:e.type_id})),e},diskOptions:h,diskLoading:x,renderDiskOptions:async()=>{try{x.value=!0;const{data:e}=await l();if(s(e)){if(r.value){const{mountpoint:a}=e.find(e=>e.mountpoint===c.value.mountpoint);c.value.mountpoint=a}else c.value.mountpoint=e[0].mountpoint;h.value=e.map(e=>({label:"".concat(e.mountpoint,"(").concat(n(e.used),"/").concat(n(e.total),") 配额：").concat(e.is_user_quota?"启用":"未启用"),value:e.mountpoint,data:e}))}}catch(e){}finally{x.value=!1}},selectPackageOptions:f,changePackageEvent:e=>{const a=m.value.find(a=>a.data.package_id===e);f.value=a.data},refreshList:()=>{d.value=(new Date).getTime()},refreshInfo:d,checkedAccountLimit:u,accountAuth:o}}),ce=()=>{const e=oe(),a=M(e);return{...e,...a}},pe={class:"p-[2rem]"},de={class:"custom-table"},ue=["disabled"],me=E({__name:"index",setup(e,{expose:a}){const{isEdit:t,formData:s,packageOptions:l,packageLoading:i,renderPackageOptions:b,changePackageEvent:k,selectPackageOptions:f,diskOptions:g,diskLoading:v,renderDiskOptions:y,refreshList:w,resetFormData:C}=ce(),{request:j,load:T}=u(),q=e=>e.getTime()<Date.now()-864e5,{BtForm:O,submit:B}=r({data:s.value,options:e=>z(()=>[ie("用户名","username",{attrs:{class:"!w-[32rem]",clearable:!0,placeholder:"请输入用户名",disabled:t.value},rules:[{required:!0,message:"用户名不能为空！",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}]}),re("密码","password",{attrs:{class:"!w-[32rem]",placeholder:"请输入密码"},rules:t.value?[]:[{required:!0,clearable:!0,message:"密码不能为空！"},o({complex:{length:6}})]},()=>e.value.password=m(12)),{type:"slots",key:"expire_time"},{type:"slots",key:"package_id"},!t.value&&{type:"slots",key:"mountpoint"},ie("备注","remark",{attrs:{class:"!w-[32rem]",clearable:!0,placeholder:"请输入备注内容，可为空"}})]),submit:async(e,a,s)=>{await a();let l={...e.value,email:"vhost@bt.cn"};0===l.expireType?l.expire_date="0000-00-00":l.expire_date=c(l.expire_date)?l.expire_date:U(l.expire_date,"YYYY-MM-DD"),delete l.expireType;const{max_site_limit:n,disk_space_quota:i,monthly_bandwidth_limit:r,max_email_account:o,max_database:u,php_start_children:m,php_max_children:_}=f.value;l={...l,disk_space_quota:i,monthly_bandwidth_limit:r,max_site_limit:n,max_email_account:o,max_database:u,php_start_children:m,php_max_children:_},t.value?delete l.mountpoint:delete l.account_id;let h=null;const x=T("正在提交表单信息，请稍候...");try{if(h=await(t.value?p(l):d(l)),j(h),!h.status)return!1;C(),w()}catch(b){}finally{x.close()}return h}});return F(()=>{b(),y()}),a({onConfirm:B,onCancel:C}),(e,a)=>{const r=_,o=ne,c=h,p=x,d=le,u=H("bt-loading");return N(),S("div",pe,[G(R(O),null,{expire_time:I(()=>[G(c,{prop:"expire_date",label:"到期时间"},{default:I(()=>[G(r,{modelValue:R(s).expireType,"onUpdate:modelValue":a[0]||(a[0]=e=>R(s).expireType=e),options:[{label:"永久",value:0},{label:"自定义",value:1}]},null,8,["modelValue"]),R(s).expireType?(N(),$(o,{key:0,"disabled-date":q,class:"!w-[15rem] ml-[3.5rem]",modelValue:R(s).expire_date,"onUpdate:modelValue":a[1]||(a[1]=e=>R(s).expire_date=e),type:"date","date-format":"YYYY-MM-DD",placeholder:"选择到期日期"},null,8,["modelValue"])):J("",!0)]),_:1})]),package_id:I(()=>[G(c,{prop:"expire_date",label:"资源包"},{default:I(()=>[K((N(),S("div",null,[G(p,{modelValue:R(s).package_id,"onUpdate:modelValue":a[2]||(a[2]=e=>R(s).package_id=e),options:R(l),placeholder:"请选择资源包",onChange:R(k),clearable:"",class:"!w-[28rem]"},null,8,["modelValue","options","onChange"]),G(d,{trigger:"hover",placement:"right","popper-style":"padding:0",width:"240px"},{reference:I(()=>[...a[4]||(a[4]=[Q("span",{class:"bt-link text-[12px] ml-[15px]"},"详情",-1)])]),default:I(()=>[Q("table",de,[Q("tbody",null,[Q("tr",null,[a[5]||(a[5]=Q("td",null,"资源名称",-1)),Q("td",null,X(R(f).package_name),1)]),Q("tr",null,[a[6]||(a[6]=Q("td",null,"备注",-1)),Q("td",null,X(R(f).remark),1)]),Q("tr",null,[a[7]||(a[7]=Q("td",null,"磁盘配额（MB）",-1)),Q("td",null,X(R(f).disk_space_quota?R(n)(R(f).disk_space_quota,!0,0):"无限制"),1)]),Q("tr",null,[a[8]||(a[8]=Q("td",null,"每月带宽限制（MB）",-1)),Q("td",null,X(R(f).monthly_bandwidth_limit?R(n)(R(f).monthly_bandwidth_limit,!0,0):"无限制"),1)]),Q("tr",null,[a[9]||(a[9]=Q("td",null,"最大网站数",-1)),Q("td",null,X(R(f).max_site_limit?R(f).max_site_limit:"无限制"),1)]),Q("tr",null,[a[10]||(a[10]=Q("td",null,"数据库数量",-1)),Q("td",null,X(R(f).max_database?R(f).max_database:"无限制"),1)]),Q("tr",null,[a[11]||(a[11]=Q("td",null,"启动子进程数量",-1)),Q("td",null,X(R(f).php_start_children),1)]),Q("tr",null,[a[12]||(a[12]=Q("td",null,"最大子进程数量",-1)),Q("td",null,X(R(f).php_max_children),1)])])])]),_:1})])),[[u,R(i)],[u,"small","size"],[u,"horizontal","type"],[u,"获取列表中","title"]])]),_:1})]),mountpoint:I(()=>[G(c,{prop:"expire_date",label:"存储磁盘"},{default:I(()=>[K((N(),S("div",{disabled:R(t)},[G(p,{modelValue:R(s).mountpoint,"onUpdate:modelValue":a[3]||(a[3]=e=>R(s).mountpoint=e),options:R(g),placeholder:"请选择存储磁盘",clearable:"",class:"!w-[28rem]"},null,8,["modelValue","options"])],8,ue)),[[u,R(v)],[u,"small","size"],[u,"horizontal","type"],[u,"获取列表中","title"]])]),_:1})]),_:1})])}}}),{request:_e}=u(),{refreshList:he,accountAuth:xe,isEdit:be,formData:ke}=ce(),fe=(e=!1)=>{if(g(e))be.value=!0,ke.value={account_id:e.account_id,username:e.username,password:"",email:e.email,package_id:e.package_id,expireType:"0000-00-00"!==e.expire_date?1:0,expire_date:"0000-00-00"!==e.expire_date?e.expire_date:"",mountpoint:e.mountpoint,remark:e.remark};else if(xe.value.number>=xe.value.limit)return void _e({type:"warning",content:"当前用户数量已达上限，如需更多用户管理，请联系客服。"});j({title:"".concat(e?"编辑":"添加","用户"),area:"500px",component:me,showFooter:!0})},ge=e=>{k({title:"删除用户".concat(e.username),content:"是否删除该用户".concat(e.username,"，是否继续？"),onConfirm:async()=>{const a=await T({account_id:e.account_id,is_del_resources:!0});_e(a),he()}})},ve=async e=>{const{data:a}=await f({account_id:e.account_id});g(a)&&window.open(a.login_url+"?token="+a.token,"_blank","noopener,noreferrer")},ye=async()=>{try{let e=[];const{data:a}=await i();return s(a)&&(e=[{label:"全部分类",value:"all"},...a.map(e=>({label:e.name,value:Number(e.type_id)}))]),e||[]}catch(e){return[]}},we={class:"ml-[10px] flex items-center h-[30px] font-bold text-[#666]"},Ce=E({__name:"index",setup(t){const{mainHeight:s}=a(),{refreshInfo:l,checkedAccountLimit:i}=ce(),{BtOperation:r}=q({options:[{type:"button",label:"添加用户",active:!0,onClick:()=>fe()}]}),{BtTable:o,BtSearch:c,BtRefresh:d,BtPage:u,BtColumn:m,BtTableCategory:_,refresh:h}=O({request:e=>(async e=>{const a=await b(e);return a.data.list?(xe.value.number=a.data.page.count,{data:a.data.list,total:a.data.page.count}):{data:[],total:0}})({rows:e.limit,search_value:e.search,p:e.p,type_id:e.type_id}),columns:[{label:"用户名",prop:"username",minWidth:100,render:e=>G("span",{class:"text-primary cursor-pointer",onClick:()=>ve(e)},[e.username])},{label:"资源包",prop:"package_name",isCustom:!0,minWidth:100},{label:"磁盘配额",prop:"quota",minWidth:100,isCustom:!0,render:e=>G("span",{class:0===e.disk_space_status?"text-error":""},[0===e.disk_space_used&&0===e.disk_space_quota?"-":n(e.disk_space_used,!0,0),Z(" / "),0===e.disk_space_quota?"无限制":n(e.disk_space_quota,!0,0)])},{label:"带宽",prop:"name",minWidth:100,isCustom:!0,render:e=>G("span",{class:0===e.monthly_bandwidth_status?"text-error":""},[n(e.monthly_bandwidth_used,!0,0),Z(" / "),0===e.monthly_bandwidth_limit?"无限制":n(e.monthly_bandwidth_limit,!0,0)])},{label:"状态",prop:"status",minWidth:60,isCustom:!0,render:e=>{const a=new Map([[-1,"所有"],[0,"停用"],[1,"正常"],[2,"过期"]]);return G("span",{onClick:()=>(async e=>{k({title:"".concat(1===e.status?"停用":"启用","用户").concat(e.username),content:"是否".concat(1===e.status?"停用":"启用","该用户").concat(e.username,"，是否继续？"),onConfirm:async()=>{const a=await p({account_id:e.account_id,status:1===e.status?0:1});_e(a),he()}})})(e),class:"cursor-pointer ".concat(1===e.status||-1===e.status?"text-primary":"text-danger")},[a.get(e.status)])}},{label:"过期时间",prop:"expire_date",minWidth:80,isCustom:!0,render:e=>"0000-00-00"===e.expire_date?"永久":e.expire_date},{label:"备注",prop:"remark",minWidth:200,isCustom:!0,render:e=>e.remark?e.remark:"--"},{label:"登录信息",prop:"info",minWidth:65,isCustom:!0,render:e=>G("span",{class:"text-primary cursor-pointer",onClick:()=>(e=>{const{login_url:a,username:t,init_password:s}=e;v({value:"账号: ".concat(a,"\n用户: ").concat(t,"\n初始密码: ").concat(s)})})(e)},[Z("复制")])},ae([{onClick:ve,title:"登录虚拟主机",width:100},{onClick:e=>fe(e),title:"编辑"},{onClick:ge,title:"删除"}])],extension:[B(),D(),te({key:"type_id",name:"",options:()=>[{label:"全部分类",value:"all"}],event:{get:ye,add:y,update:w,delete:C}})]});return ee(()=>l.value,h),(a,t)=>{const l=V,n=e;return N(),S("div",null,[G(A),G(n,null,{"header-left":I(()=>[G(R(r)),Q("div",we,[Z(X(R(i))+"，更多信息 ",1),G(l,{href:"https://www.bt.cn/new/wechat_customer",class:"mx-[10px]"},{default:I(()=>[...t[1]||(t[1]=[Q("img",{src:L,class:"w-[14px] h-[14px]"},null,-1),Z("联系客服",-1)])]),_:1})]),Q("div",{class:"flex items-center mr-[10px]",onClick:t[0]||(t[0]=e=>R(se)({name:"用户管理",type:35,id:62}))},[...t[2]||(t[2]=[Q("i",{class:"svgtofont-desired text-[1.6rem] mr-[4px]"},null,-1),Q("span",{class:"bt-link"},"需求反馈",-1)])]),G(l,{href:"https://www.bt.cn/bbs/thread-141273-1-1.html",class:"mr-[10px]"},{default:I(()=>[...t[3]||(t[3]=[Z(">> 使用文档",-1)])]),_:1})]),"header-right":I(()=>[G(R(c),{placeholder:"请输入用户名称",class:"!w-[270px] mr-[10px]"}),G(R(d),{class:"mr-[10px]"}),G(R(m))]),content:I(()=>[G(R(o),{"min-height":R(s)},null,8,["min-height"])]),"footer-right":I(()=>[G(R(u))]),_:1})])}}});export{Ce as default};
