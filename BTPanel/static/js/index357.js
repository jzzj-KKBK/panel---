import{bV as e,G as a,l as t,L as l,at as o,o as r,_ as s,H as n,j as p,c as i,h as d,b as c,K as u,aa as m,fg as _,$ as v,W as j,M as f}from"./utils-lib.js?v=1756369731";import{c as h,k as w,r as b,g,ay as y,w as x,p as V,q as k,v as D,e as U,A as C,y as T,x as E,M as S,B as P,C as I,F as O,a_ as M,P as B,H as J,I as A,_ as F,z as L,D as X,a9 as K,aj as R,aQ as z,T as H,ag as q,af as N,ax as W,a7 as G,ai as $,Z as Q,G as Z,K as Y}from"./base-lib.js?v=1756369731";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang13.js?v=1756369731";import{_ as ae}from"./index101.js?v=1756369731";import{addLocalJdk as te,getCommand as le,getSpringbootPort as oe,jarRestartJavaProject as re,checkJavaParams as se,modifyJavaProject as ne,addJavaProject as pe,getJavaInfo as ie,getTomcat as de}from"./site.js?v=1756369731";import{f as ce}from"./validator.js?v=1756369731";import{u as ue,S as me}from"./useStore4.js?v=1756369731";import{i as _e,b as ve,e as je}from"./useController11.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const fe={class:"flex items-center"},he={class:"flex items-center justify-between"},we={class:"flex items-center"},be={class:"flex items-center custom-refresh-select"},ge={class:"el-input-group__append !h-3rem !flex items-center"},ye={class:"flex items-center"},xe={class:"flex items-center"},Ve={class:"flex items-center"},ke={class:"flex items-center"},De={class:"flex items-center"},Ue=["title"],Ce={key:0,class:"mb-[18px] ml-[122px] block text-warning"},Te={class:"py-[1.6rem]"},Ee=h({__name:"spring-boot",props:{projectData:{default:{}}},setup(m,{expose:_}){var v,j,f;const h=m,{siteInfo:Q,isRefreshList:Z}=ue(),Y=w(h.projectData),ie=c(),de=b({project_path:"/www/wwwroot",project_type:3,project_jar:"",project_name:"",port:"",project_jdk:(null==(v=h.projectData.jdk_info[0])?void 0:v.path)||"",project_cmd:"",nohup_log:!0,run_user:"www",auth:!1,project_ps:"",domains:"",jmx_port:"",debug:!1,is_separation:!1,release_firewall:!1,host_url:"http://127.0.0.1",env:"",envPath:"/www",by_process:0,proxy_dir:"/",target_dir:"/",static_dir:""}),me=g(()=>{if(de.value.domains){const e=de.value.domains.split("\n")[0].trim();return"http://".concat(e)}return"http://域名"}),je=b(0),Ee=b(!1),Se=b(""),Pe=b(!1),Ie=b(),Oe=b(!1),Me=w({project_jar:(null==(f=null==(j=Q.value)?void 0:j.project_config)?void 0:f.project_jar)||""}),Be=w({project_jar:[e({message:"请输入项目jar路径"})]}),Je=y("getSystemInfoEvent",e=>{});b("file"),b([{label:".jar",value:"file"},{label:".war",value:"war"}]);const Ae=g(()=>"/"===de.value.proxy_dir?"当前未启用前后端分离,nginx仅代理本地java服务":de.value.proxy_dir.startsWith("/")?"使用".concat(me.value).concat(de.value.proxy_dir,"访问后端接口,以实现前后端分离"):"");x(()=>h.projectData.jdk_info.length,()=>{var e;de&&!_e.value&&(de.value.project_jdk=null==(e=h.projectData.jdk_info[0])?void 0:e.path,de.value.project_jdk&&de.value.project_cmd&&ze(de.value.project_jdk))},{immediate:!0,deep:!0});const{BtForm:Fe,validate:Le,ref:Xe}=a({data:de.value,options:a=>g(()=>[{type:"slots",key:"custom",rules:{project_jdk:[e({message:"请选择项目JDK"})],project_path:[e({message:"请输入项目路径"})],project_jar:[e({message:"请输入项目jar路径"})],project_name:[e({message:"请输入项目名称"})],project_cmd:[e({message:"请输入项目执行命令"})],proxy_dir:[{validator:(e,a,t)=>{if(a&&de.value.static_dir&&"/"===de.value.proxy_dir)return t(new Error("前端资源需使用根路由【/】,请修改合理的后端路由，用于实现前后端分离，如：/api/")),!1;t()},trigger:["blur","change"]}],static_dir:[{validator:(e,a,t)=>{var l;a&&(null==(l=Xe.value)||l.validateField("proxy_dir")),t()},trigger:["blur","change"]}]}}])}),Ke=()=>{t({isAsync:!0,title:"接管已启动项目",area:76,component:()=>l(()=>import("./take-over-started-project.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{setProject:qe}})},Re=e=>{de.value.project_ps=e},ze=e=>{var a;if(de.value.project_jdk=e,_e.value)-1===Se.value.indexOf("/bin/java")&&(Se.value=Se.value+"/bin/java"),de.value.project_cmd=null==(a=de.value.project_cmd)?void 0:a.replace(Se.value,e),Se.value=e;else if(de.value.project_cmd){let e=de.value.project_cmd.split("-Xmx1024M -Xms256M");de.value.project_cmd=de.value.project_jdk+" -jar -Xmx1024M -Xms256M "+e[1]}else de.value.project_cmd=de.value.project_jdk+" -jar  -Xmx1024M -Xms256M "+de.value.project_jar},He=g(()=>_e.value&&""===de.value.port?"未设置":"选择项目文件，自动获取端口"),qe=async e=>{if(!e.java_bin&&!e.jar_path)return ie.error("未能解析到项目信息");if(de.value.project_path=e.jar_path,de.value.project_jar=e.jar_path,de.value.port=e.port,de.value.project_cmd=e.cmdline,de.value.project_name=e.project_name,de.value.run_user=e.user,!Y.jdk_info.some(a=>a.path===e.java_bin)&&""!==e.java_bin){const a=e.java_bin.split("/");Y.jdk_info.push({name:a[a.length-3],path:e.java_bin}),await te({data:JSON.stringify({jdk:e.java_bin})})}de.value.project_jdk=e.java_bin||"",de.value.by_process=e.pid,We(e.env)},Ne=e=>{let a=e.split("\n").filter(e=>""!==e),t=[];return a.forEach(e=>{let a=e.split("=");t.push({k:a[0],v:a[1]})}),t},We=e=>{if(de&&0!==e.length)switch(je.value){case 0:de.value.env=e.map(e=>e.k+"="+e.v).join("\n"),je.value=1;break;case 1:let a=Ne(de.value.env);const t=new Map,l=[...a,...e].reduce((e,a)=>{const l=a.k;return t.has(l)||(t.set(l,!0),e.push(a)),e},[]);de.value.env=null==l?void 0:l.map(e=>e.k+"="+e.v).join("\n")}},Ge=()=>{ce({type:"file",path:de.value.envPath,change:e=>{de.value.envPath=e}})},$e=()=>{if(!de)return;if(_e.value)return;let e=de.value.project_cmd.match(/--server.port=(\d+)/);e&&(de.value.port=e[1])},Qe=async e=>{if(de&&"/www/wwwroot"!==de.value.project_jar)try{let a={type:e,project_name:de.value.project_name,project_cmd:de.value.project_cmd,project_jar:de.value.project_jar,project_jdk:de.value.project_jdk,port:de.value.port};const{data:t}=await le(a);if(!t.status)return ie.request(t);if(de.value.project_cmd=t.data,t.data.match(/--server.port=(\d+)/)){t.data.match(/--server.port=(\d+)/)[1]!==de.value.port&&(de.value.project_cmd=de.value.project_cmd.replace(/--server.port=(\d+)/,"--server.port="+de.value.port))}else de.value.project_cmd=de.value.project_cmd+" --server.port="+de.value.port;de.value.host_url="http://127.0.0.1:".concat(de.value.port);let l="Dcom.sun.management.jmxremote.port";de.value.jmx_port=t.data.substr(t.data.indexOf(l)+l.length+1,4)}catch(a){o(a)}},Ze=()=>{de&&ce({type:"file",path:de.value.project_jar,change:async e=>{var a;if(_e.value)de.value.project_cmd&&(de.value.project_cmd=null==(a=de.value.project_cmd)?void 0:a.replace(de.value.project_jar,e));else{let a=e.substring(e.lastIndexOf("/")+1).split(".")[0];de.value.project_name=a,de.value.project_ps=a,de.value.project_cmd=de.value.project_jdk+" -jar  -Xmx1024M -Xms256M "+e;const{data:t}=await oe({jar_path:e});t.status&&(de.value.port=t.data.port)}de.value.project_jar=e,de.value.project_path=e}})},Ye=()=>{de&&ce({type:"dir",path:de.value.static_dir,change:e=>{de.value.static_dir=e}})},ea=()=>{de&&ce({type:"file",path:Me.project_jar,change:e=>{Me.project_jar=e}})},aa=async()=>{await Ie.value.validate();const{name:e}=Q.value;await r({title:"更新项目",content:"将要重启项目【".concat(e,"】，是否继续？")});const a={project_name:e,project_jar:Me.project_jar};try{const e=await re(a);ie.msg({dangerouslyUseHTMLString:!0,message:e.msg,type:e.status?"success":"error",duration:e.status?2e3:0,showClose:!e.status}),e.status&&(Z.value=!0,Ee.value=!1)}catch(t){o(t)}};let ta=null;const la=async(e,a,t)=>{await a();let l=e.env;1===je.value&&(l=Ne(l));let o={project_type:0,domains:e.domains?e.domains.split("\n"):[],project_jar:e.project_jar,project_jdk:e.project_jdk,project_name:e.project_name,project_cmd:e.project_cmd,project_ps:e.project_ps,run_user:e.run_user,env_file:2===je.value?e.envPath:"",env_list:1===je.value?l:[],ps:e.project_ps,port:e.port,project_path:e.project_path,proxy_dir:e.proxy_dir,target_dir:e.target_dir,static_dir:e.static_dir};_e.value?o.project_id=Q.value.id:(o.by_process=e.by_process,o.release_firewall=e.release_firewall);const r=_e.value?ne:pe,s=await u({loading:"正在操作，请稍后...",request:r({data:JSON.stringify(o)}),message:!0});return s.status&&(Z.value=!0,_e.value||t()),s.status},oa=async e=>(await Le(),_e.value?await la(de.value,Le,e):(async e=>{try{let a=de.value.env;1===je.value&&(a=Ne(a));let o={project_jar:de.value.project_jar,project_cmd:de.value.project_cmd,by_process:de.value.by_process,env_file:2===je.value?de.value.envPath:"",env_list:JSON.stringify(1===je.value?a:[])};const r=await se(o);if(!(r.status&&r.data.length>0))return e();ta=await t({isAsync:!0,title:"项目帮助",area:76,component:()=>l(()=>import("./springboot-check-list.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{data:r.data,params:o,confirmEvent:e},btn:"继续创建",onConfirm:e,cancel:()=>{ta=null}})}catch(a){o(a)}})(async()=>{if(ta){const e=await ta;null==e||e.unmount(),ta=null}return await la(de.value,Le,e)}));return V(()=>{if(_e.value){const{ps:e,project_config:a}=Q.value,{project_jar:t,project_jdk:l,run_user:o,project_cmd:r,jmx_status:s,java_type:n,watch_file:p,env_file:i,env_list:d}=a;Se.value=l,je.value=(null==d?void 0:d.length)?1:i?2:0;const c="springboot"===n&&((e=>{try{const a=/--server\.port=(\d+)/,t=e.match(a);return!!t&&t[1]}catch(a){}})(r)||a.port);Object.assign(de.value,{project_ps:e,project_jar:t,project_jdk:-1===(null==l?void 0:l.indexOf("/bin/java"))?l+"/bin/java":l,project_name:a.project_name,project_cmd:r,run_user:o,env_file:i,env_list:d,proxy_path:a.proxy_path,watch_file:p,domains:a.domains.join("\n"),envPath:i,env:null==d?void 0:d.map(e=>e.k+"="+e.v).join("\n"),port:c||"",project_path:a.project_jar,proxy_dir:a.proxy_dir,target_dir:a.target_dir,static_dir:a.static_dir})}}),_({onConfirm:oa}),(e,a)=>{const t=s,l=n,o=p,r=X,c=K,u=$,m=R,_=i,v=z,j=H,f=q,h=N,w=ae,b=W,g=ee,y=G,x=d;return k(),D("div",null,[U(E(Fe),{class:"mt-2rem","label-width":"100px"},{custom:C(()=>[T("div",fe,[U(c,{label:"项目路径",prop:"project_path"},{default:C(()=>[U(o,{width:"30rem",modelValue:E(de).project_path,"onUpdate:modelValue":a[0]||(a[0]=e=>E(de).project_path=e)},{append:C(()=>[U(l,{onClick:Ze},{default:C(()=>[U(t,{icon:"el-folder-opened",class:"cursor-pointer"})]),_:1})]),_:1},8,["modelValue"]),E(_e)?I("",!0):(k(),S(r,{key:0,class:"ml-[12px]",type:"default",onClick:Ke},{default:C(()=>[...a[29]||(a[29]=[P("接管原项目",-1)])]),_:1}))]),_:1})]),U(c,{label:"项目名称",prop:"project_name"},{default:C(()=>[T("div",he,[U(o,{onChange:Re,width:"32rem",modelValue:E(de).project_name,"onUpdate:modelValue":a[1]||(a[1]=e=>E(de).project_name=e),disabled:E(_e),placeholder:"选择项目文件，自动获取名称"},null,8,["modelValue","disabled"])])]),_:1}),U(c,{label:"项目JDK",prop:"project_jdk"},{default:C(()=>[T("div",we,[T("div",be,[U(m,{modelValue:E(de).project_jdk,"onUpdate:modelValue":a[2]||(a[2]=e=>E(de).project_jdk=e),onChange:ze,class:"!w-[32rem]",disabled:!E(Y).jdk_info},{default:C(()=>[(k(!0),D(O,null,M(E(Y).jdk_info,(e,a)=>(k(),S(u,{key:a,value:e.path,label:e.name+"["+e.path+"]"},null,8,["value","label"]))),128))]),_:1},8,["modelValue","disabled"]),T("div",ge,[U(l,{title:"刷新项目JDK",class:"!flex",onClick:a[3]||(a[3]=e=>E(Je)("项目JDK"))},{default:C(()=>[U(t,{icon:"el-refresh",class:"!text-[14px]"})]),_:1})])]),U(_,{class:"ml-8px",onClick:a[4]||(a[4]=e=>E(ve)())},{default:C(()=>[...a[30]||(a[30]=[P("添加JDK信息",-1)])]),_:1})])]),_:1}),U(c,{label:"项目启动命令",prop:"project_cmd"},{default:C(()=>[U(o,{onBlur:$e,width:"40rem",type:"textarea",rows:4,resize:"none",modelValue:E(de).project_cmd,"onUpdate:modelValue":a[5]||(a[5]=e=>E(de).project_cmd=e),placeholder:"选择项目jar文件，自动获取项目执行命令"},null,8,["modelValue"])]),_:1}),E(_e)?(k(),D(O,{key:0},[U(c,{label:"启动用户"},{default:C(()=>[T("div",ye,[U(m,{modelValue:E(de).run_user,"onUpdate:modelValue":a[6]||(a[6]=e=>E(de).run_user=e),class:"mr-8px !w-[16rem]"},{default:C(()=>[(k(!0),D(O,null,M(E(Y).userList,e=>(k(),S(u,{key:e,value:e,label:e},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),_:1}),U(c,{label:"项目端口",prop:"port"},{default:C(()=>[T("div",xe,[U(o,{type:"number",onChange:a[7]||(a[7]=e=>Qe(1)),width:"20rem",class:"mr-[1rem]",modelValue:E(de).port,"onUpdate:modelValue":a[8]||(a[8]=e=>E(de).port=e),placeholder:E(He)},null,8,["modelValue","placeholder"]),E(_e)?I("",!0):(k(),S(j,{key:0,modelValue:E(de).release_firewall,"onUpdate:modelValue":a[9]||(a[9]=e=>E(de).release_firewall=e)},{default:C(()=>[a[32]||(a[32]=P(" 放行端口 ",-1)),U(v,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:C(()=>[...a[31]||(a[31]=[T("i",{class:"svgtofont-el-question text-warning"},null,-1)])]),_:1})]),_:1},8,["modelValue"]))])]),_:1}),U(c,{label:"环境变量"},{default:C(()=>[U(h,{modelValue:E(je),"onUpdate:modelValue":a[10]||(a[10]=e=>B(je)?je.value=e:null)},{default:C(()=>[U(f,{label:0},{default:C(()=>[...a[33]||(a[33]=[P("无",-1)])]),_:1}),U(f,{label:1},{default:C(()=>[...a[34]||(a[34]=[P("指定变量",-1)])]),_:1}),U(f,{label:2},{default:C(()=>[...a[35]||(a[35]=[P("从文件加载",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),J(U(c,{label:" "},{default:C(()=>[J(U(o,{width:"40rem",type:"textarea",rows:4,resize:"none",modelValue:E(de).env,"onUpdate:modelValue":a[11]||(a[11]=e=>E(de).env=e),placeholder:"环境变量，1行1个，例如： JAVA_HOME=/usr/local/btjdk/jdk8"},null,8,["modelValue"]),[[A,1===E(je)]]),J(U(w,{width:"40rem",modelValue:E(de).envPath,"onUpdate:modelValue":a[12]||(a[12]=e=>E(de).envPath=e),placeholder:"请选择环境变量文件,如:项目路径/.xx.env",icon:"el-folder-opened",onIconClick:Ge},null,8,["modelValue"]),[[A,2===E(je)]])]),_:1},512),[[A,0!==E(je)]]),U(c,{label:"项目备注"},{default:C(()=>[U(o,{width:"32rem",modelValue:E(de).project_ps,"onUpdate:modelValue":a[13]||(a[13]=e=>E(de).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])]),_:1})],64)):I("",!0),U(g,{isShowDivider:!E(_e)},F({_:2},[E(_e)?void 0:{name:"config",fn:C(()=>[U(c,{label:"启动用户"},{default:C(()=>[T("div",Ve,[U(m,{modelValue:E(de).run_user,"onUpdate:modelValue":a[14]||(a[14]=e=>E(de).run_user=e),class:"mr-8px !w-[16rem]"},{default:C(()=>[(k(!0),D(O,null,M(E(Y).userList,e=>(k(),S(u,{key:e,value:e,label:e},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),_:1}),U(c,{label:"项目端口",prop:"port"},{default:C(()=>[T("div",ke,[U(o,{type:"number",onChange:a[15]||(a[15]=e=>Qe(1)),width:"20rem",class:"mr-[1rem]",modelValue:E(de).port,"onUpdate:modelValue":a[16]||(a[16]=e=>E(de).port=e),placeholder:E(He)},null,8,["modelValue","placeholder"]),E(_e)?I("",!0):(k(),S(j,{key:0,modelValue:E(de).release_firewall,"onUpdate:modelValue":a[17]||(a[17]=e=>E(de).release_firewall=e)},{default:C(()=>[a[37]||(a[37]=P(" 放行端口 ",-1)),U(v,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:C(()=>[...a[36]||(a[36]=[T("i",{class:"svgtofont-el-question text-warning"},null,-1)])]),_:1})]),_:1},8,["modelValue"]))])]),_:1}),U(c,{label:"环境变量"},{default:C(()=>[U(h,{modelValue:E(je),"onUpdate:modelValue":a[18]||(a[18]=e=>B(je)?je.value=e:null)},{default:C(()=>[U(f,{label:0},{default:C(()=>[...a[38]||(a[38]=[P("无",-1)])]),_:1}),U(f,{label:1},{default:C(()=>[...a[39]||(a[39]=[P("指定变量",-1)])]),_:1}),U(f,{label:2},{default:C(()=>[...a[40]||(a[40]=[P("从文件加载",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),J(U(c,{label:" "},{default:C(()=>[J(U(o,{width:"40rem",type:"textarea",rows:4,resize:"none",modelValue:E(de).env,"onUpdate:modelValue":a[19]||(a[19]=e=>E(de).env=e),placeholder:"环境变量，1行1个，例如： JAVA_HOME=/usr/local/btjdk/jdk8"},null,8,["modelValue"]),[[A,1===E(je)]]),J(U(w,{width:"40rem",modelValue:E(de).envPath,"onUpdate:modelValue":a[20]||(a[20]=e=>E(de).envPath=e),placeholder:"请选择环境变量文件,如:项目路径/.xx.env",icon:"el-folder-opened",onIconClick:Ge},null,8,["modelValue"]),[[A,2===E(je)]])]),_:1},512),[[A,0!==E(je)]]),U(c,{label:"绑定域名"},{default:C(()=>[U(b,{placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:E(Pe),"onUpdate:visible":a[23]||(a[23]=e=>B(Pe)?Pe.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:C(()=>[U(o,{rows:4,resize:"none",width:"40rem",modelValue:E(de).domains,"onUpdate:modelValue":a[21]||(a[21]=e=>E(de).domains=e),type:"textarea",onFocus:a[22]||(a[22]=e=>Pe.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),default:C(()=>[a[41]||(a[41]=T("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[P("如果需要绑定外网，请输入需要绑定的域名，该选项可为空"),T("br"),P("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),T("br"),P("泛解析添加方法 *.domain.com"),T("br"),P("如另加端口格式为 www.domain.com:88")],-1))]),_:1},8,["visible"])]),_:1}),U(c,{label:"后端路由",prop:"proxy_dir"},{default:C(()=>[T("div",De,[U(o,{disabled:E(_e),width:"40rem",modelValue:E(de).proxy_dir,"onUpdate:modelValue":a[24]||(a[24]=e=>E(de).proxy_dir=e),placeholder:"请输入访问地址"},{prepend:C(()=>[T("div",{class:"max-w-[20rem] truncate",title:E(me)},L(E(me)),9,Ue)]),_:1},8,["disabled","modelValue"])])]),_:1}),E(_e)?I("",!0):(k(),D("span",Ce,L(E(Ae)),1)),U(c,{label:"前端资源",prop:"static_dir"},{default:C(()=>[U(o,{width:"40rem",disabled:E(_e),modelValue:E(de).static_dir,"onUpdate:modelValue":a[25]||(a[25]=e=>E(de).static_dir=e)},{append:C(()=>[U(l,{onClick:Ye},{default:C(()=>[U(t,{icon:"el-folder-opened",class:"cursor-pointer"})]),_:1})]),_:1},8,["disabled","modelValue"])]),_:1}),U(c,{label:"项目备注"},{default:C(()=>[U(o,{width:"32rem",modelValue:E(de).project_ps,"onUpdate:modelValue":a[26]||(a[26]=e=>E(de).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])]),_:1})]),key:"0"}]),1032,["isShowDivider"]),E(_e)?(k(),S(c,{key:1,label:" "},{default:C(()=>[U(r,{type:"primary",onClick:oa},{default:C(()=>[...a[42]||(a[42]=[P("保存当前配置",-1)])]),_:1})]),_:1})):I("",!0)]),_:1}),U(x,{modelValue:E(Ee),"onUpdate:modelValue":a[28]||(a[28]=e=>B(Ee)?Ee.value=e:null),area:50,showFooter:"",onConfirm:aa,title:"项目更新"},{default:C(()=>[T("div",Te,[U(y,{ref_key:"javaFormRef",ref:Ie,model:E(Me),disabled:E(Oe),"label-width":"9rem",rules:E(Be)},{default:C(()=>[U(c,{label:"jar包路径",prop:"project_jar"},{default:C(()=>[U(w,{modelValue:E(Me).project_jar,"onUpdate:modelValue":a[27]||(a[27]=e=>E(Me).project_jar=e),icon:"el-folder-opened",onIconClick:ea,width:"32rem"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled","rules"])])]),_:1},8,["modelValue"])])}}}),Se={class:"flex items-center"},Pe={class:"flex items-center justify-between"},Ie={class:"flex items-center"},Oe={class:"flex items-center justify-between"},Me={class:"text-[#999]"},Be={class:"flex items-center"},Je=h({__name:"traditional-project",props:{projectData:{default:{}},editForm:{}},setup(t,{expose:l}){var o,d,c,u;const v=t,{siteInfo:j}=ue();let f=!1;const h=b({project_path:"/www/wwwroot",project_ps:"",release_firewall:!1,tomcat_version:(null==(d=null==(o=null==v?void 0:v.projectData)?void 0:o.tomcat_list[0])?void 0:d.version)||"",port:"",project_name:"",domains:"",proxy_dir:"/",target_dir:"/",tomcat_name:(null==(u=null==(c=null==v?void 0:v.projectData)?void 0:c.tomcat_list[0])?void 0:u.name)||"",run_user:"",use_project_watch:!1}),w=b(!1),J=b("file");b([{label:".war",value:"file"},{label:"文件夹",value:"dir"}]),g(()=>{if(h.value.domains){const e=h.value.domains.split("\n")[0].trim();return"http://".concat(e)}return"http://域名"}),y("getSystemInfoEvent",e=>{});const A=e=>{_e.value||(h.value.project_ps=e,h.value.target_dir="/".concat(e),"/www/wwwroot"!==h.value.project_path&&"/www/wwwroot/"!==h.value.project_path||(h.value.project_path="/www/wwwroot/".concat(e)))},z=()=>{ce({type:"all",path:h.value.project_path,change:e=>{h.value.project_path=e;let a=e.substring(e.lastIndexOf("/")+1).split(".")[0];h.value.project_ps=a,_e.value||(h.value.project_name=a,Z(a))}})},H=()=>{f=!0},{BtForm:q,validate:N,param:G}=a({data:h.value,options:()=>g(()=>[{type:"slots",key:"custom",rules:{project_path:[e({message:"请输入项目路径"})],tomcat_version:[e({message:"请选择tomcat版本",trigger:"change"})],port:[e({message:"请输入端口号",trigger:"blur"}),m()],project_name:[e({message:"请输入项目名称"})],domains:[e({message:"请输入项目域名"})],proxy_dir:[e({message:"请输入访问地址"})],target_dir:[e({message:"请输入到达地址"})]}}])}),Q=async e=>{const a=v.projectData.tomcat_list.find(a=>a.name===e);a&&(h.value.tomcat_version=a.version,h.value.run_user=a.user,h.value.port=a.port)};g(()=>"http://127.0.0.1".concat(h.value.port?":".concat(h.value.port):"").concat(h.value.target_dir));const Z=e=>{h.value.target_dir="/"===e.charAt(0)?e:"/"+e},Y=async()=>{await N();let e={...G.value,domains:G.value.domains.split("\n"),project_type:1};return _e.value&&(f&&await r({title:"提示",width:"35rem",icon:"warning-filled",content:"更改后会重启Tomcat，是否继续？"}),f=!1,e.project_jar="",e.debug=G.value.debug?1:0,delete e.jmx_info,e.log_conf,delete e.logs,e.scripts),je(e)};return x(()=>v.projectData.tomcat_list.length,()=>{var e,a,t,l;if(h&&!_e.value&&(h.value.tomcat_name=null==(e=v.projectData.tomcat_list[0])?void 0:e.name,h.value.tomcat_version=null==(a=v.projectData.tomcat_list[0])?void 0:a.version,h.value.port=null==(t=v.projectData.tomcat_list[0])?void 0:t.port,Q(null==(l=v.projectData.tomcat_list[0])?void 0:l.name)),j.value){const{project_config:e}=j.value;if(!e.tomcat_name&&_e.value){const a=v.projectData.tomcat_list.find(a=>a.config_path===e.server_xml);a&&(h.value.tomcat_name=a.name,h.value.tomcat_version=a.version)}}},{immediate:!0,deep:!0}),V(()=>{if(_e.value){const{project_config:e,ps:a,path:t}=j.value;Object.assign(h.value,{...e,domains:e.domains.join("\n"),project_path:t,project_name:e.project_name,is_separation:1===e.is_separation,debug:0,release_firewall:!1,project_ps:_(a),host_url:"http://127.0.0.1:"+e.port,jmx_status:!1,proxy_dir:e.proxy_dir,target_dir:e.target_dir}),J.value=(e=>{if(!e)return"dir";if(/[/\\]$/.test(e))return"dir";const a=e.toLowerCase();return a.endsWith(".war")||a.endsWith(".jar")?"file":"dir"})(t)}else J.value="dir"}),l({onConfirm:Y}),(e,a)=>{const t=s,l=n,o=p,r=K,d=W,c=$,u=R,m=i,_=X;return k(),D("div",null,[U(E(q),{"label-width":"100px",class:"mt-[2rem]"},{custom:C(()=>[T("div",Se,[U(r,{label:"项目路径",prop:"project_path"},{default:C(()=>[U(o,{width:"30rem",disabled:E(_e),modelValue:E(h).project_path,"onUpdate:modelValue":a[0]||(a[0]=e=>E(h).project_path=e)},F({_:2},[E(_e)?void 0:{name:"append",fn:C(()=>[U(l,{onClick:z},{default:C(()=>[U(t,{icon:"el-folder-opened",class:"cursor-pointer"})]),_:1})]),key:"0"}]),1032,["disabled","modelValue"])]),_:1})]),E(_e)?I("",!0):(k(),S(r,{key:0,label:"项目名称",prop:"project_name"},{default:C(()=>[T("div",Pe,[U(o,{onChange:A,width:"36rem",modelValue:E(h).project_name,"onUpdate:modelValue":a[1]||(a[1]=e=>E(h).project_name=e),placeholder:"选择项目文件，自动获取名称"},null,8,["modelValue"])])]),_:1})),E(_e)?I("",!0):(k(),S(r,{key:1,label:"绑定域名",prop:"domains"},{default:C(()=>[U(d,{placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:E(w),"onUpdate:visible":a[4]||(a[4]=e=>B(w)?w.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:C(()=>[U(o,{rows:4,resize:"none",width:"40rem",modelValue:E(h).domains,"onUpdate:modelValue":a[2]||(a[2]=e=>E(h).domains=e),type:"textarea",onFocus:a[3]||(a[3]=e=>w.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),default:C(()=>[a[9]||(a[9]=T("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[P("如果需要绑定外网，请输入需要绑定的域名，该选项可为空"),T("br"),P("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),T("br"),P("泛解析添加方法 *.domain.com"),T("br"),P("如另加端口格式为 www.domain.com:88")],-1))]),_:1},8,["visible"])]),_:1})),U(r,{label:"Tomcat版本",prop:"tomcat_version"},{default:C(()=>[T("div",Ie,[U(u,{modelValue:E(h).tomcat_name,"onUpdate:modelValue":a[5]||(a[5]=e=>E(h).tomcat_name=e),class:"mr-[8px] !w-[20rem]",disabled:E(_e),onChange:Q},{default:C(()=>[(k(!0),D(O,null,M(e.projectData.tomcat_list,(e,a)=>(k(),S(c,{key:a,value:e.name},{default:C(()=>[T("div",Oe,[T("span",null,L(e.name),1),T("span",Me,L(e.path.includes("/www/server/bt_tomcat_web")?"独立Tomcat":"全局Tomcat"),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"]),U(m,{onClick:a[6]||(a[6]=e=>E(ve)("newTomCat"))},{default:C(()=>[...a[10]||(a[10]=[P("安装/管理Tomcat",-1)])]),_:1})])]),_:1}),U(r,{label:"Tomcat端口",prop:"port"},{default:C(()=>[T("div",Be,[U(o,{width:"20rem",type:"number",onChange:H,class:"mr-[12px]",modelValue:E(h).port,"onUpdate:modelValue":a[7]||(a[7]=e=>E(h).port=e),placeholder:"选择Tomcat版本，自动获取端口"},null,8,["modelValue"])])]),_:1}),U(r,{label:"项目备注"},{default:C(()=>[U(o,{width:"36rem",modelValue:E(h).project_ps,"onUpdate:modelValue":a[8]||(a[8]=e=>E(h).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])]),_:1}),E(_e)?(k(),S(r,{key:2,label:" "},{default:C(()=>[U(_,{type:"primary",onClick:Y},{default:C(()=>[...a[11]||(a[11]=[P("保存当前配置",-1)])]),_:1})]),_:1})):I("",!0)]),_:1})])}}}),Ae={class:"flex items-center"},Fe={class:"flex items-center ml-[12px]"},Le=h({__name:"index",props:{compData:{default:()=>({isEdit:!1})}},setup(e,{expose:a}){const{siteInfo:t}=ue(),{getRootUser:l}=me(),o=b(),r=b(),s=w({userList:[],jdk_info:[],tomcat_list:[]}),n=w({radioType:"SpringBoot"}),p=b(!1),d=async(e="")=>{var a;try{const t=await ie();s.jdk_info=null==(a=t.data.jdk_info)?void 0:a.filter(e=>0!==e.operation);const l=await de();Object.entries(l.data).forEach(([e,a])=>{a.status&&s.tomcat_list.push({...a,name:e,version:Number(a.version.split(".")[0])})}),e&&f.success("".concat(e,"，刷新成功"))}catch(t){}};Q("getSystemInfoEvent",d);const c=async()=>{if("tomcat"===n.radioType)return;const{data:e}=await l({springboot:Number("SpringBoot"===n.radioType)});s.userList=e},u=async()=>{var e;p.value=!0,await c(),await d(),p.value=!1,_e.value&&(n.radioType="springboot"===(null==(e=t.value.project_config)?void 0:e.java_type)?"SpringBoot":"tomcat")};return V(u),a({init:u,onConfirm:async e=>{let a="SpringBoot"===n.radioType?o.value:r.value;await a.onConfirm(e)&&e&&e()}}),(e,a)=>{const t=v,l=i,d=K,u=G,m=j,_=Z("bt-loading");return k(),D("div",{class:"overflow-auto p-2rem",style:Y("max-height:".concat(E(_e)?68:64,"rem"))},[J((k(),S(u,{model:E(n),"label-width":"100px"},{default:C(()=>[E(_e)?I("",!0):(k(),S(d,{key:0,label:"项目类型"},{default:C(()=>[T("div",Ae,[U(t,{modelValue:E(n).radioType,"onUpdate:modelValue":a[0]||(a[0]=e=>E(n).radioType=e),type:"button",options:[{label:"SpringBoot",value:"SpringBoot"},{label:"Tomcat项目",value:"tomcat"}],disabled:E(_e),onChange:c},null,8,["modelValue","disabled"]),T("div",Fe,[U(l,{href:"https://www.bt.cn/bbs/thread-76217-1-1.html"},{default:C(()=>[...a[1]||(a[1]=[P("Java项目教程",-1)])]),_:1}),a[2]||(a[2]=T("i",{class:"svgtofont-el-link text-primary text-[1.6rem] ml-[4px]"},null,-1))])])]),_:1})),J(U(Ee,{ref_key:"SpringBootFormRef",ref:o,isEdit:e.compData.isEdit,onCloseEvent:e.compData.closeEvent,projectData:E(s)},null,8,["isEdit","onCloseEvent","projectData"]),[[A,"SpringBoot"==E(n).radioType]]),J(U(Je,{ref_key:"TraditionalProjectRef",ref:r,isEdit:e.compData.isEdit,projectData:E(s)},null,8,["isEdit","projectData"]),[[A,"tomcat"==E(n).radioType]])]),_:1},8,["model"])),[[_,E(p)]]),U(m,{options:[{content:"过往内置Tomcat项目、独立Tomcat项目的添加已经整合到Tomcat项目中"}],class:"ml-[40px] mt-[20px]"})],4)}}});export{Le as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
