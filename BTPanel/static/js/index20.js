import{u as e,l as a,L as s,M as t,K as l,S as i,c as r,al as n,J as o,k as d,a0 as m,o as c}from"./utils-lib.js?v=1756369731";import{_ as u}from"./index103.js?v=1756369731";import{_ as p}from"./index112.js?v=1756369731";import{c as _,r as f,g as y,k as v,e as b,w as x,p as g,G as h,q as k,v as w,x as L,M as j,A as C,C as V,y as N,B as S,P as A,F as D,a_ as O,J,K as R,z as q,H as E,D as T,aj as U,ai as P,aA as F}from"./base-lib.js?v=1756369731";import{_ as H}from"./index130.js?v=1756369731";import{g as I}from"./useStore2.js?v=1756369731";import{getRedisKey as K,getRedisKeyValue as M,delBatchRedisValue as z,delRedisValue as B,getModulesCloudServer as G}from"./database.js?v=1756369731";import{a as Q,u as W,c as X}from"./column.js?v=1756369731";import{o as Y,a as Z,m as $}from"./useMethod4.js?v=1756369731";import{B as ee}from"./index131.js?v=1756369731";import{_ as ae}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1756369731";import{e as se,h as te,i as le,o as ie}from"./validator.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";const re={class:"flex items-center"},ne={class:"flex items-center mx-4px inline-flex"},oe={class:"flex items-center"},de={class:"mr-[1.6rem] text-[1.2rem]"},me={class:"!float-right mb-8px !w-[24rem]"},ce=_({__name:"index",setup(_){e();const{refs:{isRefreshTable:ce,envStatus:ue,isHaveServer:pe,softData:_e},resetRefresh:fe,refreshTableList:ye}=I(),ve=f("0"),be=f(),xe=f(!1),ge=f(0),he=y(()=>!ue.value.setup&&!pe.value),ke=v({serverList:[],keyList:[],valueList:[]}),we=f(0),Le=v({search:"",sid:0,limit:10,db_idx:0,p:1}),je=f({db_status:!0,msg:"加载中"}),Ce=y(()=>je.value.db_status?"check":"close"),Ve=()=>{a({title:"数据库备份",area:78,compData:{sid:Le.sid,keyList:ke.keyList},component:()=>s(()=>import("./index133.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},Ne=()=>{a({title:"清理数据库",area:42,compData:{sid:Le.sid,keyList:ke.keyList},showFooter:!0,component:()=>s(()=>import("./index134.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},Se=async e=>{const a=t.load("正在切换服务器,请稍后...");Le.sid=Number(e),await qe(),a.close()},Ae=(e,a)=>{Le.db_idx=Number(e),Oe()},De=async e=>{const a=await l({request:K({data:JSON.stringify({sid:e})}),data:Array});return ke.keyList=a,a},Oe=async()=>{const e=await l({request:M({data:JSON.stringify({...Le})}),data:{data:Array,page:i(we)}});ke.valueList=e.data||[]},Je=[Q({type:"page",key:"name"}),{label:"键",prop:"name"},{label:"值",prop:"val",width:320,render:e=>b("span",{class:"truncate !w-[30rem]",title:e.val},[e.val])},{label:"数据类型",prop:"type"},{label:"数据长度",prop:"len"},{label:"有效期",prop:"showtime"},W([{onClick:e=>{a({title:"编辑redis数据库",area:44,compData:{refresh:()=>De(Le.sid),row:{...e,db_idx:Number(ve.value)}},showFooter:!0,component:()=>s(()=>import("./index135.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},title:"编辑"},{onClick:async e=>{await c({icon:"warning-filled",title:"提示",content:"此操作将删除选中的数据【".concat(e.name,"】, 是否继续?")}),await l({request:B({data:JSON.stringify({sid:Le.sid,db_idx:Number(ve.value),key:e.name})}),message:!0}),ye()},title:"删除"}])],Re=[{label:"删除",value:"delete",event:async(e,a,s,t,l,i)=>{const{label:r,value:n}=t,{enable:o,exclude:d}=i;await e({title:"批量".concat(r,"键"),content:"即将批量".concat(r,"键，是否继续操作！"),column:[{label:"键名",prop:"name"},X()],onConfirm:async()=>{const e=s.value.map(e=>({key:e.name})),a=te(!1,d,o,{params:{database_list:JSON.stringify(e),sid:Le.sid,db_idx:Number(ve.value)}}),t=await z(a);ye();const{data:i}=le(t.data);ie(i,{title:"删除键"}),null==l||l()}})}}],qe=async()=>{try{const e=await $(Le.sid);if(je.value=e,(async()=>{const e=await l({request:G({data:JSON.stringify({type:"redis"})},"redis"),data:Array});ke.serverList=e,ke.serverList.length&&(pe.value=!0)})(),!e.db_status)return ke.valueList=[],ke.keyList=[],pe.value=!1,!1;De(Le.sid),Oe()}catch(e){}};return x(()=>ce.value,async e=>{e&&(await De(Le.sid),await Oe()),fe()}),g(qe),(e,a)=>{const s=H,t=T,l=r,i=P,c=U,_=F,f=n,y=o,v=d,x=m,g=p,I=u,K=h("bt-loading");return k(),w("div",null,[L(he)?(k(),j(s,{key:0},{content:C(()=>[b(ae,{type:"Redis"})]),_:1})):V("",!0),b(I,null,{"header-left":C(()=>[N("div",re,[b(t,{type:"primary",onClick:a[0]||(a[0]=e=>L(Y)(()=>De(L(Le).sid),L(Le).sid,L(ve)))},{default:C(()=>[...a[7]||(a[7]=[S("添加Key",-1)])]),_:1}),b(t,{onClick:L(Z)},{default:C(()=>[...a[8]||(a[8]=[S("远程数据库",-1)])]),_:1},8,["onClick"]),b(t,{onClick:Ve},{default:C(()=>[...a[9]||(a[9]=[S("备份列表",-1)])]),_:1}),b(t,{onClick:Ne},{default:C(()=>[...a[10]||(a[10]=[S("清空数据库",-1)])]),_:1}),b(ee,{pluginName:"redis","plugin-info":L(_e),"is-request":!1,class:"ml-8px"},null,8,["plugin-info"]),b(l,{onClick:a[1]||(a[1]=e=>L(se)({name:"数据库",type:12,id:17})),class:"ml-[12px] <2xl:hidden"},{default:C(()=>[...a[11]||(a[11]=[S(" 需求反馈 ",-1)])]),_:1})])]),"header-right":C(()=>[N("div",ne,[a[12]||(a[12]=N("span",{class:"text-warning inline-block whitespace-nowrap flex items-center"},[N("i",{class:"svgtofont-el-info-filled mt-2px mr-4px"}),S("当前所有操作都关联至 ")],-1)),b(c,{modelValue:L(ge),"onUpdate:modelValue":a[2]||(a[2]=e=>A(ge)?ge.value=e:null),class:"!w-[16rem] mx-4px",onChange:Se},{default:C(()=>[(k(!0),w(D,null,O(L(ke).serverList,e=>(k(),j(i,{key:e.ps,label:e.ps,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),N("div",oe,[N("i",{class:J("text-[1.4rem] mt-4px mr-2px svgtofont-el-circle-".concat(L(Ce),"-filled text-").concat("close"===L(Ce)?"danger":"primary"))},null,2),N("div",de,[a[13]||(a[13]=N("span",null,"状态：",-1)),N("span",{style:R("color:".concat(L(je).db_status?"#20a53a":"#ef0808"))},q(L(je).msg),5)])])]),content:C(()=>[b(f,{modelValue:L(ve),"onUpdate:modelValue":a[3]||(a[3]=e=>A(ve)?ve.value=e:null),type:"card",onChange:Ae,class:"tab-switch"},{default:C(()=>[(k(!0),w(D,null,O(L(ke).keyList,(e,a)=>(k(),j(_,{class:"h-0 !p-0",key:a,label:e.name+"【"+e.keynum+"】",name:String(e.id),lazy:!0},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),N("div",me,[b(y,{modelValue:L(Le).search,"onUpdate:modelValue":a[4]||(a[4]=e=>L(Le).search=e),onSearch:Oe,placeholder:"请输入键名称"},null,8,["modelValue"])]),E(b(v,{ref_key:"redisTableRef",ref:be,column:Je,data:L(ke).valueList,total:L(we)},null,8,["data","total"]),[[K,L(xe)]])]),"footer-left":C(()=>[b(x,{"table-ref":L(be),options:Re},null,8,["table-ref"])]),"footer-right":C(()=>[b(g,{page:L(Le).p,"onUpdate:page":a[5]||(a[5]=e=>L(Le).p=e),row:L(Le).limit,"onUpdate:row":a[6]||(a[6]=e=>L(Le).limit=e),total:L(we),onChange:Oe},null,8,["page","row","total"])]),_:1})])}}});export{ce as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
