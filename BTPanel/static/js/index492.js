import{_ as e}from"./index117.js?v=1756369731";import{c as s,r as a,k as n,g as t,p as l,G as i,H as r,x as c,q as o,v as d,y as u,e as m,M as p,F as g,B as v,z as f,C as b,A as y,J as x,a_ as w,K as k,I as _,D as h,a$ as S,bv as E,bw as T}from"./base-lib.js?v=1756369731";import{u as C,o as j,R as M,_ as F,d as H,c as L,b as I,ah as D,e as z}from"./utils-lib.js?v=1756369731";import{j as q,p as B}from"./validator.js?v=1756369731";import{scanSingleSite as J}from"./site.js?v=1756369731";import{u as O}from"./useStore4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const P={id:"safeDetectList"},N={key:0},R={class:"progress-header"},A={class:"progress-header-cot"},G={class:"flex items-center"},K={key:0,class:"scan-icon relative h-[8rem] w-[8rem] flex"},$={key:1},Q={class:"progress-header-cot"},U={class:"scanning-progress-title"},V={class:"text-danger"},W={class:"scanning-progress-cont"},X={class:"progress-header-cot"},Y={class:"progress-cont-list"},Z={key:0},ee={class:"inline-grid grid-cols-4 w-full mt-20px"},se=["onClick"],ae={class:"progress_type"},ne={class:"flex-1"},te={key:0,class:"text-danger mr-4px"},le={key:1},ie={key:2,class:"text-primary"},re={key:3},ce={class:"progress_fold text-[1.2rem] flex items-center"},oe={class:"mr-4px"},de={class:"progress_item_body"},ue={class:"flex items-center justify-between w-full"},me={class:"flex items-center ml-12px"},pe=["innerHTML"],ge={class:"flex flex-col py-[1rem] px-[1.6rem] text-[1.2rem] progress_item_info"},ve={class:"flex items-center"},fe=["innerHTML"],be={class:"flex"},ye=["innerHTML"],xe=z(s({__name:"index",setup(s,{expose:z}){const xe=I(),{siteInfo:we}=O(),{payment:ke}=C(),{authType:_e}=ke.value,he=a(!1),Se=a([{name:"webscan",title:"网站配置安全性"},{name:"filescan",title:"文件泄露"},{name:"backup",title:"备份文件"},{name:"index",title:"首页内容风险"},{name:"webhorse",title:"挂马排查"},{name:"deadchain",title:"坏链检测"},{name:"database",title:"数据库安全"},{name:"ftps",title:"网站FTP风险"},{name:"backend",title:"网站后台安全"}]),Ee=a(0),Te=a(""),Ce=a(""),je=n({scanStatus:!1,isEnd:!1,error:0,warn:0,time:0,progress:0,progressColor:"#20a53a",progressConfig:{},statusTotal:{},result:{},progressStatus:{},active:{}});let Me=null;const Fe=n({0:{text:"警告",bg:"rgba(252, 109, 38, 0.1)",color:"#fc6d26"},1:{text:"低危",bg:"rgba(232, 213, 68, 0.1)",color:"#D4BB00"},2:{text:"中危",bg:"rgba(240, 173, 78, 0.14)",color:"#f0ad4e"},3:{text:"高危",bg:"rgba(239, 8, 8, 0.1)",color:"#EF0808"}}),He=n({title:"安全扫描-功能介绍",height:36,ps:"扫描服务器系统的漏洞，异常用户，已安装软件的安全问题并提供修复方案.",source:66,desc:["漏洞扫描","网站配置安全性","文件泄露","备份文件","木马程序"],tabImgs:["https://www.bt.cn/Public/new/plugin/introduce/site/security-Introduction.png"]}),Le=e=>{"free"==_e&&B({sourceId:65})},Ie=t(()=>je.scanStatus&&!je.isEnd?"正在扫描":"定期扫描网站，提升网站安全性"),De=t(()=>je.scanStatus&&!je.isEnd?"".concat(Te.value||""):je.time?"上次检测时间：".concat(je.time):"当前安全风险未知，请立即检测"),ze=(e,s)=>{var a,n;if(s.data){const e=JSON.parse(s.data.replace(/'/g,'"'));if(e.hasOwnProperty("end")&&e.end){if((null==(n=null==(a=e.webinfo)?void 0:a.result)?void 0:n[e.type].length)>0?(je.progressConfig[e.type]=e.webinfo.result[e.type],je.statusTotal[e.type]=e.webinfo.result[e.type].length):je.statusTotal[e.type]=0,Te.value=e.info,Ee.value===Se.value.length-1)return null==Me||Me.close(),Ee.value=0,je.scanStatus=!1,void(je.isEnd=!0);let s=(new Date).getTime();Ee.value++,null==Me||Me.send({mod_name:"webscanning",def_name:"ScanSingleSite",ws_callback:s,name:we.value.name,scan_list:[Se.value[Ee.value].name]})}else Te.value=e.info,Ce.value=e.type,e.is_error&&je.error++}},qe=async()=>{if(je.scanStatus&&!je.isEnd||je.isEnd,je.scanStatus&&!je.isEnd)return await j({title:"取消扫描",content:"确定取消扫描吗?",icon:"warning"}),null==Me||Me.close(),Ee.value=0,void Be();je.isEnd&&(await(null==Me?void 0:Me.close()),Ee.value=0,await Be()),je.scanStatus=!0,Me=D({route:"/ws_project",onMessage:ze});let e=(new Date).getTime();null==Me||Me.send({"x-http-token":window.vite_public_request_token}),null==Me||Me.send({mod_name:"webscanning",def_name:"ScanSingleSite",ws_callback:e,name:we.value.name,scan_list:[Se.value[Ee.value].name]})},Be=()=>{je.scanStatus=!1,je.isEnd=!1,je.error=0,je.warn=0,je.time=0,je.progress=0,je.progressConfig={vulscan:[],webscan:[],filescan:[],backup:[],webshell:[],index:[],webhorse:[],deadchain:[],database:[],ftps:[],backend:[]},je.statusTotal={},je.result={},je.progressStatus={},je.active={vulscan:!1,webscan:!1,filescan:!1,backup:!1,webshell:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1}},Je=async()=>{if("ltd"===ke.value.authType){he.value=!0;try{const e=await J({data:JSON.stringify({name:we.value.name})});if(!e.status)return void xe.request(e);je.isEnd=je.time||!1,je.time=M(e.data.time,"yyyy-MM-dd")}catch(e){}finally{he.value=!1}}};return l(()=>{Je(),Be()}),z({onRefresh:async()=>{Je(),Be()}}),(s,a)=>{const n=F,t=h,l=S,C=H,j=L,M=E,I=T,D=e,z=i("bt-loading");return r((o(),d("div",P,["ltd"===c(ke).authType?(o(),d("div",N,[u("div",R,[u("div",A,[u("div",G,[c(je).scanStatus&&!c(je).isEnd?(o(),d("div",K,[a[0]||(a[0]=u("div",{class:"animate-spin absolute top-0 border-[#F39C12] border-b-2 rounded-full h-full w-full bg-#cccccc00"},null,-1)),m(n,{icon:"scanning-danger",size:60,color:"#F39C12",class:"m-auto"})])):(o(),d("div",$,[c(je).warn||c(je).error?(o(),p(n,{key:0,icon:"scanning-danger",size:70,color:"#ef0808"})):(o(),p(n,{key:1,icon:"scanning-"+(c(je).isEnd?"success":"danger"),size:72,color:c(je).isEnd?"#20a53a":"#F39C12"},null,8,["icon","color"]))]))])]),u("div",Q,[u("div",U,[c(je).isEnd?(o(),d(g,{key:1},[a[3]||(a[3]=v(" 检测完成 ",-1)),c(je).error>0||c(je).warn>0?(o(),d(g,{key:0},[a[2]||(a[2]=v(" ，共发现 ",-1)),c(je).error>0?(o(),d(g,{key:0},[u("span",V,f(c(je).error),1),a[1]||(a[1]=v(" 项风险 ",-1))],64)):b("",!0)],64)):b("",!0)],64)):(o(),d(g,{key:0},[v(f(c(Ie)),1)],64))]),u("div",W,f(c(De)),1)]),u("div",X,[m(t,{class:x({"warning-hover":c(je).scanStatus&&!c(je).isEnd}),type:c(je).scanStatus&&!c(je).isEnd?"warning":"primary",onClick:qe,plain:!(!c(je).scanStatus||c(je).isEnd)},{default:y(()=>[v(f(c(je).scanStatus&&!c(je).isEnd?"取消扫描":c(je).isEnd?"重新检测":"立即检测"),1)]),_:1},8,["class","type","plain"]),c(je).isEnd?(o(),p(t,{key:0,type:"default",onClick:c(q)},{default:y(()=>[...a[4]||(a[4]=[v(" 立即修复 ",-1)])]),_:1},8,["onClick"])):b("",!0)])]),m(l,{class:"!mt-0 !mb-20px !bg-[#F1F1F1]"}),u("div",Y,[c(je).scanStatus||c(je).isEnd?b("",!0):(o(),d("div",Z,[a[5]||(a[5]=u("div",{class:"font-bold text-[1.6rem] text-[#666] mb-[2rem]"},"支持网站以下安全扫描项:",-1)),u("div",ee,[(o(!0),d(g,null,w(c(Se),(e,s)=>(o(),d("div",{key:s,class:"flex flex-col inline-block items-center mb-[20px]"},[m(C,{class:"w-[4rem] inline-block mb-8px opacity-90",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),v(" "+f(e.title),1)]))),128))])])),c(je).scanStatus||c(je).isEnd?(o(!0),d(g,{key:1},w(c(Se),(e,s)=>(o(),d("div",{key:s,class:x([e.name+"_item "+(c(je).active[e.name]?"active":""),"progress_item"])},[u("div",{class:"progress_item_header",onClick:s=>(e=>{je.active[e]=!je.active[e]})(e.name)},[u("div",ae,[u("span",null,f(e.title),1)]),u("div",ne,[c(je).statusTotal[e.name]?(o(),d("span",te," 发现"+f(c(je).statusTotal[e.name])+"项危险 ",1)):b("",!0),c(je).scanStatus&&c(Ce)==e.name?(o(),d("span",le," 正在扫描... ")):b("",!0),c(je).scanStatus||c(je).statusTotal[e.name]?b("",!0):(o(),d("span",ie," 无风险项 ")),c(je).scanStatus&&c(Ce)!=e.name&&!c(je).statusTotal[e.name]?(o(),d("span",re," 等待扫描 ")):b("",!0)]),u("div",ce,[u("span",oe,f(c(je).active[e.name]?"收起":"展开"),1),u("i",{class:x(c(je).active[e.name]?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down")},null,2)])],8,se),r(u("div",de,[m(I,{accordion:""},{default:y(()=>[(o(!0),d(g,null,w(c(je).progressConfig[e.name],(e,s)=>(o(),p(M,{key:s,disabled:"free"==c(_e)},{title:y(()=>[u("div",ue,[u("div",me,[u("span",{class:"text-[1.2rem] h-[2.2rem] flex items-center px-[8px] rounded-[0.2rem] mr-[1rem]",style:k({color:c(Fe)[e.dangerous||0].color,backgroundColor:c(Fe)[e.dangerous||0].bg})},f(c(Fe)[e.dangerous||0].text),5),u("span",{innerHTML:e.name},null,8,pe)]),m(j,{class:"mb-2px mr-4px",onClick:Le},{default:y(()=>[...a[6]||(a[6]=[v(" 详情 ",-1)])]),_:1})])]),default:y(()=>[u("div",ge,[u("div",ve,[a[7]||(a[7]=u("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 详情： ",-1)),u("span",{class:"leading-[1.6rem]",innerHTML:e.name},null,8,fe)]),m(l,{class:"!my-8px"}),u("div",be,[a[8]||(a[8]=u("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 修复方案： ",-1)),u("span",{innerHTML:e.repair},null,8,ye)])])]),_:2},1032,["disabled"]))),128))]),_:2},1024)],512),[[_,c(je).active[e.name]]])],2))),128)):b("",!0)])])):(o(),p(D,{key:1,data:c(He)},null,8,["data"]))])),[[z,c(he)]])}}}),[["__scopeId","data-v-d448d5ed"]]);export{xe as default};
