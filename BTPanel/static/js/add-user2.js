import{c as e,r as a,k as s,p as l,G as r,q as d,v as o,H as t,x as u,M as m,A as n,e as i,F as p,a_ as b,I as c,Q as f,ai as h,aj as w,a9 as _,b8 as g,a7 as V}from"./base-lib.js?v=1756369731";import{bU as v,fi as y,M as j,K as U,j as q}from"./utils-lib.js?v=1756369731";import{getDatabasesList as x,addUser as D}from"./database.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const F={class:"p-[24px]"},k=e({__name:"add-user",props:{compData:{default:()=>{}}},setup(e,{expose:k}){const C=e,E=a([]),H=a(null),M=a(C.compData.serverList),A=s({sid:0,username:"",password:v(),host:"127.0.0.1",dbname:"*",tbname:"*",address:"",access:"",disabled:!1,selected:[1,6,21,22],loading:!1}),G={username:[{required:!0,message:"请输入用户名",trigger:["blur"]}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],address:[{required:!0,validator:(e,a,s)=>{y(a)||"ip"!==A.host?s():s(new Error("请输入正确的ip地址"))},trigger:["blur"]}],tbname:[{required:!0,validator:(e,a,s)=>{""===a&&"*"!==A.dbname?s(new Error("请选择数据库表")):s()},trigger:["blur"]}]},I=async()=>{try{A.loading=!0;const e=await x({sid:A.sid});E.value=e.data}catch(e){j.error(e)}finally{A.loading=!1}};return k({onConfirm:async e=>{try{await H.value.validate();const a=("ip"===A.host&&(A.host=A.address),"*"===A.dbname&&(A.tbname="*"),{sid:A.sid,username:A.username,password:A.password,host:A.host,db_name:A.dbname,tb_name:A.tbname});await U({loading:"正在添加用户,请稍后...",request:D(a),message:!0,success:a=>{a.status&&(C.compData.refreshFn&&C.compData.refreshFn(),e())}})}catch(a){}}}),l(I),(e,a)=>{const s=h,l=w,v=_,y=q,j=g,U=V,x=r("bt-loading");return d(),o("div",F,[t((d(),m(U,{"label-width":"90px",model:u(A),ref_key:"addUserFormRef",ref:H,rules:G,onSubmit:a[5]||(a[5]=f(()=>{},["prevent"]))},{default:n(()=>[i(v,{label:"服务器",prop:"password"},{default:n(()=>[i(l,{modelValue:u(A).sid,"onUpdate:modelValue":a[0]||(a[0]=e=>u(A).sid=e),class:"mr-[1.5rem] !w-[16rem]",placeholder:"请选择",onChange:I},{default:n(()=>[(d(!0),o(p,null,b(u(M),e=>(d(),m(s,{key:e.id,label:e.ps,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(v,{label:"用户名",prop:"username"},{default:n(()=>[i(y,{width:"38rem",placeholder:"请填写用户名",modelValue:u(A).username,"onUpdate:modelValue":a[1]||(a[1]=e=>u(A).username=e)},null,8,["modelValue"])]),_:1}),i(v,{label:"密码",prop:"password"},{default:n(()=>[i(y,{width:"38rem",iconType:"refresh",modelValue:u(A).password,"onUpdate:modelValue":a[2]||(a[2]=e=>u(A).password=e),"is-null":!0},null,8,["modelValue"])]),_:1}),i(v,{label:"访问权限",prop:"host"},{default:n(()=>[i(j,{span:8},{default:n(()=>[i(l,{modelValue:u(A).host,"onUpdate:modelValue":a[3]||(a[3]=e=>u(A).host=e),class:"!w-[16rem]"},{default:n(()=>[i(s,{label:"所有人",value:"%"}),i(s,{label:"本地服务器",value:"127.0.0.1"}),i(s,{label:"指定ip",value:"ip"})]),_:1},8,["modelValue"])]),_:1}),t(i(v,{prop:"address"},{default:n(()=>[i(y,{placeholder:"请输入指定ip",modelValue:u(A).address,"onUpdate:modelValue":a[4]||(a[4]=e=>u(A).address=e),width:"22.3rem",class:"ml-[1rem]"},null,8,["modelValue"])]),_:1},512),[[c,"ip"===u(A).host]])]),_:1})]),_:1},8,["model"])),[[x,u(A).loading]])])}}});export{k as default};
