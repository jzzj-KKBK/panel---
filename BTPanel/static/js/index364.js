import{K as e,o as a,j as t,c as l,k as s,h as r,b as n,ah as o,a2 as i}from"./utils-lib.js?v=1756369731";import{c as p,r as u,p as m,aD as d,G as _,q as c,v,e as j,A as y,y as g,x as f,B as x,H as b,M as w,P as h,U as C,ai as S,aj as z,D as V,w as k,Z as M}from"./base-lib.js?v=1756369731";import{g as L}from"./index70.js?v=1756369731";import{u as T,S as U}from"./useStore4.js?v=1756369731";import{_ as H,a as J,b as q}from"./traditional-project.vue_vue_type_script_setup_true_lang.js?v=1756369731";import{_ as D}from"./index.vue_vue_type_style_index_0_lang2.js?v=1756369731";import{_ as N}from"./index.vue_vue_type_script_setup_true_lang14.js?v=1756369731";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1756369731";import{_ as I}from"./index.vue_vue_type_script_setup_true_lang15.js?v=1756369731";import{_ as A}from"./index.vue_vue_type_script_setup_true_lang16.js?v=1756369731";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang17.js?v=1756369731";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang18.js?v=1756369731";import G from"./index476.js?v=1756369731";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang19.js?v=1756369731";import{_ as P}from"./index103.js?v=1756369731";import{u as Z}from"./column.js?v=1756369731";import{getNodeModules as E,installPackages as Q,installModule as R,upgradeModule as W,uninstallModule as X}from"./site.js?v=1756369731";import{_ as Y}from"./index.vue_vue_type_script_setup_true_lang20.js?v=1756369731";import{_ as $}from"./index.vue_vue_type_script_setup_true_lang21.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index130.js?v=1756369731";import"./index104.js?v=1756369731";import"./validator.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";import"./useController6.js?v=1756369731";import"./index141.js?v=1756369731";import"./index124.js?v=1756369731";import"./index.vue_vue_type_script_setup_true_lang13.js?v=1756369731";import"./index101.js?v=1756369731";import"./index140.js?v=1756369731";import"./ace.js?v=1756369731";import"./index418.js?v=1756369731";import"./form-item.js?v=1756369731";import"./useStore12.js?v=1756369731";import"./useController14.js?v=1756369731";import"./config.js?v=1756369731";import"./useController15.js?v=1756369731";import"./useController16.js?v=1756369731";import"./useController13.js?v=1756369731";import"./useController5.js?v=1756369731";import"./useMethod5.js?v=1756369731";import"./useController4.js?v=1756369731";import"./useStore10.js?v=1756369731";import"./useController17.js?v=1756369731";import"./index116.js?v=1756369731";import"./useController18.js?v=1756369731";import"./index323.js?v=1756369731";import"./useStore6.js?v=1756369731";const ee={class:"flex items-center"},ae={class:"flex items-center justify-center text-[12px]"},te={class:"bg-[#333] p-[12px] h-[36rem] text-white overflow-auto"},le=["innerHTML"],se=p({__name:"index",props:{compData:{default:{}}},setup(i,{expose:p}){const{siteInfo:k}=T(),M=n(),L=u(!1),U=u([]),H=u(!1),J=u({mod_name:"",type:"yarn"}),q=u(),D=u("正在请求安装..."),N=async()=>{await e({loading:H,request:E({data:JSON.stringify({project_name:k.value.name,project_cwd:k.value.project_cwd})}),data:[Array,U]})},O=async(t,l)=>{var s,r,n;const{name:o}=k.value,{mod_name:i,type:p}=J.value;if(""===i&&"install"===l)return void M.error("请输入模块名称");"install"!==l&&await a({width:38,title:"".concat("update"===l?"更新":"卸载","模块【").concat(null==t?void 0:t.name,"】"),content:"".concat("update"===l?"更新":"卸载","模块后，可能影响项目正常运行，请谨慎操作，是否继续操作？"),type:"calc"});const u={install:{data:JSON.stringify({project_name:o,mod_name:i,pkg_manager:p})},update:{data:JSON.stringify({project_name:o,mod_name:null==t?void 0:t.name,type:p})},uninstall:{data:JSON.stringify({project_name:o,mod_name:null==t?void 0:t.name})}},m=new Map([["install",R],["update",W],["uninstall",X]]).get(l),d=u[l],_=await e({loading:"正在操作,请稍后...",request:m(d)});(null==(s=null==_?void 0:_.data)?void 0:s.status)?(J.value.mod_name="",N(),M.success(null==(r=null==_?void 0:_.data)?void 0:r.data)):M.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:null==(n=null==_?void 0:_.data)?void 0:n.error_msg,type:"error",duration:0,showClose:!0})};let I=null;const A=(e,a)=>{const t=a.data;D.value+="\n"+t,t.includes("Done")&&(null==I||I.close())},B=async()=>{try{D.value="";const e=Q({data:JSON.stringify({project_name:k.value.name})});I=o({route:"/sock_shell",onMessage:A}),null==I||I.send({"x-http-token":window.vite_public_request_token}),null==I||I.send("tail -f /www/server/panel/logs/npm-exec.log"),L.value=!0,q.value=await e;let{data:a}=await e;a.status||(M.request({status:a.status,msg:a.data||a.msg}),null==I||I.close()),M.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:q.value.data.data,type:q.value.status?"success":"error"})}catch(e){}},F=C([{label:"模块名称",prop:"name"},{label:"版本",prop:"version"},{label:"协议",prop:"license"},{label:"描述",prop:"description"},Z([{onClick:e=>{O(e,"update")},title:"更新"},{onClick:e=>{O(e,"uninstall")},title:"卸载"}])]);return m(N),p({init:N}),d(()=>{null==I||I.close()}),(e,a)=>{const n=S,o=z,i=t,p=V,u=l,m=s,d=r,C=P,k=_("bt-loading"),M=_("scroll-bottom");return c(),v("div",null,[j(C,null,{"header-left":y(()=>[g("div",ee,[j(o,{modelValue:f(J).type,"onUpdate:modelValue":a[0]||(a[0]=e=>f(J).type=e),class:"!w-[10rem]"},{default:y(()=>[j(n,{label:"yarn",value:"yarn"}),j(n,{label:"pnpm",value:"pnpm"}),j(n,{label:"npm",value:"npm"})]),_:1},8,["modelValue"]),j(i,{class:"ml-4px !w-[24rem]",modelValue:f(J).mod_name,"onUpdate:modelValue":a[1]||(a[1]=e=>f(J).mod_name=e),placeholder:"模块名称"},null,8,["modelValue"]),j(p,{type:"primary",class:"ml-1.4rem",onClick:a[2]||(a[2]=e=>O(null,"install"))},{default:y(()=>[...a[4]||(a[4]=[x("安装模块",-1)])]),_:1})])]),"header-right":y(()=>[j(p,{type:"primary",onClick:B},{default:y(()=>[...a[5]||(a[5]=[x("一键安装项目模块",-1)])]),_:1})]),content:y(()=>[b((c(),w(m,{"max-height":"620",column:f(F),data:f(U)},{empty:y(()=>[g("div",ae,[a[7]||(a[7]=x(" 未安装模块,点击 ",-1)),j(u,{onClick:B},{default:y(()=>[...a[6]||(a[6]=[x("一键安装项目模块",-1)])]),_:1})])]),_:1},8,["column","data"])),[[k,f(H)]])]),popup:y(()=>[j(d,{title:"正在安装模块,请稍后...",modelValue:f(L),"onUpdate:modelValue":a[3]||(a[3]=e=>h(L)?L.value=e:null),area:[50,36]},{default:y(()=>[b((c(),v("div",te,[g("pre",{class:"whitespace-pre-line",innerHTML:f(D)},null,8,le)])),[[M]])]),_:1},8,["modelValue"])]),_:1})])}}}),re=p({__name:"index",setup(e){const{siteInfo:a,settingTabActive:t,isJump:l}=T(),{resetTab:s}=U(),r=u(t.value||"project"),n=u(a.value),o=[{label:"项目配置",name:"project",lazy:!0,render:()=>{const e={node:H,pm2:J,general:q};return e[n.value.project_config.project_type]||e.node}},{label:"域名管理",name:"domain",lazy:!0,render:D},{label:"外网映射",name:"mapping",lazy:!0,render:N},{label:"流量限制",name:"limit",lazy:!0,render:O},{label:"伪静态",name:"pseudo",lazy:!0,render:I},{label:"配置文件",name:"configFile",lazy:!0,render:A},{label:"SSL",name:"ssl",lazy:!0,render:B},{label:"重定向",name:"redirect",render:F},{label:"负载状态",name:"load",lazy:!0,render:G},{label:"服务",name:"state",lazy:!0,render:K},{label:"模块管理",name:"modules",lazy:!0,render:se},{label:"项目日志",name:"projectLogs",lazy:!0,render:Y},{label:"网站日志",name:"siteLogs",lazy:!0,render:$}],{BtTabs:p}=i({type:"left-bg-card",value:r,options:o});k(()=>l.value,e=>{e&&(r.value=t.value,s())});const d=u({});return M("nodeData",d),m(async()=>{if("general"===n.value.project_config.project_type){const e=o.findIndex(e=>"modules"===e.name);o.splice(e,1)}if("pm2"===n.value.project_config.project_type){const e=o.findIndex(e=>"load"===e.name);o.splice(e,1)}d.value=await L()}),(e,a)=>(c(),w(f(p),{type:"left-bg-card",modelValue:f(r),"onUpdate:modelValue":a[0]||(a[0]=e=>h(r)?r.value=e:null),options:o},null,8,["modelValue"]))}});export{re as default};
