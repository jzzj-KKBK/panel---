import{_ as e}from"./index103.js?v=1756369731";import{aj as a,v as t,R as s,o,K as n,aM as i,a6 as r,a7 as l,a8 as c}from"./utils-lib.js?v=1756369731";import{s as m,c as d,q as p,v as u,e as f,A as b,x as _}from"./base-lib.js?v=1756369731";import{B as h,C as k,D as g,d as j}from"./useMethod5.js?v=1756369731";import{a as y,u as B,c as C}from"./column.js?v=1756369731";import{u as v}from"./useController5.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./validator.js?v=1756369731";import"./index104.js?v=1756369731";import"./site.js?v=1756369731";import"./useStore4.js?v=1756369731";import"./useController6.js?v=1756369731";const{localRow:w,isRefreshBackupList:R}=m(v()),x=async(e,a,t,s)=>{const{label:o,value:n}=s,i=new Map([["delete","批量删除已选的备份文件，是否继续操作？"]]),r=async(e,a)=>{const{id:t}=e;if("delete"===n)return await k({bak_id:t})};await e({title:"批量".concat(o,"备份文件"),content:"".concat(i.get(n),"，是否继续操作！"),column:[{label:"备份文件",prop:"filename"},C()],onConfirm:async()=>(await a(r),R.value=!0,!1)})},q={class:"p-[2rem]"},M=d({__name:"index",setup(d){const{isRefreshBackupList:C}=m(v()),{BtOperation:M}=i({options:[{type:"button",label:"备份",active:!0,onClick:()=>{n({loading:"正在备份，请稍后...",request:j({s_id:w.value.id,bak_type:3}),success:e=>{e.status&&(R.value=!0)},message:!0})}}]}),L=c([{label:"删除",value:"delete",event:x}]),{BtTable:W,BtPage:z,BtRecommendSearch:D,BtRefresh:S,BtColumn:T,BtBatch:A,BtTableCategory:E,BtErrorMask:H,tableRef:I,classList:K,refresh:N}=r({request:e=>(async e=>{try{const{data:{data:t,page:s}}=await h({s_id:w.value.id,p:e.p,limit:e.limit});return{data:t,total:a(s)}}catch(t){return{data:[],total:0}}})(e),columns:[y(),{label:"文件名",prop:"filename",isCustom:!0,minWidth:180},{label:"文件大小",prop:"size",render:e=>t(Number(e.size),!0)},{label:"备份时间",prop:"addtime",minWidth:120,render:e=>s(e.bak_time)},{label:"信息",prop:"bak_type",minWidth:80,render:e=>1==e.bak_type?"仅文件":2==e.bak_type?"仅DB":"完整的备份"},B([{title:"恢复",onClick:async e=>{await o({title:"恢复备份文件",content:"将恢复站点文件和数据库，继续吗？",onConfirm:async()=>{n({loading:"正在恢复备份文件，请稍后...",request:g({bak_id:e.id}),success:e=>{},message:!0})}})}},{title:"下载",onClick:e=>{const a="".concat(window.location.origin);window.open("".concat(a,"/download?filename=").concat(encodeURIComponent(e.bak_file)).concat(e.filename?"&amp;name=".concat(e.filename):""),"_blank","noopener,noreferrer")}},{title:"删除",onClick:e=>{o({title:"删除备份文件",content:"网站备份即将被删除 【".concat(e.filename,"】，是否继续操作?"),onConfirm:async()=>{n({loading:"正在删除备份文件，请稍后...",request:k({bak_id:e.id}),success:e=>{e.status&&(R.value=!0)},message:!0})}})}}])],extension:[L,l(C)]});return(a,t)=>{const s=e;return p(),u("div",q,[f(s,null,{"header-left":b(()=>[f(_(M))]),"header-right":b(()=>[...t[0]||(t[0]=[])]),content:b(()=>[f(_(W),{"min-height":500})]),"footer-left":b(()=>[f(_(A))]),"footer-right":b(()=>[f(_(z))]),_:1})])}}});export{M as default};
