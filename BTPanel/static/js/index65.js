import{_ as e}from"./index103.js?v=1756369731";import{_ as t}from"./index145.js?v=1756369731";import{o as a,K as s,fc as l,M as n,eU as i,eX as r,l as o,L as c,fd as d,u,a6 as p,fe as m,a7 as _,a8 as v}from"./utils-lib.js?v=1756369731";import{s as y,j as f,r as b,c as h,e as g,aQ as w,q as k,v as j,A as x,y as T,x as A,J as R}from"./base-lib.js?v=1756369731";import{c as q,a as L,b as B,u as M}from"./column.js?v=1756369731";const O=f("NODE-ALARM-STORE",()=>{const e=b(),t=b(!1);return{alarmRowData:e,nodeAlarmRefresh:b(!1),isAlarmEdit:t}}),S=()=>y(O()),{alarmRowData:C,isAlarmEdit:E,nodeAlarmRefresh:N}=S(),D=async(e,t,a,s)=>{const n=async(e,t)=>{const{id:a,status:s}=e,n=new Map([["delete",l],["start",d],["stop",d]]).get(r);switch(r){case"start":if(n)return await n({task_id:a,status:1});break;case"stop":if(n)return await n({task_id:a,status:0});break;case"delete":if(n)return await n({task_id:a})}},{label:i,value:r}=s;await e({title:"批量".concat(i,"告警"),content:"即将批量".concat(i,"告警，是否继续操作?"),column:[{label:"告警名称",prop:"title"},q()],onConfirm:async()=>(await t(n),N.value=!0,!1)})},J=()=>{var e,t,a,s,l,n,i,r,o,c,d,u;try{let p="clb";return E.value&&(p=["222","223"].includes(null==(t=null==(e=C.value)?void 0:e.task_data)?void 0:t.tid)?"master":"clb"),{alarmType:p,lcbType:0,sendTimes:(null==(s=null==(a=C.value)?void 0:a.number_rule)?void 0:s.day_num)||3,failTimes:(null==(n=null==(l=C.value)?void 0:l.task_data)?void 0:n.err_num)||3,successCode:(null==(r=null==(i=C.value)?void 0:i.task_data)?void 0:r.codes)||"200,301,302,403,404",name:E.value?null==(c=null==(o=C.value)?void 0:o.task_data)?void 0:c.project:"",type:(null==(d=C.value)?void 0:d.sender)||[],masterType:(null==(u=C.value)?void 0:u.template_id)||"222"}}catch(p){return{}}},z=async e=>{try{await a({icon:"warning-filled",title:"删除告警任务",content:"删除后将不再告警此条任务，是否继续？"}),await s({loading:"正在删除告警任务，请稍候...",request:l({task_id:e.id}),message:!0,success:()=>{N.value=!0}})}catch(t){}},H=async e=>{C.value=e||{},E.value=!!e;const t=n.load("正在加载数据，请稍后..."),{data:{data:a}}=await i({page:1,page_size:100}),{data:{data:s}}=await r({page:1,page_size:100});t.close(),e||(C.value={clbList:[],tcpList:[]}),C.value.clbList=a.map(e=>({label:e.ps,value:e.load_id})),C.value.tcpList=s.map(e=>({label:e.ps,value:e.load_id})),o({isAsync:!0,title:"".concat(e?"修改":"添加","告警"),area:48,btn:!0,component:()=>c(()=>import("./index355.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},I=async e=>{try{await a({title:"".concat(e.status?"禁用":"启用","【").concat(e.title,"】任务"),content:"您真的要".concat(e.status?"禁用":"启用","【").concat(e.title,"】这个任务吗？")}),await s({loading:"正在修改告警任务状态，请稍候...",request:d({task_id:e.id,status:Number(!e.status)}),message:!0,success:()=>{N.value=!0}})}catch(t){}},P=[{label:"启动",value:"start",event:D},{label:"停止",value:"stop",event:D},{label:"删除",value:"delete",event:D}],K=e=>{const{alarmType:t,lcbType:a,sendTimes:s,failTimes:l,successCode:n,name:i,type:r,masterType:o}=e,c={sender:r,number_rule:{day_num:Number(s),total:2},time_rule:{send_interval:0,time_range:[0,86399]}},d={status:!0,count:0,interval:600};switch(!0){case"clb"===t&&0===a:return{template_id:"220",task_data:JSON.stringify({...c,task_data:{...d,tid:"220",type:"nodes_nginx_http_load_push",title:"节点管理-负载均衡",project:i,codes:n}})};case"clb"===t&&1===a:return{template_id:"221",task_data:JSON.stringify({...c,task_data:{...d,tid:"221",type:"nodes_nginx_tcp_load_push",title:"节点管理-tcp负载均衡",project:i,err_num:l}})};case"master"===t:return{template_id:o,task_data:JSON.stringify({...c,task_data:{...d,tid:"mysql"===o?"222":"223",type:"mysql"===o?"nodes_mysql_slave_err_push":"nodes_redis_slave_err_push",title:"mysql"===o?"节点管理-Mysql主从告警":"节点管理-Redis主从告警",project:""}})};default:return null}},Q={class:"node-clb-http module-ui"},U={class:"flex items-center"},V={class:"flex items-center"},W=h({__name:"index",setup(a){const{nodeAlarmRefresh:s}=S(),{mainHeight:l,push:n,getSenderAlarmListInfo:i}=u(),r=[{content:"添加告警",dropdownClass:"bg-white",splitButton:!0,active:!0,event:()=>H()}],o=v(P),c=new Map([["wx_account","微信公众号"],["feishu","飞书"],["mail","邮箱"],["sms","短信通知"],["dingding","钉钉"],["weixin","企业微信"],["webhook","自定义消息通道"]]);let d=!0;const{BtTable:y,BtRefresh:f,BtSearch:b,BtColumn:h,BtBatch:q,BtErrorMask:O,refresh:C}=p({request:async e=>{var t;d&&(await i(),d=!1);const{data:a}=await m({keyword:e.search,template_ids:'["220", "221", "222", "223"]'});return{data:null==(t=a.data)?void 0:t.map(e=>{const{sender:t}=e;return{...e,alarmAccounts:t.map(e=>{const t=n.value.config.find(t=>t.id===e);return t?"sms"===t.sender_type?{id:e,type:t.sender_type,title:"短信"}:{id:e,type:t.sender_type,title:c.get(t.sender_type)||"",account:t.data.title}:null})}}),total:0,other:{}}},columns:[L({type:"page",key:"id"}),{label:"名称",prop:"title"},B({minWidth:100,event:I,data:["停用","正常"]}),{label:"告警方式",width:260,render:e=>{const t=(e.alarmAccounts||[]).filter(e=>null!==e),a=t.map(e=>"sms"===(null==e?void 0:e.type)?"短信通知":"".concat((null==e?void 0:e.account)||"","(").concat((null==e?void 0:e.title)||"",")")).join(","),s=t.map(e=>"sms"===(null==e?void 0:e.type)?"短信通知":"".concat(null==e?void 0:e.account,"(").concat(e.title,")")).join(",");return g(w,{content:a,placement:"top","open-delay":500},{default:()=>[g("span",null,[s])]})}},{label:"告警条件",prop:"view_msg",render:e=>g("span",{innerHTML:e.view_msg},null)},M([{onClick:H,title:"修改"},{onClick:z,title:"删除"}])],extension:[o,_(s)]});return(a,s)=>{const n=t,i=e;return k(),j("div",Q,[g(i,null,{"header-left":x(()=>[T("div",U,[g(n,{options:r})])]),"header-right":x(()=>[T("div",V,[g(A(b),{class:R(["mr-[10px]","!w-[210px]"]),placeholder:"请输入节点地址或备注"}),g(A(h))])]),content:x(()=>[g(A(y),{"min-height":A(l)},null,8,["min-height"])]),"footer-left":x(()=>[g(A(q))]),"footer-right":x(()=>[...s[0]||(s[0]=[])]),_:1})])}}}),X=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{J as a,K as g,X as i,S as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
