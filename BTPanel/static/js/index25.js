import{K as a,au as e,aj as t,b as l,u as s,av as n,aw as i,ax as o,l as p,L as r,c,e as d,ay as u,az as m,aA as v,o as f,aB as _,aC as y,w as g,ai as h,aD as x,aE as w,aF as k,aG as b,aH as C,aI as D,aJ as j,ah as I,I as q}from"./utils-lib.js?v=1756369731";import{k as E,ar as T,s as z,j as A,r as R,U as S,c as O,w as V,p as L,a4 as M,q as P,v as H,y as F,e as N,x as G,O as U,B,A as K,J as W,F as J,a_ as Q,M as $,H as X,I as Y,z as Z,C as aa,D as ea,ao as ta,an as la,aQ as sa,ap as na,n as ia,T as oa,aj as pa,ai as ra,i as ca,g as da,ba as ua,a$ as ma,ax as va,aD as fa,K as _a,av as ya,G as ga}from"./base-lib.js?v=1756369731";import{g as ha}from"./useStore3.js?v=1756369731";import{_ as xa}from"./index101.js?v=1756369731";import{c as wa,N as ka,g as ba}from"./useMethods.js?v=1756369731";import{j as Ca}from"./validator.js?v=1756369731";import{s as Da}from"./vue-virtual-scroller.esm.js?v=1756369731";import"./vue-virtual-scroller.js?v=1756369731";import{h as ja,b as Ia,c as qa}from"./form-item.js?v=1756369731";import{o as Ea}from"./useController4.js?v=1756369731";import{_ as Ta}from"./index.vue_vue_type_style_index_0_lang.js?v=1756369731";import{B as za}from"./index140.js?v=1756369731";const Aa=l(),{refs:{deployMenuData:Ra}}=ha(),Sa=E({loading:!1,list:[],total:0}),Oa=E({p:1,row:200,query:"",force:0}),Va=async(l={query:Oa.query,p:Oa.p,row:Oa.row,force:0})=>{const s="docker_app_list_timestamp",n=localStorage.getItem(s),i=Date.now();let o=!1;(!n||i-parseInt(n)>864e5)&&(o=!0),a({request:e({...l,app_type:Ra.value.app_type,force:l.force||(o?1:0)}),loading:T(Sa,"loading"),success:a=>{a.status?((1===l.force||o)&&(localStorage.setItem(s,i.toString()),!o&&Aa.success("刷新成功")),Sa.list=a.data.data.map((a,e)=>({...a,index:"".concat(a.appname||Math.random().toString(36).substring(2,15),"_").concat(e)})),Sa.total=t(a.data.page),Ra.value.maximum_cpu=a.data.maximum_cpu,Ra.value.maximum_memory=a.data.maximum_memory+" MB"):Aa.error(a.msg)}})},La=A("DOCKER-APP-STORE-LOCAL",()=>({activeTabs:R("git"),apphubGitConfig:R({}),isSaveGitConfig:R(!1),usingHelpLink:R("https://www.bt.cn/bbs/thread-147864-1-1.html")})),Ma=()=>z(La()),{apphubGitConfig:Pa,isSaveGitConfig:Ha}=Ma(),Fa=l(),{refs:{deployMenuData:Na}}=ha(),{mainWidth:Ga}=s(),Ua=S([]),Ba=S(""),Ka=()=>Math.floor((Ga.value-420)/140),Wa=R(),Ja=async a=>{if(Oa.p=1,Qa(),"installed"===Na.value.app_type)return await Xa("all"),void(a&&Fa.success("刷新成功"));Oa.force=a?1:0,a&&await wa(),await Va(Oa)},Qa=async()=>await a({request:n(),data:[Array,Ua],success:a=>{Wa.value=a.slice(Ka(),a.length)}}),$a=async a=>{var e,t;Ba.value=(null==(t=null==(e=Wa.value)?void 0:e.find(e=>e.type===a))?void 0:t.desc)||"",Na.value.app_type=a,Oa.query="",Oa.p=1,Oa.force=0,await Va(Oa)},Xa=async e=>{var l,s;Sa.loading=!0,Ba.value=(null==(s=null==(l=Ua.value)?void 0:l.find(a=>a.type===e))?void 0:s.desc)||"",Na.value.app_type="installed",a({request:i({app_type:e,p:1,row:20,query:Oa.query||""}),loading:T(Sa,"loading"),success:a=>{a.status?(Sa.list=a.data.data.map((a,e)=>({...a,index:e}))||[],a.data.page?Sa.total=t(a.data.page):Sa.total=0):Fa.error(a.msg)}})},Ya=()=>{"installed"===Na.value.app_type&&Xa("all"),Na.value.app_type="installed"},Za=()=>{Ua.value=[],Ba.value="",Wa.value=[]},ae=async a=>{const e=Fa.load("正在获取配置信息...");try{const a=await o(),e=a.data.git_config||{},{git_url:t="",git_branch:l="",user_config:s={}}=e;Pa.value={git_url:t,git_branch:l,name:s.name||"",password:s.password||""},a.status&&(Ha.value=!0),p({title:"导入应用",area:70,btn:["导入","取消"],component:()=>r(()=>import("./index138.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})}catch(t){}finally{null==e||e.close()}},ee={class:"flex flex-1 relative items-center mb-20px"},te={class:"text-[1.2rem] text-[#666] leading-[2rem] mx-[2rem] flex items-center"},le={class:"w-full flex items-center"},se={class:"flex flex-1 relative flex-wrap"},ne=["onClick"],ie=d(O({__name:"index",setup(a,{expose:e}){const{refs:{deployMenuData:t}}=ha(),{mainWidth:l}=s();V(()=>l.value,()=>{var a,e,l;Wa.value=Ua.value.slice(Ka(),null==(a=Ua.value)?void 0:a.length),Ba.value=(null==(l=null==(e=Wa.value)?void 0:e.find(a=>a.type===t.value.app_type))?void 0:l.desc)||""}),L(Qa);const n=R();return M(Za),e({testRef:n}),(a,e)=>{var l,s;const i=xa,o=c,p=ea,r=na,d=ta,u=la,m=sa;return P(),H("div",{ref_key:"testRef",ref:n},[F("div",ee,[e[13]||(e[13]=F("span",{class:"w-[80px] pr-16px text-[14px] flex justify-end flex-shrink-0"},"应用搜索",-1)),N(i,{class:"!w-[52rem]",ref:"searchRef",icon:"el-search",modelValue:G(Oa).query,"onUpdate:modelValue":e[0]||(e[0]=a=>G(Oa).query=a),clearable:"",onClear:e[1]||(e[1]=a=>G(Ja)(!1)),onIconClick:e[2]||(e[2]=a=>G(Ja)(!1)),placeholder:"支持应用名称、字段模糊搜索",onKeyup:e[3]||(e[3]=U(a=>G(Ja)(!1),["enter","native"]))},null,8,["modelValue"]),F("span",te,[e[11]||(e[11]=B(" 如果您希望添加其它Docker应用，请 ",-1)),F("span",{class:"bt-link",onClick:e[4]||(e[4]=a=>G(Ca)())},"联系客服"),e[12]||(e[12]=B(" ,或进行 ",-1)),F("span",{class:"bt-link",onClick:e[5]||(e[5]=a=>G(ka)())},"需求反馈"),N(o,{href:"https://www.bt.cn/bbs/thread-137717-1-1.html",class:"ml-4px"},{default:K(()=>[...e[10]||(e[10]=[B(">>使用帮助",-1)])]),_:1})])]),F("div",le,[e[20]||(e[20]=F("span",{class:"w-[80px] pr-16px text-[14px] flex justify-end"},"应用分类",-1)),F("div",{class:W(["class-item",{on:"all"===G(t).app_type}]),onClick:e[6]||(e[6]=a=>G($a)("all"))},"全部",2),F("div",{class:W(["class-item flex-shrink-0",{on:"installed"===G(t).app_type}]),onClick:e[7]||(e[7]=(...a)=>G(Ya)&&G(Ya)(...a))},"已安装",2),F("div",se,[(P(!0),H(J,null,Q(null==(l=G(Ua))?void 0:l.slice(0,G(Ka)()),(a,e)=>(P(),H("div",{key:e,onClick:e=>G($a)(a.type),class:W(["class-item",G(t).app_type===a.type?"on":""])},Z(a.desc),11,ne))),128)),(null==(s=G(Wa))?void 0:s.length)?(P(),$(u,{key:0,"show-timeout":200,onCommand:G($a)},{dropdown:K(()=>[N(d,null,{default:K(()=>[(P(!0),H(J,null,Q(G(Wa),(a,e)=>(P(),$(r,{key:e,command:a.type},{default:K(()=>[B(Z(a.desc),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:K(()=>[N(p,{type:"default",class:W(["AppClassButton",{on:G(Wa).some(a=>a.type===G(t).app_type)}])},{default:K(()=>[e[14]||(e[14]=B(" 更多 ",-1)),X(F("span",null,"（"+Z(G(Ba))+"）",513),[[Y,G(Ba)]]),e[15]||(e[15]=F("i",{class:"svgtofont-el-arrow-down ml-[.5rem]"},null,-1))]),_:1},8,["class"])]),_:1},8,["onCommand"])):aa("",!0)]),X(N(p,{title:"更新列表",class:"refresh !mr-[1.2rem]",onClick:e[8]||(e[8]=a=>G(Ja)(!0))},{default:K(()=>[...e[16]||(e[16]=[B(" 更新应用列表 ",-1)])]),_:1},512),[[Y,"installed"!==G(t).app_type&&"AppHub"!==G(t).app_type]]),"AppHub"===G(t).app_type?(P(),H(J,{key:0},[N(m,{content:"支持从Git仓库或本地文件导入应用，自动扫描并识别多个应用，支持选择性导入和批量导入",placement:"top"},{content:K(()=>[...e[17]||(e[17]=[F("div",{class:"flex flex-col pb-[4px]"},[F("div",null,"支持从Git仓库或本地文件导入应用"),F("div",null,"自动扫描并识别多个应用"),F("div",null,"支持选择性导入和批量导入")],-1)])]),default:K(()=>[...e[18]||(e[18]=[F("span",{class:"bt-ico-ask"},"?",-1)])]),_:1}),N(p,{type:"primary",title:"导入应用",class:"refresh !mr-[1.2rem] ml-[1rem]",onClick:e[9]||(e[9]=a=>G(ae)())},{default:K(()=>[...e[19]||(e[19]=[B(" 导入应用 ",-1)])]),_:1})],64)):aa("",!0)])],512)}}}),[["__scopeId","data-v-c3cb349f"]]),oe=l(),{refs:{deployMenuData:pe}}=ha(),re=R(!1),ce=R(!1);let de=null;const ue=async()=>{re.value||(re.value=!0,ce.value=!0,Sa.list.length<Sa.total&&(Oa.p++,"installed"===pe.value.app_type?await me("all"):await Va(Oa)),re.value=!1)},me=async(e,l)=>{try{1===Oa.p&&(Sa.list=[]),l||(Sa.loading=!0),pe.value.app_type="installed",await a({request:i({app_type:e||"all",p:Oa.p,row:20,query:Oa.query||""}),success:a=>{if(a.status){const e=a.data.data.map((a,e)=>({...a,index:e}))||[];Sa.list=[...Sa.list,...e],a.data.page?Sa.total=t(a.data.page):Sa.total=0}else oe.error(a.msg)}})}catch(s){}finally{Sa.loading=!1}},ve=()=>{Sa.list.some(a=>"initializing"===a.status)&&(de=setTimeout(()=>{me("all",!0),ve()},3e4))},fe=""+new URL("../img/soft_ico/icon_plug.svg",import.meta.url).href;function _e(a){return"function"==typeof a||"[object Object]"===Object.prototype.toString.call(a)&&!ca(a)}const ye=l(),{refs:{deployMenuData:ge}}=ha(),{refs:{isRefreshInstallList:he}}=u(),xe={mode:"ace/mode/json",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"},we=async(a,e)=>{const{appname:t,appid:l}=a,s=-1==l?"/static/img/soft_ico/apphub":"/static/img/soft_ico/dkapp",n=-1==l?"ico-apphub_":"ico-dkapp_",i=null==t?void 0:t.replace(/-+[{0-9},\.,]+$/,""),o="".concat(s,"/").concat(n).concat(i,".png");e.value=await ba(o)},ke=a=>a.canUpdate&&a.installed,be=async a=>{await Ye({appData:a,openDependInstall:Ce}),Xe(),p({title:"".concat(a.appname,"安装配置"),area:70,component:()=>r(()=>import("./add-app-soft.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{appData:a,openDependInstall:Ce},showFooter:!0})},Ce=async({name:a,type:e})=>{ge.value.app_type=e,Oa.query="",await Va(),ia(async()=>{const e=Sa.list.find(e=>e.appname===a);e&&(await Ye({appData:e,openDependInstall:Ce}),Xe(),p({title:"".concat(e.appname,"安装配置"),area:70,component:()=>r(()=>import("./add-app-soft.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{appData:e,openDependInstall:Ce},showFooter:!0}))})},De=async a=>{p({title:"更新配置",area:42,component:()=>r(()=>import("./app-update.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:a,showFooter:!0})},je=a=>{p({title:"详情展示",area:64,component:()=>r(()=>import("./detail-view.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:a,btns:!1})},Ie=(a,e,t)=>{switch(a){case"ollama":case"ollama_and_openwebui":case"deepseek_r1":p({title:"管理",area:[86,52],component:()=>r(()=>import("./index139.js?v=1756369731").then(a=>a.i),__vite__mapDeps([]),import.meta.url),compData:{...e,...t},btns:!1});break;case"mysql":case"redis":case"postgresql":case"tdengine":Ee(a,e)}},qe=O({name:"ContainerTerminalDialog",props:{compData:{type:Object,default:()=>({})}},setup(a,{expose:e}){const t=R(),l=R(a.compData.cmd);let s=R(null);return L(()=>{ia(()=>{s.value=t.value.socketInfo(),s.value.send("cd /www/wwwroot\r\n"),s.value.send("clear && ".concat(l.value,"\r\n"))})}),e({onCancel:()=>{s.value.close()}}),()=>N("div",{class:"p-[1rem] bg-[#111] h-full"},[N(Ta,{id:"dockerTerminal",class:"h-full",active:!0,ref:t,url:"/webssh","host-info":{}},null)])}}),Ee=async(e,t)=>{const l=["redis_password","mysql_root_password","postgres_password"];let s="";for(const a of t.appinfo)if(l.includes(a.fieldKey)){s=a.fieldValue;break}const n=await a({request:m({appname:e,id:t.container_id,password:s}),loading:"正在获取数据库终端命令，请稍后..."});if(!n.status)return ye.error("连接数据库失败");p({component:()=>qe,title:"宝塔终端",area:[80,50],compData:{cmd:n.msg}})},Te=a=>"0.0.0.0"===a.host_ip&&"Database"!==a.apptype&&"System"!==a.apptype,ze=(a,e,t)=>{"0.0.0.0"===a.host_ip&&"Database"!==a.apptype&&"System"!==a.apptype?window.open("".concat(t,"://").concat(a.server_ip,":").concat(e),"_blank","noopener,noreferrer"):ye.error("当前应用不支持IP+端口访问")},Ae=async(a,e)=>{var t;if("path"===a){const{router:a}=await r(()=>import("./utils-lib.js?v=1756369731").then(a=>a.jG),__vite__mapDeps([]),import.meta.url),l=null==(t=e.appinfo.filter(a=>"app_path"===a.fieldKey)[0])?void 0:t.fieldValue;v("Path",l);let s=ye.load("正在跳转,请稍后...");a.push({path:"/files"}),s.close()}},Re=async a=>{Ea({id:a.site_id,name:a.site_name,addtime:a.site_addtime})},Se=(a,e,t)=>{if(t&&"initializing"!==a.status)return;let l=!1;"log"===e&&"initializing"===a.status&&(l=!0);const s={back:{component:()=>r(()=>import("./backup-view.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),area:82,title:"应用备份",showFooter:!1},log:{component:()=>r(()=>import("./app-log.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),area:88,title:"应用日志",showFooter:!1},password:{component:()=>r(()=>import("./update-password.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),area:42,title:"修改mysql密码",showFooter:!0}};p({title:s[e].title,area:s[e].area,compData:{...a,isInit:l},component:s[e].component,showFooter:s[e].showFooter})},Oe=async(e,t,l)=>{await f({title:"提示",content:"确定要".concat({rebuild:"重建",start:"启动",restart:"重启",stop:"停止"}[t],"【").concat(l.service_name,"】吗?"),icon:"warning-filled"}),await a({request:_({service_name:l.service_name,status:t,app_name:l.appname}),loading:"正在操作,请稍后...",message:!0}),e("refresh")},Ve=async(e,t)=>{await f({title:"提示",content:"确定要删除【".concat(t.appname,"】吗?"),icon:"warning-filled",type:"check",check:{content:"同时删除此应用的所有数据",onConfirm:async l=>{await a({request:y({id:t.id,delete_data:Number(l)}),loading:"正在删除,请稍后...",message:!0}),e("refresh")}}})},Le=a=>window.open("http://"+a,"_blank","noopener,noreferrer"),Me=S({});let Pe=E({version:""});const He=(a,e)=>{switch(a.type){case"password":return ja(a.name,()=>N("div",{class:"flex flex-col items-start justify-center w-full"},[N(xa,{placeholder:"请输入".concat(a.name),width:"24rem","is-active":!0,modelValue:e.value[a.attr],"onUpdate:modelValue":t=>e.value[a.attr]=t,icon:"el-refresh",onInput:t=>Ke(a,t,e),onIconClick:()=>Pe[a.attr]=g(16)},null)]),a.attr,{rules:{}});case"checkbox":return ja(a.name,()=>N(oa,{modelValue:e.value[a.attr],"onUpdate:modelValue":t=>e.value[a.attr]=t,label:a.name,class:"!my-0"},{default:()=>[N("span",{class:"unit"},[B(" * "),a.suffix,B(" ")])]}),a.attr);case"textarea":return qa(a.name,a.attr,{attrs:{placeholder:"请输入".concat(a.name),autosize:{minRows:1,maxRows:15},class:"!w-[244px]",onInput:t=>Ke(a,t,e)},rules:[{required:!1,message:"请输入".concat(a.name),trigger:["change","blur"]}],slots:{unit:()=>We(a)}});default:if("string"==typeof a.type&&a.type.startsWith("ace:")){const t=a.type.split(":")[1]||"",l={...xe,mode:t?"ace/mode/".concat(t):"ace/mode/text"};return ja(a.name,()=>N("div",{class:"flex flex-col items-start justify-center w-full"},[N(za,{key:"editer1",class:"!w-[360px] h-[30rem]",modelValue:e.value[a.attr],"onUpdate:modelValue":t=>e.value[a.attr]=t,editorOption:l},null),a.suffix?N("span",{class:"text-[#666] text-[1.2rem] leading-[1] mt-[1rem]",innerHTML:" * ".concat(a.suffix)},null):N("span",null,null)]),a.attr)}return Ia(a.name,a.attr,{attrs:{class:"!w-[244px] relative;",placeholder:"请输入".concat(a.name)},slots:{unit:()=>We(a)},rules:[{required:!1,message:"请输入".concat(a.name),trigger:"blur"}]})}},Fe=(a,e,t)=>ja(a.appTypeCN,()=>{var e;let l,s;return N("div",null,[(null==(e=Ge.value[Ue(a)])?void 0:e.appname)&&N(pa,{class:"!w-[12rem]",modelValue:Ge.value.form[a.apptype],"onUpdate:modelValue":e=>Ge.value.form[a.apptype]=e},_e(l=a.appname.map(a=>N(ra,{label:a,value:a},null)))?l:{default:()=>[l]}),N(pa,{modelValue:Ge.value[Be(a)].service_name,"onUpdate:modelValue":e=>Ge.value[Be(a)].service_name=e,placeholder:0==Ge.value[Be(a)].option.length?"未安装":"请选择",disabled:0==Ge.value[Be(a)].option.length,class:"ml-[0.8rem] !w-[16rem]"},_e(s=Ge.value[Be(a)].option.map(a=>N(ra,{label:a.service_name+" "+a.version,value:a.service_name},null)))?s:{default:()=>[s]}),N("span",{class:"ml-[2rem] text-[1.2rem] leading-[2.2rem] text-[#999]"},[a.appDesc]),0==Ge.value[Be(a)].option.length&&N("div",null,[N("span",{class:"leading-[1] bt-link !text-[1.2rem]",onClick:()=>Je({name:Be(a),type:a.apptype},t)},[B("点击安装")])])])}),Ne=S([]),Ge=R({}),Ue=({appname:a})=>h(a)?a:a[0],Be=a=>Ge.value.form[a.apptype],Ke=(a,e,t)=>{"domain"===a.attr&&""!==e&&(t.value.allow_access=!1)},We=a=>{const e="whitespace-nowrap absolute left-[250px] top-0 text-[#666]";return"cpus"===a.attr?N("span",{class:e},[" * ".concat(a.suffix).concat(ge.value.maximum_cpu)]):"memory_limit"===a.attr?N("span",{class:e},[" * ".concat(a.suffix).concat(ge.value.maximum_memory)]):a.suffix?N("span",{class:e,innerHTML:" * ".concat(a.suffix)},null):N("span",null,null)},Je=(a,e)=>{Me.value.openDependInstall(a),e()},Qe=a=>{if(!(a.indexOf(".")>-1))return!1;const e=a.split(".");return 3===e.length?{x:e[0],yz:"".concat(e[1],".").concat(e[2])}:2===e.length&&{x:e[0],yz:e[1]}},$e=async e=>{const t=await(()=>{try{if(Pe.domain&&!C(Pe.domain))return void ye.error("域名格式不正确");let a={...Pe,...-1==Me.value.appData.appid?{appid:Number(Me.value.appData.appid)}:{},app_name:Me.value.appData.appname,disable_domain:Number(!Pe.domain),allow_access:Number(Pe.allow_access)};return Qe(Pe.version)?(a.m_version=Qe(Pe.version).x,a.s_version=Qe(Pe.version).yz):(a.m_version=Pe.version,a.s_version=""),Me.value.appData.depend&&(a.depend_app=[],Object.keys(Ge.value.form).forEach(e=>{const t=Ge.value.form[e];Object.keys(Ge.value).forEach(e=>{if(t===e){if(!Ge.value[e].service_name)throw ye.error("未选择必须依赖项"),new Error("未选择必须依赖项");a.depend_app.push({appname:Ge.value[e].appname,service_name:Ge.value[e].service_name})}})}),a.depend_app=JSON.stringify(a.depend_app)),a}catch(a){}})();t&&a({loading:"正在安装...",request:x(t),message:!0,success:a=>{a.status&&(ge.value.app_type="installed",e())}})},Xe=()=>{var a,e,t;Ne.value=[],null==(e=null==(a=Me.value.appData)?void 0:a.appversion)||e.forEach(a=>{a.s_version.length?a.s_version.forEach(e=>{Ne.value.push({label:a.m_version+"."+e,value:a.m_version+"."+e})}):Ne.value.push({label:a.m_version,value:a.m_version})}),Pe.version=null==(t=Ne.value[0])?void 0:t.value},Ye=async e=>{var t,l;let s=[];Ge.value.form={},Me.value=e,(a=>{var e;null==(e=a.field)||e.forEach(a=>{Pe[a.attr]=a.default,"checkbox"===a.type&&(Pe[a.attr]=Boolean(a.default))}),Pe.service_name="".concat(a.appname,"_").concat(g(4))})(e.appData),null==(t=e.appData.depend)||t.forEach(a=>Ge.value.form[a.apptype]=""),null==(l=e.appData.depend)||l.forEach(a=>{a.appname.forEach((e,t)=>{!t&&(Ge.value.form[a.apptype]=e),Ge.value[e]={appname:e,apptype:a.apptype,version:"",service_name:"",option:[]},s.push({app_name:e,app_type:a.apptype})})}),a({request:w({depend_app:JSON.stringify(s)}),data:{data:Array},success:a=>{var e;null==(e=a.data)||e.forEach((a,e)=>{var t;Ge.value[a.appname].service_name=null==(t=a.installed[0])?void 0:t.service_name,Ge.value[a.appname].option=a.installed||[]})}})},Ze=()=>{Me.value={},Pe=E({version:""}),Ne.value=[],Ge.value={}};let at=null,et=[],tt={};const lt=R("run"),st=S(""),nt=(a,e)=>{try{const a=e.data;et.push(a),et.length>50?st.value=null==et?void 0:et.slice(et.length-50).join(" "):st.value=null==et?void 0:et.join(" "),(a.includes("bt_successful")||a.includes("bt_failed"))&&(null==at||at.close())}catch(t){null==at||at.close()}},it=a=>{st.value="",et=[],"run"===a?pt():ct()},ot=()=>{"run"===lt.value?pt():ct()},pt=async()=>{a({request:D({service_name:tt.service_name,app_name:tt.appname}),success:a=>{st.value=a.data.data}})},rt=a=>{tt=a,tt.isInit?(lt.value="install",ct()):pt()},ct=async()=>{if(tt.isInit)return at=I({route:"/sock_shell",onMessage:nt}),void(null==at||at.send("tail -f "+(null==(e=tt.appinfo.filter(a=>"installed_log"===a.fieldKey)[0])?void 0:e.fieldValue)));var e;a({request:j({service_name:tt.service_name}),success:a=>{st.value=a.data.data||""}})},dt=()=>{null==at||at.close(),at=null,et=[],tt={},lt.value="run",st.value=""},ut=E({version:"",backup:!1,pull:!1,id:""}),mt=S([]),vt=async e=>{ut.id=e.id,await a({request:k({id:ut.id}),data:{data:[Array,mt]},success:a=>{ut.version=a.data[0].version}})},ft=async e=>{let t={id:ut.id,m_version:ut.version.split(".")[0],s_version:"".concat(ut.version.split(".")[1],".").concat(ut.version.split(".")[2]),backup:ut.backup,pull:ut.pull};await a({request:b(t),loading:"正在更新,请稍后...",message:!0}),he.value=!0,e()},_t=()=>{ut.version="",ut.backup=!1,ut.pull=!1,ut.id="",mt.value=[]},yt=["src"],gt={src:fe,alt:"icon_plug",key:"icon_plug",class:"AppImg"},ht={class:"AppContent"},xt={class:"w-full flex items-start justify-between"},wt={class:"flex-col flex flex-grow-0"},kt={class:"AppRow"},bt=["title"],Ct={key:0,class:"flex items-center"},Dt={key:0,class:"flex items-center"},jt={key:1},It={class:"mx-8px"},qt=["innerHTML","title"],Et={key:1,class:"AppDescribe"},Tt={class:"AppRow"},zt={class:"-m-[12px]"},At=["onClick"],Rt=["onClick"],St=["title","onClick"],Ot={class:"flex items-center flex-1"},Vt={class:"flex items-center"},Lt={class:"truncate max-w-[24rem]"},Mt={key:0,class:"flex"},Pt={key:0,class:"absolute bottom-14px w-[80%]"},Ht={key:1,class:"tag-container absolute bottom-6"},Ft=d(O({__name:"index",props:{data:{default:()=>({})}},emits:["refresh"],setup(a,{emit:e}){const t=a,{refs:{deployMenuData:l}}=ha(),s=R("");V(t,async()=>{s.value="",await we(t.data,s)}),L(async()=>{await we(t.data,s)});const n=e,i=da(()=>{switch(t.data.status){case"running":return["运行中","success"];case"exited":return["已停止","danger"];case"initializing":return["安装中","info"];default:return["异常","warning"]}});return(a,e)=>{const t=c,o=ua,p=sa,r=va,d=ea,u=ma;return P(),H("div",{class:W(["AppItem relative",{"!h-[12.8rem]":!a.data.installed}])},[G(s)?(P(),H("img",{src:G(s),key:a.data.appname,class:"AppImg"},null,8,yt)):(P(),H("img",gt)),F("div",ht,[F("div",xt,[F("div",wt,[F("div",kt,[F("span",{class:W(["text-[1.6rem] font-600",{"truncate leading-[22px] !font-normal flex-1 max-w-[20rem]":a.data.installed,"flex items-center":!a.data.installed}]),title:a.data.installed?a.data.service_name:a.data.apptitle},[F("span",null,Z(a.data.installed?a.data.service_name:a.data.apptitle),1),a.data.installedCount?(P(),H("span",{key:0,class:"mx-8px bt-link text-[1.2rem] font-normal",onClick:e[0]||(e[0]=a=>G(l).app_type="installed")},"已安装 ("+Z(a.data.installedCount)+")",1)):aa("",!0),a.data.help?(P(),$(t,{key:1,href:a.data.help,target:"_blank",class:"ml-8px bt-link text-[1.2rem] font-normal"},{default:K(()=>[...e[17]||(e[17]=[B(" >>帮助",-1)])]),_:1},8,["href"])):aa("",!0)],10,bt),a.data.installed?(P(),H("div",Ct,[N(o,{type:G(i)[1],class:W(["mx-[0.8rem]",{"cursor-pointer":"initializing"===a.data.status}]),onClick:e[1]||(e[1]=e=>G(Se)(a.data,"log",!0))},{default:K(()=>["initializing"===a.data.status?(P(),H("span",Dt,[...e[18]||(e[18]=[B("正在安装 ",-1),F("i",{class:"svgtofont-el-loading !text-[1.2rem] animation-spin"},null,-1)])])):(P(),H("span",jt,Z(G(i)[0]),1))]),_:1},8,["type","class"]),N(p,{class:"item",effect:"dark",content:"进入安装目录",placement:"top"},{default:K(()=>[F("i",{class:"svgtofont-folder-open mr-[0.4rem]",onClick:e[2]||(e[2]=e=>G(Ae)("path",a.data))})]),_:1}),N(p,{class:"item",effect:"dark",content:"打开日志",placement:"top"},{default:K(()=>[F("i",{class:"svgtofont-left-logs",onClick:e[3]||(e[3]=e=>G(Se)(a.data,"log"))})]),_:1}),F("span",It,"已安装:"+Z(a.data.createat),1)])):aa("",!0)]),F("div",null,[a.data.installed?aa("",!0):(P(),H("span",{key:0,innerHTML:a.data.appdesc,title:a.data.appdesc,class:"AppNoSetDes"},null,8,qt)),a.data.installed?(P(),H("div",Et,[F("div",Tt,[N(o,{type:"info",class:"mr-[0.8rem]",effect:"plain"},{default:K(()=>[B("版本:"+Z(a.data.m_version+(a.data.s_version?".":"")+a.data.s_version),1)]),_:1}),(P(!0),H(J,null,Q(a.data.port,(e,t)=>(P(),$(r,{key:e,trigger:"hover",placement:"bottom",width:"12.5rem","popper-class":"!min-w-[12.5rem]"},{reference:K(()=>[X(N(o,{type:"info",class:W(["mr-[0.8rem]",G(Te)(a.data)?"cursor-pointer":""]),effect:"plain",onClick:t=>G(ze)(a.data,e,"http")},{default:K(()=>[B("端口:"+Z(e),1)]),_:2},1032,["class","onClick"]),[[Y,t<2]])]),default:K(()=>[F("div",zt,[F("div",{class:"px-[16px] py-[8px] cursor-pointer text-center hover:bg-[#f5f5f5]",onClick:t=>G(ze)(a.data,e,"http")}," HTTP协议访问 ",8,At),F("div",{class:"px-[16px] py-[8px] cursor-pointer text-center hover:bg-[#f5f5f5]",onClick:t=>G(ze)(a.data,e,"https")}," HTTPS协议访问 ",8,Rt)])]),_:2},1024))),128)),N(p,{placement:"top"},{content:K(()=>[F("div",null,[(P(!0),H(J,null,Q(a.data.port,(e,t)=>{var l;return X((P(),H("span",{key:t,class:W(G(Te)(a.data)?"cursor-pointer":""),title:G(Te)(a.data)?"点击访问应用":"",onClick:t=>G(ze)(a.data,e)},[B(Z(e)+" ",1),X(F("span",null,",",512),[[Y,t!==(null==(l=a.data.port)?void 0:l.length)-1]])],10,St)),[[Y,t>1]])}),128))])]),default:K(()=>{var e;return[(null==(e=a.data.port)?void 0:e.length)>=3?(P(),$(o,{key:0,type:"info"},{default:K(()=>{var e;return[B(" +"+Z((null==(e=a.data.port)?void 0:e.length)-2),1)]}),_:1})):aa("",!0)]}),_:1})]),F("div",Ot,[a.data.domain?(P(),$(o,{key:0,type:"info",class:"mr-[0.8rem] cursor-pointer",effect:"plain",onClick:e[4]||(e[4]=e=>G(Le)(a.data.domain))},{default:K(()=>[F("div",Vt,[e[19]||(e[19]=F("i",{class:"svgtofont-icon-max-black mr-[0.4rem] !text-[1.4rem]"},null,-1)),N(p,{effect:"dark",content:"点击跳转域名:"+a.data.domain,placement:"top-start"},{default:K(()=>[F("span",Lt,"域名:"+Z(a.data.domain),1)]),_:1},8,["content"])])]),_:1})):aa("",!0),a.data.domain?(P(),H("span",{key:1,class:"bt-link",onClick:e[5]||(e[5]=e=>G(Re)(a.data))}," >管理网站")):aa("",!0)])])):aa("",!0)])]),a.data.installed?(P(),H("div",Mt,["ollama"===a.data.appname||"ollama_and_openwebui"===a.data.appname||"deepseek_r1"===a.data.appname?(P(),$(d,{key:0,size:"small",onClick:e[6]||(e[6]=e=>G(Ie)(a.data.appname,a.data))},{default:K(()=>[...e[20]||(e[20]=[B("模型管理",-1)])]),_:1})):aa("",!0),"mysql"===a.data.appname||"redis"===a.data.appname||"postgresql"===a.data.appname||"tdengine"===a.data.appname?(P(),$(d,{key:1,size:"small",onClick:e[7]||(e[7]=e=>G(Ie)(a.data.appname,a.data))},{default:K(()=>[...e[21]||(e[21]=[B("终端",-1)])]),_:1})):aa("",!0)])):aa("",!0),a.data.installed?aa("",!0):(P(),$(d,{key:1,type:"primary",onClick:e[8]||(e[8]=e=>G(be)(a.data))},{default:K(()=>[...e[22]||(e[22]=[B("安装",-1)])]),_:1}))]),a.data.installed?(P(),H("div",Pt,[N(u,{class:"!my-[0.8rem] w-full"}),N(d,{size:"small",onClick:e[9]||(e[9]=e=>G(je)(a.data))},{default:K(()=>[...e[23]||(e[23]=[B("详情 ",-1)])]),_:1}),N(d,{size:"small",onClick:e[10]||(e[10]=e=>G(Se)(a.data,"back"))},{default:K(()=>[...e[24]||(e[24]=[B("备份",-1)])]),_:1}),"exited"===a.data.status?(P(),$(d,{key:0,size:"small",onClick:e[11]||(e[11]=e=>G(Oe)(n,"start",{service_name:a.data.service_name,appname:a.data.appname}))},{default:K(()=>[...e[25]||(e[25]=[B("启动 ",-1)])]),_:1})):aa("",!0),"exited"!==a.data.status?(P(),$(d,{key:1,size:"small",onClick:e[12]||(e[12]=e=>G(Oe)(n,"stop",{service_name:a.data.service_name,appname:a.data.appname}))},{default:K(()=>[...e[26]||(e[26]=[B("停止 ",-1)])]),_:1})):aa("",!0),N(d,{size:"small",onClick:e[13]||(e[13]=e=>G(Oe)(n,"restart",{service_name:a.data.service_name,appname:a.data.appname}))},{default:K(()=>[...e[27]||(e[27]=[B("重启 ",-1)])]),_:1}),N(d,{type:"default",plain:"",size:"small",class:"danger-button",onClick:e[14]||(e[14]=e=>G(Oe)(n,"rebuild",{service_name:a.data.service_name,appname:a.data.appname}))},{default:K(()=>[...e[28]||(e[28]=[B("重建 ",-1)])]),_:1}),N(d,{type:"default",plain:"",size:"small",class:"danger-button",onClick:e[15]||(e[15]=e=>G(Ve)(n,{appname:a.data.appname,id:a.data.id}))},{default:K(()=>[...e[29]||(e[29]=[B("卸载",-1)])]),_:1}),G(ke)(a.data)?(P(),$(d,{key:2,size:"small",onClick:e[16]||(e[16]=e=>G(De)(a.data))},{default:K(()=>[...e[30]||(e[30]=[B("更新",-1)])]),_:1})):aa("",!0)])):aa("",!0),a.data.installed?aa("",!0):(P(),H("div",Ht,[N(o,{type:"info"},{default:K(()=>[B(Z(a.data.appTypeCN),1)]),_:1}),-1==a.data.appid?(P(),$(o,{key:0,type:"success",class:"ml-4"},{default:K(()=>[...e[31]||(e[31]=[B("外部应用",-1)])]),_:1})):aa("",!0)]))])],2)}}}),[["__scopeId","data-v-058bfe41"]]),Nt={class:"pr-[1.5rem]"},Gt={class:"w-full !h-[4rem] p-2rem inline-block flex justify-center items-center text-[1.2rem]"},Ut=d(O({__name:"index",setup(a){const{mainHeight:e,mainWidth:t}=s(),{refs:{deployMenuData:l}}=ha(),{refs:{isRefreshAppList:n,isRefreshInstallList:i}}=u(),o=R(null),p=R(null),r=da(()=>t.value<1125?1:t.value<1632?2:3),d=da(()=>(t.value-35)/r.value);return V(()=>l.value.app_type,async a=>{o.value.scrollTop=0,ce.value=!1,"installed"===a?(clearTimeout(de),await me("all"),ve()):clearTimeout(de)}),V(()=>n.value,a=>{a&&(Va(Oa),n.value=!1)}),V(()=>i.value,a=>{a&&(clearTimeout(de),me("all"),i.value=!1)}),V(()=>Sa.list.length,a=>{p.value.scrollToPosition(0),p.value.handleResize()}),L(()=>{"installed"===l.value.app_type?i.value=!0:n.value=!0}),fa(()=>{clearTimeout(de)}),(a,t)=>{const s=c,n=ma,i=ya;return P(),H("div",{ref_key:"scrollContainerRef",ref:o,style:_a("height:".concat(G(e)-260,"px")),class:"overflow-hidden relative scrollBox"},[X(N(G(Da),{ref_key:"virtualScrollRef",ref:p,class:"AppList",style:_a("height:".concat(G(e)-280,"px;width: calc(20px + ").concat(G(d),"px * ").concat(G(r),");")),items:G(Sa).list,"item-size":"installed"===G(l).app_type?175:145,itemSecondarySize:G(d),gridItems:G(r),buffer:100,"key-field":"index",itemClass:"app-item",onScrollEnd:G(ue)},{default:K(({item:a})=>[F("div",Nt,[N(Ft,{data:a,onRefresh:G(me)},null,8,["data","onRefresh"])])]),after:K(()=>[G(ce)&&G(Sa).list.length&&"installed"!==G(l).app_type?(P(),$(n,{key:0},{default:K(()=>[F("span",Gt,[t[2]||(t[2]=B("没有更多了,如没有想要的应用可",-1)),N(s,{onClick:G(ka)},{default:K(()=>[...t[1]||(t[1]=[B("提交需求反馈",-1)])]),_:1},8,["onClick"])])]),_:1})):aa("",!0)]),_:1},8,["style","items","item-size","itemSecondarySize","gridItems","onScrollEnd"]),[[Y,G(Sa).list.length]]),G(Sa).list.length?aa("",!0):(P(),$(i,{key:0,class:"w-full"},{description:K(()=>[F("span",null,[t[3]||(t[3]=B("未查询到搜索内容,请尝试",-1)),F("span",{class:"inline-flex bt-link",onClick:t[0]||(t[0]=a=>G(Ja)(!0))},"更新应用列表"),t[4]||(t[4]=B("或加入QQ群：767189639反馈",-1))])]),_:1}))],4)}}}),[["__scopeId","data-v-0df4395b"]]),Bt={class:"w-full"},Kt=d(O({__name:"index",setup:a=>(fa(()=>{q(["/mod/docker/com/get_apps","/mod/docker/com/get_tags","/mod/docker/com/get_installed_apps"])}),M(()=>{Sa.list=[],Sa.total=0,Oa.p=1,Oa.query=""}),(a,e)=>{const t=ga("bt-loading");return P(),H("div",Bt,[N(ie,{class:"mb-8px"}),X(N(Ut,null,null,512),[[t,G(Sa).loading],[t,"正在加载列表，请稍后...","title"]])])})}),[["__scopeId","data-v-17181e50"]]),Wt=Object.freeze(Object.defineProperty({__proto__:null,default:Kt},Symbol.toStringTag,{value:"Module"}));export{He as a,Fe as b,Ze as c,Ge as d,_t as e,Pe as f,vt as g,ft as h,$e as i,ut as j,mt as k,rt as l,dt as m,lt as n,it as o,st as p,ot as q,Ja as r,Wt as s,Ma as u,Ne as v};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
