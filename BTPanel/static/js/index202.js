import{K as e,hi as a,hj as t,hk as s,M as n,hl as l,N as r,bX as o,aH as i,o as u,fj as c,c as d,a7 as m,a8 as p,G as v,bV as g,aa as h,l as y,j as _,hm as f,at as w,hn as b,ho as x,hp as E,hq as k,_ as V,e as R,hr as C,hs as P,ht as D,u as q,hu as L,hv as T,W as I,hw as j,hx as S,b as z,A as U,ag as O,a2 as H,hy as F,hz as A,hA as B,hB as N,bv as M,L as J,fk as K,h as G,hC as W,hD as Q,hE as X,hF as Z,hG as $,hH as Y,hI as ee,hJ as ae,w as te,hK as se,hL as ne,hM as le,hN as re,hO as oe,hP as ie,hQ as ue,hR as ce,hS as de,hT as me,hU as pe,al as ve,hV as ge,hW as he}from"./utils-lib.js?v=1756369731";import{s as ye,j as _e,r as fe,c as we,e as be,B as xe,aB as Ee,q as ke,v as Ve,y as Re,A as Ce,x as Pe,P as De,z as qe,H as Le,I as Te,g as Ie,ax as je,D as Se,aj as ze,ai as Ue,a$ as Oe,al as He,p as Fe,a4 as Ae,i as Be,t as Ne,G as Me,F as Je,a_ as Ke,M as Ge,Q as We,C as Qe,o as Xe,J as Ze,k as $e,Z as Ye,a9 as ea,T as aa,a7 as ta,w as sa}from"./base-lib.js?v=1756369731";import{n as na,k as la,D as ra}from"./useController4.js?v=1756369731";import{_ as oa}from"./index103.js?v=1756369731";import{B as ia}from"./index418.js?v=1756369731";import{h as ua,F as ca,k as da,g as ma}from"./form-item.js?v=1756369731";import{i as pa,f as va}from"./validator.js?v=1756369731";import{a as ga,c as ha,b as ya,u as _a}from"./column.js?v=1756369731";import{B as fa}from"./index140.js?v=1756369731";import{S as wa}from"./useStore4.js?v=1756369731";import{saveFileBody as ba,getRedirectList as xa}from"./site.js?v=1756369731";import{_ as Ea}from"./index116.js?v=1756369731";const ka=_e("DOCKERSITE-DOMAIN-STORE",()=>{const o=fe();return{isRefreshDomain:fe(!1),port:o,delMultDomainEvent:async e=>{const a=n.load("正在删除域名，请稍后...");try{const{data:a}=await l(e),{data:t}=pa(a);return{data:t.map(e=>({name:e.domain,...e})),status:!0}}catch(t){return{status:!1,msg:"删除域名失败"}}finally{a.close()}},getDomainListEvent:async t=>{try{return{data:(await e({request:a(t)})).data,status:!0}}catch(s){return{status:!1,msg:"获取域名信息失败"}}},addDomainEvent:async a=>{try{const t=await e({loading:"正在添加域名，请稍后...",request:s(a)});return{status:t.status,msg:t.msg,data:t.data}}catch(t){return{status:!1,msg:"添加域名失败"}}},setPortEvent:async a=>{try{return{...await e({loading:"正在设置HTTPS端口，请稍候...",request:t(a),message:!0})}}catch(s){return{status:!1,msg:"设置https端口失败"}}},delDomainEvent:async e=>{var a;let t=n.load("正在删除域名，请稍后...");try{const t=await l(e),s=(null==(a=t.data)?void 0:a.hasOwnProperty("status"))?t.data:t;return r(s.data)?{status:s.status,msg:s.data[0].msg}:{status:s.status,msg:(null==s?void 0:s.data)||(null==s?void 0:s.error_msg)||s.msg}}catch(s){return{status:!1,msg:"删除域名失败"}}finally{t.close()}}}}),Va=()=>ye(ka()),{siteInfo:Ra}=na(),{port:Ca,isRefreshDomain:Pa}=Va(),{getDomainListEvent:Da,setPortEvent:qa,addDomainEvent:La,delDomainEvent:Ta,delMultDomainEvent:Ia}=ka(),ja=fe(!1),Sa=fe(""),za=async()=>{var e,a;try{const t=Sa.value,s=["21","25","443","888","8888","8443"];if(""===t)return n.error("域名不能为空"),!1;let l=String(t.match(/:(\d+)/g)).replace(/:/g,"");if(s.includes(l))return n.error("端口不能为常用端口21、25、443、888、8888、8443"),!1;if(!(await Oa()))return!1;const r=(e=>{const{name:a,id:t}=Ra.value;return{id:t,site_name:a,domains:e}})(t),o=await La(r);return o.status&&la({title:"域名添加结果",resultData:(null==(e=null==o?void 0:o.data)?void 0:e.domains)||(null==(a=null==o?void 0:o.data)?void 0:a.data)||[],autoTitle:"添加域名完成"}),Pa.value=!0,Sa.value="",o.status}catch(t){}},Ua=async()=>{try{const e=(()=>{const e=Ra.value;return{site_name:e.name,id:e.id}})(),a=await Da(e);return Ca.value=Number(a.data.https_port)||"未开启",{data:a.data.domain_list,total:a.data.domain_list.length,other:{port:a.data.https_port}}}catch(e){return{data:[],total:0,other:{}}}},Oa=async(e=Sa.value)=>{let a=e.trim().replace(" ","").split("\n");const t=a.findIndex(e=>e.split(":")[0].length<3);for(var s=0;s<a.length;s++){var l=a[s];let e=l.includes(":");if(e&&!o(l))return n.error("第"+(s+1)+"行【"+l+"】域名格式错误"),!1;if(!e&&!i(l))return n.error("第"+(s+1)+"行【"+l+"】域名格式错误"),!1}return-1!==t?(n.error("第 ".concat(t+1," 个域名长度不符合要求（必须大于3个字符）")),!1):a},Ha=async e=>{try{const a=await qa({site_name:Ra.value.name,https_port:e.value.port});(null==a?void 0:a.status)&&(Ca.value=Number(e.value.port))}catch(a){}},Fa=async e=>{try{await u({icon:"warning-filled",title:"删除【".concat(e.name,"】"),content:"删除".concat(e.name,"后，将无法使用该域名访问网站，是否继续操作？")});const a=(e=>{const{id:a,name:t}=Ra.value;return{id:a,site_name:t,domain:e.name,port:e.port}})(e),t=await Ta(a);return n.request(t),Pa.value=!0,t}catch(a){}},Aa=async e=>{try{await u({icon:"warning-filled",title:"批量删除",content:"同时删除选中的域名，是否继续？",type:"calc"});let a=[];const t=(e=>{const{name:a}=Ra.value,t=e.map(e=>({id:e.id,port:e.port,domain:e.name,site_name:a}));return{del_domain_list:JSON.stringify(t)}})(e);return a=(await Ia(t)).data,await la({resultData:a,autoTitle:"删除域名完成"}),Pa.value=!0,{status:!0,msg:"删除域名成功"}}catch(a){return{status:!1,msg:"删除域名失败"}}},Ba=async()=>{try{return await Ua()}catch(e){return{data:[],total:0,other:{}}}},Na={class:""},Ma={class:"flex items-end mb-[12px]"},Ja=we({__name:"index",setup(e){const{isRefreshDomain:a,port:t}=Va(),s=p([{label:"删除",value:"delete",event:async(e,a,t,s)=>{Aa(t.value)}}]),{BtTable:n,BtBatch:l,config:r}=c({request:Ba,columns:[ga(),{label:"域名",prop:"name",width:400,render:e=>be("div",{class:"truncate"},[be(d,{class:"bt-link",href:"http://".concat(e.name,":").concat(e.port),target:"_blank"},{default:()=>[e.name]})])},{label:"端口",prop:"port"},{label:"操作",align:"right",render:e=>1===r.data.length?be("span",null,[xe("不可操作")]):Ee("span",{class:"cursor-pointer bt-link",onClick:()=>{Fa(e)}},"删除")}],extension:[s,m(a)]}),o=()=>{const{BtForm:e,submit:a}=v({data:{port:t.value},options:e=>Ie(()=>[ua("HTTPS端口",()=>be(ia,{modelValue:e.value.port,"onUpdate:modelValue":a=>e.value.port=a},null),"port",{attrs:{min:1,max:65535},rules:[g({message:"请输入端口号",trigger:"blur"}),h()]})]),submit:Ha});y({title:"更换端口",area:42,showFooter:!0,component:()=>be(e,{class:"p-2rem"},null),onConfirm:a})};return(e,a)=>{const s=_,r=je,i=Se,u=oa;return ke(),Ve("div",Na,[Re("div",Ma,[be(r,{ref:"popover",placement:"top-start",width:"41rem","popper-class":"green-tips-popover !p-0 !border-none",visible:Pe(ja),"onUpdate:visible":a[2]||(a[2]=e=>De(ja)?ja.value=e:null),"trigger-keys":[],trigger:"focus"},{default:Ce(()=>[...a[3]||(a[3]=[Re("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[xe(" 如需绑定外网，请换行填写，每行一个域名，默认为80端口 "),Re("br"),xe(" IP地址格式：192.168.1.199 "),Re("br"),xe(" 泛解析添加方法 *.domain.com "),Re("br"),xe(" 如另加端口格式为 www.domain.com:88 ")],-1)])]),reference:Ce(()=>[be(s,{modelValue:Pe(Sa),"onUpdate:modelValue":a[0]||(a[0]=e=>De(Sa)?Sa.value=e:null),type:"textarea",resize:"none",rows:4,width:"42rem",onFocus:a[1]||(a[1]=e=>ja.value=!0),placeholder:"如需绑定外网，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),_:1},8,["visible"]),be(i,{type:"primary",class:"absolute",style:{right:"4rem",top:"5rem"},onClick:Pe(za)},{default:Ce(()=>[...a[4]||(a[4]=[xe("添加",-1)])]),_:1},8,["onClick"])]),be(u,null,{"header-right":Ce(()=>[Re("div",null,[xe(" HTTPS端口："+qe(Pe(t))+" ",1),Le(Re("span",{class:"bt-link cursor-pointer",onClick:o},"更换",512),[[Te,"number"==typeof Pe(t)]])])]),content:Ce(()=>[be(Pe(n),{"max-height":440})]),"footer-left":Ce(()=>[be(Pe(l))]),_:1}),a[5]||(a[5]=Re("ul",{class:"mt-[.8rem] leading-8 text-[1.2rem] list-disc ml-2rem"},[Re("li",null,"建议所有域名都使用默认的80端口")],-1))])}}}),Ka=_e("DOCKER-SITE-SITE-DIR-STORE",()=>{const{siteInfo:a}=na(),t=fe([]),s=fe({path:"",run_path:"",userini:!1});return{dirOptions:t,resetData:()=>{t.value=[],s.value.path="",s.value.run_path=""},getFormData:()=>s,getDir:async()=>{try{const t={id:a.value.id},n=await e({loading:"正在获取版本，请稍后...",request:f(t)});n.status?s.value.path=n.data.path:w(n)}catch(t){w(t)}},formData:s,saveDirPath:async(t,s)=>{if(!t)return void n.error("请选择目录");const l={site_name:a.value.name,id:a.value.id,..."path"===s?{path:t}:{run_path:t}};e({loading:"正在获取版本，请稍后...",message:!0,request:"path"===s?x(l):E(l)})},setDirUser:async t=>{const s={id:a.value.id,status:t?1:0};e({loading:"正在设置，请稍后...",message:!0,request:k(s)})},getUserini:async()=>{try{const n={id:a.value.id},l=await e({loading:"正在获取版本，请稍后...",request:b(n)});l.status?(s.value.userini=l.data.userini,s.value.run_path=l.data.runPath.runPath,t.value=l.data.runPath.dirs.map(e=>({label:e,value:e}))):w(l)}catch(n){w(n)}}}}),Ga={class:"p-[2rem] overflow-auto"};const Wa=R(we({__name:"index",setup(e,{expose:a}){const t=Ka(),{dirOptions:s,formData:n}=ye(t),{getDir:l,resetData:r,saveDirPath:o,setDirUser:i,getUserini:u}=t,{BtForm:c}=v({data:()=>n.value,options:e=>Ie(()=>[ua("网站目录",()=>be("div",null,[be("div",{class:"formItem"},[be(_,{modelValue:e.value.path,"onUpdate:modelValue":a=>e.value.path=a,width:"32rem"},{append:()=>be(Se,{onClick:()=>(e=>{va({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(a,t)=>{e.value.path=a}})})(e)},{default:()=>[be(V,{icon:"icon-file_mode",class:"cursor-pointer"},null)]})}),be(Se,{type:"primary",class:"!ml-[1.2rem]",onClick:()=>o(e.value.path,"path")},{default:()=>[xe("保存")]})]),be("span",{class:"formTips"},[xe("当前网站的部署目录，可以选择其他目录")])]),"path",{rules:[{required:!1,trigger:"change",message:"请选择网站目录"}]}),ua("运行目录",()=>{let a;return be("div",null,[be("div",{class:"formItem"},[be(ze,{class:"!w-[32rem]",modelValue:e.value.run_path,"onUpdate:modelValue":a=>e.value.run_path=a},(t=a=s.value.map(e=>be(Ue,{key:e.value,label:e.label,value:e.value},null)),"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!Be(t)?a:{default:()=>[a]})),be(Se,{type:"primary",class:"!ml-[1.2rem]",onClick:()=>o(e.value.run_path,"run_path")},{default:()=>[xe("保存")]})]),be("span",{class:"formTips"},[xe("部分程序需要指定二级目录作为运行目录，如ThinkPHP5,Laravel")])]);var t},"run_path",{rules:[{required:!1,trigger:"change",message:"请选择网站运行目录"}]}),ca(()=>be("div",null,[be(Oe,null,null),be("div",{class:"formItem"},[be("span",{class:"formLabel"},[xe("防跨站攻击")]),be(He,{class:"mr-[12px]",modelValue:e.value.userini,"onUpdate:modelValue":a=>e.value.userini=a,onChange:i},null),be("span",{class:"text-[#999]"},[xe("防跨站攻击(open_basedir)，防止黑客通过其他网站目录进行入侵攻击")])])]),{key:"userini",rules:[]})])});return Fe(()=>{l(),u()}),Ae(()=>{r()}),a({init:()=>{l(),u()}}),(e,a)=>(ke(),Ve("div",Ga,[be(Pe(c))]))}}),[["__scopeId","data-v-4728c209"]]),Qa=_e("SITE-PSEUDO-STORE",()=>({delPseudoStaticEvent:async a=>{try{await e({loading:"正在删除伪静态规则，请稍候...",request:C(a),message:!0})}catch(t){return{status:!1,msg:"删除失败"}}},getReWriteListEvent:async a=>{try{const{data:t}=await e({request:P(a)});return{data:t,status:status}}catch(t){return{status:!1,msg:"获取伪静态列表失败"}}},setTemplateEvent:async a=>{try{const t=await e({loading:"正在设置模板，请稍候...",request:D(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"设置模板失败"}}}})),{siteInfo:Xa}=na(),{getFileEvent:Za}=wa(),{plugin:$a,getGlobalInfo:Ya}=q(),{webserver:et}=Ne($a.value),{delPseudoStaticEvent:at,getReWriteListEvent:tt,setTemplateEvent:st}=Qa(),nt=fe(""),lt=fe([]),rt=fe(""),ot=fe([]),it=fe(!1),ut=fe(""),ct=fe(!1),dt=[{content:"请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default"},{content:"您可以对伪静态规则进行修改，修改完后保存即可。"}],mt=e=>!lt.value.includes(e),pt=async e=>{await u({title:"删除伪静态模板【".concat(e.name,"】"),content:"删除后不可恢复，确定删除吗？",icon:"warning-filled"});(await at(e)).status&&(await vt(),await ht())},vt=async()=>{const e={siteName:Xa.value.name};ct.value=!0;const a=await tt(e);gt(a.data),ct.value=!1},gt=async e=>{ot.value=e.rewrite,lt.value=e.default_list,ut.value=e.sitePath+"/.htaccess",rt.value=e.rewrite[0]||""},ht=async(e={site_name:Xa.value.name})=>{try{ct.value=!0;const a=e.path?await Za(e):await L(e);return nt.value=a.data.data,ct.value=!1,a}catch(a){return ct.value=!1,{data:"获取伪静态内容失败"}}},yt=e=>{let a="/www/server/panel/rewrite/".concat(et.value,"/").concat(e,".conf");ht({path:"0.当前"===e?"":a})},_t=async(e={rewrite_conf:nt.value,site_name:"".concat(Xa.value.name)})=>{const a=await T(e);n.request(a),a.status&&vt()},ft=async()=>{await Ya(),await vt(),await ht()},wt={class:"h-full"},bt={class:"flex items-center justify-between"},xt={class:"flex items-center justify-between"},Et=["onClick"],kt={class:"flex items-center"},Vt={class:"my-[12px]"},Rt=we({__name:"index",setup(e){const a=()=>{const{BtForm:e,submit:a}=v({options:()=>Ie(()=>[{type:"input",label:"模板名称",key:"name",attrs:{placeholder:"请输入模板名称"},rules:[{required:!0,message:"请输入模板名称",trigger:"blur"}]}]),submit:async(e,a)=>(await a(),await(async e=>{try{const a={...e,data:nt.value};if(a.name=a.name.trim(),a.name.includes(" "))return n.error("模板名称不能包含空格");if(""===a.name)return n.error("模板名称不能为空");if(ot.value.includes(a.name))return n.error("模板名称不能和已有的模板名称重复且不可为空");const t=await st(a);return t.status&&(it.value=!1,await vt(),await ht()),t.status}catch(a){return!1}})(e.value))});y({title:"另存为模板",area:42,showFooter:!0,component:()=>be(e,{class:"p-2rem"},null),onConfirm:a})};return Fe(ft),(e,t)=>{const s=Ue,n=ze,l=d,r=fa,o=Se,i=I,u=Me("bt-loading");return ke(),Ve("div",wt,[Le((ke(),Ve("div",null,[Re("div",bt,[be(n,{class:"!w-[15rem]",modelValue:Pe(rt),"onUpdate:modelValue":t[0]||(t[0]=e=>De(rt)?rt.value=e:null),onChange:Pe(yt)},{default:Ce(()=>[(ke(!0),Ve(Je,null,Ke(Pe(ot),(e,a)=>(ke(),Ge(s,{key:a,value:e},{default:Ce(()=>[Re("div",xt,[Re("span",null,qe(e),1),Pe(mt)(e)?(ke(),Ve("span",{key:0,class:"el-icon-close cursor-pointer text-[1.4rem] ml-1rem",onClick:We(a=>Pe(pt)({name:e}),["stop"])},null,8,Et)):Qe("",!0)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","onChange"]),Re("span",kt,[t[4]||(t[4]=xe("规则转换工具： ",-1)),be(l,{class:"bt-link",href:"https://www.bt.cn/Tools"},{default:Ce(()=>[...t[3]||(t[3]=[xe("Apache转Nginx ",-1),Re("i",{class:"svgtofont-el-link"},null,-1)])]),_:1})])]),Re("div",Vt,[be(r,{id:"staticContentRef",request:!1,class:"!h-[40rem] !w-full border border-[#DCDFE6] rounded-[4px]",modelValue:Pe(nt),"onUpdate:modelValue":t[1]||(t[1]=e=>De(nt)?nt.value=e:null),onSave:Pe(_t)},null,8,["modelValue","onSave"])]),Re("div",null,[be(o,{type:"primary",onClick:t[2]||(t[2]=e=>Pe(_t)())},{default:Ce(()=>[...t[5]||(t[5]=[xe("保存",-1)])]),_:1}),be(o,{onClick:a},{default:Ce(()=>[...t[6]||(t[6]=[xe("另存为模板",-1)])]),_:1})]),be(i,{options:Pe(dt),class:"ml-[20px] mt-[20px]"},null,8,["options"])])),[[u,Pe(ct)],[u,"正在加载内容，请稍候...","title"]])])}}}),Ct=z(),{siteInfo:Pt}=na(),Dt=fe("master"),qt=fe("server_block"),Lt=[{label:"server块",value:"server_block"},{label:"HTTP块",value:"http_block"}],Tt=[{content:"主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作"}],It=[{content:"保存前请检查输入的配置文件是否正确，错误的配置可能会导致网站访问异常"},{content:"如果您对此配置不熟悉，请勿添加自定义配置"},{isHtml:!0,content:'server块的nginx官方配置文档：<a class="text-primary cursor-pointer" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#server" target="_blank" rel="noreferrer noopener">点击跳转</a>'}],jt=[{content:"保存前请检查输入的配置文件是否正确，错误的配置可能会导致网站访问异常"},{content:"如果您对此配置不熟悉，请勿添加自定义配置"},{isHtml:!0,content:'http块的nginx官方配置文档：<a class="text-primary cursor-pointer" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#http" target="_blank" rel="noreferrer noopener">点击跳转</a>'}],St=fe(It),zt=fe(""),Ut=fe(!1),Ot=async()=>{try{Ut.value=!0;const{data:e}=await j({site_name:Pt.value.name});return e.status?"master"===Dt.value?zt.value=e.data.site_conf:(zt.value=e.data[qt.value],St.value="server_block"===qt.value?It:jt):Ct.error(e.msg),{data:zt.value}}catch(e){return{data:""}}finally{Ut.value=!1}};Xe(()=>{Ct.error("主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作")},3e3);const Ht=async()=>{if("master"===Dt.value)return{status:!1,msg:"主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作"};let e=Ct.load("正在保存内容，请稍候...");try{const e=await S({site_name:Pt.value.name,conf_type:qt.value,body:zt.value});return Ct.msg({dangerouslyUseHTMLString:!0,message:e.msg,type:e.status?"success":"error",duration:e.status?2e3:0,showClose:!e.status}),e}catch(a){return w(a),{status:!1,msg:"保存文件失败"}}finally{e.close()}},Ft={class:"h-full"},At={key:0,class:"mb-1rem text-[#666] flex items-center"},Bt={class:"mt-1rem"},Nt={key:0,class:"ml-[20px] mt-[2rem]"},Mt=we({__name:"files",props:{type:{}},setup(e){const a=e;return Fe(()=>{Ot()}),(e,t)=>{const s=O,n=I,l=fa,r=Se,o=Me("bt-loading");return ke(),Ve("div",Ft,[Re("div",null,["master"!==Pe(Dt)?(ke(),Ve("div",At,[t[4]||(t[4]=Re("span",null,"选择配置块：",-1)),be(s,{class:"!w-[16rem]",modelValue:Pe(qt),"onUpdate:modelValue":t[0]||(t[0]=e=>De(qt)?qt.value=e:null),options:Pe(Lt),onChange:t[1]||(t[1]=e=>Pe(Ot)())},null,8,["modelValue","options"])])):Qe("",!0),Le(be(n,{options:Pe(Tt),"list-style":"none",class:"ml-[12px] text-[1.2rem] mb-1rem"},null,8,["options"]),[[Te,"master"===Pe(Dt)]]),Le(be(l,{class:Ze(["!w-[64rem] border border-[#DCDFE6] rounded-[4px]","master"===a.type?"!h-[50rem]":"!h-[34rem]"]),modelValue:Pe(zt),"onUpdate:modelValue":t[2]||(t[2]=e=>De(zt)?zt.value=e:null),id:1e3*Math.random(),editorOption:{readOnly:"master"===Pe(Dt),mode:"ace/mode/nginx"}},null,8,["modelValue","class","id","editorOption"]),[[o,Pe(Ut)]]),Re("div",Bt,["master"!==Pe(Dt)?(ke(),Ge(r,{key:0,type:"primary",onClick:Pe(Ht)},{default:Ce(()=>[...t[5]||(t[5]=[xe("保存",-1)])]),_:1},8,["onClick"])):Qe("",!0),be(r,{type:"default",onClick:t[3]||(t[3]=e=>Pe(U)({value:Pe(zt)}))},{default:Ce(()=>[...t[6]||(t[6]=[xe("复制",-1)])]),_:1})])]),"master"!==Pe(Dt)?(ke(),Ve("div",Nt,[be(n,{options:Pe(St)},null,8,["options"])])):Qe("",!0)])}}}),Jt=R(we({__name:"index",setup(e,{expose:a}){const t=$e({site_conf:"",http_block:"",server_block:""});Ye("configList",t),Ye("tabActive",Dt);const{BtTabs:s}=H({type:"card",value:Dt,options:[{label:"主配置文件",name:"master",render:()=>be(Mt,{type:"master"},null)},{label:"自定义配置文件",name:"custom",lazy:!0,render:()=>be(Mt,{type:"custom"},null)}]});return a({init:Ot}),(e,a)=>(ke(),Ve("div",null,[be(Pe(s),{onChange:Pe(Ot)},null,8,["onChange"])]))}}),[["__scopeId","data-v-4ed3f2da"]]),Kt=_e("DOCKERSITE-REDIRECT-STORE",()=>({changeStatusEvent:async a=>{try{const t=await e({loading:"正在修改，请稍后...",request:F(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"修改状态失败"}}},delRedirectEvent:async a=>{try{const t=await e({loading:"正在删除，请稍后...",request:A(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"删除重定向失败"}}},getRedirectFileEvent:async a=>{try{return{data:{content:(await e({loading:"正在获取内容，请稍候...",request:B(a)})).data.data,redirect_conf_file:a.path},status:!0}}catch(t){return{status:!1,msg:"获取配置文件失败"}}},getRedirectDataEvent:async a=>{try{const t=await e({request:xa(a,"proxy"),data:Array});return{data:t,total:t.length,other:{}}}catch(t){return{data:[],total:0,other:{}}}},submitRedirectEvent:async(a,t)=>{try{const s=await e({loading:"正在提交，请稍后...",request:t?F(a):N(a),message:!0});return{status:s.status,msg:s.msg}}catch(s){return{status:!1,msg:"添加重定向失败"}}},isRefreshList:fe(!1),saveFileEvent:async a=>{try{const t=await e({loading:"正在保存内容，请稍候...",request:ba(a),data:{status:Boolean,msg:String},message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"保存文件失败"}}},getDomainListEvent:async t=>{try{return{data:(await e({request:a(t)})).data,status:!0}}catch(s){return{status:!1,msg:"获取域名信息失败"}}}})),Gt=()=>ye(Kt()),{siteInfo:Wt}=na(),{isRefreshList:Qt}=Gt(),{getDomainListEvent:Xt,changeStatusEvent:Zt,delRedirectEvent:$t,getRedirectDataEvent:Yt,getRedirectFileEvent:es,submitRedirectEvent:as,saveFileEvent:ts}=Kt(),ss=fe([]),ns=fe(!1),ls=fe(!1),rs=fe(""),os=fe(""),is=fe(!1),us=fe(),cs=fe(!1),ds=fe(),ms=fe(),ps=[{content:"设置域名重定向后，该域名的404重定向将失效"},{content:"取消重定向时，由于浏览器会缓存重定向信息，在清除缓存前，浏览器仍会根据缓存自动重定向"}],vs=[{content:"重定向类型：表示访问选择的“域名”或输入的“路径”时将会重定向到指定URL"},{content:"目标URL：可以填写你需要重定向到的站点，目标URL必须为可正常访问的URL，否则将返回错误"},{content:"重定向方式：使用301表示永久重定向，使用302表示临时重定向"},{content:"保留URI参数：表示重定向后访问的URL是否带有子路径或参数如设置访问http://b.com"},{content:"重定向到http://a.com 保留URI参数： http://b.com/1.html ---\x3e http://a.com/1.html"},{content:"不保留URI参数：http://b.com/1.html ---\x3e http://a.com"}],gs=e=>{let a={...e,type:e.type?0:1,redirectdomain:JSON.stringify(e.redirectdomain)};return delete a.redirect_conf_file,a.site_name=Wt.value.name,delete a.sitename,a},hs=async(e,a,t,s)=>{const{label:n,value:l}=s,r=new Map([["start","批量启用选中的规则后，配置的重定向域名/目录将会生效"],["stop","批量停用选中的规则后，配置的重定向域名/目录将会失效"],["delete","批量删除当前选中的规则后，配置的重定向域名/目录将会彻底失效"]]),o=async e=>{const a=new Map([["start",F],["stop",F],["delete",A]]),{redirectname:t}=e,s=a.get(l);switch(l){case"start":case"stop":if(s){const a=gs({...e,type:"stop"===l?1:0});return await s(a)}case"delete":if(s)return await s({site_name:Wt.value.name,redirectname:t})}};await e({title:"批量".concat(n),content:"".concat(r.get(l),"，是否继续操作？"),column:[{label:"规则名称",render:e=>{var a;return e.errorpage?"404错误页面":"domain"===e.domainorpath?null==(a=M(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath}},ha()],onConfirm:async()=>(await a(o),Qt.value=!0,!1)})},ys=async e=>{try{const a=gs(e),t=await Zt(a);return t.status&&(Qt.value=!0),t}catch(a){return{status:!1,msg:"修改状态失败"}}},_s=async e=>{var a;try{await u({title:"删除重定向【".concat("domain"===e.domainorpath?null==(a=M(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath,"】"),content:"删除选中的规则后，配置的重定向域名/目录将指向源地址，是否继续操作？",icon:"warning-filled",type:"calc"});const{name:t}=Wt.value,{redirectname:s}=e,n={proxy:{site_name:t,redirectname:s}},l=await $t(n.proxy);return l.status&&(Qt.value=!0),l}catch(t){return{status:!1,msg:"删除重定向失败"}}},fs=async(e={data:rs.value,encoding:"utf-8",path:os.value})=>await ts(e),ws=e=>{cs.value=!!e,ms.value=e||!1,y({title:"".concat(e?"编辑":"添加","重定向").concat(e?"【".concat(e.sitename,"】"):""),area:68,component:()=>J(()=>import("./add-redirect.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),btn:!0})},bs=async()=>{var e;try{const a=await(async(e=!1)=>{const a={sitename:Wt.value.name};try{const t=await Yt(a);return e&&n.success("刷新成功"),is.value=!1,us.value=null,Array.isArray(t.data)&&t.data.forEach(e=>{e.errorpage&&(is.value=!0,us.value=e)}),t}catch(t){return{data:[],total:0,other:{}}}})();return ss.value=Array.isArray(a.data)?a.data.map(e=>e.redirectdomain).flat():[],{...a,data:(null==(e=a.data)?void 0:e.map((e,a)=>({...e,id:a+1})))||[]}}catch(a){}},xs=async e=>{try{const a=(e=>{const{name:a}=Wt.value,{holdpath:t,type:s,redirectdomain:n}=e;return{...e,site_name:a,holdpath:t?"1":"0",type:s?"1":"0",redirectdomain:JSON.stringify(n),redirectname:e.redirectname||(new Date).getTime()}})(e),t=await as(a,cs.value);return t.status&&(Qt.value=!0),t.status}catch(a){return!1}},Es=async()=>{try{const e={site_name:Wt.value.name,id:Wt.value.id},a=await Xt(e);return ds.value=cs.value?a.data.domain_list:a.data.domain_list.filter(e=>!ss.value.some(a=>a.includes(e.name))),a}catch(e){return{status:!1,msg:"获取域名失败"}}},ks={class:"h-full"},Vs={class:"p-[20px]"},Rs=we({__name:"index",setup(e){const a=z(),{isRefreshList:t}=Gt(),s=p([{label:"启用重定向规则",value:"start",event:hs},{label:"停用重定向规则",value:"stop",event:hs},{label:"删除重定向规则",value:"delete",event:hs}]),{BtTable:l,BtRefresh:r,BtBatch:o}=c({request:bs,columns:[ga(),{label:"被重定向",render:e=>{var a;return e.errorpage?"404错误页面":"domain"===e.domainorpath?null==(a=M(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath}},{label:"重定向类型",prop:"domainorpath",render:e=>e.errorpage?"错误":"domain"===e.domainorpath?"域名":"路径"},{label:"重定向到",render:e=>e.topath?e.topath:e.tourl},ya({prop:"type",event:ys,data:["已停止","运行中"]}),_a([{width:70,title:"配置文件",onClick:e=>{if(!e.type)return a.warn("请先启用重定向规则再查看配置文件");(async e=>{try{ls.value=!0;let a={path:e.redirect_conf_file};const t=await es(a);t.status?(ns.value=!0,rs.value=t.data.content,os.value=t.data.redirect_conf_file):(n.error(t.msg),ns.value=!1),ls.value=!1}catch(a){ns.value=!1}})(e)}},{title:"编辑",onClick:e=>{ws(e)}},{onClick:_s,title:"删除"}])],extension:[K(),s,m(t)]});return(e,a)=>{const t=oa,s=I,n=G,i=Me("bt-loading");return ke(),Ve("div",ks,[be(t,null,{"header-left":Ce(()=>[be(Pe(Se),{type:"primary",onClick:a[0]||(a[0]=e=>Pe(ws)())},{default:Ce(()=>[...a[5]||(a[5]=[xe("添加重定向",-1)])]),_:1})]),"header-right":Ce(()=>[be(Pe(r))]),content:Ce(()=>[be(Pe(l),{"max-height":460})]),"footer-left":Ce(()=>[be(Pe(o))]),_:1}),be(s,{class:"mt-2rem",options:Pe(ps),"list-style":"disc"},null,8,["options"]),be(n,{title:"编辑配置文件",modelValue:Pe(ns),"onUpdate:modelValue":a[4]||(a[4]=e=>De(ns)?ns.value=e:null),area:54},{default:Ce(()=>[Re("div",Vs,[a[7]||(a[7]=xe(" 提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换 ",-1)),Le(be(Pe(fa),{class:"!h-[36rem] my-[8px]",ref:"aceEditor",modelValue:Pe(rs),"onUpdate:modelValue":a[1]||(a[1]=e=>De(rs)?rs.value=e:null),onSave:a[2]||(a[2]=e=>Pe(fs)())},null,8,["modelValue"]),[[i,Pe(ls)]]),be(Pe(Se),{type:"primary",onClick:a[3]||(a[3]=e=>Pe(fs)())},{default:Ce(()=>[...a[6]||(a[6]=[xe("保存",-1)])]),_:1}),a[8]||(a[8]=Re("ul",{class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-[20px]"},[Re("li",null,"此处为该重定向的配置文件，若您不了解配置规则,请勿随意修改。")],-1))])]),_:1},8,["modelValue"])])}}}),{siteInfo:Cs}=na(),Ps=fe(),Ds=fe(!1),qs=fe(!1),Ls=$e({fix:"jpg,jpeg,gif,png,js,css",domains:"",return_rule:"404",http_status:!1,status:!1}),Ts=fe(null),Is=[{content:'【URL后缀】一般填写文件后缀,每个文件后缀使用","分隔,如: png,jpg'},{content:"【许可域名】允许作为来路的域名，每行一个域名,如: www.bt.cn"},{content:"【响应资源】可设置404/403等状态码，也可以设置一个有效资源，如：/security.png"},{content:"【允许空HTTP_REFERER请求】是否允许浏览器直接访问，若您的网站访问异常，可尝试开启此功能"}],js=e=>{if(!Ls.status)return n.error("请先启用防盗链!")},Ss=e=>{Ls.status=e,e||(Ls.http_status=!1)},zs=async a=>{var t;await Ts.value.validate();let s={...Ls,domains:null==(t=Ls.domains)?void 0:t.replace(/\n/g,",")};Ds.value?s.site_ids=JSON.stringify(Ps.value.map(e=>e.id)):(s.id=Cs.value.id,s.site_name=Cs.value.name);const n=Q;await e({loading:"正在设置防盗链，请稍后...",request:n(s),message:!Ds.value}),Us(Ps.value)},Us=async e=>{var a,t;if(Ps.value=e||[],!e){const{id:e,name:n}=Cs.value;try{qs.value=!0;const{data:s}=await W({id:e,name:n});s&&(Ls.fix=s.fix||"jpg,jpeg,gif,png,js,css",Ls.domains=(null==(t=null==(a=s.domains)?void 0:a.toString())?void 0:t.replace(/,/g,"\n"))||"",Ls.return_rule=s.return_rule||"404",Ls.http_status=s.http_status||!1,Ls.status=s.status||!1)}catch(s){w(s)}finally{qs.value=!1}}},Os={fix:[{required:!0,message:"请输入url后缀",trigger:"blur"}],return_rule:[{required:!0,message:"请输入响应资源",trigger:"blur"}]},Hs={class:"p-[20px]"},Fs=we({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:a,emit:t}){const s=e;return Fe(()=>{Us(s.compData)}),a({onConfirm:zs}),(e,a)=>{const t=_,s=ea,n=aa,l=Se,r=ta,o=I,i=Me("bt-loading");return Le((ke(),Ve("div",Hs,[be(r,{ref_key:"hotFormRef",ref:Ts,model:Pe(Ls),rules:Pe(Os)},{default:Ce(()=>[be(s,{label:"URL后缀",prop:"fix"},{default:Ce(()=>[be(t,{modelValue:Pe(Ls).fix,"onUpdate:modelValue":a[0]||(a[0]=e=>Pe(Ls).fix=e),width:"30rem"},null,8,["modelValue"])]),_:1}),be(s,{label:"许可域名"},{default:Ce(()=>[be(t,{width:"30rem",modelValue:Pe(Ls).domains,"onUpdate:modelValue":a[1]||(a[1]=e=>Pe(Ls).domains=e),type:"textarea",resize:"none",rows:8,placeholder:"默认添加主域名，可追加其他的允许域名，一行一个，可为空"},null,8,["modelValue"])]),_:1}),be(s,{label:"响应资源",prop:"return_rule"},{default:Ce(()=>[be(t,{width:"30rem",modelValue:Pe(Ls).return_rule,"onUpdate:modelValue":a[2]||(a[2]=e=>Pe(Ls).return_rule=e)},null,8,["modelValue"])]),_:1}),be(s,{label:" "},{default:Ce(()=>[be(n,{modelValue:Pe(Ls).status,"onUpdate:modelValue":a[3]||(a[3]=e=>Pe(Ls).status=e),onChange:Pe(Ss)},{default:Ce(()=>[...a[6]||(a[6]=[xe("启用防盗链",-1)])]),_:1},8,["modelValue","onChange"]),be(n,{disabled:!Pe(Ls).status,title:"".concat(Pe(Ls).status?"":"需开启防盗链"),modelValue:Pe(Ls).http_status,"onUpdate:modelValue":a[4]||(a[4]=e=>Pe(Ls).http_status=e),onChange:Pe(js)},{default:Ce(()=>[...a[7]||(a[7]=[xe(" 允许空HTTP_REFERER请求 ",-1)])]),_:1},8,["disabled","title","modelValue","onChange"])]),_:1}),Pe(Ds)?Qe("",!0):(ke(),Ge(s,{key:0,label:" "},{default:Ce(()=>[be(l,{type:"primary",onClick:a[5]||(a[5]=e=>Pe(zs)())},{default:Ce(()=>[...a[8]||(a[8]=[xe("保存",-1)])]),_:1})]),_:1}))]),_:1},8,["model","rules"]),Pe(Ds)?Qe("",!0):(ke(),Ge(o,{key:0,options:Pe(Is),class:"ml-[20px] mt-[20px]"},null,8,["options"]))])),[[i,Pe(qs)]])}}}),As=_e("DOCKERSITE-LOGS-STORE",()=>({getErrorLogsEvent:async e=>{try{const{data:a}=await X(e);return{data:a,status:!0}}catch(a){return{msg:"获取错误日志失败",status:!1}}},getResLogEvent:async e=>{try{const a=await X(e);return{data:a.data,status:a.status}}catch(a){return{msg:"获取日志失败",status:!1}}}})),Bs=z(),{siteInfo:Ns}=na(),Ms=fe("cache"),Js=fe({site_name:"",domain_list:[],site_port:[],port_conf:"",ssl_port_conf:"",site_path:"",ssl_info:{},err_age_404:"",err_age_502:"",ip_limit:{ip_black:[],ip_white:[]},basic_auth:[],proxy_cache:{},gzip:{},sub_filter:{},websocket:{},security:{},redirect:{},proxy_log:{},http_block:"",server_block:"",remark:"",proxy_info:[],ipv6_status:!1}),Ks=async()=>{const e=await Z({site_name:Ns.value.name});e.status?Js.value=e.data:Bs.error(e.msg)},Gs=fe(!1),Ws=fe(!1),Qs=fe(),Xs=$e({status:!1,time:"",unit:"m"}),Zs=[{label:"分钟",value:"m"},{label:"小时",value:"h"},{label:"天",value:"d"}],$s=[{content:"缓存是一种用于加速网站性能和提高用户体验的技术"},{content:"开启后资源会被缓存，如果影响网站访问请关闭"},{content:"缓存键由主机名、URI 和请求参数组成"},{content:"默认忽略的响应头有：Set-Cookie|Cache-Control|expires|X-Accel-Expires"},{content:"默认缓存的静态资源有：css|js|jpg|jpeg|gif|png|webp|woff|eot|ttf|svg|ico|css.map|js.map"}],Ys={time:[{required:!0,message:"请输入正确的缓存时间",trigger:"blur",validator:(e,a,t)=>{a?isNaN(Number(a))?t(new Error("请输入数字")):Number(a)<1?t(new Error("请输入正确数字")):t():t(new Error("目标URL不能为空"))}},{}]},en=async()=>{await u({title:"清理缓存【".concat(Ns.value.name,"】"),width:"35rem",icon:"warning-filled",content:"清理后包含所有URL的及站点的缓存都会被清空,是否继续？"}),await e({loading:"正在清理缓存，请稍后...",request:$({site_name:Ns.value.name}),message:!0})},an=async()=>{let a={site_name:Ns.value.name,cache_status:Xs.status?1:0,expires:"".concat(Xs.time).concat(Xs.unit)};await Qs.value.validate(),await e({loading:Ws,request:Y(a),message:!0})},tn=fe(),sn=$e({status:!1,type:"",level:1,minLength:"",unit:"m"}),nn=[{label:"k",value:"k"},{label:"m",value:"m"}],ln=[{content:"用于对 HTTP 响应的内容进行压缩，以减少数据传输量，提高网站性能和加载速度"},{content:"压缩级别1-9，例如：1为压缩速度最快，但压缩率较低；9为压缩速度最慢，但压缩率最高，建议默认"},{content:"如果开启gzip后影响网站正常访问，请关闭此功能 和请求参数组成"}],rn={type:[{required:!0,message:"请输入压缩类型",trigger:["blur","change"]}],minLength:[{required:!0,message:"请输入正确的压缩最小长度",trigger:"blur",validator:(e,a,t)=>{a?isNaN(Number(a))?t(new Error("请输入数字")):Number(a)<1?t(new Error("请输入正确数字")):t():t(new Error("压缩最小长度不能为空"))}},{}]},on=e=>{sn.status=e.gzip_status,sn.type=e.gzip_types,sn.level=e.gzip_comp_level;let a="",t="m";e.gzip_min_length&&e.gzip_min_length.length>1&&(a=e.gzip_min_length.slice(0,-1),t=e.gzip_min_length.slice(-1)),sn.minLength=a,sn.unit=t},un=async()=>{const a={site_name:Ns.value.name,gzip_status:sn.status?1:0,gzip_min_length:"".concat(sn.minLength).concat(sn.unit),gzip_comp_level:sn.level,gzip_types:sn.type};await tn.value.validate(),await e({loading:Ws,request:ee(a),message:!0})},cn=$e({loading:!1,type:"black",white:[],black:[]}),dn=e=>{cn.type="ipBlackList"===Ms.value?"black":"white",hn.value.address="",hn.value.types=cn.type,cn.white=e.ip_white.map(e=>({ip:e,type:"white"})),cn.black=e.ip_black.map(e=>({ip:e,type:"black"}))},mn=async a=>{const t=!!Array.isArray(a);await u({title:"".concat(t?"批量删除IP":"删除".concat("white"===a.type?"白名单":"黑名单","【").concat(a.ip,"】")),content:t?"批量删除选中的IP，是否继续操作？":"删除".concat("white"===a.type?"白名单":"黑名单","【").concat(a.ip,"】，是否继续操作？")});let s={site_name:Ns.value.name};t?(s.ip_type=cn.type,s.ips=a.map(e=>e.ip).join("\n")):(s.ip_type=a.type,s.ip=a.ip);const n=t?me:pe;(await e({loading:"正在删除，请稍后...",request:n(s),message:!0})).status&&Ks()},pn=fe([ga(),{label:"IP",prop:"ip",minWidth:120},_a([{title:"删除",onClick:e=>{mn(e)}}])]),vn=[{label:"删除IP",value:"delete",event:async(e,a,t,s)=>{mn(t.value)}}],gn=()=>{hn.value.address="",y({isAsync:!0,title:"添加IP".concat("ipBlackList"===Ms.value?"黑":"白","名单"),area:40,btn:"确认",component:()=>J(()=>import("./add-ip.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{listType:cn.type,refreshEvent:()=>{hn.value.address="",Ks()}}})},hn=fe({types:cn.type,address:""}),yn=[{content:"一行一条配置，多个IP请换行"}],_n=fe(),fn={address:[{validator:(e,a,t)=>{a.length>0?t():t(new Error("请输入IP地址"))},trigger:["blur","change"]}]},wn=async a=>{const{types:t,address:s}=hn.value,n={site_name:Ns.value.name,ip_type:t,ips:s};(await e({loading:Ws,request:ae(n),message:!0})).status&&(hn.value.address="",Ks(),a())},bn=fe([]),xn=e=>{Vn.value=e||!1,y({isAsync:!0,title:"".concat(e?"编辑":"添加","http认证").concat(e?"【".concat(e.auth_name,"】"):""),area:48,btn:"确认",component:()=>J(()=>import("./http-auth-add.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{refreshEvent:Ks,proxy_info:Js.value.proxy_info,isEdit:!!e,row:e}})},En=fe([{label:"名称",prop:"auth_name"},{label:"路径",prop:"auth_path"},_a([{onClick:xn,title:"编辑"},{onClick:async a=>{await u({title:"删除http认证【".concat(a.auth_name,"】"),content:"删除http认证【".concat(a.auth_name,"】，是否继续操作？")});(await e({loading:"正在删除http认证，请稍候...",request:ue({site_name:Ns.value.name,auth_path:a.auth_path,name:a.auth_name}),message:!0})).status&&Ks()},title:"删除"}])]),kn=e=>{bn.value=e||[]},Vn=fe(),Rn=fe({name:te(5),path:"",user:"",password:""}),Cn=[{content:"例如我设置了加密访问/test/,那我访问http://aaa.com/test/时就要输入账号密码才能访问"}],Pn=fe(),Dn={name:[{required:!0,message:"请输入名称",trigger:["blur","change"]}],path:[{required:!0,message:"请输入路径",trigger:["blur","change"]}],user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]},qn=(e,a)=>{const t=Js.value.proxy_info.map(e=>({value:e.proxy_path}));a(e?t.filter(a=>a.value.includes(e)):t)},Ln=async a=>{let t=Rn.value;await Pn.value.validate();const s={site_name:Ns.value.name,auth_path:t.path,username:t.user,password:t.password,name:t.name},n=Vn.value?se:ne;(await e({loading:Ws,request:n(s)})).status&&(Ks(),a&&a())},Tn=()=>{Object.assign(Rn.value,{name:Vn.value?Vn.value.auth_name:te(5),path:Vn.value?Vn.value.auth_path:"",user:"",password:""})},In=fe(),jn=$e({type:"default",accessLog:"",address:"",port:"514"}),Sn={accessLog:[{validator:(e,a,t)=>{"file"!==jn.type||a?t():t(new Error("请选择日志目录"))},trigger:["blur","change"]}],address:[{validator:(e,a,t)=>{"rsyslog"!==jn.type||a?t():t(new Error("请输入接收地址"))},trigger:["blur","change"]}]},zn=[{content:"指定目录可选择自定义的日志存储目录，请注意此目录必须www用户可写"},{content:"发送到远程服务器设置之后本地不会保存日志内容，填写前请确保日志接收端可正常访问"}],Un=[{label:"默认",value:"default"},{label:"不记录日志",value:"off"},{label:"指定目录",value:"file"},{label:"发送到远程服务器",value:"rsyslog"}],On=e=>{va({type:"dir",path:"/www/wwwlogs",change:e=>{jn.accessLog=e}})},Hn=e=>{e?(jn.type=e.log_type,jn.accessLog=e.log_path,jn.address=e.rsyslog_host):jn.type="default"},Fn=async()=>{await In.value.validate();const a={site_name:Ns.value.name,log_type:jn.type,log_path:"file"==jn.type?jn.accessLog:jn.address};await e({loading:"正在设置日志配置，请稍后...",request:ce(a),message:!0})},An=$e({websocket:!1}),Bn=async a=>{(await e({loading:Ws,request:le({site_name:Ns.value.name,websocket_status:a?1:0}),message:!0})).status||(An.websocket=!a)},Nn=e=>{An.websocket=!!e&&e.websocket_status},Mn=a=>{e({loading:"正在设置，请稍后...",request:re({site_name:Ns.value.name,status:a?"1":"0"}),message:!0})},Jn=async(a,t,s,n)=>{try{const l=await e({loading:a,request:oe({site_name:Ns.value.name})});t.value=l.data.data,s.value=l.data.encoding||"utf-8",n.value=l.data.status}catch(l){}},Kn=async(a,t)=>{e({request:de({site_name:Ns.value.name,file_body:a,encoding:t}),message:!0})},Gn=async()=>{let a={site_name:Ns.value.name,ipv6_status:Js.value.ipv6_status?"1":"0"};await Qs.value.validate(),await e({loading:Ws,request:ie(a),message:!0})},Wn={class:"h-full"},Qn={class:"mb-[1.6rem]"},Xn={class:"flex"},Zn=we({__name:"error-log",setup:e=>(Fe(pl),(e,a)=>{const t=Me("bt-loading");return Le((ke(),Ve("div",Wn,[Re("div",Qn,"日志大小："+qe(Pe(ul).size),1),Re("div",Xn,[be(Ea,{content:Pe(ul).logs,isHtml:!0,fullScreen:{title:"全屏查看[错误]日志",onRefresh:Pe(pl)},style:{height:"58rem",width:"99.5%"}},null,8,["content","fullScreen"])])])),[[t,Pe(il)]])})}),$n={class:"h-full"},Yn=we({__name:"response-log",setup:e=>(Fe(hl),(e,a)=>{const t=Me("bt-loading");return ke(),Ve("div",$n,[Re("div",null,"日志大小："+qe(Pe(vl).size),1),Le(be(Ea,{class:"mt-[16px]",content:Pe(vl).logs,isHtml:!0,fullScreen:{title:"全屏查看[响应]日志",onRefresh:Pe(gl)},style:{height:"58rem",width:"99.5%"}},null,8,["content","fullScreen"]),[[t,Pe(il)]])])})}),el={class:"p-[16px]"},al={class:"mt-[1.6rem]"},tl={class:"mt-[1.6rem]"},sl={class:"ml-[20px]"},nl=we({__name:"config",setup:(e,{expose:a})=>(sa(()=>Js.value.proxy_log,e=>{Hn(e)}),Fe(()=>{Hn(Js.value.proxy_log)}),a({onConfirm:Fn}),(e,a)=>{const t=O,s=ea,n=V,l=Se,r=_,o=ta,i=I,u=Me("bt-loading");return ke(),Ve("div",el,[Le((ke(),Ge(o,{ref_key:"logFormRef",ref:In,class:"h-[48rem]",model:Pe(jn),"label-width":"60px",rules:Pe(Sn),disabled:Pe(Ws)},{default:Ce(()=>[be(s,{label:"日志",prop:"type"},{default:Ce(()=>[be(t,{class:"!w-[24rem]",modelValue:Pe(jn).type,"onUpdate:modelValue":a[0]||(a[0]=e=>Pe(jn).type=e),options:Pe(Un),placeholder:"请选择"},null,8,["modelValue","options"])]),_:1}),Le(Re("div",al,[be(s,{label:"访问日志",prop:"accessLog"},{default:Ce(()=>[be(r,{modelValue:Pe(jn).accessLog,"onUpdate:modelValue":a[2]||(a[2]=e=>Pe(jn).accessLog=e),placeholder:"请选择或输入目录，例如：/www/wwwlogs",width:"35rem"},{append:Ce(()=>[be(l,{onClick:a[1]||(a[1]=e=>Pe(On)("accessLog"))},{default:Ce(()=>[be(n,{icon:"el-folder-opened",class:"cursor-pointer"})]),_:1})]),_:1},8,["modelValue"])]),_:1})],512),[[Te,"file"===Pe(jn).type]]),Le(Re("div",tl,[be(s,{label:"接收地址",prop:"address"},{default:Ce(()=>[be(r,{modelValue:Pe(jn).address,"onUpdate:modelValue":a[3]||(a[3]=e=>Pe(jn).address=e),placeholder:"接收地址，如：202.96.128.86:9204",width:"24rem"},null,8,["modelValue"])]),_:1})],512),[[Te,"rsyslog"===Pe(jn).type]]),be(s,{class:"mt-[1.6rem]",label:" "},{default:Ce(()=>[be(l,{type:"primary",onClick:Pe(Fn)},{default:Ce(()=>[...a[4]||(a[4]=[xe("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules","disabled"])),[[u,Pe(Gs)]]),Re("div",sl,[be(i,{options:Pe(zn)},null,8,["options"])])])})}),{getErrorLogsEvent:ll,getResLogEvent:rl}=As(),{siteInfo:ol}=na(),il=fe(!1),ul=fe({logs:"",size:"0 b"}),cl=fe("response"),dl=fe([{label:"响应日志",name:"response",lazy:!0,render:()=>be(Yn,null,null)},{label:"错误日志",name:"error",lazy:!0,render:()=>be(Zn,null,null)},{label:"配置",name:"config",lazy:!0,render:()=>be(nl,null,null)}]),ml=()=>{var e;cl.value=(null==(e=ol.value)?void 0:e.tabName)||"response"},pl=async()=>{const e=ol.value.name;try{il.value=!0;const a=await ll({site_name:e,type:"error"});return ul.value.size=a.data.size||"0 b",ul.value.logs=a.data.msg||"暂无日志信息",a}catch(a){return w(a),{msg:"获取错误日志失败",status:!1}}finally{il.value=!1}},vl=$e({alert:!1,showIp:!1,ipData:0,logs:"",size:"0 b"}),gl=async(e=ol.value.name)=>{try{il.value=!0;const a=await rl({site_name:e,type:"access"});return vl.logs=a.data.msg||"暂无日志信息",vl.size=a.data.size||"0 b",a}catch(a){return w(a),{msg:"获取日志失败",status:!1}}finally{il.value=!1}},hl=async()=>{await gl(),Ks()},yl=we({__name:"index",setup:e=>(Fe(ml),(e,a)=>{const t=ve;return ke(),Ve("div",null,[be(t,{type:"card",modelValue:Pe(cl),"onUpdate:modelValue":a[0]||(a[0]=e=>De(cl)?cl.value=e:null),options:Pe(dl)},null,8,["modelValue","options"])])})}),{siteInfo:_l}=na(),fl=fe([]),wl=()=>({version:"",oldVersion:""}),bl=async a=>{const t=await e({request:ge({id:_l.value.id})});t.status?(a.value.version="".concat(t.data.used.name,":").concat(t.data.used.version),a.value.oldVersion="".concat(t.data.used.name,":").concat(t.data.used.version),fl.value=t.data.runtime_list.map(e=>({label:"PHP-".concat(e.version,"(").concat(e.name,")"),value:"".concat(e.name,":").concat(e.version)}))):n.error(t.msg)},xl={class:"p-[16px]"},El={class:"ml-[20px]"},kl=we({__name:"index",setup(a,{expose:t}){const{BtForm:s,submit:l,param:r}=v({data:wl,options:()=>Ie(()=>[da("PHP版本","version",fl.value,{attrs:{class:"!w-[22rem]"},rules:[{required:!0,message:"请选择PHP版本",trigger:"change"}]}),ma("切换",{label:" ",attrs:{type:"primary",onClick:l}})]),submit:async(a,t,s)=>{await t(),(async({version:a,oldVersion:t},s)=>{try{if(a===t)return void n.error("当前版本与原版本一致，无需切换");await u({title:"切换PHP版本",content:"切换PHP版本可能会导致无法访问，是否切换？"}),e({loading:"正在切换PHP版本，请稍后...",request:he({id:_l.value.id,runtime_name:a}),message:!0,success:e=>{e.status&&(s.value.oldVersion=a)}})}catch(l){}})(a.value,r)}});return Fe(()=>{bl(r)}),Ae(()=>{fl.value=[]}),t({init:()=>{bl(r)}}),(e,a)=>{const t=I;return ke(),Ve("div",xl,[be(Pe(s)),Re("div",El,[be(t,{options:[{content:"切换PHP版本可能会导致网站无法访问"},{content:"如果网站访问异常，建议删除网站重新创建以选择新的PHP版本"}]})])])}}}),Vl=R(we({__name:"index",setup(e){const{settingTabActive:a,siteInfo:t}=ye(ra()),s=fe(a.value||"domain"),{BtTabs:n}=H({type:"left-bg-card",value:s,options:[{label:"域名管理",name:"domain",lazy:!0,render:()=>be(Ja,null,null)},{label:"网站目录",name:"dir",lazy:!0,render:()=>be(Wa,null,null)},{label:"反向代理",name:"urlProxy",lazy:!0,render:()=>J(()=>import("./index430.js?v=1756369731").then(e=>e.af),__vite__mapDeps([]),import.meta.url)},{label:"全局配置",name:"golbalConfig",lazy:!0,render:()=>J(()=>import("./index431.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)},{label:"伪静态",name:"pseudo",lazy:!0,render:()=>be(Rt,null,null)},{label:"配置文件",name:"configFile",lazy:!0,render:()=>be(Jt,null,null)},{label:"SSL",name:"ssl",lazy:!0,render:()=>J(()=>import("./index432.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)},..."PHP"===t.value.type?[{label:"PHP",name:"php",lazy:!0,render:()=>be(kl,null,null)}]:[],{label:"重定向",name:"redirect",lazy:!0,render:()=>be(Rs,null,null)},{label:"防盗链",name:"antiLeech",lazy:!0,render:()=>be(Fs,null,null)},{label:"日志",name:"siteLogs",lazy:!0,render:()=>be(yl,null,null)}]});return sa(()=>a.value,e=>{e&&(s.value=a.value,a.value="")}),(e,a)=>(ke(),Ge(Pe(n)))}}),[["__scopeId","data-v-59d4f08d"]]),Rl=Object.freeze(Object.defineProperty({__proto__:null,default:Vl},Symbol.toStringTag,{value:"Module"}));export{Rl as $,Nn as A,An as B,Bn as C,Jn as D,Mn as E,Kn as F,Gn as G,Ks as H,ms as I,xs as J,Es as K,ds as L,vs as M,wn as N,hn as O,yn as P,_n as Q,fn as R,Tn as S,vn as T,Ln as U,Rn as V,Vn as W,qn as X,Cn as Y,Pn as Z,Dn as _,en as a,Qs as b,Xs as c,Ys as d,Ws as e,Gs as f,$s as g,Js as h,sn as i,un as j,tn as k,nn as l,rn as m,ln as n,an as o,Ms as p,gn as q,dn as r,on as s,Zs as t,cn as u,pn as v,xn as w,kn as x,bn as y,En as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
