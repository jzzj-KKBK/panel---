import{_ as e}from"./index116.js?v=1756369731";import{ba as a,b as s}from"./utils-lib.js?v=1756369731";import{c as t,w as o,r as c,p as l,aD as n,q as m,v as r,e as i,x as u}from"./base-lib.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const p={class:"flex-wrap"},v=t({__name:"index",props:{compData:{default:()=>({type:"scan",endMsg:"扫描结束",logPath:"",successMsg:"修复成功",isClear:!1,completeEvent:null,failMsg:""})}},emits:["close","onCancel"],setup(t,{expose:v,emit:d}){const g=t,f=s();o(()=>g.compData,()=>{M.value=!0,_()});const D=d,x=c("获取中..."),M=c(!0),y=c(null),_=async()=>{try{const e=await a({num:20,filename:g.compData.logPath});if(x.value!==e.msg&&(x.value=e.msg),""!==g.compData.failMsg&&-1!==e.msg.indexOf(g.compData.failMsg))return M.value=!1,g.compData.completeEvent?(C(),void g.compData.completeEvent(!1,()=>{D("close")})):(f.error("失败"),void C());if(-1!==e.msg.indexOf(g.compData.endMsg))return M.value=!1,g.compData.completeEvent?(g.compData.completeEvent(!0,()=>{D("close")}),void C()):("repair"===g.compData.type?(D("close"),f.msg({dangerouslyUseHTMLString:!0,message:"修复完成，请按 Ctrl+F5 刷新缓存，或等待2s自动刷新！",type:"success",duration:2e3}),setTimeout(()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},2e3)):"scan"===g.compData.type?f.success("扫描已结束"):(f.success(g.compData.successMsg),D("close")),void C());-1===e.msg.indexOf(g.compData.endMsg)&&M.value&&(y.value=setTimeout(function(){_()},1500)),e.status||(f.request(e),M.value=!1)}catch(e){M.value&&_()}},C=()=>{y.value&&clearTimeout(y.value)},b=()=>{g.compData.isClear&&clearTimeout(y.value)};return D("onCancel",b),l(()=>{_()}),n(()=>{C()}),v({onCancel:b}),(a,s)=>{const t=e;return m(),r("div",p,[i(t,{class:"h-[40rem] !rounded-none",content:u(x)},null,8,["content"])])}}});export{v as default};
