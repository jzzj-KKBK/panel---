import{u as e,ah as s,o as a,at as t,_ as n,k as i,h as r,b as l,d as c,c as o,e as d}from"./utils-lib.js?v=1756369731";import{c as m,r as p,k as u,p as b,G as g,H as f,x as v,q as x,v as y,y as k,e as h,M as _,z as w,A as S,B as T,J as j,I as C,F as L,a_ as F,C as O,P as M,D as E,b3 as H,a$ as I,K as z,bv as D,bw as P}from"./base-lib.js?v=1756369731";import{a as A}from"./column.js?v=1756369731";import{p as B}from"./validator.js?v=1756369731";import{getRiskCount as V}from"./site.js?v=1756369731";import{i as G}from"./useController5.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./useStore4.js?v=1756369731";import"./useController6.js?v=1756369731";import"./useMethod5.js?v=1756369731";const J={id:"safeDetectList",class:"p-[2rem]"},q={class:"progress-header"},K={class:"progress-header-cot"},N={class:"flex items-center"},R={key:0,class:"scan-icon relative h-[8rem] w-[8rem] flex"},U={key:1},$={class:"progress-header-cot h-[8rem]"},Q=["innerHTML"],W={class:"scanning-progress-cont"},X={class:"progress-header-cot"},Y={class:"progress-cont-list"},Z={key:0},ee={class:"inline-grid grid-cols-4 w-full mt-20px"},se=["onClick"],ae={class:"progress_type"},te={class:"flex-1"},ne={key:0},ie={key:1},re={key:2,class:"text-danger mr-[4px]"},le={key:3,class:"text-primary"},ce={class:"progress_fold text-[1.2rem] flex items-center"},oe={class:"mr-4px"},de={class:"progress_item_body"},me={class:"flex items-center justify-between w-full"},pe={class:"flex items-center ml-12px"},ue=["innerHTML"],be={class:"flex flex-col py-[1rem] px-[1.6rem] text-[1.2rem] progress_item_info"},ge={class:"flex items-center"},fe=["innerHTML"],ve={class:"flex"},xe=["innerHTML"],ye={class:"p-[2rem]"},ke=d(m({__name:"index",setup(d){const m=l(),{payment:ke}=e(),{authType:he}=ke.value,_e=p(),we=p(!1),Se=p([{name:"webscan",title:"网站配置安全性"},{name:"filescan",title:"文件泄露"},{name:"backup",title:"备份文件"},{name:"index",title:"首页内容风险"},{name:"webhorse",title:"挂马排查"},{name:"deadchain",title:"坏链扫描"},{name:"database",title:"数据库安全"},{name:"ftps",title:"网站FTP风险"},{name:"backend",title:"网站后台安全"}]),Te=p(""),je=u({title:"定期扫描网站，提升网站安全性",msg:"当前安全风险未知，请立即扫描",isFirst:!0,error:0,scanStatus:!1,isEnd:!1,siteList:[],time:0,scanTypeStatus:{vulscan:!0,webscan:!0,filescan:!0,backup:!0,index:!0,webhorse:!0,deadchain:!0,database:!0,ftps:!0,backend:!0},btnObj:{text:"立即扫描",type:"primary"},progress:0,progressColor:"#20a53a",progressConfig:{},statusTotal:{},active:{vulscan:!1,webscan:!1,filescan:!1,backup:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1}}),Ce=u({0:{text:"警告",bg:"rgba(252, 109, 38, 0.1)",color:"#fc6d26"},1:{text:"低危",bg:"rgba(232, 213, 68, 0.1)",color:"#D4BB00"},2:{text:"中危",bg:"rgba(240, 173, 78, 0.14)",color:"#f0ad4e"},3:{text:"高危",bg:"rgba(239, 8, 8, 0.1)",color:"#EF0808"}});let Le=null;const Fe=p(),Oe=p(!1),Me=p(!1),Ee=p([]),He=p([A({key:"name",type:"page"}),{label:"网站名",prop:"name"}]),Ie=()=>{Le=s({route:"/ws_project",onMessage:Pe})},ze=e=>{Me.value=!0,je.siteList=e},De=()=>{if(0==je.siteList.length)return m.error("请选择扫描站点"),!1;Oe.value=!1,Ae()},Pe=(e,s)=>{const a=JSON.parse(s.data);if(a.hasOwnProperty("site_list"))return Ee.value=a.site_list,void(je.siteList=a.site_list);if(a.hasOwnProperty("end")){if(je.progress=a.bar,je.msg=a.info,a.dangerous&&(je.progressConfig[a.type]||(je.progressConfig[a.type]=[]),je.progressConfig[a.type].push(a),je.statusTotal[a.type]?je.statusTotal[a.type]++:je.statusTotal[a.type]=1,je.error++),a.end)return je.isEnd=!0,je.scanStatus=!1,null==Le||Le.close(),G(),void Ve("end");a.type!=Te.value&&(Te.value&&!je.statusTotal[Te.value]&&(je.scanTypeStatus[Te.value]=!1),Te.value=a.type)}},Ae=async()=>{if(je.time=0,je.error=0,setInterval(()=>{je.time++},1e3),"ltd"!==he)return B({sourceId:20});je.siteList=Ee.value,je.isFirst?(Be(),je.scanStatus=!0,je.isFirst=!1,Ve("scan")):je.scanStatus?(await a({title:"取消扫描",content:"确定取消扫描吗?"}),null==Le||Le.close(),je.isFirst=!0,Ve("scan"),Je()):(Je(),Be(),je.scanStatus=!0,Ve("scan"))},Be=async()=>{await Ie(),await(null==Le?void 0:Le.send({mod_name:"webscanning",def_name:"ScanAllSite",site_list:je.siteList.map(e=>e.name),ws_callback:"123"}))},Ve=e=>{switch(e){case"scan":je.title="正在扫描",je.isEnd=!1,je.btnObj.text="取消扫描",je.btnObj.type="warning";break;case"end":qe(),je.btnObj.text="重新扫描",je.btnObj.type="primary"}},Ge=e=>{"free"==he&&B({sourceId:65})},Je=()=>{Te.value="",je.scanStatus=!1,je.isEnd=!1,je.error=0,je.time=0,je.progress=0,je.progressConfig={vulscan:[],webscan:[],filescan:[],backup:[],index:[],webhorse:[],deadchain:[],database:[],ftps:[],backend:[]},je.statusTotal={},je.active={vulscan:!1,webscan:!1,filescan:!1,backup:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1},je.scanTypeStatus={vulscan:!0,webscan:!0,filescan:!0,backup:!0,index:!0,webhorse:!0,deadchain:!0,database:!0,ftps:!0,backend:!0},je.btnObj.text="立即扫描",je.btnObj.type="primary",je.title="定期扫描网站，提升网站安全性",je.msg="当前安全风险未知，请立即扫描"},qe=async()=>{try{const{data:e}=await V();e.risk_count.high+e.risk_count.middle>0?(je.error=e.risk_count.high+e.risk_count.middle,je.title="".concat(e.web_count,"个网站检测出，高危").concat(e.risk_count.high>0?'<span class="text-danger">'.concat(e.risk_count.high,"</span>"):0,"个/中危").concat(e.risk_count.middle,"个！"),je.msg="上次扫描时间：".concat(e.scan_time)):(je.title="已完成对".concat(e.web_count,"个网站的全面检测，暂未发现风险。"),je.msg="最后扫描时间：".concat(e.scan_time)),e.risk_count.high>0&&(je.isEnd=!0)}catch(e){t(e)}};return qe(),b(()=>{Ie(),null==Le||Le.send({mod_name:"webscanning",def_name:"GetAllSite",ws_callback:""})}),(e,s)=>{const a=n,t=E,l=H,d=I,m=c,p=o,u=D,b=P,A=i,B=r,V=g("bt-loading");return f((x(),y("div",J,[k("div",q,[k("div",K,[k("div",N,[v(je).scanStatus?(x(),y("div",R,[s[1]||(s[1]=k("div",{class:"animate-spin absolute top-0 border-primary border-b-2 rounded-full h-full w-full bg-#cccccc00"},null,-1)),h(a,{icon:"scanning-danger",size:60,color:"#F39C12",class:"m-auto"})])):(x(),y("div",U,[v(je).warn||v(je).error?(x(),_(a,{key:0,icon:"scanning-danger",size:70,color:"#ef0808"})):(x(),_(a,{key:1,icon:"scanning-"+(v(je).isEnd?"success":"danger"),size:72,color:v(je).isEnd?"#20a53a":"#F39C12"},null,8,["icon","color"]))]))])]),k("div",$,[k("div",{class:"scanning-progress-title",innerHTML:v(je).title},null,8,Q),k("div",W,w(v(je).msg.length>35?v(je).msg.substring(0,35)+"...":v(je).msg),1)]),k("div",X,[h(t,{class:j({"warning-hover":v(je).scanStatus}),plain:!!v(je).scanStatus,type:v(je).btnObj.type,onClick:Ae},{default:S(()=>[T(w(v(je).btnObj.text),1)]),_:1},8,["class","plain","type"])])]),f(h(l,{class:"!w-full",color:v(je).progressColor,"show-text":!1,"stroke-width":2,percentage:v(je).progress},null,8,["color","percentage"]),[[C,v(je).scanStatus]]),f(h(d,{class:"!mt-0 !mb-20px !bg-[#F1F1F1]"},null,512),[[C,!v(je).scanStatus]]),k("div",Y,[v(je).scanStatus||v(je).isEnd?O("",!0):(x(),y("div",Z,[s[2]||(s[2]=k("div",{class:"font-bold text-[1.6rem] text-[#666] my-[4rem]"},"支持网站以下安全扫描项:",-1)),k("div",ee,[(x(!0),y(L,null,F(v(Se),(e,s)=>(x(),y("div",{key:s,class:"flex flex-col inline-block items-center mb-20px"},[h(m,{class:"w-[4rem] inline-block mb-8px opacity-90",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),T(" "+w(e.title),1)]))),128))])])),v(je).scanStatus||v(je).isEnd?(x(!0),y(L,{key:1},F(v(Se),(e,a)=>(x(),y("div",{key:a,class:j([e.name+"_item "+(v(je).active[e.name]?"active":""),"progress_item"])},[k("div",{class:"progress_item_header",onClick:s=>(e=>{je.active[e]||(je.active[e]=!1),je.active[e]=!je.active[e]})(e.name)},[k("div",ae,[h(m,{class:"mr-12px w-[2rem]",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),k("span",null,w(e.title),1)]),k("div",te,[v(je).scanStatus&&v(Te)==e.name?(x(),y("span",ne," 正在扫描... ")):v(je).scanStatus&&v(Te)!=e.name&&!v(je).statusTotal[e.name]&&v(je).scanTypeStatus[e.name]?(x(),y("span",ie," 等待扫描 ")):v(je).statusTotal[e.name]?(x(),y("span",re," 发现"+w(v(je).statusTotal[e.name])+"项危险 ",1)):(x(),y("span",le,"无风险项"))]),k("div",ce,[k("span",oe,w(v(je).active[e.name]?"收起":"展开"),1),k("i",{class:j(v(je).active[e.name]?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down")},null,2)])],8,se),f(k("div",de,[h(b,{accordion:""},{default:S(()=>[(x(!0),y(L,null,F(v(je).progressConfig[e.name],(e,a)=>(x(),_(u,{key:a,disabled:"free"==v(he)},{title:S(()=>[k("div",me,[k("div",pe,[k("span",{class:"text-[1.2rem] h-[2.2rem] flex items-center px-[8px] rounded-[0.2rem] mr-[1rem]",style:z({color:v(Ce)[e.dangerous||0].color,backgroundColor:v(Ce)[e.dangerous||0].bg})},w(v(Ce)[e.dangerous||0].text),5),k("span",{innerHTML:e.info},null,8,ue)]),h(p,{class:"mb-2px mr-4px",onClick:Ge},{default:S(()=>[...s[3]||(s[3]=[T(" 详情 ",-1)])]),_:1})])]),default:S(()=>[k("div",be,[k("div",ge,[s[4]||(s[4]=k("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 详情： ",-1)),k("span",{class:"leading-[1.6rem]",innerHTML:e.detail},null,8,fe)]),h(d,{class:"!my-8px"}),k("div",ve,[s[5]||(s[5]=k("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 修复方案： ",-1)),k("span",{innerHTML:e.repair},null,8,xe)])])]),_:2},1032,["disabled"]))),128))]),_:2},1024)],512),[[C,v(je).active[e.name]]])],2))),128)):O("",!0)]),h(B,{title:"选择扫描网站",modelValue:v(Oe),"onUpdate:modelValue":s[0]||(s[0]=e=>M(Oe)?Oe.value=e:null),ref_key:"scanSiteListDialog",ref:Fe,area:45,onConfirm:De,showFooter:""},{default:S(()=>[k("div",ye,[h(A,{ref_key:"scanSiteTableRef",ref:_e,data:v(Ee),column:v(He),"max-height":296,onSelectionChange:ze,description:"网站列表为空"},null,8,["data","column"])])]),_:1},8,["modelValue"])])),[[V,v(we)]])}}}),[["__scopeId","data-v-33c78097"]]);export{ke as default};
