import{c as e,t as a,s as t,k as s,r as l,p as i,G as d,q as n,v as r,x as o,y as p,e as c,A as u,B as m,C as f,z as x,H as v,F as b,a_ as y,M as h,T as g,R as w,D as M,aQ as k}from"./base-lib.js?v=1756369731";import{checkDelData as j,batchDelSite as _,deleteAsync as D,deleteSite as S}from"./site.js?v=1756369731";import{u as F,N as P,M as V,bv as z,r as C,K as H,at as R,v as A}from"./utils-lib.js?v=1756369731";import{h as O,i as T}from"./validator.js?v=1756369731";import{o as U}from"./useController6.js?v=1756369731";import{u as q}from"./useStore4.js?v=1756369731";import{u as L}from"./useController5.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./useMethod5.js?v=1756369731";const I={class:""},N={key:0,class:"p-[20px] w-[480px]"},B={class:"flex items-center ml-[48px] mt-[12px]"},G={key:0,class:"!mt-[12px] text-danger ml-[48px]"},J={key:0},K={key:1},Q={key:2},E={class:"p-[20px] bg-#f1f1f1 mt-[12px]"},W={class:"mx-[1rem]"},X={key:1,class:"p-[20px] w-[610px]"},Y={class:"border border-[#d6d7d9] min-h-[12rem] overflow-auto mt-[20px] mb-1rem max-h-[40rem]"},Z={class:"inline-flex items-center justify-between px-[12px] py-[8px] w-full"},$={class:"truncate w-[28%]"},ee={class:"inline-flex items-center justify-between flex-1"},ae={key:0,class:"flex item-center"},te=["title"],se={key:0,class:"text-danger flex items-center"},le={key:1},ie={class:"truncate !w-[180px] flex-shrink-0"},de={key:0,class:"flex items-center justify-between px-[12px] py-[8px] w-full border-t-1 border-[#f1f1f1]"},ne={class:"truncate w-[28%]"},re={class:"items-center inline-flex justify-between flex-1"},oe={class:"truncate mr-12px flex items-center"},pe={class:"truncate !w-[180px] flex-shrink-0"},ce={key:0},ue={class:"text-danger bold"},me={key:1,class:"text-danger"},fe={class:"bg-[#f6f8f8] footer-btn flex items-center justify-end p-[12px] w-full"},xe=e({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{emit:xe}){const ve=e,{panel:be}=F(),{isFileRecycle:ye,isDbRecycle:he}=a(be.value),{isRefreshList:ge,batchConfig:we}=q(),{isRefreshLocalList:Me}=t(L()),ke=xe,je=s({addend1:Math.round(9*Math.random()+1),addend2:Math.round(9*Math.random()+1),sum:void 0,steps:1,isFtp:!1,isDatabase:!1,isSite:!1,data:{},isMult:!1,fileSize:0,dbSize:0}),_e=()=>{ke("close"),je.steps=1,je.addend1=Math.round(9*Math.random()+1),je.addend2=Math.round(9*Math.random()+1),je.sum=void 0,je.isFtp=!1,je.isDatabase=!1,je.isSite=!1},De=l(!1),Se=l(5),Fe=async()=>{var e,a;if(je.sum===je.addend1+je.addend2){let s;if(je.isFtp||je.isDatabase||je.isSite){try{let t;je.data.hasOwnProperty("id")?t=[je.data.id]:(t=null==(e=je.data)?void 0:e.map(e=>e.id),je.isMult=!0),s=V.load("正在检查要删除的数据,请稍后...");const l=await j({ids:JSON.stringify(t)}),i=null==(a=z(l.data.data,"array",[]))?void 0:a.map(e=>{var a,t,s,l;return"PHPMOD"===(Array.isArray(je.data)?null==(t=null==(a=je.data.find(a=>a.id===e.id))?void 0:a.project_config)?void 0:t.type:(null==(l=null==(s=je.data)?void 0:s.project_config)?void 0:l.type)||je.data.project_type)?{...e,project_config:{type:"PHPMOD"}}:e});je.data=i,je.fileSize=l.data.file_size,je.dbSize=l.data.db_size}catch(t){}finally{null==s||s.close()}je.steps=2,je.addend1=Math.round(9*Math.random()+1),je.addend2=Math.round(9*Math.random()+1),je.sum=void 0}else Array.isArray(je.data)||(je.data=[je.data]),await Ve(),je.addend1=Math.round(9*Math.random()+1),je.addend2=Math.round(9*Math.random()+1),je.sum=void 0;(()=>{De.value=!0,Se.value=5;const e=setInterval(()=>{Se.value-=1,Se.value<=0&&(clearInterval(e),De.value=!1)},1e3)})()}else V.error("计算错误，请重新计算")},Pe=async(e,a,t)=>{var s;const l=je.data[a],i=(null==(s=l.project_config)?void 0:s.type)||l.project_type;let d={id:l.id,webname:l.name,ftp:je.isFtp?1:0,database:je.isDatabase?1:0,path:je.isSite?1:0};je.isFtp||delete d.ftp,je.isDatabase||delete d.database,je.isSite||delete d.path;const n="PHPMOD"===i?await D({id:l.id,webname:l.name}):await S(d);e.push({name:l.name,status:!0}),a===je.data.length-1&&(ge.value=!0,Me.value=!0,t?U({resultData:e,resultTitle:"删除结果"}):V.request(n)),a<je.data.length-1&&Pe(e,a+1,t)},Ve=async()=>{let e=V.load("正在删除站点..."),a=[];const{fullPath:t}=C.currentRoute.value;try{if(je.isMult&&t.includes("site")){const{enable:e,exclude:a}=we.value,t=O(je.data,a,e,{params:{project_type:"PHP",ftp:je.isFtp?1:0,database:je.isDatabase?1:0,path:je.isSite?1:0}});H({loading:"正在删除站点,请稍后...",request:_(t),success:e=>{const{data:a}=T(e.data);U({resultData:a,title:"批量删除站点"}),ge.value=!0,Me.value=!0}})}else await Pe(a,0,je.isMult);e.close(),ke("close")}catch(s){R(s)}finally{je.steps=1}},ze=async()=>{1===je.steps?je.sum===je.addend1+je.addend2?(await Ve(),ke("close")):V.error("计算错误，请重新计算"):(await Ve(),ke("close"))};return i(()=>{je.data=ve.compData,P(ve.compData)&&(je.isMult=!0)}),(e,a)=>{const t=g,s=w,l=k,i=M,j=d("focus");return n(),r("div",I,[1===o(je).steps?(n(),r("div",N,[a[11]||(a[11]=p("div",{class:"flex items-center"},[p("i",{class:"text-warning svgtofont-el-warning-filled !text-[4rem]"}),p("span",{class:"text-[1.4rem] ml-[8px] leading-10"},"是否要删除关联的FTP、数据库、站点目录！")],-1)),p("div",B,[c(t,{modelValue:o(je).isFtp,"onUpdate:modelValue":a[0]||(a[0]=e=>o(je).isFtp=e)},{default:u(()=>[...a[4]||(a[4]=[m("FTP",-1)])]),_:1},8,["modelValue"]),c(t,{modelValue:o(je).isDatabase,"onUpdate:modelValue":a[1]||(a[1]=e=>o(je).isDatabase=e)},{default:u(()=>[...a[5]||(a[5]=[m("数据库",-1)])]),_:1},8,["modelValue"]),c(t,{modelValue:o(je).isSite,"onUpdate:modelValue":a[2]||(a[2]=e=>o(je).isSite=e)},{default:u(()=>[...a[6]||(a[6]=[m("站点目录",-1)])]),_:1},8,["modelValue"])]),o(ye)&&o(he)?f("",!0):(n(),r("div",G,[p("span",null,[a[7]||(a[7]=m(" 当前 ",-1)),o(ye)||o(he)?f("",!0):(n(),r("span",J,"【文件回收站】【数据库回收站】")),o(ye)&&!o(he)?(n(),r("span",K,"【数据库回收站】")):f("",!0),!o(ye)&&o(he)?(n(),r("span",Q,"【文件回收站】")):f("",!0),a[8]||(a[8]=m(" 尚未开启，请谨慎操作！ ",-1))])])),p("div",E,[a[9]||(a[9]=p("span",null,"计算结果：",-1)),p("span",W,x(o(je).addend1)+" + "+x(o(je).addend2),1),a[10]||(a[10]=p("span",{class:"mr-[1rem]"},"=",-1)),v(c(s,{modelValue:o(je).sum,"onUpdate:modelValue":a[3]||(a[3]=e=>o(je).sum=e),autofocus:"true","controls-position":"right",size:"small"},null,8,["modelValue"]),[[j]])])])):f("",!0),2===o(je).steps?(n(),r("div",X,[a[20]||(a[20]=p("div",{class:"flex items-center"},[p("i",{class:"text-warning svgtofont-el-warning !text-[4rem]"}),p("span",{class:"text-[2rem] ml-[8px] leading-10 font-bold"},"堡塔温馨提示您，请冷静几秒钟，确认以下要删除的数据。")],-1)),p("div",Y,[(n(!0),r(b,null,y(o(je).data,(e,t)=>(n(),r("div",{key:t,class:"flex items-center flex-col p-[12px] border-b-1 border-[#f1f1f1] hover:bg-[#f1f1f140] last:border-b-0",style:{gap:"0.4rem"}},[p("div",Z,[p("span",$,"站点名:"+x(e.name),1),p("div",ee,[o(je).isSite?(n(),r("div",ae,[p("span",{class:"truncate w-[110px]",title:e.path},"目录:"+x(e.path),9,te),e.total?(n(),r("span",se,[m(" ("+x(o(A)(e.total))+") ",1),o(je).fileSize<=e.total?(n(),h(l,{key:0,class:"item",effect:"dark",placement:"top"},{content:u(()=>[a[12]||(a[12]=m(" 此目录较大，可能为重要数据，请谨慎操作！ ",-1)),a[13]||(a[13]=p("br",null,null,-1)),m(" 目录："+x(e.path),1)]),default:u(()=>[a[14]||(a[14]=p("i",{class:"svgtofont-el-warning cursor-pointer ml-4px"},null,-1))]),_:2},1024)):f("",!0)])):f("",!0)])):f("",!0),o(je).isSite?f("",!0):(n(),r("div",le,"仅删除记录")),p("span",ie,"创建时间:"+x(e.addtime),1)])]),e.database&&o(je).isDatabase?(n(),r("div",de,[p("span",ne,"数据库:"+x(e.database.name),1),p("div",re,[p("span",oe,[m(" 大小:"+x(o(A)(e.database.total))+" ",1),o(je).dbSize<=e.database.total?(n(),h(l,{key:0,class:"item",effect:"dark",placement:"top"},{content:u(()=>[a[15]||(a[15]=m(" 此数据库较大，可能为重要数据，请谨慎操作！ ",-1)),a[16]||(a[16]=p("br",null,null,-1)),m(" 数据库："+x(e.database.name),1)]),default:u(()=>[a[17]||(a[17]=p("i",{class:"svgtofont-el-warning cursor-pointer ml-4px text-[#ef0808]"},null,-1))]),_:2},1024)):f("",!0)]),p("span",pe,"创建时间:"+x(e.addtime),1)])])):f("",!0)]))),128))]),o(Se)&&o(De)?(n(),r("div",ce,[a[18]||(a[18]=m(" 请仔细阅读以上要删除信息，防止网站数据被误删，确认删除还有 ",-1)),p("span",ue,x(o(Se)),1),a[19]||(a[19]=m(" 秒可以操作。 ",-1))])):(n(),r("div",me,"注意：请仔细阅读以上要删除信息，防止网站数据被误删"))])):f("",!0),p("div",fe,[c(i,{type:"warning",onClick:_e},{default:u(()=>[...a[21]||(a[21]=[m("取消",-1)])]),_:1}),1===o(je).steps?(n(),h(i,{key:0,type:"danger",onClick:Fe},{default:u(()=>[...a[22]||(a[22]=[m("下一步",-1)])]),_:1})):f("",!0),2===o(je).steps?(n(),h(i,{key:1,type:"danger",disabled:o(De),onClick:ze},{default:u(()=>[m(x(o(Se)&&o(De)?"等待".concat(o(Se),"秒"):"确认删除数据"),1)]),_:1},8,["disabled"])):f("",!0)])])}}});export{xe as default};
