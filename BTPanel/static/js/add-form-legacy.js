!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,r,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",u=a.toStringTag||"@@toStringTag";function l(e,a,o,u){var l=a&&a.prototype instanceof c?a:c,s=Object.create(l.prototype);return t(s,"_invoke",function(e,t,a){var o,u,l,c=0,s=a||[],f=!1,p={p:0,n:0,v:n,a:d,f:d.bind(n,4),d:function(e,t){return o=e,u=0,l=n,p.n=t,i}};function d(e,t){for(u=e,l=t,r=0;!f&&c&&!a&&r<s.length;r++){var a,o=s[r],d=p.p,m=o[2];e>3?(a=m===t)&&(l=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=n):o[0]<=d&&((a=e<2&&d<o[1])?(u=0,p.v=t,p.n=o[1]):d<m&&(a=e<3||o[0]>t||t>m)&&(o[4]=e,o[5]=t,p.n=m,u=0))}if(a||e>1)return i;throw f=!0,t}return function(a,s,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===s&&d(s,m),u=s,l=m;(r=u<2?n:l)||!f;){o||(u?u<3?(u>1&&(p.n=-1),d(u,l)):p.n=l:p.v=l);try{if(c=2,o){if(u||(a="next"),r=o[a]){if(!(r=r.call(o,l)))throw TypeError("iterator result is not an object");if(!r.done)return r;l=r.value,u<2&&(u=0)}else 1===u&&(r=o.return)&&r.call(o),u<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=n}else if((r=(f=p.n<0)?l:e.call(t,p))!==i)break}catch(r){o=n,u=1,l=r}finally{c=1}}return{value:r,done:f}}}(e,o,u),!0),s}var i={};function c(){}function s(){}function f(){}r=Object.getPrototypeOf;var p=[][o]?r(r([][o]())):(t(r={},o,function(){return this}),r),d=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,u,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=f,t(d,"constructor",f),t(f,"constructor",s),s.displayName="GeneratorFunction",t(f,u,"GeneratorFunction"),t(d),t(d,u,"Generator"),t(d,o,function(){return this}),t(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:l,m:m}})()}function t(e,n,r,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,r,a){function u(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[n]=r:(u("next",0),u("throw",1),u("return",2))},t(e,n,r,a)}function n(e,t,n,r,a,o,u){try{var l=e[o](u),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(r,a)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(a,o){var u=e.apply(t,r);function l(e){n(u,a,o,l,i,"next",e)}function i(e){n(u,a,o,l,i,"throw",e)}l(void 0)})}}System.register(["./utils-lib-legacy.js?v=1756369731","./form-item-legacy.js?v=1756369731","./column-legacy.js?v=1756369731","./index-legacy63.js?v=1756369731","./base-lib-legacy.js?v=1756369731","./index-legacy103.js?v=1756369731","./__commonjsHelpers__-legacy.js?v=1756369731","./index-legacy104.js?v=1756369731","./useController-legacy6.js?v=1756369731","./site-legacy.js?v=1756369731","./validator-legacy.js?v=1756369731","./useStore-legacy4.js?v=1756369731"],function(t,n){"use strict";var a,o,u,l,i,c,s,f,p,d,m,v,y,g,b,h,_,j,w,x,I,P,k,S,O,T,q,G,M;return{setters:[function(e){a=e.G,o=e.o,u=e.l,l=e.M,i=e.iY,c=e.a6,s=e.iZ,f=e.v,p=e.e},function(e){d=e.k,m=e.b,v=e.h,y=e.f},function(e){g=e.a},function(e){b=e.a,h=e.b},function(e){_=e.c,j=e.r,w=e.e,x=e.T,I=e.B,P=e.ac,k=e.ag,S=e.af,O=e.q,T=e.v,q=e.x,G=e.i},function(e){M=e._},null,null,null,null,null,null],execute:function(){var n={class:"p-[2rem] node-master-mysql-add-form"};var B=_({__name:"add-form",props:{compData:{default:function(){return{panel_address:""}}}},setup:function(t,p){var _,B,E,z,A,C,D,F=p.expose,V=b(),H=V.mysqlRowData,L=V.isRefreshList,N=t,R=[{label:"面板自动同步",value:"auto",desc:"通过主库面板连接从库面板进行导入导出数据，简单快捷，建议内网机器使用"},{label:"手动同步到从库",value:"manual",desc:"通过主库面板备份，手动将备份文件上传至从库导入后进行数据还原后同步，大于1G数据建议使用此方法同步"}],U=j({node_id:"",master_ip:(null==N||null===(_=N.compData)||void 0===_?void 0:_.panel_address)||"",slave_ip:"",err_code:["1062"],sync_type:"auto",db_name:""}),$=a({data:U.value,options:[d("选择从库节点","node_id",H.value,{attrs:{placeholder:"请选择从库节点",class:"!w-[45rem]",onChange:function(e){var t;J.value.slave_ip=(null===(t=H.value.find(function(t){return t.value===e}))||void 0===t?void 0:t.remarks)||""}},rules:[{required:!0,message:"请选择从库节点",trigger:"change"}]}),m("主库IP地址","master_ip",{attrs:{placeholder:"请输入主库IP地址，如：192.168.1.100",class:"!w-[45rem]"},rules:[{required:!0,message:"请输入主库IP地址",trigger:["blur","change"]},{pattern:/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,message:"请输入正确的IP地址格式",trigger:["blur","change"]}]}),m("从库IP地址","slave_ip",{attrs:{placeholder:"请输入从库IP地址，如：192.168.1.101",class:"!w-[45rem]"},rules:[{required:!0,message:"请输入从库IP地址",trigger:["blur","change"]},{pattern:/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,message:"请输入正确的IP地址格式",trigger:["blur","change"]}]}),v(" ",function(){return w(P,{modelValue:J.value.err_code,"onUpdate:modelValue":function(e){return J.value.err_code=e},class:"mb-[1.2rem]"},{default:function(){return[w(x,{value:"1062",key:"1062"},{default:function(){return[w("span",null,[I("跳过1062错误")]),w("div",{class:"err_code_desc"},[I("跳过主键或唯一键冲突错误")])]}})]}})},"err_code"),(z=c({request:(E=r(e().m(function t(n){var r,a;return e().w(function(e){for(;;)switch(e.n){case 0:return n.limit=50,e.n=1,s(n);case 1:return r=e.v,(a=r.data).data[0].keys_scopes_status=!0,e.a(2,{data:a.data,total:a.page.total_count})}},t)})),function(e){return E.apply(this,arguments)}),columns:[g({key:"id"}),{label:"数据库名称",prop:"name"},{label:"数据库大小",prop:"size",render:function(e){return w("span",null,[f(e.size)])}},{label:"数据库引擎",prop:"type"}]}),A=z.BtTable,C=z.BtPage,D=z.BtSearch,v("同步数据库",function(){return w("div",{class:"w-[94.2%]"},[w(M,null,{"header-right":function(){return w(D,{placeholder:"请输入数据库名称",class:"!w-[20rem]"},null)},content:function(){return w(A,{height:"200px",onSelectionChange:(t=r(e().m(function t(n){return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,J.value.db_name=n.map(function(e){return e.name}).join(","),J.value.db_type=n.map(function(e){return e.type}).join(","),e.n=1,Z();case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},t,null,[[0,2]])})),function(e){return t.apply(this,arguments)})},null);var t},"footer-right":function(){return w(C,{layout:"prev, pager, next, total, jumper","page-size":50},null)}})])},"db_name",{class:"node-master-mysql-db-table",rules:[{required:!0,message:"请选择要同步的数据库",trigger:"change"}]})),y(" ",[{content:"添加后仅同步选中的数据库数据，如需新增数据库需删除主从重新配置"}]),v("首次同步方式",function(){var e,t;return w(S,{modelValue:J.value.sync_type,"onUpdate:modelValue":function(e){return J.value.sync_type=e}},"function"==typeof(t=e=R.map(function(e){return w(k,{class:"mt-[1rem]",value:e.value,key:e.value,style:{height:"auto",lineHeight:"1",alignItems:"flex-start"}},{default:function(){return[w("span",{class:"radio-label"},[e.label]),w("div",{class:"radio-desc mt-[1rem] mb-[1rem] w-[43rem]",style:{whiteSpace:"normal",lineHeight:"1.5"}},[e.desc])]}})}))||"[object Object]"===Object.prototype.toString.call(t)&&!G(t)?e:{default:function(){return[e]}})},"sync_type"),y("",[{content:"仅支持mysql-5.7+版本（不支持mariadb）"}])],submit:(B=r(e().m(function t(n,r,a){var c,s;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,r();case 1:return e.n=2,o({icon:"warning-filled",title:"提示",content:"首次配置将会重启数据库，如从库有同名数据库将会进行数据覆盖，建议空闲时间配置，是否继续？"});case 2:e.n=4;break;case 3:return e.p=3,e.v,e.a(2,!1);case 4:if(!n.value.db_type.includes("MyISAM")){e.n=8;break}return e.p=5,e.n=6,new Promise(function(e,t){u({title:"MyISAM 引擎警告",area:50,showFooter:!0,component:function(){return w("div",{class:"p-[2rem] text-[1.4rem]"},[w("div",{style:"color:#e53e3e;margin-bottom:8px;font-size: 1.4rem;"},[I("检测到选中的数据库包含 MyISAM 存储引擎的表，可能存在以下风险：")]),w("ul",{style:"margin-bottom:16px;list-style: disc;padding-left: 2rem;"},[w("li",null,[I("数据不一致：MyISAM 不支持事务，同步过程中可能出现数据不完整")]),w("li",null,[I("主从中断：表级锁定机制在高并发时内容易导致同步失败")]),w("li",null,[I("错误频发：需要设置错误跳过机制才能正常运行")])]),w("div",{style:"margin-bottom:2rem"},[w("div",{style:"margin-bottom:1rem"},[I("建议方案：")]),w("div",{style:"color:#22c55e; font-size: 1.4rem;margin-bottom:1rem"},[I("【推荐】转换为 InnoDB: ALTER TABLE table_name ENGINE=InnoDB")]),w("div",{style:"color:#2563eb; font-size: 1.4rem;"},[I("【备选】继续使用并设置错误跳过码（如: 1062）")])]),w("div",null,[I("确定要继续选择这些数据库吗？")])])},confirmText:"继续添加",cancelText:"取消",onConfirm:function(){return e(!0),!0},onCancel:function(){return t(),!1}})});case 6:e.n=8;break;case 7:return e.p=7,e.v,e.a(2,!1);case 8:return c=l.load("正在添加主从，请稍后..."),e.p=9,e.n=10,i(n.value);case 10:if(!(s=e.v).status){e.n=11;break}return l.success("创建成功"),h(n.value.slave_ip),e.a(2,!0);case 11:return l.error(s.msg),e.a(2,!1);case 12:e.n=14;break;case 13:return e.p=13,e.v,l.error("创建失败，请重试"),e.a(2,!1);case 14:return e.p=14,L.value=!0,c.close(),e.f(14);case 15:return e.a(2)}},t,null,[[9,13,14,15],[5,7],[0,3]])})),function(e,t,n){return B.apply(this,arguments)})}),Y=$.BtForm,Z=$.validate,J=$.param,K=$.submit;return F({validate:Z,onConfirm:K,formData:J}),function(e,t){return O(),T("div",n,[w(q(Y))])}}});t("default",p(B,[["__scopeId","data-v-29a45000"]]))}}})}();
