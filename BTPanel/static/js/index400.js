import{G as e,_ as a,e as l,Y as s,a4 as t,j as r,ag as o,bg as n,c as u,l as i,N as p,K as d,M as m,al as c}from"./utils-lib.js?v=1756369731";import{_ as v}from"./index104.js?v=1756369731";import{c as _,s as g,p as b,q as w,v as f,e as h,x,C as y,y as k,M as P,r as q,A as j,L as V,b0 as W,D as S,b3 as C,k as D,a9 as L,a7 as E,g as F,aQ as U,T as M,B as z,P as H}from"./base-lib.js?v=1756369731";import{u as I}from"./index95.js?v=1756369731";import{b as B,k as Q,h as R,e as A}from"./form-item.js?v=1756369731";import{_ as O}from"./index101.js?v=1756369731";import{f as T,k as $}from"./validator.js?v=1756369731";import{j as Z,k as G,l as K,m as N}from"./useMethod5.js?v=1756369731";import{u as Y}from"./useController5.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index103.js?v=1756369731";import"./index.vue_vue_type_script_setup_true_lang6.js?v=1756369731";import"./index130.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";import"./useStore4.js?v=1756369731";import"./site.js?v=1756369731";import"./column.js?v=1756369731";import"./useStore13.js?v=1756369731";import"./useController6.js?v=1756369731";const J={key:0,class:"software-mask"},X={key:1,class:"software-install"},ee={class:"software-view"},ae=l(_({__name:"index",setup(l){const{addWordpressFormData:s,mysql:t,php:r,createSiteSubmit:o}=g(I()),{getInitData:n,resetCreateForm:u}=I(),{BtForm:i,submit:p}=e({data:()=>s.value,options:()=>he(),submit:je});return b(()=>{n(),o.value=p,u()}),(e,l)=>{const s=a,o=v;return w(),f("div",null,[h(x(i)),x(r).setup&&x(t).setup?y("",!0):(w(),f("div",J)),x(r).setup&&x(t).setup?y("",!0):(w(),f("div",X,[k("div",ee,[h(s,{icon:"el-warning",size:30,class:"mr-[8px]",color:"orange"}),l[2]||(l[2]=k("span",{class:"text-[1.4rem] font-black"},"服务器未安装，",-1)),x(r).setup?y("",!0):(w(),f("span",{key:0,class:"bt-link text-[1.3rem]",onClick:l[0]||(l[0]=e=>x(ke)("php-7.4"))},"安装PHP")),x(r).setup||x(t).setup?y("",!0):(w(),P(o,{key:1})),x(t).setup?y("",!0):(w(),f("span",{key:2,class:"text-[1.3rem] bt-link",onClick:l[1]||(l[1]=e=>x(ke)("mysql"))},"安装MySQL"))])]))])}}}),[["__scopeId","data-v-638fdc88"]]),le=_({__name:"index",setup(a){const{addBackupFormData:l,createImportSubmit:s}=g(I()),{getInitData:t,resetImportForm:r}=I(),{BtForm:o,submit:n}=e({data:()=>l.value,options:ye,submit:Ve});return b(()=>{t(),s.value=n,r()}),(e,a)=>(w(),f("div",null,[h(x(o))]))}}),se=l(_({__name:"upload",props:{path:{default:"/"}},emits:["finish"],setup(e,{emit:a}){const l=e,r=a,o=q([]);s();const n=q(0),u=e=>"".concat(e,"%"),i=async e=>{const{file:a,onProgress:u,onSuccess:i,onError:p}=e,d=1048576,m=Math.ceil(a.size/d),c=s();for(let s=0;s<m;s++){const e=s*d,r=Math.min(e+d,a.size),o=a.slice(e,r),i=new FormData;i.append("f_path",l.path),i.append("f_name",a.name),i.append("f_start",e.toString()),i.append("blob",o),i.append("f_size",a.size.toString()),i.append("request_time",c.request_time.toString()),i.append("request_token",c.request_token);try{await t.post("/files?action=upload",i,{headers:{"Content-Range":"bytes ".concat(e,"-").concat(r-1,"/").concat(a.size),"x-http-token":window.vite_public_request_token,"Content-Type":"application/x-www-form-urlencoded"},onUploadProgress:e=>{if(e.lengthComputable){Math.round(100*e.loaded/e.total);const l=Math.round(100*(s*d+e.loaded)/a.size);n.value=l,u({percent:l})}}})}catch(v){return void(p&&p(v))}}r("finish","".concat(l.path,"/").concat(a.name)),i&&i(null),o.value=[],setTimeout(()=>{n.value=0},1e3)};return(e,a)=>{const l=S,s=C;return w(),P(x(W),{ref:"upload",class:"custom-upload w-auto",action:"",name:"blob","file-list":x(o),"show-file-list":!1,multiple:!1,"http-request":i},{trigger:j(()=>[h(l,{type:"primary"},{default:j(()=>[V(e.$slots,"default",{},void 0,!0)]),_:3})]),default:j(()=>[x(n)>0&&x(n)<100?(w(),P(s,{key:0,percentage:x(n),format:u},null,8,["percentage"])):y("",!0)]),_:3},8,["file-list"])}}}),[["__scopeId","data-v-86614539"]]),te={class:"px-[20px] pt-[20px]"},re={class:"flex items-center mb-[4px]"},oe=_({__name:"edit-option",props:{compData:{default:{}}},setup(e,{expose:a}){const{addWordpressFormData:l}=g(I()),s=e,t=D({datauser:"",datapassword:"",type:"MySQL",code:"utf8mb4",version:""}),o=D({datauser:[{trigger:["blur","change"],validator:(e,a,l)=>{0===a.length?l(new Error("名称不能为空！")):/^[a-zA-Z0-9_]+$/g.test(a)?a.length<=3?l(new Error("名称长度错误，不能少于3个字符！")):a.length>16?l(new Error("名称长度错误，不能大于16个字符！")):l():l(new Error("名称只能包含字母、数字和下划线！"))}}],datapassword:[{trigger:["blur","change"],validator:(e,a,l)=>{0===a.length?l(new Error("密码不能为空！")):l()}}]}),n=q();return b(()=>{t.datauser=s.compData.datauser,t.datapassword=s.compData.datapassword}),a({onConfirm:async e=>{await n.value.validate().catch(()=>!1)&&(l.value.datauser=t.datauser,l.value.datapassword=t.datapassword,e())}}),(e,a)=>{const l=r,s=L,u=E;return w(),f("div",te,[h(u,{model:x(t),rules:x(o),ref_key:"editFormRef",ref:n},{default:j(()=>[h(s,{label:"数据库账号"},{default:j(()=>[k("div",re,[h(s,{prop:"datauser",label:""},{default:j(()=>[h(l,{placeholder:"创建数据库账号",modelValue:x(t).datauser,"onUpdate:modelValue":a[0]||(a[0]=e=>x(t).datauser=e),width:"17rem"},null,8,["modelValue"])]),_:1}),h(s,{prop:"datapassword",label:"",class:"!mt-0"},{default:j(()=>[h(l,{class:"ml-[8px]",width:"16rem",placeholder:"数据库密码",modelValue:x(t).datapassword,"onUpdate:modelValue":a[1]||(a[1]=e=>x(t).datapassword=e)},null,8,["modelValue"])]),_:1})]),a[2]||(a[2]=k("span",{class:"text-[#999] text-[1.2rem]"}," 创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。 ",-1))]),_:1})]),_:1},8,["model","rules"])])}}}),{addSelectOption:ne,addPHPSelectOption:ue,addWPSelectOption:ie,web:pe,sitePath:de,addWordpressFormData:me,selectLoading:ce,phpLoading:ve,wpLoading:_e,addBackupFormData:ge}=g(I()),{setWpLoading:be}=I(),{isRefreshLocalList:we}=g(Y()),fe=[{label:"创建站点",name:"single",render:()=>h(ae,null,null)},{label:"从备份创建",name:"import",lazy:!0,render:()=>h(le,null,null)}],he=()=>{const e={class:"!w-[400px]",clearable:!0};return F(()=>[B("域名","domain",{attrs:{...e,placeholder:"请输入网站域名","onUpdate:modelValue":xe},rules:[{required:!0,message:"请输入网站域名",trigger:"blur"}]}),B("网站标题","weblog_title",{attrs:{...e,placeholder:"请输入 WordPress 的网站标题"},rules:[{required:!0,message:"请输入 WordPress 的网站标题",trigger:"blur"}]}),Q("语言","language",ne.value,{attrs:{class:"!w-[230px]",loading:ce.value}}),Q("PHP 版本","php_version",ue.value,{attrs:{class:"!w-[230px]",loading:ve.value,onChange:Pe},rules:[{required:!0,message:"请选择PHP版本",trigger:"blur"}]}),R("WP 版本",()=>h("div",{class:"flex items-center"},[h(o,{options:ie.value,class:"!w-[230px]",loading:_e.value,modelValue:me.value.wp_version,"onUpdate:modelValue":e=>me.value.wp_version=e},null),h(U,{content:"版本5.6.0+自动打开自动版本更新",placement:"top"},{default:()=>[h("span",{class:"svgtofont-el-warning !text-[2rem] ml-[1rem]"},null)]})]),"wp_version",{rules:[{required:!0,message:"请选择WP版本",trigger:"blur"}]}),B("用户名","user_name",{attrs:{...e,placeholder:"WordPress 后台用户"},rules:[{required:!0,message:"WordPress 后台用户不能为空",trigger:"blur"}]}),{key:"admin_password",type:"custom",render:()=>{const e=F(()=>{const e={required:!0,message:"WordPress 后台密码不能为空",trigger:"blur"};return me.value.pw_weak?[e]:[e,{validator:(e,a,l)=>{/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(a)?l():l(new Error("密码必须至少8位，包含大小写字母和数字"))},trigger:"blur"}]});return h(n,{label:"密码",prop:"admin_password",class:"flex items-center",rules:e.value},{default:()=>[h(r,{class:"!w-[230px]",clearable:!0,modelValue:me.value.admin_password,"onUpdate:modelValue":e=>me.value.admin_password=e,type:"input"},null),h(M,{class:"ml-[2rem]",modelValue:me.value.pw_weak,"onUpdate:modelValue":e=>me.value.pw_weak=e,label:"允许密码较弱"},null)]})},rules:{admin_password:[{required:!0,message:"WordPress 后台密码不能为空",trigger:"blur"}]}},B("电子邮件","admin_email",{attrs:{...e,placeholder:"请输入电子邮件地址"},rules:[{required:!0,message:"电子邮件地址不能为空",trigger:"blur"},{type:"email",message:"请输入正确的电子邮件地址",trigger:"blur"},{min:3,max:50,message:"电子邮件长度在 3 到 50 个字符之间",trigger:"blur"}]}),B("前缀","prefix",{attrs:{...e,placeholder:"请输入 WordPress 表名前缀"},rules:[{required:!0,message:"WordPress 表名前缀不能为空",trigger:"blur"}]}),R("缓存",()=>h(M,{modelValue:me.value.enable_cache,"onUpdate:modelValue":e=>me.value.enable_cache=e,label:"启用缓存，目前仅支持nginx",disabled:"nginx"!==pe.value.type},null)),{key:"mysql_setup",type:"custom",render:()=>h(n,{label:"其他配置",prop:"mysql_setup",class:"!mb-0"},{default:()=>[h("div",{class:"flex flex-col bg-[#f8f8f8] p-[12px] px-[16px] text-[1.2rem] w-full"},[h("div",{class:"flex items-center justify-between"},[h("span",null,[z("数据库："),"MySQL数据库"]),h("span",null,[z("账号："),me.value.datauser]),h("span",null,[z("密码："),me.value.datapassword])])]),h("span",{class:"text-[#999] flex items-center"},[z("其他配置初始状态为默认选择的配置项，如需修改请点击"),h(u,{onClick:()=>{i({title:"编辑配置",area:62,component:()=>h(oe,null,null),compData:me.value,btn:!0})}},{default:()=>[z("编辑配置")]})])]})}])},xe=e=>{const a="sql_"+e.replace(new RegExp(/([-.])/g),"_");a.length<=16&&(me.value.datauser=a)},ye=e=>{const a={class:"!w-[400px]",clearable:!0};return F(()=>[A("备份类型","method",[{label:"本地",value:1},{label:"Plesk或Cpanel",value:2}]),{type:"custom",label:"备份文件路径",render:()=>h(L,{label:"备份文件路径",prop:"bak_file"},{default:()=>[h(se,{class:"mr-[1rem]",path:"/www/server/panel/temp",onFinish:a=>{e.value.bak_file=a}},{default:()=>[z("上传文件")]}),h(O,{modelValue:e.value.bak_file,"onUpdate:modelValue":a=>e.value.bak_file=a,icon:"el-folder-opened",width:"32rem",onIconClick:()=>{T({type:"file",path:e.value.bak_file,change:a=>{e.value.bak_file=a}})}},null)]}),key:"bak_file",rules:{bak_file:[{required:!0,message:"请填写备份文件路径",trigger:"blur"}]}},B("域名","domain",{attrs:{...a,placeholder:"请输入网站域名","onUpdate:modelValue":Ce},rules:[{required:!0,message:"请输入网站域名",trigger:"blur"}]}),B("网站路径","sub_path",{attrs:{...a,placeholder:"根目录留空，子目录填写目录名"},slots:{prepend:()=>h("span",null,[Se(de.value)])}}),Q("PHP 版本","php_version",ue.value,{attrs:{class:"!w-[230px]",loading:ve.value},rules:[{required:!0,message:"请选择PHP版本",trigger:"blur"}]}),R("缓存",()=>h(M,{modelValue:e.value.enable_cache,"onUpdate:modelValue":a=>e.value.enable_cache=a,label:"启用缓存，目前仅支持nginx",disabled:"nginx"!==pe.value.type},null))])},ke=e=>$({type:"i",name:e}),Pe=async e=>{try{be(!0);const{data:{msg:a}}=await Z({php_version_short:e||me.value.php_version});p(a)&&(ie.value=a.map(e=>({label:e.version,value:e.version})))}finally{be(!1)}},qe=()=>{const{domain:e,php_version:a}=me.value,l=e.replace(new RegExp(/([-.])/g),"_");if(null===a)throw m.error("请选择PHP版本"),new Error("请选择PHP版本");return{webname:{domain:e,domainlist:[],count:0},type:"PHP",port:80,type_id:0,ftp:!1,sql:"MySQL",codeing:"utf8",set_ssl:0,force_ssl:0,project_type:"WP",path:de.value+"/"+e,ps:l,version:a,datauser:me.value.datauser,datapassword:me.value.datapassword,password:me.value.admin_password,pw_weak:me.value.pw_weak?"on":"off",email:me.value.admin_email,weblog_title:me.value.weblog_title,language:me.value.language,user_name:me.value.user_name,prefix:me.value.prefix,enable_cache:me.value.enable_cache?1:0,enable_whl:0,whl_page:me.value.Login_url?me.value.Login_url:null,whl_redirect_admin:me.value.redirection_url?me.value.redirection_url:null,package_version:me.value.wp_version}},je=async(e,a,l)=>{try{await a(),await d({loading:"正在创建站点...",request:G(qe()),message:!0,success:async e=>{if(!e.status)throw new Error(e.msg);we.value=!0}})}catch(s){throw s}},Ve=async(e,a,l)=>{try{await a();const e={bak_file:ge.value.bak_file,domain:ge.value.domain,sub_path:ge.value.sub_path,php_ver_short:ge.value.php_version||"",enable_cache:ge.value.enable_cache?1:0};await d({loading:"正在创建站点...",request:1===ge.value.method?K(e):N(e),message:!0,success:async e=>{if(!e.status)throw new Error(e.msg);we.value=!0}})}catch(s){throw s}},We=q(""),Se=e=>e.endsWith("/")?e:"".concat(e,"/"),Ce=e=>{We.value||(We.value=de.value),de.value=e?"".concat(We.value,"/").concat(e,"/"):"".concat(We.value,"/")},De={class:"p-[1.6rem] pb-0"},Le=_({__name:"index",setup(e){const{tabActive:a}=g(I()),{getConfig:l}=I();return b(()=>{l()}),(e,l)=>{const s=c;return w(),f("div",De,[h(s,{modelValue:x(a),"onUpdate:modelValue":l[0]||(l[0]=e=>H(a)?a.value=e:null),type:"bg-card",options:x(fe)},null,8,["modelValue","options"])])}}});export{Le as default};
