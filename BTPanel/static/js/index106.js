import{u as e,bn as a,bo as l,bp as s,q as t,bg as r,j as n,c as o,H as i,bq as c,b as d,e as u}from"./utils-lib.js?v=1756369731";import{_ as v}from"./index104.js?v=1756369731";import{B as m}from"./index100.js?v=1756369731";import{c as p,r as w,k as f,p as h,aD as b,G as g,q as _,M as y,A as x,e as k,y as j,z as D,J as V,H as z,x as C,O as I,v as q,B,C as E,I as U}from"./base-lib.js?v=1756369731";import{b as H}from"./useController.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const K={class:"flex !justify-center !w-full items-center"},M={class:"text-[2rem] text-dark inline-block mr-2 font-bold my-[10px]"},G={key:0,class:"absolute el-form-item__error"},O={class:"flex justify-end items-center mt-6 text-[1.2rem]"},$=u(p({__name:"index",props:{compData:{default:()=>({title:"",btn:"",isDialog:!0})}},setup(u,{expose:p}){const{getGlobalInfo:$}=e(),A=d(),J=u,L=w(!1),P=w(null),R=w(null),T=w(!1),F=w("获取验证码"),N=f({username:"",password:"",code:""}),Q=f({username:!1,password:!1,code:!1}),S=w(""),W=w(),X=w(),Y=w(!1),Z=w({username:[{validator:(e,a,l)=>{var s,t;if((null==(s=J.compData)?void 0:s.title)&&(Y.value=!1),/^1[3456789]\d{9}$/.test(a))l();else if(""===a)l(new Error("请输入宝塔官网账号"));else{if(null==(t=J.compData)?void 0:t.title)return Y.value=!0,void l(new Error(" "));l(new Error("请输入正确的手机号"))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,a,l)=>{a.length>=8?l():l(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,a,l)=>{T.value||l(),6===a.length?l():l(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),ee=()=>{X.value.validate(async e=>{e&&H({isCheck:T,userInfo:N,userToken:S})})},ae=async()=>{if(!N.username||!N.password)return void A.error("请先输入手机号和密码");Q.username=!0,Q.password=!0,(e=>{W.value&&clearInterval(W.value);const a=()=>{if(--e<=0)return clearInterval(W.value),F.value="获取验证码",void(Q.code=!1);F.value="重新获取验证码(".concat(e,"s)")};a(),W.value=setInterval(a,1e3),Q.code=!0})(60);const e=await a({username:N.username,token:S.value});A.request(e)},le=async()=>{L.value=!0;try{const e=await l();if(e.status){const a=600,l=500,s=window.screen.width/2-a/2,t=window.screen.height/2-l/2;P.value=window.open(e.msg.replace("login.html","new/wxBindPanel.html"),"_blank","width=".concat(a,",height=").concat(l,",left=").concat(s,",top=").concat(t)),window.addEventListener("message",e=>{var a,l;switch(e.data.type){case"wechat_auth_error":A.error(e.data.msg);try{null==(a=P.value)||a.close(),le()}catch(s){}break;case"wechat_auth_complete":const{code:t,state:r}=e.data.data;null==(l=P.value)||l.close(),se(t,r)}})}}catch(e){}finally{L.value=!1}},se=async(e,a)=>{var l;const t=A.load("正在配置面板用户信息，请稍后...");try{const t=await s({code:e,state:a});t.status?(A.success("微信绑定成功"),window.location.href=(null==(l=J.compData)?void 0:l.redirect)||"/"):A.error(t.msg||"微信绑定失败")}catch(r){A.error("微信绑定失败")}finally{t.close()}};return p({onOpen:()=>{t(X.value.$el,"username")},onCancel:()=>{X.value.clearValidate(),R.value&&(clearInterval(R.value),R.value=null),P.value&&!P.value.closed&&(P.value.close(),P.value=null)}}),h(()=>{var e;null==(e=X.value)||e.clearValidate(),$()}),b(()=>{W.value&&(clearInterval(W.value),W.value=null),R.value&&(clearInterval(R.value),R.value=null),P.value&&!P.value.closed&&(P.value.close(),P.value=null)}),(e,a)=>{var l;const s=m,t=r,d=n,u=o,p=i,w=v,f=c,h=g("focus");return _(),y(f,{ref_key:"bindUserRef",ref:X,size:"default",rules:C(Z),model:C(N),class:V(["bind-user-info",{"bind-form":!!(null==(l=e.compData)?void 0:l.title)}])},{default:x(()=>{var l;return[k(t,{class:"!mb-5 flex !justify-center"},{default:x(()=>{var l;return[j("div",K,[j("h3",M,D((null==(l=e.compData)?void 0:l.title)||"切换宝塔官网账号"),1),k(s,{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:x(()=>[...a[7]||(a[7]=[j("a",{class:"bt-ico-ask align-middle inline-block",href:"javascript:;"}," ? ",-1)])]),_:1})])]}),_:1}),(_(),y(t,{key:1,prop:"username",class:V({"!mb-[3rem]":!!(null==(l=e.compData)?void 0:l.title)})},{default:x(()=>{var l;return[z(k(d,{modelValue:C(N).username,"onUpdate:modelValue":a[0]||(a[0]=e=>C(N).username=e),clearable:"",required:"",name:"username",placeholder:"宝塔官网账号",class:"h-[4rem] leading-[4rem] w-full",disabled:C(Q).username,onKeyup:a[1]||(a[1]=I(e=>ee(),["enter","native"]))},null,8,["modelValue","disabled"]),[[h]]),(null==(l=e.compData)?void 0:l.title)&&C(Y)?(_(),q("span",G,[a[9]||(a[9]=j("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),k(u,{class:"!text-[12px]",href:"https://www.bt.cn/register"},{default:x(()=>[...a[8]||(a[8]=[B(" 免费注册 ",-1)])]),_:1})])):E("",!0)]}),_:1},8,["class"])),(_(),y(t,{key:2,prop:"password"},{default:x(()=>[k(d,{modelValue:C(N).password,"onUpdate:modelValue":a[2]||(a[2]=e=>C(N).password=e),clearable:"",required:"",type:"password",name:"password",placeholder:"密码",class:"h-[4rem] leading-[4rem] w-full","show-password":!0,disabled:C(Q).password,onKeyup:a[3]||(a[3]=I(e=>ee(),["enter","native"]))},null,8,["modelValue","disabled"])]),_:1})),z(k(t,{prop:"code"},{default:x(()=>[k(d,{modelValue:C(N).code,"onUpdate:modelValue":a[4]||(a[4]=e=>C(N).code=e),clearable:"",placeholder:"验证码",type:"text",onKeyup:a[5]||(a[5]=I(e=>ee(),["enter","native"]))},{append:x(()=>[k(p,{class:"relative top-0 rounded-none rounded-r-[3px] w-full !h-[auto]",size:"large",type:"primary",disabled:C(Q).code,plain:"",onClick:ae},{default:x(()=>[B(D(C(F)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},512),[[U,C(T)]]),k(p,{type:"primary",class:"w-[100%] mt-[1.2rem]",size:"large",onClick:a[6]||(a[6]=e=>ee())},{default:x(()=>{var a,l;return[B(D((null==(a=e.compData)?void 0:a.btn)||((null==(l=e.compData)?void 0:l.title)?"绑定账号":"切换账号")),1)]}),_:1}),j("div",O,[k(u,{href:"https://www.bt.cn/register"},{default:x(()=>[...a[10]||(a[10]=[B("注册账号",-1)])]),_:1}),k(w),k(u,{href:"https://www.bt.cn/login.html?page=reset"},{default:x(()=>[...a[11]||(a[11]=[B("忘记密码",-1)])]),_:1}),k(w),k(u,{href:"https://www.bt.cn/bbs"},{default:x(()=>[...a[12]||(a[12]=[B("问题反馈",-1)])]),_:1})]),a[14]||(a[14]=j("div",{class:"divider-container"},[j("div",{class:"divider-line"}),j("div",{class:"divider-text"},"第三方登录"),j("div",{class:"divider-line"})],-1)),j("div",{class:"flex justify-center items-center mt-2"},[j("div",{class:"wechat-login-container",onClick:le},[...a[13]||(a[13]=[j("div",{class:"wechat-icon-circle"},[j("i",{class:"wechat-icon"},[j("svg",{t:"1749545795651",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"9096",width:"20",height:"20"},[j("path",{d:"M391.95 175.27c-159.03 0-289.29 108.4-289.29 246.04 0 79.45 43.35 144.67 115.74 195.2l-28.93 87.05 101.12-50.74c36.19 7.19 65.22 14.54 101.33 14.54 9.08 0 18.09-0.45 27.01-1.16-5.64-19.37-8.92-39.61-8.92-60.62 0-126.32 108.54-228.89 245.97-228.89 9.37 0 18.64 0.69 27.86 1.71C658.8 261.87 534.2 175.27 391.95 175.27z m-93.97 195.31c-21.67 0-43.56-14.52-43.56-36.21 0-21.77 21.89-36.09 43.56-36.09s36.12 14.33 36.12 36.09c-0.02 21.69-14.45 36.21-36.12 36.21z m202.46 0c-21.69 0-43.45-14.52-43.45-36.21 0-21.77 21.76-36.09 43.45-36.09 21.79 0 36.21 14.33 36.21 36.09 0 21.69-14.43 36.21-36.21 36.21z m0 0",fill:"#3CB034","p-id":"9097"}),j("path",{d:"M920.01 602.12c0-115.59-115.74-209.86-245.72-209.86-137.64 0-246.05 94.27-246.05 209.86 0 115.84 108.41 209.92 246.05 209.92 28.81 0 57.85-7.25 86.79-14.51l79.36 43.44-21.76-72.3c58.06-43.53 101.33-101.3 101.33-166.55z m-325.5-36.14c-14.41 0-28.95-14.31-28.95-28.92 0-14.44 14.54-28.96 28.95-28.96 21.89 0 36.21 14.52 36.21 28.96 0 14.61-14.33 28.92-36.21 28.92z m159.13 0c-14.31 0-28.74-14.31-28.74-28.92 0-14.44 14.43-28.96 28.74-28.96 21.67 0 36.21 14.52 36.21 28.96 0 14.61-14.54 28.92-36.21 28.92z m0 0",fill:"#3CB034","p-id":"9098"})])])],-1)])])])]}),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-9d4fa5bb"]]);export{$ as default};
