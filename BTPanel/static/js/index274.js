import{_ as a}from"./index117.js?v=1756369731";import{_ as e}from"./index103.js?v=1756369731";import{u as s,K as t,S as l,M as r,o as n,J as i,k as o,a0 as d,W as u,h as c,e as m}from"./utils-lib.js?v=1756369731";import{c as p,r as f,k as v,e as g,B as _,p as y,G as w,q as I,v as P,x as b,M as h,A as x,C as j,y as k,P as V,z as S,H as C,al as q,D as J,a$ as N,S as U}from"./base-lib.js?v=1756369731";import{_ as H}from"./index112.js?v=1756369731";import{_ as M}from"./index130.js?v=1756369731";import{H as O,I as T,J as A,K as $,L as K,M as R}from"./firewall.js?v=1756369731";import{p as z}from"./validator.js?v=1756369731";import{r as B,f as D}from"./useMethod6.js?v=1756369731";import{a as F,u as G}from"./column.js?v=1756369731";import{_ as L}from"./index.vue_vue_type_script_setup_true_lang12.js?v=1756369731";import{g as W}from"./useStore5.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";const E={class:"min-h-[30rem]"},Q={class:"flex items-center text-[#666]"},X={class:"mr-[8px]"},Y={class:"p-[2rem]"},Z={class:"flex items-center"},aa=m(p({__name:"index",setup(m){const{payment:p}=s(),{refs:{systemTabActive:aa,firewallInfo:ea}}=W(),sa=f(null),ta=f([]),la=f(""),ra=f(0),na=f("--"),ia=f("--"),oa=f(0),da=f(!1),ua=f(!1),ca=v({p:1,limit:20}),ma=f(!1),pa=f(0),fa={title:"恶意IP自动封禁-功能介绍",ps:"从宝塔官网获取最新的恶意IP名单，与访问本机的IP做对比，将吻合的恶意IP全部IP加入黑名单，黑名单将从系统防火墙(网络层)隔离，黑名单内的恶意IP将无法访问任何端口、服务，大大提升本机的安全性。",source:362,desc:["每天自动更新最新恶意IP","全自动管理","防入侵","准确性高"],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/firewall/malicious.png"}]},va=async()=>{"banned"===aa.value&&(ga(),await t({loading:ua,request:O({data:JSON.stringify({...ca,query:la.value})}),data:{data:[Array,ta],page:l(ra)},success:a=>{}}))},ga=async()=>{try{const{data:a}=await T();a.status?(ma.value=a.data.status,pa.value=a.data.ip_count||0,na.value=a.data.runtime||"--",ia.value=a.data.bantime,oa.value="永久封禁"===ia.value?0:Number(ia.value.replace("天",""))):r.error(a.msg)}catch(a){}},_a=async()=>{await n({icon:"warning",title:"清空恶意IP",content:"将清空所有恶意IP，是否继续操作？"}),await t({loading:"正在清空恶意IP列表，请稍后...",request:A(),message:!0,success:va})},ya=async a=>{try{ma.value=!a,await n({icon:"warning",title:"自动封禁开关提示",content:"".concat(a?"开启":"关闭","自动封禁功能后，系统将").concat(a?"会":"不会","运行封禁恶意IP，是否继续操作？")});(await t({loading:"正在".concat(a?"开启":"关闭","自动封禁功能，请稍后..."),request:$({data:JSON.stringify({status:a?1:0})}),message:!0,success:O})).status&&(ma.value=a)}catch(e){}},wa=async()=>{if(!/^[1-9]\d*$|^0$/.test(oa.value.toString()))return r.error("请输入正确的封禁时间"),!1;try{await t({loading:"正在设置封禁时间，请稍后...",request:K(Number(oa.value)),message:!0,success:va}),da.value=!1}catch(a){}},Ia=[{label:"删除",value:"delete",event:async(a,e)=>{await D(a,e,async(a,e)=>await R({data:JSON.stringify({id:a.id,address:a.address})}),{label:"恶意IP地址",prop:"address"},va)}}],Pa=[F({key:"id"}),{label:"IP地址",prop:"address",width:120},{label:"IP归属地",render:a=>"ltd"!=p.value.authType?g("span",{class:"bt-link",onClick:()=>z({sourceId:362})},[_("点击查看")]):g("span",null,[(a.area.continent||"")+(a.area.info||"--")])},{label:"时间",prop:"addtime",renderHeader:()=>B("添加时间","封禁时间:".concat(ia.value))},G([{onClick:async a=>{await n({icon:"warning-filled",title:"删除恶意IP【"+a.address+"】",content:"删除选中的IP后，该IP将不再被监控，是否继续操作？"}),await t({loading:"正在删除恶意IP，请稍后...",request:R({data:JSON.stringify({id:a.id,address:a.address})}),message:!0,success:va})},title:"删除"}])];return y(va),(s,t)=>{const l=M,r=q,n=J,m=N,f=i,v=o,y=d,O=H,T=U,A=u,$=c,K=e,R=a,z=w("bt-loading");return I(),P("div",E,[b(ea).init_status?j("",!0):(I(),h(l,{key:0,width:"38rem"},{content:x(()=>[g(L)]),_:1})),"ltd"===b(p).authType?(I(),h(K,{key:1},{"header-left":x(()=>[k("div",Q,[t[11]||(t[11]=_(" 自动封禁开关 ",-1)),g(r,{modelValue:b(ma),"onUpdate:modelValue":t[0]||(t[0]=a=>V(ma)?ma.value=a:null),class:"mx-[0.8rem]",onChange:ya},null,8,["modelValue"]),_(" 封禁总数: "+S(b(pa))+" ",1),g(n,{onClick:_a,class:"mx-[0.8rem]"},{default:x(()=>[...t[9]||(t[9]=[_("清空",-1)])]),_:1}),k("span",null,"系统将于每日"+S(b(na))+"自动同步IP情报库",1),g(m,{direction:"vertical"}),k("span",X,"封禁时间："+S(b(ia)),1),g(n,{onClick:t[1]||(t[1]=a=>da.value=!0)},{default:x(()=>[...t[10]||(t[10]=[_("修改",-1)])]),_:1})])]),"header-right":x(()=>[g(f,{class:"!w-[32rem]",modelValue:b(la),"onUpdate:modelValue":t[2]||(t[2]=a=>V(la)?la.value=a:null),onSearch:t[3]||(t[3]=a=>va()),placeholder:"请输入恶意IP地址"},null,8,["modelValue"])]),content:x(()=>[C(g(v,{ref_key:"ipTableRef",ref:sa,column:Pa,data:b(ta),description:"恶意IP列表为空"},null,8,["data"]),[[z,b(ua)],[z,"正在加载IP列表，请稍后...","title"]])]),"footer-left":x(()=>[g(y,{"table-ref":b(sa),options:Ia},null,8,["table-ref"])]),"footer-right":x(()=>[g(O,{ref:"ipRulesPager",total:b(ra),page:b(ca).p,"onUpdate:page":t[4]||(t[4]=a=>b(ca).p=a),row:b(ca).limit,"onUpdate:row":t[5]||(t[5]=a=>b(ca).limit=a),onChange:t[6]||(t[6]=a=>va()),name:"ip"},null,8,["total","page","row"])]),popup:x(()=>[g($,{title:"设置封禁时间",modelValue:b(da),"onUpdate:modelValue":t[8]||(t[8]=a=>V(da)?da.value=a:null),area:42,onConfirm:wa,showFooter:""},{default:x(()=>[k("div",Y,[k("div",Z,[t[12]||(t[12]=_(" 设置封禁时间: ",-1)),g(T,{modelValue:b(oa),"onUpdate:modelValue":t[7]||(t[7]=a=>V(oa)?oa.value=a:null),class:"mx-[0.8rem] !w-[26rem]",placeholder:"请输入要修改的封禁时间"},null,8,["modelValue"])]),g(A,{options:[{content:"0为永久封禁"},{content:"修改后下一次运行生效"}],class:"mt-[1rem]"})])]),_:1},8,["modelValue"])]),_:1})):(I(),h(R,{key:2,data:fa,class:"px-[20%] py-[2rem]"}))])}}}),[["__scopeId","data-v-336d465a"]]);export{aa as default};
