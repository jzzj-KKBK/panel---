import{M as e,K as a,at as t,j as s,W as l}from"./utils-lib.js?v=1756369731";import{r as u,g as o,k as r,c as n,p as i,G as d,H as m,x as p,q as c,v as f,e as _,A as g,B as v,M as j,C as h,a9 as x,T as b,D as V,a7 as y}from"./base-lib.js?v=1756369731";import{batchPhpReferer as w,setSecurity as R,getSecurity as C}from"./site.js?v=1756369731";import{o as U}from"./useController6.js?v=1756369731";import{u as E}from"./useStore4.js?v=1756369731";import{h as L,i as k}from"./validator.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";const{siteInfo:H,isRefreshList:T}=E(),q=u(),D=o(()=>{var e,a,t;return Array.isArray(null==(e=q.value)?void 0:e.selectedList)&&(null==(t=null==(a=q.value)?void 0:a.selectedList)?void 0:t.length)>0}),P=u(!1),A=r({fix:"jpg,jpeg,gif,png,js,css",domains:"",return_rule:"404",http_status:!1,status:!1}),F=u(null),M=[{content:'【URL后缀】一般填写文件后缀,每个文件后缀使用","分隔,如: png,jpg'},{content:"【许可域名】允许作为来路的域名，每行一个域名,如: www.bt.cn"},{content:"【响应资源】可设置404/403等状态码，也可以设置一个有效资源，如：/security.png"},{content:"【允许空HTTP_REFERER请求】是否允许浏览器直接访问，若您的网站访问异常，可尝试开启此功能"}],S=a=>{if(!A.status)return e.error("请先启用防盗链!")},z=e=>{A.status=e,e||(A.http_status=!1)},B=async e=>{var t;await F.value.validate();let s={...A,domains:null==(t=A.domains)?void 0:t.replace(/\n/g,",")};if(D.value){const{enable:e,exclude:a}=q.value.config,t=L(q.value.selectedList,a,e,{params:{project_type:"PHP"}});s={...s,...t}}else s.id=H.value.id,s.site_name=H.value.name;const l=D.value?w:R,u=await a({loading:"正在设置防盗链，请稍后...",request:l(s),message:!D.value});if(D.value){const{data:a}=k(u.data);U({resultData:a,title:"批量设置防盗链"}),T.value=!0,I(),e&&e()}else G(q.value)},G=async e=>{var a,s;if(q.value=e||[],D.value&&I(),!e){const{id:e,name:u}=H.value;try{P.value=!0;const{data:t}=await C({id:e,site_name:u});t&&(A.fix=t.fix||"jpg,jpeg,gif,png,js,css",A.domains=(null==(s=null==(a=t.domains)?void 0:a.toString())?void 0:s.replace(/,/g,"\n"))||"",A.return_rule=t.return_rule||"404",A.http_status=t.http_status||!1,A.status=t.status||!1)}catch(l){t(l)}finally{P.value=!1}}},I=()=>{A.fix="jpg,jpeg,gif,png,js,css",A.domains="",A.return_rule="404",A.http_status=!1,A.status=!1},K={fix:[{required:!0,message:"请输入url后缀",trigger:"blur"}],return_rule:[{required:!0,message:"请输入响应资源",trigger:"blur"}]},W={class:"p-[20px]"},J=n({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:a,emit:t}){const u=e,o=()=>{G(u.compData)};return i(o),a({onConfirm:B,init:o}),(e,a)=>{const t=s,u=x,o=b,r=V,n=y,i=l,w=d("bt-loading");return m((c(),f("div",W,[_(n,{ref_key:"hotFormRef",ref:F,model:p(A),rules:p(K)},{default:g(()=>[_(u,{label:"URL后缀",prop:"fix"},{default:g(()=>[_(t,{modelValue:p(A).fix,"onUpdate:modelValue":a[0]||(a[0]=e=>p(A).fix=e),width:"30rem"},null,8,["modelValue"])]),_:1}),_(u,{label:"许可域名"},{default:g(()=>[_(t,{width:"30rem",modelValue:p(A).domains,"onUpdate:modelValue":a[1]||(a[1]=e=>p(A).domains=e),type:"textarea",resize:"none",rows:8,placeholder:"默认添加主域名，可追加其他的允许域名，一行一个，可为空"},null,8,["modelValue"])]),_:1}),_(u,{label:"响应资源",prop:"return_rule"},{default:g(()=>[_(t,{width:"30rem",modelValue:p(A).return_rule,"onUpdate:modelValue":a[2]||(a[2]=e=>p(A).return_rule=e)},null,8,["modelValue"])]),_:1}),_(u,{label:" "},{default:g(()=>[_(o,{modelValue:p(A).status,"onUpdate:modelValue":a[3]||(a[3]=e=>p(A).status=e),onChange:p(z)},{default:g(()=>[...a[6]||(a[6]=[v("启用防盗链",-1)])]),_:1},8,["modelValue","onChange"]),_(o,{disabled:!p(A).status,title:"".concat(p(A).status?"":"需开启防盗链"),modelValue:p(A).http_status,"onUpdate:modelValue":a[4]||(a[4]=e=>p(A).http_status=e),onChange:p(S)},{default:g(()=>[...a[7]||(a[7]=[v(" 允许空HTTP_REFERER请求 ",-1)])]),_:1},8,["disabled","title","modelValue","onChange"])]),_:1}),p(D)?h("",!0):(c(),j(u,{key:0,label:" "},{default:g(()=>[_(r,{type:"primary",onClick:a[5]||(a[5]=e=>p(B)())},{default:g(()=>[...a[8]||(a[8]=[v("保存",-1)])]),_:1})]),_:1}))]),_:1},8,["model","rules"]),p(D)?h("",!0):(c(),j(i,{key:0,options:p(M),class:"ml-[20px] mt-[20px]"},null,8,["options"]))])),[[w,p(P)]])}}});export{J as default};
