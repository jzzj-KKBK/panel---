import{aX as a,l as e,L as t,M as l,o as s,K as o,aM as n,a6 as r,a7 as c,k as u,al as i,h as m,b as p,e as d}from"./utils-lib.js?v=1756369731";import{r as v,c as _,q as f,M as h,A as y,e as b,x as g,p as k,aD as w,G as j,v as x,y as T,P as C,B as V,F as D,a_ as J,H as q,D as O,ax as K,ai as E,aj as S,aA as A}from"./base-lib.js?v=1756369731";import{_ as M}from"./index103.js?v=1756369731";import{_ as U}from"./index123.js?v=1756369731";import{_ as I}from"./index101.js?v=1756369731";import{b as L,u as P,o as B}from"./column.js?v=1756369731";import{getTomcat as F,getFileBody as H,saveFileBody as R,settingsTomcat as z,uninstallTomcat as N,setTomcatStatus as G,getJavaInfo as X,getSystemUserList as Q,installTomcatNew as W,getTomcatRandomInstall as Y,addLocalJdk as Z,setJdkEnvironment as $,installNewTomcat as aa,installNewJdk as ea,delLocalJdk as ta}from"./site.js?v=1756369731";import{m as la,f as sa}from"./validator.js?v=1756369731";const oa=v("jdkSettings"),na=v(!1),ra=v([]),ca=v([]),ua=v([]),ia=v([]),ma=v({}),pa=()=>{e({title:"Java环境管理 - Tomcat安装",area:60,component:()=>t(()=>import("./install-tomcat.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},da=async a=>{var e;try{"global"===a.install_type&&(a.ps="",a.name=a.base_version);let t=l.load("正在安装Tomcat，请稍后...");const s=await W(a);return l.request(s),t.close(),na.value=!0,(null==(e=s.msg)?void 0:e.includes("已添加到安装任务"))&&la(),s.status}catch(t){}},va=async()=>{try{const{data:e}=await F(),t=Object.keys(e).map(a=>({...e[a],t_name:a}));return!e.status&&a("msg",e)?{data:[],total:0,other:{}}:{data:t,total:0,other:{}}}catch(e){}},_a=a=>{ma.value=a,e({title:"Java环境管理 - Tomcat【".concat(a.t_name,"】配置"),area:60,component:()=>t(()=>import("./config-file.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},fa=v(""),ha=async()=>{try{const a=await H({path:ma.value.config_path});fa.value=a.data.data}catch(a){}},ya=async()=>{try{const a=await R({encoding:"utf-8",data:fa.value,path:ma.value.config_path});l.request(a)}catch(a){}},ba=a=>{ma.value=a,e({title:"Java环境管理 - Tomcat【".concat(a.t_name,"】设置"),area:60,component:()=>t(()=>import("./set-tomcat.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},ga=async a=>{let e=l.load("正在设置Tomcat，请稍后...");try{let e={tomcat_name:ma.value.t_name,user:a.user,auto_restart:a.auto_restart,port:a.port,jdk_path:a.jdk_path,ps:a.ps};const t=await z(e);return l.request(t),na.value=!0,t.status}catch(t){}finally{e.close()}},ka=async a=>{await s({title:"卸载Tomcat",isHtml:!0,content:"是否卸载【 ".concat(a.t_name,'】，<span class="text-danger">此操作将会删除该Tomcat目录下的所有文件，请确保该Tomcat未被使用</span>，是否继续操作？')}),await o({loading:"正在卸载Tomcat，请稍后...",request:N({tomcat_name:a.t_name}),success:()=>na.value=!0,message:!0})},wa=async(a,e)=>{const t=a.running;await s({title:"Tomcat状态",content:"是否".concat(e?"重启":t?"停止":"启动","【").concat(a.t_name,"】，是否继续操作？")});let o=l.load("正在".concat(e?"重启":t?"停止":"启动","Tomcat【").concat(a.t_name,"】，请稍后..."));try{const s=await G({type:e?"restart":t?"stop":"start",tomcat_name:a.t_name});l.request(s),na.value=!0}catch(n){}finally{o.close()}},ja=async()=>{try{const a=await X();ra.value=[],a.data.tomcat_status.forEach(a=>{a.is_install||ra.value.push({label:"Tomcat".concat(a.version),value:"tomcat".concat(a.version),...a})}),ca.value=a.data.jdk_info.filter(a=>1===a.operation||2===a.operation),ca.value=ca.value.map(a=>({label:a.name,value:a.path})),ua.value=ca.value.map(a=>({...a,value:a.value.replace("/bin/java","")}))}catch(a){}},xa=async()=>{try{const a=await Q({springboot:0});return ia.value=a.data.map(a=>({label:a,value:a})),{data:a.data,status:a.status}}catch(a){return{msg:"获取用户列表失败",status:!1}}},Ta=()=>{oa.value="jdkSettings"},Ca=async a=>{const e=await Y();a.value.port=e.msg},Va=_({__name:"index",setup(a){const{BtOperation:e}=n({options:[{type:"button",label:"安装Tomcat",active:!0,onClick:pa}]}),{BtTable:t,BtRefresh:l,BtColumn:s}=r({request:va,columns:[{label:"名称",prop:"t_name",isCustom:!0},{label:"Tomcat版本",prop:"version",isCustom:!0},{label:"JAVA支持",prop:"jdk_support",isCustom:!0},{label:"类型",width:60,render:a=>"global"===a.type?"全局":"自定义"},{label:"路径",prop:"path",isCustom:!0,showOverflowTooltip:!0},L({prop:"running",event:a=>wa(a,!1)}),{label:"端口",prop:"port"},{label:"JDK",prop:"jdk_version"},{label:"备注",prop:"ps"},P([{title:"修改",onClick:ba},{title:"重载",onClick:a=>wa(a,!0)},{title:"配置",onClick:_a},{title:"卸载",onClick:ka}])],extension:[c(na)]});return(a,o)=>{const n=M;return f(),h(n,null,{"header-left":y(()=>[b(g(e))]),"header-right":y(()=>[b(g(l),{class:"mr-[10px]"}),b(g(s))]),content:y(()=>[b(g(t),{"max-height":"440"})]),"footer-left":y(()=>[...o[0]||(o[0]=[])]),"footer-right":y(()=>[...o[1]||(o[1]=[])]),_:1})}}}),Da={class:"flex items-center"},Ja={class:"flex items-center"},qa={class:"flex items-center mx-[12px]"},Oa={class:"p-[20px] flex flex-col"},Ka={class:"flex items-center ml-[40px]"},Ea={class:"bg-[#333] p-[12px] h-full text-white overflow-auto logMsg"},Sa=["innerHTML"],Aa=d(_({__name:"index",props:{compData:{default:{}}},emits:["close"],setup(a,{emit:e}){const t=a,l=p(),n=e,r=v(""),c=v(""),d=v(!1),_=v([]),L=v([]),P=v([]),F=v(!1),H=v(""),R=v([]),z=v(!1),N=v(!1),G=v("正在请求安装..."),Q=()=>{sa({type:"file",path:r.value,change:a=>{r.value=a,setTimeout(()=>{d.value=!0},0)}})},W=async()=>{try{const a=await Z({data:JSON.stringify({jdk:r.value})});l.request(a),a.status&&(d.value=!1),ua()}catch(a){}},Y=async()=>{try{const a=await $({name:c.value});(null==a?void 0:a.status)?l.request(a):l.error("string"==typeof a?a:a.msg)}catch(a){}},na=a=>{a.hasOwnProperty("props")?oa.value=a.props.name:oa.value=a.name,ua()},ra=v({}),ca=v([{label:"JDK版本",prop:"name",width:100},{label:"JDK地址",render:a=>2===a.operation?b("span",{class:"truncate"},[a.path]):b("span",{class:"truncate bt-link ",onClick:()=>{B(a),n("close")}},[a.path])},{label:"操作",align:"right",width:136,render:a=>{switch(a.operation){case 0:return b("span",{class:" bt-link",onClick:()=>{(async a=>{try{R.value.find(e=>{e.name===a.name&&(e.operation=3)});const e=await ea({version:a.name});l.request(e),e.status&&la(),ua()}catch(e){}})(a)}},[V("安装")]);case 1:return b("span",{class:"bt-danger",onClick:()=>{(async a=>{await s({title:"删除jdk",isHtml:!0,content:"是否删除【 ".concat(a.name,'】，<span class="text-danger">此操作将会删除该JDK目录下的所有文件，请确保该JDK未被使用</span>，是否继续操作？')}),o({loading:"正在删除，请稍后...",request:ta({data:JSON.stringify({jdk:a.path})}),success:ua})})(a)}},[V("删除")]);case 2:return b("span",null,[V("不可操作")]);case 3:return b("span",{class:"bt-link",onClick:()=>{ua()}},[V("正在安装,点击刷新")])}}}]),ua=async()=>{try{z.value=!0;const a=await X();R.value=a.data.jdk_info.sort((a,e)=>e.operation-a.operation),_.value.length=0,L.value=[];for(let e=0;e<a.data.jdk_info.length;e++)a.data.jdk_info[e].is_current&&(c.value=a.data.jdk_info[e].name),1===a.data.jdk_info[e].operation&&_.value.push({label:a.data.jdk_info[e].name,value:a.data.jdk_info[e].name}),0!==a.data.jdk_info[e].operation&&L.value.push({label:a.data.jdk_info[e].name,value:a.data.jdk_info[e].path});P.value=[],a.data.tomcat_status.forEach(a=>{P.value.push({name:"Tomcat".concat(a.version),...a,popover:!1,portInput:a.port})})}catch(a){}finally{z.value=!1}};return k(async()=>{t.compData.name?(oa.value=t.compData.name,na({name:t.compData.name})):(oa.value="newTomCat",await ua())}),w(()=>{oa.value="jdkSettings"}),(a,e)=>{const t=I,s=O,o=K,n=E,p=S,v=U,k=u,w=M,P=A,B=i,X=m,Z=j("bt-loading");return f(),x("div",null,[b(B,{type:"left-bg-card",class:"h-full",modelValue:g(oa),"onUpdate:modelValue":e[3]||(e[3]=a=>C(oa)?oa.value=a:null),onTabClick:na},{default:y(()=>[b(P,{label:"JDK管理",name:"jdkSettings",lazy:!0,class:"overflow-y-auto"},{default:y(()=>[b(w,null,{"header-left":y(()=>[T("div",Da,[b(o,{placement:"bottom",width:"380",trigger:"click",visible:g(d),"onUpdate:visible":e[1]||(e[1]=a=>C(d)?d.value=a:null),"popper-class":"white-tips-popover"},{default:y(()=>[T("div",Ja,[e[10]||(e[10]=V(" jdk路径: ",-1)),b(t,{modelValue:g(r),"onUpdate:modelValue":e[0]||(e[0]=a=>C(r)?r.value=a:null),placeholder:"请输入JDK路径",icon:"el-folder-opened",onIconClick:Q,class:"!w-[20rem] mx-[12px]",width:"20rem"},null,8,["modelValue"]),b(s,{type:"primary",onClick:W},{default:y(()=>[...e[9]||(e[9]=[V("添加",-1)])]),_:1})])]),reference:y(()=>[b(s,{type:"primary"},{default:y(()=>[...e[11]||(e[11]=[V("添加自定义JDK",-1)])]),_:1})]),_:1},8,["visible"]),T("div",qa,[e[12]||(e[12]=T("span",{class:"mr-[4px]"},"命令行版本",-1)),b(p,{class:"!w-[14rem]",modelValue:g(c),"onUpdate:modelValue":e[2]||(e[2]=a=>C(c)?c.value=a:null),onChange:Y},{default:y(()=>[(f(!0),x(D,null,J(g(_),a=>(f(),h(n,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),"header-right":y(()=>[b(v,{onRefresh:ua})]),content:y(()=>[q(b(k,{height:"440",column:g(ca),data:g(R)},null,8,["column","data"]),[[Z,g(z)]])]),_:1})]),_:1}),b(P,{label:"Tomcat管理",name:"newTomCat",lazy:!0},{default:y(()=>[b(Va)]),_:1})]),_:1},8,["modelValue"]),b(X,{title:"安装tomcat",modelValue:g(F),"onUpdate:modelValue":e[5]||(e[5]=a=>C(F)?F.value=a:null),area:36,showFooter:"",onConfirm:e[6]||(e[6]=a=>(async()=>{try{const a=await aa({java_path:H.value,version:ra.value.name.replace("Tomcat","")});a.status?la():l.error(a.msg),F.value=!1}catch(a){}})())},{default:y(()=>[T("div",Oa,[e[14]||(e[14]=T("div",{class:"flex items-center text-[1.4rem]"},[T("i",{class:"svgtofont-el-warning-filled text-warning !text-[4rem] mr-[12px]"}),V(" 是否安装Tomcat？ ")],-1)),T("div",Ka,[e[13]||(e[13]=V(" jdk版本： ",-1)),b(p,{class:"!w-[16rem] ml-[12px]",modelValue:g(H),"onUpdate:modelValue":e[4]||(e[4]=a=>C(H)?H.value=a:null),"empty-values":[null,void 0]},{default:y(()=>[b(n,{label:"默认版本",value:""}),(f(!0),x(D,null,J(g(L),a=>(f(),h(n,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"]),b(X,{title:"安装信息",modelValue:g(N),"onUpdate:modelValue":e[7]||(e[7]=a=>C(N)?N.value=a:null),area:[50,36],onCancel:e[8]||(e[8]=()=>G.value="正在请求安装...")},{default:y(()=>[T("div",Ea,[T("pre",{innerHTML:g(G),class:"whitespace-pre-wrap"},null,8,Sa)])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f8992e23"]]),Ma=Object.freeze(Object.defineProperty({__proto__:null,default:Aa},Symbol.toStringTag,{value:"Module"}));export{xa as a,Ca as b,ha as c,fa as d,ua as e,Ta as f,ja as g,ga as h,da as i,ca as j,Ma as k,ma as r,ya as s,ra as t,ia as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
