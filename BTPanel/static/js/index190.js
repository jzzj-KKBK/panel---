import{c as e,r as a,g as l,p as s,q as d,v as r,e as u,A as o,x as t,M as i,C as m,F as p,a_ as n,B as c,Q as b,S as v,b8 as _,ai as f,aj as g,a9 as h,a7 as w}from"./base-lib.js?v=1756369731";import{w as V,fi as j,K as y,M as x,j as A,c as k,e as I}from"./utils-lib.js?v=1756369731";import{_ as U}from"./index101.js?v=1756369731";import{a as C,m as q}from"./useMethod4.js?v=1756369731";import{g as M}from"./useStore2.js?v=1756369731";import{addDatabase as S}from"./database.js?v=1756369731";import{_ as P}from"./index.vue_vue_type_script_setup_true_lang9.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./validator.js?v=1756369731";const E={class:"p-[24px]"},D=I(e({__name:"index",props:{compData:{default:()=>({refresh:async()=>[]})}},setup(e,{expose:I}){const D=e,{refreshTableList:F}=M(),L=a(),Q=a(!1),B=a([]),H=a({name:"",db_user:"",password:V(16),dataAccess:"127.0.0.1",address:"",codeing:"utf8mb4",dtype:"MySQL",ps:"",sid:0,listen_ip:"0.0.0.0/0",host:""}),K={name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]}],db_user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}],address:[{validator:(e,a,l)=>{"ip"===H.value.dataAccess&&(""===a?l(new Error("请输入IP地址")):(a.split("\n").forEach(e=>{""===e||j(e)||l(new Error("请输入正确的IP地址"))}),l())),l()},trigger:["blur","change"]}]},R=l(()=>{var e;return(null==(e=B.value.find(e=>e.id===H.value.sid))?void 0:e.db_host)||""}),T=e=>{H.value.db_user=e,H.value.ps=e},z=()=>{L.value.clearValidate("address")},G=async()=>{const e=x.load("正在连接服务器，请稍后...");try{const{status:e,msg:a,err_msg:l}=await q(H.value.sid);return!!e||(x.error(l),!1)}catch(a){}finally{e.close()}};return s(async()=>{var e;B.value=await D.compData.refresh(),H.value.sid=null==(e=B.value[0])?void 0:e.id}),I({onConfirm:async e=>{await L.value.validate(),await G(),"ip"===H.value.dataAccess&&(H.value.address=H.value.address.replace(/\n/g,",")),await y({request:S({...H.value,sid:String(H.value.sid),address:"ip"===H.value.dataAccess?H.value.address:H.value.dataAccess}),loading:"正在添加数据库，请稍后...",message:!0}),F(),e()}}),(e,a)=>{const l=v,s=_,j=f,y=g,x=h,I=A,q=U,M=k,S=w;return d(),r("div",E,[u(S,{disabled:t(Q),model:t(H),ref_key:"addFormRef",ref:L,rules:K,onSubmit:a[8]||(a[8]=b(()=>{},["prevent"]))},{default:o(()=>[u(x,{label:"数据库名",prop:"name"},{default:o(()=>[u(s,{span:14},{default:o(()=>[u(l,{placeholder:"新的数据库名称",modelValue:t(H).name,"onUpdate:modelValue":a[0]||(a[0]=e=>t(H).name=e),onInput:T},null,8,["modelValue"])]),_:1}),u(s,{span:10},{default:o(()=>[u(x,null,{default:o(()=>[u(y,{modelValue:t(H).codeing,"onUpdate:modelValue":a[1]||(a[1]=e=>t(H).codeing=e),class:"ml-8px !w-[13.2rem]"},{default:o(()=>[u(j,{label:"utf8",value:"utf8"}),u(j,{label:"utf8mb4",value:"utf8mb4"}),u(j,{label:"gbk",value:"gbk"}),u(j,{label:"big5",value:"big5"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(x,{label:"用户名",prop:"db_user"},{default:o(()=>[u(I,{width:"38rem",placeholder:"数据库用户",modelValue:t(H).db_user,"onUpdate:modelValue":a[2]||(a[2]=e=>t(H).db_user=e)},null,8,["modelValue"])]),_:1}),u(x,{label:"密码",prop:"password"},{default:o(()=>[u(q,{width:"38rem",icon:"el-refresh",modelValue:t(H).password,"onUpdate:modelValue":a[3]||(a[3]=e=>t(H).password=e),modelModifiers:{sync:!0},onIconClick:a[4]||(a[4]=()=>t(H).password=t(V)(16)),isActive:!0},null,8,["modelValue"])]),_:1}),u(x,{label:"访问权限",prop:"dataAccess"},{default:o(()=>[u(y,{class:"!w-[38rem]",modelValue:t(H).dataAccess,"onUpdate:modelValue":a[5]||(a[5]=e=>t(H).dataAccess=e),onChange:z},{default:o(()=>[u(j,{label:"所有人",value:"%"}),u(j,{label:"本地服务器",value:"127.0.0.1"}),u(j,{label:"指定ip",value:"ip"})]),_:1},8,["modelValue"]),u(x,{prop:"address"},{default:o(()=>["ip"===t(H).dataAccess?(d(),i(I,{key:0,type:"textarea",rows:4,placeholder:"如需填写多个IP，请换行填写，每行一个IP",modelValue:t(H).address,"onUpdate:modelValue":a[6]||(a[6]=e=>t(H).address=e),width:"38rem",class:"mt-[8px] w-full"},null,8,["modelValue"])):m("",!0)]),_:1})]),_:1}),u(x,{label:"添加至",prop:"sid",class:"!mb-0"},{default:o(()=>[u(y,{class:"!w-[24rem]",modelValue:t(H).sid,"onUpdate:modelValue":a[7]||(a[7]=e=>t(H).sid=e)},{default:o(()=>[(d(!0),r(p,null,n(t(B),(e,a)=>(d(),i(j,{key:a,label:e.ps+(e.db_host?"（"+e.db_host+"）":""),value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(M,{class:"ml-[8px]",onClick:t(C)},{default:o(()=>[...a[9]||(a[9]=[c("管理远程数据库",-1)])]),_:1},8,["onClick"])]),_:1}),u(x,{label:" ",class:"!mb-0"},{default:o(()=>[u(P,{server:{sid:t(H).sid,ip:t(R)}},null,8,["server"])]),_:1})]),_:1},8,["disabled","model"])])}}}),[["__scopeId","data-v-b34e8314"]]);export{D as default};
