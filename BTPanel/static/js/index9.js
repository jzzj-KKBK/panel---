import{_ as a}from"./index116.js?v=1756369731";import{r as e,g as s,e as t,c as r,p as l,q as o,v as i,x as n,y as u,z as p,C as c,M as m,B as d,aW as g,b3 as v}from"./base-lib.js?v=1756369731";import{v as _,o as f,K as w,M as b,l as y,L as h,G as x,a9 as L,aa as S,e as j}from"./utils-lib.js?v=1756369731";import{b as k,c as T,d as C,e as F,f as P,g as K}from"./form-item.js?v=1756369731";import{a0 as O,a1 as I,a2 as q,a3 as z,a4 as E}from"./config.js?v=1756369731";import{d as N}from"./useMethod2.js?v=1756369731";import{a as H}from"./useController2.js?v=1756369731";const R=e({last_update:"",total_time:"",start_time:"",panel_addr:"",panel_user:"",panel_password:"",panel_port:""});e("计算中..."),e("计算中..."),e({total:0,use:0});const V=e({}),D=e([]),M=e({status:0,progress:0,msg:"准备开始迁移",progressLog:"",remain_time:100}),A=e(!1),B=[{type:"index"},{label:"失败项",prop:"name"},{label:"失败原因",prop:"msg",width:320,render:a=>t("span",{class:"text-[#ef0808]"},[a.msg])}],J=e({}),G=async()=>{try{Z(),M.value.status=1,A.value=!0;await E(J.value);M.value.msg="准备迁移中...",M.value.progress=0,M.value.progressLog="",$()}catch(a){}},W=()=>(V.value={},N.value.operateType="add",y({area:84,title:"设置迁移数据",component:()=>h(()=>import("./index114.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{saveConfig:(a,e,s,t)=>{const r={site:"site",database:"database",wptools:"wp_tools",plugin:"plugin",runtime:"soft",Ftp:"ftp",Crontab:"crontab",Vmail:"vmail",Terminal:"ssh",Firewall:"firewall",node:"node"},l=[];Object.entries(e).map(([a,e])=>{("database"===a&&t.length>0||"site"===a&&s.length>0||e)&&l.push(r[a])}),V.value={site_id:JSON.stringify(s.map(a=>a.id)),database_id:JSON.stringify(t.map(a=>a.id)),backup_data:JSON.stringify(l)}}},btn:["确定","取消"],showFooter:!0})),Q=e([]);s(()=>_(Q.value.reduce((a,e)=>a+Number(e.size),0)));const U=e([]);s(()=>_(U.value.reduce((a,e)=>a+Number(e.size),0)));const X=e([]);s(()=>_(X.value.reduce((a,e)=>a+Number(e.size),0))),e([]);const Y=e([]);s(()=>_(Y.value.reduce((a,e)=>a+Number(e.size),0))),e({ftpList:[],crontabList:[],termList:[],firewallList:[]}),e({site:!0,database:!0,ftp:!0,crontab:!0,terminal:!0,firewall:!0,wptools:!0,plugin:!0,runtime:!0}),s(()=>({Ftp:{title:"FTP",icon:"ftp",dataKey:"ftpList",loadingKey:"Ftp",tooltip:"仅备份FTP账号和密码，不备份FTP目录"},Crontab:{title:"计划任务",icon:"crontab",dataKey:"crontabList",loadingKey:"Crontab"},Terminal:{title:"终端",icon:"xterm",dataKey:"termList",loadingKey:"Terminal"},Firewall:{title:"系统防火墙",icon:"firewall",dataKey:"firewallList",loadingKey:"Firewall"}}));const Z=()=>{M.value={status:0,progress:0,msg:"准备开始迁移",progressLog:"",remain_time:100}},$=async()=>{try{const{data:a}=await I();if(M.value.progress=a.data.migrate_progress,M.value.progressLog=a.data.migrate_log,M.value.msg=a.data.migrate_msg,M.value.status=a.data.run_status,2!==a.data.run_status&&3!==a.data.run_status)setTimeout(()=>{$()},1e3);else{if(2===a.data.run_status||(D.value=a.data.err_info),R.value=a.data,a.data.task_info.panel_info){const{panel_url:e,password:s,username:t}=a.data.task_info.panel_info;R.value.panel_addr=e,R.value.panel_user=t,R.value.panel_password=s}A.value=!1,sa()}}catch(a){}},aa=async(a=!0)=>{a&&await f({title:"取消迁移",content:"取消迁移后，迁移任务将被删除，是否继续操作？"}),w({loading:"正在取消迁移，请稍后...",request:q(),message:!0,success:a=>{b.success("迁移任务已取消"),A.value=!1,M.value.status=0,M.value.msg="准备开始迁移",M.value.progress=0,M.value.progressLog=""}})},ea=()=>{y({area:60,title:"迁移历史",component:()=>h(()=>import("./migrate-history.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},sa=()=>{y({area:60,title:!1,component:()=>h(()=>import("./migrate-progress.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},ta={class:""},ra={class:"p-2rem"},la={class:"w-[56rem]"},oa={key:0,class:"flex-col flex"},ia={class:"text-[1.4rem]"},na={class:"mb-1.2rem mt-[0.4rem] flex items-center"},ua=j(r({__name:"index",setup(e){const r=[{label:"密码认证",value:"password"},{label:"私钥验证",value:"key"}],_=(a,e,s,t)=>{s?t():t(new Error("password"===a.value.auth_type?"请输入SSH密码":"请输入SSH私钥"))},{BtForm:w,submit:y,ref:h}=x({data:()=>({auth_type:"password",server_ip:"",ssh_port:"22",ssh_user:"",password:""}),options:a=>s(()=>{const e=[k("密码","password",{attrs:{placeholder:"请输入SSH密码",class:"mr-4 !w-[275px]"},rules:[{required:!0,validator:(e,s,t)=>_(a,0,s,t),trigger:["change","blur"]}]})],s=[T("私钥","password",{attrs:{placeholder:"请输入SSH私钥",class:"mr-4 !w-[275px]",autosize:{minRows:4,maxRows:4}},rules:[{required:!0,validator:(e,s,t)=>_(a,0,s,t),trigger:["change","blur"]}]})];return[C([k("服务器IP","server_ip",{attrs:{class:"mr-[8px] !w-[180px]",placeholder:"请输入服务器IP",onInput:()=>{a.value.ps=a.value.server_ip},onBlur:()=>H(a)},rules:[{required:!0,message:"请输入服务器IP",trigger:["change","blur"]},L()]}),k("端口","ssh_port",{attrs:{placeholder:"请输入端口",class:"!w-[84px]"},rules:[{required:!0,message:"请输入端口",trigger:["change","blur"]},S()]})]),k("账号","ssh_user",{attrs:{placeholder:"请输入SSH账号",class:"mr-4 !w-[275px]"},rules:[{required:!0,message:"请输入SSH账号",trigger:["change","blur"]}]}),F("验证方式","auth_type",r,{attrs:{class:"mr-4 !w-[275px]",onChange:()=>{var e;a.value.password="",null==(e=h.value)||e.clearValidate()}}}),..."password"===(null==a?void 0:a.value.auth_type)?e:s,P("",[{content:"请在上方输入目标服务器的root账号信息进行迁移"},{content:t("span",{class:"bt-link",onClick:W},[d("点击设置迁移数据")])}],{attrs:{class:"ml-[6rem]"}}),C([K("迁移记录",{attrs:{class:"ml-[4rem]",onClick:ea}}),K("开始迁移",{attrs:{class:"ml-[40rem]",type:"primary",onClick:y}})])]}),submit:async(a,e)=>{await e(),(async a=>{J.value=a;try{await f({title:"整机迁移提醒",content:"迁移至目标服务器【"+a.server_ip+"】，迁移过程中网站访问受影响，是否继续操作？",type:"calc"}),A.value=!0,Z();const e=b.load("正在检查目标服务器连接，请稍后..."),s=await z(a);if(e.close(),s.status){let e=b.load("正在开始迁移，请稍后...");const s=await E({...a,...V.value});e.close(),s.status?(M.value.status=0,M.value.msg="准备迁移中...",M.value.progress=0,M.value.progressLog="",$()):b.error(s.msg)}else b.error(s.msg)}catch(e){}})(a.value)}});return l(()=>{(async()=>{try{const{data:a}=await O();Z(),a.data.task_status&&(A.value=!0,$())}catch(a){}})()}),(e,s)=>{const r=g,l=v,d=a;return o(),i("div",ta,[t(r,{class:"!mb-[1.2rem] !text-[1.2rem]","show-icon":"",title:"整机迁移会自动安装宝塔面板，建议使用【全新机器】进行迁移，如有数据将会覆盖，支持不同系统之间进行迁移！",closable:!1,type:"warning"}),t(n(w)),u("div",ra,[u("div",la,[1===n(M).status?(o(),i("div",oa,[s[1]||(s[1]=u("span",{class:"text-[#666] font-bold text-[1.4rem] mb-[2rem]"},"迁移进度",-1)),u("span",ia,p(n(M).msg),1),u("div",na,[t(l,{class:"w-full","text-inside":!0,"stroke-width":20,percentage:n(M).progress,status:"success"},null,8,["percentage"]),u("i",{class:"svgtofont-el-circle-close text-[#ef0808] !text-1.8rem pl-4px cursor-pointer",onClick:s[0]||(s[0]=(...a)=>n(aa)&&n(aa)(...a))})])])):c("",!0),1===n(M).status?(o(),m(d,{key:1,class:"h-22rem !rounded-[0] w-[56rem] mt-[2rem]",content:n(M).progressLog,fullScreen:{title:"全屏查看日志",onRefresh:()=>{}}},null,8,["content"])):c("",!0)])])])}}}),[["__scopeId","data-v-962ddcc9"]]),pa=Object.freeze(Object.defineProperty({__proto__:null,default:ua},Symbol.toStringTag,{value:"Module"}));export{B as a,D as e,pa as i,M as p,G as r,R as s};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
