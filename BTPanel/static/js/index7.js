import{u as e,Z as a,l as t,L as l,K as s,P as n,o,$ as i,J as r,k as c,a0 as u,e as d,c as m,M as p,a1 as w,S as v,a2 as _}from"./utils-lib.js?v=1756369731";import{c as f,r as h,k as g,aB as y,aQ as b,e as k,p as x,G as j,q as C,v as V,A,B as L,x as I,y as S,H as M,D as q,J as D,z as H,t as R,C as U,g as z,F as E,w as T,M as P,a5 as W}from"./base-lib.js?v=1756369731";import{_ as B}from"./index103.js?v=1756369731";import{a as O,b as F,u as J,c as G}from"./column.js?v=1756369731";import{t as K,W as N,X as Q}from"./config.js?v=1756369731";import{s as X}from"./validator.js?v=1756369731";import{g as Z}from"./useStore.js?v=1756369731";import{a as $}from"./useMethod.js?v=1756369731";import{_ as Y}from"./index112.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const ee={style:{"overflow-y":"hidden"}},ae=d(f({__name:"index",setup(d,{expose:m}){const{mainHeight:p,push:w,getSenderAlarmListInfo:v}=e(),_=h(),f=h(!1),D=h([]),H=g({p:1,rows:10,status:"",keyword:""}),R=new Map([["wx_account","微信公众号"],["feishu","飞书"],["mail","邮箱"],["sms","短信通知"],["dingding","钉钉"],["weixin","企业微信"],["webhook","自定义消息通道"]]),U=e=>{const s=!a(e);t({title:"".concat(s?"编辑":"添加","告警任务"),component:()=>l(()=>import("./index113.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),area:80,showFooter:!0,compData:{isEdit:s,row:e,onRefresh:z}})},z=async()=>{await s({loading:f,request:n({...H}),success:({data:e})=>{E(e.data)}})},E=e=>{D.value=null==e?void 0:e.map(e=>{const{sender:a}=e;return{...e,alarmAccounts:a.map(e=>{const a=w.value.config.find(a=>a.id===e);return a?"sms"===a.sender_type?{id:e,type:a.sender_type,title:"短信"}:{id:e,type:a.sender_type,title:R.get(a.sender_type)||"",account:a.data.title}:null})}})},T=async(e,a,t,l)=>{const s=async(e,a)=>{const{id:t,status:l}=e,s=new Map([["delete",N],["start",K],["stop",K]]).get(o);switch(o){case"start":if(s)return await s({task_id:t,status:1});break;case"stop":if(s)return await s({task_id:t,status:0});break;case"delete":if(s)return await s({task_id:t})}},{label:n,value:o}=l;await e({title:"批量".concat(n,"告警"),content:"即将批量".concat(n,"告警，是否继续操作?"),column:[{label:"告警名称",prop:"title"},G()],onConfirm:async()=>(await a(s),z(),!1)})},P=[O(),{prop:"title",label:"标题",minWidth:140,width:300},F({minWidth:100,event:async e=>{await o({title:"".concat(e.status?"禁用":"启用","【").concat(e.title,"】任务"),content:"您真的要".concat(e.status?"禁用":"启用","【").concat(e.title,"】这个任务吗？")}),await s({loading:"正在修改告警任务状态，请稍候...",request:K({task_id:e.id,status:Number(!e.status)}),message:!0,success:z})},data:["停用","正常"]}),{label:"告警方式",width:260,render:e=>y(b,{content:e.alarmAccounts.filter(e=>null!==e).map(e=>"sms"===(null==e?void 0:e.type)?"短信通知":"".concat((null==e?void 0:e.account)||"","(").concat((null==e?void 0:e.title)||"",")")).join(","),placement:"top",openDelay:500},[y("span",[e.alarmAccounts.filter(e=>null!==e).map(e=>"sms"===(null==e?void 0:e.type)?"短信通知":"".concat(null==e?void 0:e.account,"(").concat(e.title,")")).join(",")])])},{label:"告警条件",minWidth:180,render:e=>k("span",{innerHTML:e.view_msg},null)},J([{title:"告警记录",width:70,onClick:e=>{t({title:"【".concat(e.title,"】告警记录"),component:()=>l(()=>import("./record.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),area:80,compData:e})}},{title:"编辑",onClick:e=>U(e)},{title:"删除",onClick:async e=>{await o({icon:"warning-filled",title:"删除告警任务",content:"删除后将不再告警此条任务，是否继续？"}),await s({loading:"正在删除告警任务，请稍候...",request:N({task_id:e.id}),message:!0,success:z})}}])],W=[{label:"启动",value:"start",event:T},{label:"停止",value:"stop",event:T},{label:"删除",value:"delete",event:T}],Q=async()=>{await v(!0),await z()};return x(Q),m({init:Q}),(e,a)=>{const t=q,l=i,s=r,n=c,o=u,d=B,m=j("bt-loading");return C(),V("div",ee,[k(d,null,{"header-left":A(()=>[k(t,{type:"primary",onClick:a[0]||(a[0]=e=>U(!1))},{default:A(()=>[...a[3]||(a[3]=[L("添加任务",-1)])]),_:1})]),"header-right":A(()=>[k(l,{class:"alarm-custom-radio mr-[1rem]",type:"button",size:"default",modelValue:I(H).status,"onUpdate:modelValue":a[1]||(a[1]=e=>I(H).status=e),options:[{label:"全部",value:""},{label:"运行中",value:!0},{label:"已停止",value:!1}],onChange:z},null,8,["modelValue"]),S("div",null,[k(s,{modelValue:I(H).keyword,"onUpdate:modelValue":a[2]||(a[2]=e=>I(H).keyword=e),onSearch:z,placeholder:"请输入搜索关键词",class:"!w-24rem"},null,8,["modelValue"])])]),content:A(()=>[M(k(n,{ref_key:"alarmListRef",ref:_,data:I(D),column:P,"max-height":I(p)-300,description:"告警列表为空"},null,8,["data","max-height"]),[[m,I(f)],[m,"正在加载告警列表，请稍后...","title"]])]),"footer-left":A(()=>[k(o,{"table-ref":I(_),options:W},null,8,["table-ref"])]),_:1})])}}}),[["__scopeId","data-v-5d926d59"]]),te={class:"flex items-center"},le={class:"flex-1 leading-[1.5]"},se={class:"flex"},ne=d(f({__name:"module-name",props:{row:{}},setup:e=>(e,a)=>{const t=m;return C(),V("div",te,[S("div",{class:D(["icon",e.row.ps.indexOf("API")>-1?"webhook":e.row.name])},null,2),S("div",le,[S("span",{class:"text-14px font-bold cursor-pointer",onClick:a[0]||(a[0]=a=>{e.row})},H(e.row.title),1),S("div",se,[S("span",null,H(e.row.ps),1),k(t,{href:e.row.help,target:"_blank"},{default:A(()=>[...a[1]||(a[1]=[L(">>帮助文档",-1)])]),_:1},8,["href"])])])])}}),[["__scopeId","data-v-eacf7c0c"]]),oe={key:1,class:"c7"},ie={key:1},re=f({__name:"module-content",props:{row:{}},setup(a){const{getSenderAlarmListInfo:t}=e(),l=a,{row:s}=R(l),n=async()=>{await t(!0),p.success("刷新成功")};return(e,a)=>{return C(),V("div",null,[0===I(s).list.length?(C(),V("span",{key:0,class:"text-danger cursor-pointer",onClick:a[0]||(a[0]=e=>I(X)(I(s)))},"未配置")):I(s).list.length>0?(C(),V("span",oe,["sms"!==I(s).name?(C(),V("span",{key:0,class:"cursor-pointer",onClick:a[1]||(a[1]=e=>I(X)(I(s)))},"已绑定【"+H((t=I(s).list,t.map(e=>e.data.title).join("、")))+"】,可继续配置绑定更多账号",1)):U("",!0),"sms"===I(s).name?(C(),V("span",ie,[L("今日剩余发送次数："+H(I(s).list.at(0).data.count)+"( ",1),S("span",{class:"bt-link",onClick:n},"刷新次数"),a[2]||(a[2]=L(")",-1))])):U("",!0)])):U("",!0)]);var t}}}),ce=f({__name:"module-action",props:{row:{}},setup(a){const{getSenderAlarmListInfo:t}=e(),{refs:{isRefreshList:l}}=Z(),s=a,{row:n}=R(s),i=z(()=>n.value.list.at(0).used),r=async()=>{var e;try{await o({title:"".concat(i.value?"禁用":"开启","短信通知"),content:"您真的要".concat(i.value?"禁用":"开启","短信通知吗？")});const a=null==(e=n.value.list)?void 0:e.at(0).id,l=await w({sender_id:a});p.request(l),n.value.list.at(0).used=!i.value,t()}catch(a){}};return(e,a)=>(C(),V("div",null,["sms"!==I(n).name?(C(),V("span",{key:0,class:"bt-link",onClick:a[0]||(a[0]=e=>X({...n.value,callback:()=>{l.value=!0}}))},"配置")):(C(),V(E,{key:1},[I(i)?U("",!0):(C(),V("span",{key:0,class:"bt-link",onClick:r},"开启")),I(i)?(C(),V("span",{key:1,class:"bt-link",onClick:r},"禁用")):U("",!0)],64))]))}}),ue=f({__name:"index",setup(a,{expose:t}){const{push:l,getSenderAlarmListInfo:s}=e(),{refs:{isRefreshList:n}}=Z(),o=h(!1),i=h([]),r=[{label:"告警模块",width:400,render:e=>k(ne,{row:e},null)},{label:"配置情况",render:e=>k(re,{row:e},null)},{label:"操作",align:"right",width:100,render:e=>k(ce,{row:e},null)}],u=async(e=!0)=>{e&&(o.value=!0),await s(),i.value=$(l.value.config),o.value=!1};return T(()=>n.value,e=>{n.value&&(u(!1),n.value=!1)},{immediate:!0}),x(u),t({init:u}),(e,a)=>{const t=c,l=B,s=j("bt-loading");return C(),P(l,null,{content:A(()=>[M(k(t,{data:I(i),column:r,description:"告警设置列表为空"},null,8,["data"]),[[s,I(o)],[s,"正在加载告警设置列表，请稍后...","title"]])]),_:1})}}}),de=f({__name:"index",setup(a,{expose:t}){const{mainHeight:l}=e(),n=h([]),o=h(!1),u=h(0),d=g({p:1,limit:20,keyword:"",status:""}),m=async()=>{await s({loading:o,request:Q(W(d)),data:{data:[Array,n],page:v(u)}})},p=[{label:"标题",render:e=>k("span",{innerHTML:e.log},null)},{prop:"addtime",label:"时间",width:150}];return x(m),t({init:m}),(e,a)=>{const t=i,s=r,w=c,v=Y,_=B,f=j("bt-loading");return C(),P(_,null,{"header-right":A(()=>[k(t,{type:"button",modelValue:I(d).status,"onUpdate:modelValue":a[0]||(a[0]=e=>I(d).status=e),options:[{label:"全部",value:""},{label:"发送成功",value:!0},{label:"发送失败",value:!1}],onChange:m,class:"mr-[1rem]"},null,8,["modelValue"]),S("div",null,[k(s,{modelValue:I(d).keyword,"onUpdate:modelValue":a[1]||(a[1]=e=>I(d).keyword=e),onSearch:m,placeholder:"请输入搜索关键词",class:"!w-24rem"},null,8,["modelValue"])])]),content:A(()=>[M(k(w,{data:I(n),column:p,"max-height":I(l)-254,description:"告警日志列表为空"},null,8,["data","max-height"]),[[f,I(o)],[f,"正在加载告警日志列表，请稍后...","title"]])]),"footer-right":A(()=>[k(v,{total:I(u),page:I(d).p,"onUpdate:page":a[2]||(a[2]=e=>I(d).p=e),row:I(d).limit,"onUpdate:row":a[3]||(a[3]=e=>I(d).limit=e),onChange:m},null,8,["total","page","row"])]),_:1})}}}),me=f({__name:"index",setup(e){const{BtTabs:a}=_({type:"card",options:[{label:"告警列表",name:"list",lazy:!0,render:ae},{label:"告警设置",name:"set",lazy:!0,render:ue},{label:"告警日志",name:"log",lazy:!0,render:de}]});return(e,t)=>(C(),P(I(a)))}});export{me as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
