import{c as e,k as a,r as l,w as s,p as t,G as o,q as n,v as r,e as i,A as u,H as d,x as m,M as p,y as c,J as y,z as f,B as v,Q as _,D as w,a9 as g,al as h,a7 as S,U as b,F as V,a_ as x,P as k,aj as C,ai as H,a$ as j}from"./base-lib.js?v=1756369731";import{O as L,P,Q as q,R as K,S as U,T as B,U as I,V as R,W as z,X as A,Y as D}from"./firewall.js?v=1756369731";import{K as E,aq as F,M as O,r as T,at as M,l as N,L as Q,bU as G,o as J,A as W,j as X,h as Y,e as $,T as Z}from"./utils-lib.js?v=1756369731";import{k as ee}from"./validator.js?v=1756369731";import{c as ae}from"./useMethod6.js?v=1756369731";import{g as le}from"./useStore5.js?v=1756369731";import{_ as se}from"./index101.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const te={class:"bt-line"},oe={class:"bt-line"},ne=e({__name:"index",setup(e){var b,V;const{refs:{sshInfo:x}}=le(),k=a({sshBlastStatus:Boolean(null==(V=null==(b=x.value)?void 0:b.fail2ban)?void 0:V.status)}),C=l(),H=l(!1),j=l({}),K=async e=>{k.sshBlastStatus=!e;(await E({request:F({sName:"fail2ban"})})).data.setup?(await E({loading:"正在"+(e?"开启":"关闭")+"防暴破，请稍后...",request:L({act:e}),message:!0}),k.sshBlastStatus=e,ae()):O.warn("请先安装防暴破插件")},U=async e=>{try{const{data:a}=await E({request:F({sName:"fail2ban"})});a.setup?e&&e():(ee({name:a.name,type:"i",pluginInfo:a}),O.warn("请先安装防暴破插件"))}catch(a){}},B=()=>{T.push({name:"fixed"})},I=async()=>{try{H.value=!0;const{data:e}=await P();if(j.value=e,e.status){j.value.type=!0;const e={mail:"邮件",sms:"短信",dingding:"钉钉",wx_account:"微信公众号",feishu:"飞书",weixin:"企业微信",webhook:"自定义通道"};j.value.text=j.value.channels.map(a=>e[a]).join("、")+"已配置"}else j.value={type:!1,text:"告警通知未配置"};return e}catch(e){M(e)}finally{H.value=!1}},R=async()=>{N({title:"SSH登录告警",area:104,compData:{alertStatus:C.value,refreshFn:I},component:()=>Q(()=>import("./login-alert-setting.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})};return s(()=>x.value,()=>{var e,a;k.sshBlastStatus=Boolean(null==(a=null==(e=x.value)?void 0:e.fail2ban)?void 0:a.status)}),t(()=>{I()}),(e,a)=>{const l=w,s=g,t=h,b=S,V=o("bt-loading");return n(),r("div",null,[i(b,{model:m(k),onSubmit:a[5]||(a[5]=_(()=>{},["prevent"]))},{default:u(()=>[d((n(),p(s,{label:"SSH登录告警"},{default:u(()=>[c("div",te,[c("span",{onClick:a[0]||(a[0]=e=>R()),class:y(["!text-[1.2rem] cursor-pointer","text-".concat(m(j).type?"primary":"warning")])},f(m(j).text),3),i(l,{type:"primary",class:"!ml-4",size:"small",onClick:a[1]||(a[1]=e=>R())},{default:u(()=>[...a[6]||(a[6]=[v(" 设置登陆告警 ",-1)])]),_:1}),a[7]||(a[7]=c("span",{class:"text-[#999] ml-4 text-[1.2rem]"}," 推荐使用密钥登录，关闭密码，安全性更高 ",-1))])]),_:1})),[[V,m(H)]]),i(s,{label:"SSH安全防护"},{default:u(()=>[c("div",oe,[i(t,{modelValue:m(k).sshBlastStatus,"onUpdate:modelValue":a[2]||(a[2]=e=>m(k).sshBlastStatus=e),size:"small",width:36,onChange:K},null,8,["modelValue"]),i(l,{onClick:a[3]||(a[3]=e=>(async()=>{U(()=>N({title:"配置SSH防暴破",area:40,component:()=>Q(()=>import("./anti-blast-view.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),showFooter:!0}))})()),size:"small",type:"primary",class:"!ml-8"},{default:u(()=>[...a[8]||(a[8]=[v(" 配置 ",-1)])]),_:1}),i(l,{size:"small",onClick:a[4]||(a[4]=e=>(async()=>{U(()=>N({title:"防暴破日志",area:60,compData:{type:"AntiBlast",requestFn:()=>q()},component:()=>Q(()=>import("./index458.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)}))})())},{default:u(()=>[...a[9]||(a[9]=[v("日志",-1)])]),_:1}),a[10]||(a[10]=c("span",{class:"text-[#999] ml-4 text-[1.2rem]"}," 结合fail2ban服务自动阻止恶意IP地址的攻击、暴力破解等行为；首次安装后，请手动刷新页面 ",-1))])]),_:1}),i(s,null,{default:u(()=>[c("span",{class:"text-[1.2rem] text-[#999]"},[a[11]||(a[11]=v(" 更多SSH安全设置请使用系统加固模块 ",-1)),c("span",{class:"bt-link",onClick:B},">> 系统加固")])]),_:1})]),_:1},8,["model"])])}}}),re={class:"bt-line"},ie={class:"bt-line"},ue=$(e({__name:"root-setting",props:{data:{default:()=>({})}},emits:["refresh"],setup(e,{emit:t}){const o=e,d=t,y=b(o.data),f=a({rootLogin:"",rootPwd:"",rootKey:""}),h=b(),j=l(!1),L=async e=>{var a;if("yes"!==(null==(a=y.value)?void 0:a.pubkey))return O.error("请先开启SSH密钥登录，再"+(e?"查看":"下载")+"密钥");const l=await E({loading:"正在获取密钥信息，请稍后...",request:K()});e&&l.status?(f.rootKey=l.msg,j.value=!0):window.open("/ssh_security?action=download_key","_blank","noopener,noreferrer")},P=async()=>{if(!f.rootPwd)return O.error("请输入新密码");await J({title:"提示",content:"重置root密码后，之前的密码将失效，是否继续操作？",icon:"warning-filled"}),await E({loading:"正在重置root密码，请稍后...",request:U({username:"root",password:f.rootPwd}),message:!0}),d("refresh")},q=async e=>{await E({loading:"正在设置root登录，请稍后...",request:B({p_type:e}),message:!0}),d("refresh")},R=()=>{window.open("/ssh_security?action=download_key","_blank","noopener,noreferrer")},z=async()=>{var e;let a=null==(e=y.value)?void 0:e.pubkey;await E({loading:"正在重新生成SSH登录密钥，请稍后...",request:I({ssh:a,type:y.value.key_type}),message:!0});const l=await E({loading:"正在获取密钥信息，请稍后...",request:K()});if(!l.msg)return O.msg({type:"warning",message:"请重新开启SSH密钥登录再查看密钥！"});f.rootKey=l.msg,d("refresh")};return s(()=>o.data,e=>{h.value=Object.entries((null==e?void 0:e.root_login_types)||[]),f.rootLogin=null==e?void 0:e.root_login_type,y.value=e},{immediate:!0}),(e,a)=>{const l=H,s=C,t=g,o=se,d=w,y=S,b=X,K=Y;return n(),r("div",null,[i(y,{ref:"rootFormRef",model:m(f),onSubmit:a[5]||(a[5]=_(()=>{},["prevent"]))},{default:u(()=>[i(t,{label:"root登录设置",prop:"rootLogin"},{default:u(()=>[i(s,{modelValue:m(f).rootLogin,"onUpdate:modelValue":a[0]||(a[0]=e=>m(f).rootLogin=e),class:"!w-[26rem]",onChange:q},{default:u(()=>[(n(!0),r(V,null,x(m(h),e=>(n(),p(l,{key:e[0],label:e[1],value:e[0]},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(t,{label:"root密码"},{default:u(()=>[c("div",re,[i(o,{modelValue:m(f).rootPwd,"onUpdate:modelValue":a[1]||(a[1]=e=>m(f).rootPwd=e),icon:"el-refresh",placeholder:"请输入新密码",onIconClick:a[2]||(a[2]=()=>m(f).rootPwd=m(G)(16)),width:"28rem"},null,8,["modelValue"]),i(d,{type:"primary",class:"!ml-4",onClick:P},{default:u(()=>[...a[9]||(a[9]=[v(" 重置 ",-1)])]),_:1}),a[10]||(a[10]=c("span",{class:"text-[#999] ml-4 text-[1.2rem]"}," 建议使用复杂度高的密码，修改后请及时保存，刷新页面会清空密码框 ",-1))])]),_:1}),i(t,{label:"root密钥"},{default:u(()=>[c("div",ie,[i(d,{size:"small",type:"primary",onClick:a[3]||(a[3]=e=>L(!0))},{default:u(()=>[...a[11]||(a[11]=[v(" 查看密钥 ",-1)])]),_:1}),i(d,{size:"small",onClick:a[4]||(a[4]=e=>L(!1))},{default:u(()=>[...a[12]||(a[12]=[v(" 下载 ",-1)])]),_:1}),a[13]||(a[13]=c("span",{class:"text-[#999] ml-4 text-[1.2rem]"}," 推荐使用密钥登录，关闭密码，安全性更高 ",-1))])]),_:1})]),_:1},8,["model"]),i(K,{title:"SSH密钥登录",modelValue:m(j),"onUpdate:modelValue":a[8]||(a[8]=e=>k(j)?j.value=e:null),area:42},{default:u(()=>[i(y,{ref:"openSshKeyForm",model:m(f),class:"p-[2rem]","label-width":"5rem"},{default:u(()=>[i(t,null,{default:u(()=>[i(b,{modelValue:m(f).rootKey,"onUpdate:modelValue":a[6]||(a[6]=e=>m(f).rootKey=e),class:"sshKey",type:"textarea",readOnly:"",rows:12,width:"36rem"},null,8,["modelValue"])]),_:1}),i(t,null,{default:u(()=>[i(d,{type:"primary",class:"copySshPaw",onClick:a[7]||(a[7]=e=>{return a=m(f).rootKey,void W({value:a});var a}),textContent:"复制"}),i(d,{type:"primary",class:"copy",onClick:R,textContent:"下载"}),i(d,{type:"default",class:"copy",onClick:z,textContent:"重新生成"})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-6d23c4bc"]]),de={class:"bt-line"},me={class:"bt-line"},pe={class:"bt-line"},ce={class:"p-20px"},ye=$(e({__name:"ssh-setting",props:{data:{default:()=>({})}},emits:["refresh"],setup(e,{emit:t}){var o,d;const p=e,y=t,{refs:{sshInfo:f}}=le(),V=b(null==p?void 0:p.data),x=l(!1),j=a({isPwdLogin:"yes"===(null==(o=V.value)?void 0:o.password),isKeyLogin:"yes"===(null==(d=V.value)?void 0:d.pubkey)}),L=a({ssh:"yes",type:"ed25519"}),P=async e=>{await E({loading:"正在"+(e?"开启":"关闭")+"SSH密码登录，请稍后...",request:R(Boolean(e)),message:!0})},q=async()=>{await E({loading:"正在处理，请稍候...",request:I(L),message:!0}),x.value=!1,L.ssh="yes",L.type="ed25519",y("refresh")},K=async e=>{e?(j.isKeyLogin=!e,x.value=!0):(await E({loading:"正在关闭SSH密钥登录，请稍后...",request:z(),message:!0}),y("refresh"))};return s(()=>p.data,e=>{e&&(V.value=e),j.isPwdLogin="yes"===(null==e?void 0:e.password),j.isKeyLogin="yes"===(null==e?void 0:e.pubkey)},{immediate:!0}),(e,a)=>{const l=h,s=g,t=X,o=w,d=S,p=H,b=C,V=Y;return n(),r("div",null,[i(d,{ref:"sshFormRef",model:m(j),onSubmit:a[4]||(a[4]=_(()=>{},["prevent"]))},{default:u(()=>[i(s,{label:"SSH密码登录"},{default:u(()=>[c("div",de,[i(l,{size:"small",modelValue:m(j).isPwdLogin,"onUpdate:modelValue":a[0]||(a[0]=e=>m(j).isPwdLogin=e),width:36,onChange:P},null,8,["modelValue"]),i(s,{label:"SSH密钥登录",class:"ml-[2rem]"},{default:u(()=>[c("div",me,[i(l,{size:"small",modelValue:m(j).isKeyLogin,"onUpdate:modelValue":a[1]||(a[1]=e=>m(j).isKeyLogin=e),width:36,onChange:K},null,8,["modelValue"])])]),_:1})])]),_:1}),i(s,{label:"SSH端口"},{default:u(()=>[c("div",pe,[i(t,{modelValue:m(f).port,"onUpdate:modelValue":a[2]||(a[2]=e=>m(f).port=e),width:"20rem",class:"!max-w-[20rem]",placeholder:"请输入SSH端口"},null,8,["modelValue"]),i(o,{type:"primary",class:"!ml-4",onClick:a[3]||(a[3]=e=>(async()=>{Z(f.value.port)?(await E({loading:"正在保存SSH端口，请稍后...",request:A(Number(f.value.port)),message:!0}),y("refresh")):O.error("端口格式错误，可用范围：1-65535")})())},{default:u(()=>[...a[8]||(a[8]=[v("保存",-1)])]),_:1}),a[9]||(a[9]=c("span",{class:"text-[#999] ml-4 text-[1.2rem]"},"当前SSH协议所使用的的端口，默认为22",-1))])]),_:1})]),_:1},8,["model"]),i(V,{title:"开启SSH密钥登录",modelValue:m(x),"onUpdate:modelValue":a[7]||(a[7]=e=>k(x)?x.value=e:null),area:40,onConfirm:q,showFooter:""},{default:u(()=>[c("div",ce,[i(d,{"label-position":"right",model:m(L)},{default:u(()=>[i(s,{label:"SSH密码登录"},{default:u(()=>[i(b,{modelValue:m(L).ssh,"onUpdate:modelValue":a[5]||(a[5]=e=>m(L).ssh=e),class:"!w-[20rem]"},{default:u(()=>[i(p,{label:"开启",value:"yes"}),i(p,{label:"关闭",value:"no"})]),_:1},8,["modelValue"])]),_:1}),i(s,{label:"密钥加密方式"},{default:u(()=>[i(b,{modelValue:m(L).type,"onUpdate:modelValue":a[6]||(a[6]=e=>m(L).type=e),class:"!w-[20rem]"},{default:u(()=>[i(p,{label:"ED25519(推荐)",value:"ed25519"}),i(p,{label:"ECDSA",value:"ecdsa"}),i(p,{label:"RSA",value:"rsa"}),i(p,{label:"DSA",value:"dsa"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f92ed601"]]),fe={class:"px-2rem"},ve=e({__name:"index",setup(e){const a=l(),s=l(!0),u=async()=>{const e=await E({loading:s,request:D()});a.value=e.data};return t(()=>{u()}),(e,l)=>{const t=j,p=o("bt-loading");return d((n(),r("div",fe,[i(ye,{data:m(a),onRefresh:u},null,8,["data"]),i(t,{class:"!mt-0"}),i(ue,{data:m(a),onRefresh:u},null,8,["data"]),i(t,{class:"!mt-0"}),i(ne,{data:m(a),onRefresh:u},null,8,["data"])])),[[p,m(s)],[p,"正在获取配置信息,请稍后...","title"]])}}});export{ve as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
