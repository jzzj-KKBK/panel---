import{G as e,o as a,v as l,k as t,W as s,e as n}from"./utils-lib.js?v=1756369731";import{c as i,ay as o,bI as u,r as d,k as r,g as m,e as c,b6 as v,a5 as p,aG as b,p as f,a4 as g,G as x,q as h,v as k,x as y,M as w,A as _,B as C,z as V,y as z,C as D,Q as j,H as N,F as S,a_ as U,J as K,N as A,P as L,bN as T,bM as q,T as H,ax as M,bv as F,bw as B,aQ as G}from"./base-lib.js?v=1756369731";import{b as R,k as Y,h as I}from"./form-item.js?v=1756369731";import{a as P,c as J,b as Q,i as W,e as E,f as $,g as O,h as X,w as Z,j as ee,$ as ae,k as le,t as te,l as se,s as ne,m as ie,n as oe,q as ue,r as de,u as re,v as me,x as ce,y as ve,z as pe,A as be,B as fe,C as ge,D as xe,E as he,F as ke,G as ye,H as we,I as _e,J as Ce,K as Ve}from"./useMethod3.js?v=1756369731";import{d as ze}from"./useMethod2.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./config.js?v=1756369731";import"./validator.js?v=1756369731";import"./column.js?v=1756369731";const De={class:"p-2rem"},je={key:0},Ne={key:1,class:"w-[80rem] mb-[1.2rem]"},Se=["title"],Ue={key:0,class:"text-[1.2rem] text-[#666] min-w-[8rem] text-right mr-[2rem]"},Ke={class:"flex items-center"},Ae={key:1,class:"text-[#666] text-[1.2rem]"},Le={key:2,class:"svgtofont-el-loading text-[#666] text-[1.2rem] animate-spin ml-[0.4rem]"},Te={class:"flex items-center"},qe={key:1,class:"text-[#666] text-[1.2rem]"},He={key:2,class:"svgtofont-el-loading text-[#666] text-[1.2rem] animate-spin ml-[0.4rem]"},Me={class:"flex items-center"},Fe={key:1,class:"text-[#666] text-[1.2rem] ml-[0.4rem]"},Be={key:2,class:"svgtofont-el-loading text-[#666] text-[1.2rem] animate-spin ml-[0.4rem]"},Ge={class:"flex items-center"},Re={key:1,class:"text-[#666] text-[1.2rem] ml-[0.4rem]"},Ye={key:2,class:"svgtofont-el-loading text-[#666] text-[1.2rem] animate-spin ml-[0.4rem]"},Ie={class:"flex items-center"},Pe={class:"font-bold"},Je={key:2,class:"text-[#666] text-[1.2rem] ml-[0.4rem]"},Qe={key:3,class:"svgtofont-el-loading text-[#666] text-[1.2rem] animate-spin ml-[0.4rem]"},We={key:0,class:"w-full max-h-[96px] overflow-y-auto border-css"},Ee={class:"w-[33.33%] inline-flex items-center px-[0.8rem]"},$e={class:"check-name"},Oe={key:0},Xe={key:1,class:"empty-box"},Ze={class:"flex items-center"},ea={key:1,class:"text-[#666] text-[1.2rem] ml-[0.4rem]"},aa={key:2,class:"svgtofont-el-loading text-[#666] text-[1.2rem] animate-spin ml-[0.4rem]"},la={class:"flex items-center"},ta={key:1,class:"text-[#666] text-[1.2rem] ml-[0.4rem]"},sa={key:2,class:"svgtofont-el-loading text-[#666] text-[1.2rem] animate-spin ml-[0.4rem]"},na={key:1,class:"w-[80rem] mt-12px flex justify-end flex-col items-end"},ia={class:"list-disc text-[#777]"},oa={class:"flex items-center"},ua={key:1},da={key:2,class:"text-[#ef0808] inline-block !mb-[2rem] !ml-[3rem]"},ra=n(i({__name:"index",props:{data:{default:()=>({})},compData:{default:()=>({})}},setup(n,{expose:i}){const ra=o("confirmBtn"),ma=o("buttonText"),ca=o("popupClose"),va=n,pa=u("siteTableRef"),ba=u("dbTableRef"),fa=d({site:!1,database:!1,wptools:!0,plugin:!0,runtime:!0,Ftp:!0,Crontab:!0,Vmail:!0,Terminal:!0,Firewall:!0,node:!0}),ga=r({site:!1,database:!1}),xa=m(()=>{var e,a,l,t;try{return 1.5*((fa.value.plugin?P.value.reduce((e,a)=>e+Number(a.size),0):0)+(fa.value.database?null==(a=null==(e=ba.value)?void 0:e.tableSelectList)?void 0:a.reduce((e,a)=>e+Number(a.size),0):0)+(fa.value.site?null==(t=null==(l=pa.value)?void 0:l.tableSelectList)?void 0:t.reduce((e,a)=>e+Number(a.size),0):0))}catch(s){return 0}}),{BtForm:ha,submit:ka}=e({data:()=>({name:J(),path:"local",exec_time:""}),options:e=>m(()=>[R("备份名称","name",{attrs:{class:"!w-[600px]",clearable:!0,placeholder:"请输入用户名",rules:[{required:!0,message:"请输入备份名称",trigger:"blur"}]}}),Y("存储位置","path",Q.value,{attrs:{class:"!w-[600px]",placeholder:"请选择存储位置",rules:[{required:!0,message:"请选择存储位置",trigger:"change"}]}}),I("执行时间",()=>c(v,{"disabled-date":e=>e.getTime()<Date.now()-864e5,class:"!w-[600px]",modelValue:e.value.exec_time,"onUpdate:modelValue":a=>e.value.exec_time=a,type:"datetime",placeholder:"为空则立即执行",format:"YYYY/MM/DD hh:mm:ss","value-format":"x"},null),"exec_time")]),submit:async(e,l,t)=>{var s,n;const i=p((null==(s=pa.value)?void 0:s.tableSelectList)||[]),o=p((null==(n=ba.value)?void 0:n.tableSelectList)||[]);if(W.value||va.compData.saveConfig||await l(),va.compData&&va.compData.saveConfig)return va.compData.saveConfig(e.value,fa.value,i,o),void ca();return await a({title:"确认"+(W.value?"还原":"备份"),content:W.value?'<span class="text-[#666]">还原将覆盖现有数据，是否继续操作？</span><br /><span class="text-[#ef0808]">在还原数据库备份时，网站将不可访问</span>':'<span class="text-[#ef0808] text-[1.4rem]">在备份时，对应网站将不可访问，是否继续操作？</span>',type:"calc",isHtml:!0}),ca(),await E(e.value,fa.value,i,o)}});b(()=>{var e,a;X.value?xa.value<$.current?(ra.disabled=!1,ma.value=(null==(e=va.compData)?void 0:e.saveConfig)?"保存":"备份"):xa.value>=$.current&&(ra.disabled=!0,0===xa.value&&0===$.current||(ma.value="磁盘空间不足")):$.size<$.current?(ra.disabled=!1,ma.value=W.value?"还原":(null==(a=va.compData)?void 0:a.saveConfig)?"保存":"备份"):$.size>=$.current&&(ra.disabled=!0,0===$.size&&0===$.current||(ma.value="磁盘空间不足"))});const ya=(e,a)=>{var l,t,s,n;if(fa.value[a]=e,e)switch(a){case"site":null==(l=pa.value)||l.handleAllChange(e),ga.site=!1;break;case"database":null==(t=ba.value)||t.handleAllChange(e),ga.database=!1}else switch(a){case"site":null==(s=pa.value)||s.clearAllSelect(),ga.site=!1;break;case"database":null==(n=ba.value)||n.clearAllSelect(),ga.database=!1}},wa=e=>{var a,l;switch(e){case"site":if(0===Z.value.length)return fa.value.site=!1,void(ga.site=!1);const e=null==(a=pa.value)?void 0:a.tableSelectNumber;e===Z.value.length?(fa.value.site=!0,ga.site=!1):0===e?(fa.value.site=!1,ga.site=!1):(fa.value.site=!1,ga.site=!0);break;case"database":if(0===ee.value.length)return fa.value.database=!1,void(ga.database=!1);const t=null==(l=ba.value)?void 0:l.tableSelectNumber;t===ee.value.length?(fa.value.database=!0,ga.database=!1):0===t?(fa.value.database=!1,ga.database=!1):(fa.value.database=!1,ga.database=!0)}};return f(async()=>{var e,a,l,t;ma.value="正在获取数据中...",ra.disabled=!0,$.size=0,$.current=0,await O(va.data||{}),$.size<$.current?(ra.disabled=!1,ma.value=W.value?"还原":(null==(e=va.compData)?void 0:e.saveConfig)?"保存":"备份"):(ra.disabled=!0,ma.value=W.value?"还原":(null==(a=va.compData)?void 0:a.saveConfig)?"保存":"备份"),X.value&&(Z.value.length>0&&(fa.value.site=!0,null==(l=pa.value)||l.handleAllChange(!0)),ee.value.length>0&&(fa.value.database=!0,null==(t=ba.value)||t.handleAllChange(!0)))}),g(ae),i({onConfirm:ka,init:async()=>{await O()}}),(e,a)=>{const n=T,i=q,o=H,u=M,d=t,r=F,m=B,v=G,p=s,b=x("bt-loading");return h(),k("div",De,[y(le)||va.compData.saveConfig?D("",!0):(h(),k("div",je,[y(X)?(h(),w(y(ha),{key:0})):y(W)?(h(),k("div",Ne,[c(i,{class:"margin-top table-descriptions",title:"还原详情",column:2,size:"small",border:""},{default:_(()=>[c(n,null,{label:_(()=>[...a[21]||(a[21]=[C(" 名称 ",-1)])]),default:_(()=>[C(V(y(ze).backup_name),1)]),_:1}),c(n,null,{label:_(()=>[...a[22]||(a[22]=[C(" 创建时间 ",-1)])]),default:_(()=>[C(V(y(ze).create_time),1)]),_:1}),c(n,null,{label:_(()=>[...a[23]||(a[23]=[C(" 备份大小 ",-1)])]),default:_(()=>[C(V(y(l)(Number(y(ze).backup_file_size))),1)]),_:1}),c(n,null,{label:_(()=>[...a[24]||(a[24]=[C("存储位置 ",-1)])]),default:_(()=>[C(V(y(ze).backup_path),1)]),_:1}),c(n,null,{label:_(()=>[...a[25]||(a[25]=[C("SHA-256 ",-1)])]),default:_(()=>[z("span",{title:y(ze).backup_file_sha256},V(y(ze).backup_file_sha256),9,Se)]),_:1})]),_:1})])):D("",!0)])),z("div",{class:K("flex flex-row w-[".concat(y(W)?80:70,"rem]"))},[y(W)||y(le)?D("",!0):(h(),k("span",Ue,"备份数据")),c(m,{modelValue:y(ye),"onUpdate:modelValue":a[17]||(a[17]=e=>L(ye)?ye.value=e:null),class:"flex-1",accordion:""},{default:_(()=>{var e,t,s,n,i,m;return[(null==(e=y(Z))?void 0:e.length)||y(X)?(h(),w(r,{key:0,name:"site"},{title:_(()=>{var e;return[z("div",Ke,[y(X)?(h(),w(o,{key:0,modelValue:y(fa).site,"onUpdate:modelValue":a[0]||(a[0]=e=>y(fa).site=e),class:"!mr-[0.4rem]",indeterminate:y(ga).site,disabled:y(te).site,onChange:a[1]||(a[1]=e=>ya(e,"site")),onClick:a[2]||(a[2]=j(()=>{},["stop"]))},null,8,["modelValue","indeterminate","disabled"])):D("",!0),a[27]||(a[27]=z("i",{class:"svgtofont-left-home desc-i"},null,-1)),a[28]||(a[28]=z("span",{class:"font-bold"},"网站",-1)),c(u,{trigger:"hover",placement:"top-start",width:"400",content:"备份网站是会自动备份Nginx配置，SSL证书，PHP配置，重定向和反向代理等除插件外与该网站相关的配置"},{reference:_(()=>[...a[26]||(a[26]=[z("i",{class:"svgtofont-el-question-filled text-warning text-[1.4rem] mx-[0.4rem]"},null,-1)])]),_:1}),y(te).site?(h(),k("i",Le)):(h(),k("span",Ae,"(共"+V((null==(e=y(Z))?void 0:e.length)||0)+"个，共"+V(y(se))+")",1))])]}),default:_(()=>[N(c(d,{ref_key:"siteTableRef",ref:pa,column:y(ne),data:y(Z),"max-height":200,onSelectionChange:a[3]||(a[3]=e=>wa("site"))},null,8,["column","data"]),[[b,y(te).site],[b,"正在获取网站中，请稍后...","title"]])]),_:1})):D("",!0),(null==(t=y(ee))?void 0:t.length)||!y(W)?(h(),w(r,{key:1,name:"database"},{title:_(()=>{var e;return[z("div",Te,[y(X)?(h(),w(o,{key:0,modelValue:y(fa).database,"onUpdate:modelValue":a[4]||(a[4]=e=>y(fa).database=e),class:"!mr-[0.4rem]",disabled:y(te).database,indeterminate:y(ga).database,onChange:a[5]||(a[5]=e=>ya(e,"database")),onClick:a[6]||(a[6]=j(()=>{},["stop"]))},null,8,["modelValue","disabled","indeterminate"])):D("",!0),a[29]||(a[29]=z("i",{class:"svgtofont-left-database desc-i"},null,-1)),a[30]||(a[30]=z("span",{class:"font-bold"},"数据库",-1)),y(te).database?(h(),k("i",He)):(h(),k("span",qe,"(共"+V((null==(e=y(ee))?void 0:e.length)||0)+"个，共"+V(y(ie))+")",1))])]}),default:_(()=>[N(c(d,{ref_key:"dbTableRef",ref:ba,column:y(oe),data:y(ee),"max-height":200,onSelectionChange:a[7]||(a[7]=e=>wa("database"))},null,8,["column","data"]),[[b,y(te).database],[b,"正在获取数据库中，请稍后...","title"]])]),_:1})):D("",!0),!(null==(s=y(ue))?void 0:s.length)&&y(W)||y(le)?D("",!0):(h(),w(r,{key:2,name:"wptools"},{title:_(()=>{var e;return[z("div",Me,[y(X)?(h(),w(o,{key:0,modelValue:y(fa).wptools,"onUpdate:modelValue":a[8]||(a[8]=e=>y(fa).wptools=e),class:"!mr-[0.4rem]",disabled:y(te).wptools,onClick:a[9]||(a[9]=j(()=>{},["stop"]))},null,8,["modelValue","disabled"])):D("",!0),a[31]||(a[31]=z("i",{class:"svgtofont-left-wp desc-i"},null,-1)),a[32]||(a[32]=z("span",{class:"font-bold"},"Wp Tools",-1)),y(te).wptools?(h(),k("i",Be)):(h(),k("span",Fe,"(共"+V((null==(e=y(ue))?void 0:e.length)||0)+"个，共"+V(y(de))+")",1))])]}),default:_(()=>[N(c(d,{column:y(re),data:y(ue),"max-height":150},null,8,["column","data"]),[[b,y(te).wptools],[b,"正在获取网站中，请稍后...","title"]])]),_:1})),(null==(n=y(me))?void 0:n.length)||!y(W)?(h(),w(r,{key:3,name:"node"},{title:_(()=>{var e;return[z("div",Ge,[y(X)?(h(),w(o,{key:0,modelValue:y(fa).node,"onUpdate:modelValue":a[10]||(a[10]=e=>y(fa).node=e),class:"!mr-[0.4rem]",disabled:y(te).node,onClick:a[11]||(a[11]=j(()=>{},["stop"]))},null,8,["modelValue","disabled"])):D("",!0),a[33]||(a[33]=z("i",{class:"svgtofont-left-node desc-i"},null,-1)),a[34]||(a[34]=z("span",{class:"font-bold"},"多机节点",-1)),y(te).node?(h(),k("i",Ye)):(h(),k("span",Re,"(共"+V((null==(e=y(me))?void 0:e.length)||0)+"个)",1))])]}),default:_(()=>[N(c(d,{column:y(ce),data:y(me),"max-height":150},null,8,["column","data"]),[[b,y(te).node],[b,"正在获取多机节点中，请稍后...","title"]])]),_:1})):D("",!0),(h(!0),k(S,null,U(y(ve),(e,t)=>{var s;return h(),k(S,{key:t},[(null==(s=y(pe)[e.dataKey])?void 0:s.length)||!y(W)?(h(),w(r,{key:0,name:t.toLowerCase()},{title:_(()=>{var l;return[z("div",Ie,[y(X)?(h(),w(o,{key:0,modelValue:y(fa)[t],"onUpdate:modelValue":e=>y(fa)[t]=e,class:"!mr-[0.4rem]",disabled:y(te)[e.loadingKey.toLowerCase()],onClick:a[12]||(a[12]=j(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","disabled"])):D("",!0),z("i",{class:K("svgtofont-left-".concat(e.icon," desc-i"))},null,2),z("span",Pe,V(e.title),1),e.tooltip?(h(),w(u,{key:1,trigger:"hover",placement:"top-start",width:"400",content:e.tooltip},{reference:_(()=>[...a[35]||(a[35]=[z("i",{class:"svgtofont-el-question-filled text-warning text-[1.4rem] ml-[0.4rem]"},null,-1)])]),_:2},1032,["content"])):D("",!0),y(te)[e.loadingKey.toLowerCase()]?(h(),k("i",Qe)):(h(),k("span",Je,"(共"+V((null==(l=y(pe)[e.dataKey])?void 0:l.length)||0)+"个"+V(e.count?"，共"+y(be)(e.dataKey):"")+")",1)),e.extraComponent?(h(),w(A(e.extraComponent),{key:4})):D("",!0)])]}),default:_(()=>{var a;return[N((h(),k("div",null,[(null==(a=y(pe)[e.dataKey])?void 0:a.length)||y(X)?(h(),k("div",We,[(h(!0),k(S,null,U(y(pe)[e.dataKey],(a,t)=>(h(),k(S,{key:t},[z("span",Ee,[z("span",$e,V(a.name)+V(a.size?"(".concat(y(l)(Number(a.size)),")"):"")+" "+V(a.total?"(".concat(a.total,"条)"):""),1)]),t+1!==0&&(t+1)%3==0&&t+1!==y(pe)[e.dataKey].length?(h(),k("hr",Oe)):D("",!0)],64))),128))])):(h(),k("div",Xe,"暂无数据"))])),[[b,y(te)[e.loadingKey.toLowerCase()]],[b,"正在获取".concat(e.title,"中，请稍后..."),"title"]])]}),_:2},1032,["name"])):D("",!0)],64)}),128)),(null==(i=y(P))?void 0:i.length)||!y(W)?(h(),w(r,{key:4,name:"plugin"},{title:_(()=>{var e;return[z("div",Ze,[y(X)?(h(),w(o,{key:0,modelValue:y(fa).plugin,"onUpdate:modelValue":a[13]||(a[13]=e=>y(fa).plugin=e),class:"!mr-[0.4rem]",disabled:y(te).plugin,onClick:a[14]||(a[14]=j(()=>{},["stop"]))},null,8,["modelValue","disabled"])):D("",!0),a[36]||(a[36]=z("i",{class:"svgtofont-left-soft desc-i"},null,-1)),a[37]||(a[37]=z("span",{class:"font-bold"},"插件",-1)),y(te).plugin?(h(),k("i",aa)):(h(),k("span",ea,"(共"+V((null==(e=y(P))?void 0:e.length)||0)+"个,共"+V(y(fe))+")",1))])]}),default:_(()=>[N(c(d,{column:y(ge),data:y(P),"max-height":160},null,8,["column","data"]),[[b,y(te).plugin],[b,"正在获取插件中，请稍后...","title"]])]),_:1})):D("",!0),(null==(m=y(xe))?void 0:m.length)||!y(W)?(h(),w(r,{key:5,name:"runtime"},{title:_(()=>{var e;return[z("div",la,[y(X)?(h(),w(o,{key:0,modelValue:y(fa).runtime,"onUpdate:modelValue":a[15]||(a[15]=e=>y(fa).runtime=e),class:"!mr-[0.4rem]",disabled:y(te).runtime,onClick:a[16]||(a[16]=j(()=>{},["stop"]))},null,8,["modelValue","disabled"])):D("",!0),a[38]||(a[38]=z("i",{class:"svgtofont-el-monitor desc-i"},null,-1)),a[39]||(a[39]=z("span",{class:"font-bold"},"运行环境",-1)),y(te).runtime?(h(),k("i",sa)):(h(),k("span",ta,"(共"+V((null==(e=y(xe))?void 0:e.length)||0)+"个，共"+V(y(he))+")",1))])]}),default:_(()=>[N(c(d,{column:y(ke),data:y(xe),"max-height":160},null,8,["column","data"]),[[b,y(te).runtime],[b,"正在获取运行环境中，请稍后...","title"]])]),_:1})):D("",!0)]}),_:1},8,["modelValue"])],2),y(le)?D("",!0):(h(),k("div",na,[c(o,{modelValue:y(we),"onUpdate:modelValue":a[18]||(a[18]=e=>L(we)?we.value=e:null),class:"!mr-0"},{default:_(()=>[...a[40]||(a[40]=[C("出现失败后自动停止操作",-1)])]),_:1},8,["modelValue"]),y(W)?(h(),w(o,{key:0,modelValue:y(_e),"onUpdate:modelValue":a[19]||(a[19]=e=>L(_e)?_e.value=e:null)},{default:_(()=>[...a[41]||(a[41]=[C("存在同名时是否覆盖还原",-1)])]),_:1},8,["modelValue"])):D("",!0)])),z("div",{class:K(["flex items-center",{"mt-[2rem]":y(W),"ml-[3rem]":!0}])},[z("ul",ia,[y(le)?D("",!0):(h(),k("li",{key:0,class:K({"text-[#ef0808]":y($).size>=y($).current})},[z("div",oa,[c(v,{class:"item",effect:"dark",placement:"top-start"},{content:_(()=>[C(" 推断所需迁移空间:"+V(y(l)(Number(y(X)?y(xa):y($).size)))+" ",1),a[42]||(a[42]=z("br",null,null,-1)),a[43]||(a[43]=C(" 说明:因数据备份需要复制后压缩，会比实际占用更多的空间，因此推断大小为迁移数据大小的1.5倍 ",-1))]),default:_(()=>[a[44]||(a[44]=z("i",{class:"svgtofont-el-warning-filled text-warning text-[1.4rem] mr-[0.4rem]"},null,-1))]),_:1}),C(" 预计需要空间："+V(y(l)(Number(y(X)?y(xa):y($).size)))+" 当前磁盘剩余空间:"+V(y(l)(Number(y($).current))),1)])],2)),y(le)?(h(),k("li",ua,"wp tools站点将在网站中显示")):D("",!0)]),y(le)?D("",!0):(h(),k("i",{key:0,class:K(["mt-2px ml-4px cursor-pointer",{"animate-spin cursor-not-allowed svgtofont-el-loading text-[#666]":y(Ce),"svgtofont-el-refresh text-primary":!y(Ce)}]),onClick:a[20]||(a[20]=e=>y(Ve)(y(ra)))},null,2))],2),y(W)?(h(),k("p",da,"提示：若遇到还原失败会自动恢复到还原前")):D("",!0),y(X)&&!va.compData.saveConfig?(h(),w(p,{key:3,options:[{content:"出现备份失败后自动停止备份,节点管理仅备份面板节点配置信息，备份wp_tools请在网站勾选wp站点"}],class:"ml-[3rem]"})):D("",!0)])}}}),[["__scopeId","data-v-ddab0bcc"]]);export{ra as default};
