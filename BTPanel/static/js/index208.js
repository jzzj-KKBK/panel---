import{c as e,k as a,r as l,e as t,B as s,F as o,p as n,q as u,v as d,A as r,x as p,P as i,H as c,y as m,a_ as v,z as _,C as w,M as f,ax as b,a9 as h,ai as y,aj as g,a7 as x,bx as V,ay as k,w as j,J as U,I as q,aB as P,aW as S}from"./base-lib.js?v=1756369731";import{u as C,aq as D,bv as I,bU as L,o as H,K as F,j as M,c as T,W as N,e as O,b as R,l as z,L as Q,at as E,h as J,d as $,a2 as A}from"./utils-lib.js?v=1756369731";import{checkAutoInstall as W,createAsync as B,getSwooleCorrespondencePhp as Y,getSystemUserListAsync as K,GetPHPVersion as G,checkInstallAsync as X,addPhpSite as Z,setDeploymentInfo as ee,getDeploymentList as ae,getPluginInfo as le,createWebsiteMultiple as te,getIgnoreAd as se,getFtpMysqlStatus as oe,ignoreAd as ne}from"./site.js?v=1756369731";import{u as ue}from"./hooks.js?v=1756369731";import de from"./index356.js?v=1756369731";import{_ as re}from"./index101.js?v=1756369731";import{k as pe,f as ie,l as ce}from"./validator.js?v=1756369731";import{u as me}from"./useStore4.js?v=1756369731";import{v as ve}from"./useController5.js?v=1756369731";import{o as _e}from"./useController6.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./useMethod5.js?v=1756369731";const we={class:"flex"},fe={class:"flex items-center h-3.2rem"},be=["onClick"],he={key:0,class:"text-[1.2rem] ml-[8px] flex items-center"},ye={key:1,class:"text-[1.2rem] ml-[8px] flex items-center"},ge={class:"flex items-center"},xe={class:"flex items-center mb-[4px]"},Ve=O(e({__name:"index",props:{compData:{default:{}}},setup(e,{expose:k}){const j=e,{panel:U}=C(),{isRefreshList:q}=me(),P=a({database:!1}),S=l(),O=l(!1),R=l({site_path:"/www/wwwroot",project_cmd:"",install_dependence:0,php_version:"",swoole_version:4,domains:"",sql:!1,project_ps:"",project_port:"",codeing:"utf8mb4",open_proxy:!1,project_proxy_path:"",datauser:"",datapassword:"",run_user:"www",composer_version:""}),z=l(!1),Q=l([]),E=l([]);l({});const J=l(!1),$=l({});let A="/www/wwwroot/";const G=[{content:"当前仅支持nginx服务器使用"},{content:"【swoole版本】开启自动安装依赖时会给对应版本的php安装swoole"},{content:t(o,null,[s("【自动安装项目依赖】只尝试"),t("span",{class:"text-danger"},[s("composer install")]),s("进行安装依赖，最终安装结果请前往 项目-日志-安装依赖日志 进行确认，若安装依赖不成功，项目会"),t("span",{class:"text-danger"},[s("启动失败")])])},{content:"安装依赖不成功，可能和composer版本有关，可尝试切换composer版本"}],X=async e=>{const a="mysql"===e?e:"php-"+(Number(e)/10).toFixed(1),{data:l}=await D({sName:a});pe({name:l.name,type:"i",pluginInfo:l})},Z=()=>{ie({type:"dir",path:R.value.site_path.replace(/\/$/,""),change:e=>{I(e,"string",""),R.value.site_path=e,J.value=!0,ee()}})},ee=async()=>{try{const e=await W({path:R.value.site_path});R.value.composer_version=e.data?"2.7.3":"",R.value.install_dependence=e.data?1:0}catch(e){}},ae=async()=>{try{const e="php-"+(Number(R.value.php_version)/10).toFixed(1);e&&ce({name:e})}catch(e){}},le=async e=>{var a;R.value.php_version=e,$.value=null!=(a=Q.value.find(a=>a.php_version===e))?a:{}},te=e=>{var a,l,t,s;"string"==typeof e&&(R.value.site_path&&R.value.site_path!==A.replace(/\/$/,"")||(J.value=!1),J.value||(R.value.site_path=(null==A?void 0:A.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim())),R.value.datauser=null==(s=null==(t=e.split("\n")[0])?void 0:t.replace(/\W/g,"_"))?void 0:s.substr(0,16),R.value.datapassword=L(16),R.value.project_ps=e.split("\n")[0])},se=e=>{R.value.composer_version=e,R.value.install_dependence=e?1:0},oe=async e=>{R.value.swoole_version=e,await ne()},ne=async()=>{var e,a,l;try{const t=await Y({swoole_version:R.value.swoole_version});if(t.status){Q.value=t.data;const s=null==(e=Q.value)?void 0:e.filter(e=>e.setup_status);R.value.php_version=null==(a=s[0])?void 0:a.php_version,$.value=null!=(l=s[0])?l:{}}}catch(t){}},ue=async()=>{var e;const a=await j.compData.getStatus();P.database=a.mysql;const l=U.value.sitePath;l&&(R.value.site_path=l,A=null==(e=l+"/")?void 0:e.replace(/\/\//g,"/")),ne(),(async()=>{try{const e=await K();E.value=e.data}catch(e){}})()};return n(ue),k({init:ue,onConfirm:async e=>{var a;await S.value.validate(),(null==(a=$.value)?void 0:a.swoole_status)||await H({width:50,title:"提示",isHtml:!0,content:"当前版本PHP-安装扩展未安装swoole，可能导致项目无法启动，是否继续操作？",icon:"warning-filled"});const l=(e=>{var a;let l={...e,sql_user:e.datauser,sql_pwd:e.datapassword,sql_codeing:e.codeing,install_dependence:e.install_dependence,open_proxy:e.open_proxy?1:0,webname:{domain:"",domainlist:[],count:0}},t=null==(a=e.domains)?void 0:a.split("\n");return t.forEach((e,a)=>{0===a?l.webname.domain=e:l.webname.domainlist.push(t[a])}),l.webname.count=l.webname.domainlist.length,l.webname=JSON.stringify(l.webname),delete l.domains,delete l.datauser,delete l.datapassword,delete l.codeing,l})(R.value),t=await F({request:B(l),message:!0});(null==t?void 0:t.status)&&(q.value=!0,e())}}),(e,a)=>{const l=M,n=b,k=h,j=re,U=y,q=g,C=T,D=x,I=N,L=V;return u(),d("div",null,[t(D,{ref_key:"addSwooleSiteFormRef",ref:S,disabled:p(O),model:p(R),rules:p(ve)},{default:r(()=>[t(k,{label:"绑定域名",prop:"domains"},{default:r(()=>[t(n,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:p(z),"onUpdate:visible":a[2]||(a[2]=e=>i(z)?z.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:r(()=>[c(t(l,{onInput:te,modelValue:p(R).domains,"onUpdate:modelValue":a[0]||(a[0]=e=>p(R).domains=e),type:"textarea",width:"52rem",rows:4,resize:"none",onFocus:a[1]||(a[1]=e=>z.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"]),[[L,void 0,"popover"]])]),default:r(()=>[a[16]||(a[16]=m("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[s(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),m("br"),s(" IP地址格式：192.168.1.199 "),m("br"),s(" 泛解析添加方法 *.domain.com "),m("br"),s(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1}),t(k,{label:"项目目录",prop:"site_path"},{default:r(()=>[t(j,{modelValue:p(R).site_path,"onUpdate:modelValue":a[3]||(a[3]=e=>p(R).site_path=e),placeholder:"请输入项目目录",icon:"el-folder-opened",width:"52rem",onFocus:a[4]||(a[4]=e=>J.value=!0),onBlur:ee,onIconClick:Z},null,8,["modelValue"])]),_:1}),t(k,{label:"swoole版本"},{default:r(()=>[m("div",we,[m("div",null,[t(q,{modelValue:p(R).swoole_version,"onUpdate:modelValue":a[5]||(a[5]=e=>p(R).swoole_version=e),class:"!w-[8rem]",onChange:oe},{default:r(()=>[t(U,{label:"2.x",value:2}),t(U,{label:"4.x",value:4}),t(U,{label:"5.x",value:5})]),_:1},8,["modelValue"])]),t(k,{label:"PHP版本",prop:"php_version"},{default:r(()=>{var e,l,n;return[m("div",fe,[t(q,{modelValue:p(R).php_version,"onUpdate:modelValue":a[6]||(a[6]=e=>p(R).php_version=e),placeholder:"请选择PHP版本",class:"!w-[14rem]",onChange:le},{default:r(()=>[(u(!0),d(o,null,v(p(Q),(e,l)=>(u(),f(U,{key:l,disabled:!e.setup_status,label:"PHP-".concat(e.php_version),value:e.php_version},{default:r(()=>[m("span",null,"PHP-"+_(e.php_version),1),e.setup_status?w("",!0):(u(),d(o,{key:0},[a[17]||(a[17]=s(" [ ",-1)),m("span",{class:"mx-[4px] bt-link",onClick:a=>X(e.php_version)},"未安装",8,be),a[18]||(a[18]=s(" ] ",-1))],64))]),_:2},1032,["disabled","label","value"]))),128))]),_:1},8,["modelValue"]),p(R).php_version?(u(),d(o,{key:0},[(null==(e=p($))?void 0:e.swoole_status)?!(null==(l=p($))?void 0:l.setup_swoole_isactive)&&(null==(n=p($))?void 0:n.swoole_version)?(u(),d("span",ye,[s(" 当前php未安装swoole"+_(p(R).swoole_version)+"扩展 ",1),t(C,{class:"ml-[4px]",onClick:ae},{default:r(()=>[...a[21]||(a[21]=[s(">>立即安装",-1)])]),_:1})])):w("",!0):(u(),d("span",he,[a[20]||(a[20]=s(" 当前php未安装swoole扩展 ",-1)),t(C,{class:"ml-[4px]",onClick:ae},{default:r(()=>[...a[19]||(a[19]=[s(">>立即安装",-1)])]),_:1})]))],64)):w("",!0)])]}),_:1})])]),_:1}),t(k,{label:"数据库"},{default:r(()=>[m("div",ge,[t(q,{class:"!w-[16rem]",modelValue:p(R).sql,"onUpdate:modelValue":a[7]||(a[7]=e=>p(R).sql=e),disabled:!p(P).database},{default:r(()=>[t(U,{label:"不创建",value:!1}),t(U,{label:"MySQL",value:"MYSQL"})]),_:1},8,["modelValue","disabled"]),p(P).database?w("",!0):(u(),d("span",{key:0,onClick:a[8]||(a[8]=e=>X("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装数据库，点击安装")),p(R).sql?(u(),f(q,{key:1,class:"!w-[16rem] ml-[8px]",modelValue:p(R).codeing,"onUpdate:modelValue":a[9]||(a[9]=e=>p(R).codeing=e)},{default:r(()=>[t(U,{label:"utf8mb4",value:"utf8mb4"}),t(U,{label:"utf8",value:"utf8"}),t(U,{label:"gbk",value:"gbk"}),t(U,{label:"big5",value:"big5"})]),_:1},8,["modelValue"])):w("",!0)])]),_:1}),p(R).sql?(u(),f(k,{key:0,label:"数据库账号"},{default:r(()=>[m("div",xe,[t(k,{prop:"datauser"},{default:r(()=>[t(l,{placeholder:"创建数据库账号",class:"w-[24rem]",modelValue:p(R).datauser,"onUpdate:modelValue":a[10]||(a[10]=e=>p(R).datauser=e)},null,8,["modelValue"])]),_:1}),t(k,{label:"密码",class:"!mt-0"},{default:r(()=>[t(l,{placeholder:"数据库密码",class:"w-[24rem]",modelValue:p(R).datapassword,"onUpdate:modelValue":a[11]||(a[11]=e=>p(R).datapassword=e)},null,8,["modelValue"])]),_:1})]),a[22]||(a[22]=m("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))]),_:1})):w("",!0),t(k,{label:"运行用户"},{default:r(()=>[t(q,{class:"!w-[16rem]",modelValue:p(R).run_user,"onUpdate:modelValue":a[12]||(a[12]=e=>p(R).run_user=e)},{default:r(()=>[(u(!0),d(o,null,v(p(E),e=>(u(),f(U,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a[23]||(a[23]=m("span",{class:"text-[#999] text-[1.2rem] ml-[.4rem]"},"* 无特殊需求请选择www用户",-1))]),_:1}),t(k,{label:"启动命令",prop:"project_cmd"},{default:r(()=>[t(l,{modelValue:p(R).project_cmd,"onUpdate:modelValue":a[13]||(a[13]=e=>p(R).project_cmd=e),width:"52rem",placeholder:"请输入项目的启动命令，例：php serve.php"},null,8,["modelValue"])]),_:1}),t(k,{label:"依赖安装"},{default:r(()=>[t(q,{class:"!w-[16rem]",modelValue:p(R).composer_version,"onUpdate:modelValue":a[14]||(a[14]=e=>p(R).composer_version=e),"empty-values":[null,void 0],onChange:se},{default:r(()=>[t(U,{label:"不安装",value:""}),t(U,{label:"用composer2.7.3安装",value:"2.7.3"}),t(U,{label:"用composer1.10.27安装",value:"1.10.27"})]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"备注"},{default:r(()=>[t(l,{modelValue:p(R).project_ps,"onUpdate:modelValue":a[15]||(a[15]=e=>p(R).project_ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])]),_:1})]),_:1},8,["disabled","model","rules"]),t(I,{class:"mt-2rem pl-1rem",options:G})])}}}),[["__scopeId","data-v-a5ad25fb"]]),ke={class:"flex"},je={class:"mr-2rem"},Ue={key:1,class:"!text-[1.2rem]"},qe={class:"flex items-center"},Pe={class:"flex items-center mb-[4px]"},Se=O(e({__name:"index",props:{compData:{default:{}}},setup(e,{expose:c}){const _=e,{panel:V}=C(),{isRefreshList:k}=me(),j=R(),U=a({database:!1}),q=l(),P=l(!1),S=l({site_path:"/www/wwwroot",project_cmd:"php think run",install_dependence:0,php_version:"",thinkphp_version:!0,domains:"",sql:!1,project_ps:"",project_port:"",codeing:"utf8mb4",open_proxy:!1,project_proxy_path:"",datauser:"",datapassword:"",run_user:"www",composer_version:""}),O=l(!1),z=l([]),Q=l([]),E=l({}),J=l(!1);let $="/www/wwwroot/";const A=[{content:"当前仅支持nginx服务器使用"},{content:"【fileinfo版本】若未安装，项目会启动失败"},{content:t(o,null,[s("【自动安装项目依赖】只尝试"),t("span",{class:"text-danger"},[s("composer install")]),s("进行安装依赖，最终安装结果请前往 项目-日志-安装依赖日志 进行确认，若安装依赖不成功，项目会"),t("span",{class:"text-danger"},[s("启动失败")])])},{content:"安装依赖不成功，可能和composer版本有关，可尝试切换composer版本"}],Y=()=>{ie({type:"dir",path:S.value.site_path.replace(/\/$/,""),change:e=>{I(e,"string",""),S.value.site_path=e,J.value=!0,Z()}})},Z=async()=>{try{const e=await W({path:S.value.site_path});S.value.composer_version=e.data?"2.7.3":"",S.value.install_dependence=e.data?1:0}catch(e){}},ee=async(e=!1)=>{try{let a;e&&(a=j.load("正在检查安装信息，请稍后..."));const l=await X({name:"fileinfo",php_version:S.value.php_version});e&&a.close(),E.value=l}catch(a){}},ae=async()=>{try{const e="php-"+(Number(S.value.php_version)/10).toFixed(1);ce({name:e})}catch(e){}},le=async e=>{S.value.php_version=e,ee(!0)},te=e=>{var a,l,t,s;"string"==typeof e&&(S.value.site_path&&S.value.site_path!==$.replace(/\/$/,"")||(J.value=!1),J.value||(S.value.site_path=(null==$?void 0:$.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim())),S.value.datauser=null==(s=null==(t=e.split("\n")[0])?void 0:t.replace(/\W/g,"_"))?void 0:s.substr(0,16),S.value.datapassword=L(16),S.value.project_ps=e.split("\n")[0])},se=async()=>{var e;const a=await _.compData.getStatus();U.database=a.mysql;const l=V.value.sitePath;l&&(S.value.site_path=l,$=null==(e=l+"/")?void 0:e.replace(/\/\//g,"/")),await(async()=>{var e;try{const a=await G();z.value=a.data.filter(e=>"纯静态"!==e.name),z.value=z.value.reverse(),S.value.php_version=(null==(e=z.value)?void 0:e.length)?z.value[0].version:""}catch(a){}})(),await ee(),(async()=>{try{const e=await K();Q.value=e.data}catch(e){}})()};return n(se),c({init:se,onConfirm:async e=>{await q.value.validate(),E.value.status||await H({width:50,title:"提示",isHtml:!0,content:"当前版本PHP-安装扩展未安装fileinfo，可能导致项目无法启动，是否继续操作？",icon:"warning-filled"});const a=(e=>{var a;let l={...e,sql_user:e.datauser,sql_pwd:e.datapassword,sql_codeing:e.codeing,install_dependence:e.install_dependence?1:0,open_proxy:e.open_proxy?1:0,webname:{domain:"",domainlist:[],count:0}},t=null==(a=e.domains)?void 0:a.split("\n");return t.forEach((e,a)=>{0===a?l.webname.domain=e:l.webname.domainlist.push(t[a])}),l.webname.count=l.webname.domainlist.length,l.webname=JSON.stringify(l.webname),delete l.domains,delete l.datauser,delete l.datapassword,delete l.codeing,l})(S.value);(await F({loading:P,request:B(a),message:!0})).status&&(k.value=!0,e())}}),(e,a)=>{const l=M,n=b,c=h,_=re,V=y,k=g,j=T,C=x,I=N;return u(),d("div",null,[t(C,{ref_key:"addThinkphpSiteFormRef",ref:q,disabled:p(P),model:p(S),rules:p(ve)},{default:r(()=>[t(c,{label:"绑定域名",prop:"domains"},{default:r(()=>[t(n,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:p(O),"onUpdate:visible":a[2]||(a[2]=e=>i(O)?O.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:r(()=>[t(l,{onInput:te,modelValue:p(S).domains,"onUpdate:modelValue":a[0]||(a[0]=e=>p(S).domains=e),type:"textarea",width:"52rem",rows:4,resize:"none",onFocus:a[1]||(a[1]=e=>O.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),default:r(()=>[a[15]||(a[15]=m("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[s(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),m("br"),s(" IP地址格式：192.168.1.199 "),m("br"),s(" 泛解析添加方法 *.domain.com "),m("br"),s(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1}),t(c,{label:"项目目录",prop:"site_path"},{default:r(()=>[t(_,{modelValue:p(S).site_path,"onUpdate:modelValue":a[3]||(a[3]=e=>p(S).site_path=e),placeholder:"请输入项目目录",icon:"el-folder-opened",width:"52rem",onFocus:a[4]||(a[4]=e=>J.value=!0),onIconClick:Y},null,8,["modelValue"])]),_:1}),t(c,{label:"PHP版本"},{default:r(()=>[m("div",ke,[m("div",je,[t(k,{class:"!w-[16rem]",modelValue:p(S).php_version,"onUpdate:modelValue":a[5]||(a[5]=e=>p(S).php_version=e),onChange:le},{default:r(()=>[(u(!0),d(o,null,v(p(z),e=>(u(),f(V,{key:e.value,label:e.name,value:e.version},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t(c,{label:"fileinfo版本"},{default:r(()=>[p(E).status?(u(),d("span",Ue,"当前php已安装fileinfo扩展")):(u(),f(j,{key:0,onClick:ae},{default:r(()=>[...a[16]||(a[16]=[s("当前php未安装fileinfo扩展 >>立即安装",-1)])]),_:1}))]),_:1})])]),_:1}),t(c,{label:"数据库"},{default:r(()=>[m("div",qe,[t(k,{class:"!w-[16rem]",modelValue:p(S).sql,"onUpdate:modelValue":a[6]||(a[6]=e=>p(S).sql=e),disabled:!p(U).database},{default:r(()=>[t(V,{label:"不创建",value:!1}),t(V,{label:"MySQL",value:"MYSQL"})]),_:1},8,["modelValue","disabled"]),p(U).database?w("",!0):(u(),d("span",{key:0,onClick:a[7]||(a[7]=e=>(async e=>{const{data:a}=await D({sName:e});pe({name:a.name,type:"i",pluginInfo:a})})("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装数据库，点击安装")),p(S).sql?(u(),f(k,{key:1,class:"ml-[8px] !w-[16rem]",modelValue:p(S).codeing,"onUpdate:modelValue":a[8]||(a[8]=e=>p(S).codeing=e)},{default:r(()=>[t(V,{label:"utf8mb4",value:"utf8mb4"}),t(V,{label:"utf8",value:"utf8"}),t(V,{label:"gbk",value:"gbk"}),t(V,{label:"big5",value:"big5"})]),_:1},8,["modelValue"])):w("",!0)])]),_:1}),p(S).sql?(u(),f(c,{key:0,label:"数据库账号"},{default:r(()=>[m("div",Pe,[t(c,{prop:"datauser"},{default:r(()=>[t(l,{placeholder:"创建数据库账号",class:"w-[24rem]",modelValue:p(S).datauser,"onUpdate:modelValue":a[9]||(a[9]=e=>p(S).datauser=e)},null,8,["modelValue"])]),_:1}),t(c,{label:"密码",class:"!mt-0"},{default:r(()=>[t(l,{placeholder:"数据库密码",class:"w-[24rem]",modelValue:p(S).datapassword,"onUpdate:modelValue":a[10]||(a[10]=e=>p(S).datapassword=e)},null,8,["modelValue"])]),_:1})]),a[17]||(a[17]=m("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))]),_:1})):w("",!0),t(c,{label:"运行用户"},{default:r(()=>[t(k,{class:"!w-[16rem]",modelValue:p(S).run_user,"onUpdate:modelValue":a[11]||(a[11]=e=>p(S).run_user=e)},{default:r(()=>[(u(!0),d(o,null,v(p(Q),e=>(u(),f(V,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a[18]||(a[18]=m("span",{class:"text-[#999] text-[1.2rem] ml-[.4rem]"},"* 无特殊需求请选择www用户",-1))]),_:1}),t(c,{label:"启动命令",prop:"project_cmd"},{default:r(()=>[t(l,{modelValue:p(S).project_cmd,"onUpdate:modelValue":a[12]||(a[12]=e=>p(S).project_cmd=e),width:"52rem",placeholder:"请输入项目的启动命令，例：php serve.php"},null,8,["modelValue"])]),_:1}),t(c,{label:"依赖安装"},{default:r(()=>[t(k,{class:"!w-[16rem]",modelValue:p(S).composer_version,"onUpdate:modelValue":a[13]||(a[13]=e=>p(S).composer_version=e),"empty-values":[null,void 0]},{default:r(()=>[t(V,{label:"不安装",value:""}),t(V,{label:"用composer2.7.3安装",value:"2.7.3"}),t(V,{label:"用1.10.27安装",value:"1.10.27"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"备注"},{default:r(()=>[t(l,{modelValue:p(S).project_ps,"onUpdate:modelValue":a[14]||(a[14]=e=>p(S).project_ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])]),_:1})]),_:1},8,["disabled","model","rules"]),t(I,{class:"mt-2rem pl-1rem",options:A})])}}}),[["__scopeId","data-v-5af190b8"]]),Ce={class:"flex items-center"},De={class:"flex items-center mb-[4px]"},Ie=O(e({__name:"index",props:{compData:{default:{}}},setup(e,{expose:c}){const _=e,{panel:V}=C(),{isRefreshList:k}=me(),j=a({database:!1}),U=l(),q=l(!1),P=l({site_path:"/www/wwwroot",project_cmd:"",install_dependence:0,php_version:"",domains:"",sql:!1,project_ps:"",project_port:"",codeing:"utf8mb4",open_proxy:!1,project_proxy_path:"",datauser:"",datapassword:"",run_user:"www",composer_version:""}),S=l(!1),H=l([]),T=l([]),O=l(!1);let R="/www/wwwroot/";const z=[{content:"当前仅支持nginx服务器使用"},{content:t(o,null,[s("【自动安装项目依赖】只尝试"),t("span",{class:"text-danger"},[s("composer install")]),s("进行安装依赖，最终安装结果请前往 项目-日志-安装依赖日志 进行确认，若安装依赖不成功，项目会"),t("span",{class:"text-danger"},[s("启动失败")])])},{content:"安装依赖不成功，可能和composer版本有关，可尝试切换composer版本"}],Q=()=>{ie({type:"dir",path:P.value.site_path.replace(/\/$/,""),change:e=>{I(e,"string",""),P.value.site_path=e,O.value=!0,E()}})},E=async()=>{try{const e=await W({path:P.value.site_path});P.value.composer_version=e.data?"2.7.3":"",P.value.install_dependence=e.data?1:0}catch(e){}},J=e=>{var a,l,t,s;"string"==typeof e&&(P.value.site_path&&P.value.site_path!==R.replace(/\/$/,"")||(O.value=!1),O.value||(P.value.site_path=(null==R?void 0:R.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim())),P.value.datauser=null==(s=null==(t=e.split("\n")[0])?void 0:t.replace(/\W/g,"_"))?void 0:s.substr(0,16),P.value.datapassword=L(16),P.value.project_ps=e.split("\n")[0])},$=async()=>{var e;const a=await _.compData.getStatus();j.database=a.mysql;const l=V.value.sitePath;l&&(P.value.site_path=l,R=null==(e=l+"/")?void 0:e.replace(/\/\//g,"/")),(async()=>{var e;try{const a=await G();H.value=a.data.filter(e=>"纯静态"!==e.name),H.value=H.value.reverse(),P.value.php_version=(null==(e=H.value)?void 0:e.length)?H.value[0].version:""}catch(a){}})(),(async()=>{try{const e=await K();T.value=e.data}catch(e){}})()};return n($),c({init:$,onConfirm:async e=>{await U.value.validate();const a=(e=>{var a;let l={...e,sql_user:e.datauser,sql_pwd:e.datapassword,sql_codeing:e.codeing,install_dependence:e.install_dependence?1:0,open_proxy:e.open_proxy?1:0,webname:{domain:"",domainlist:[],count:0}},t=null==(a=e.domains)?void 0:a.split("\n");return t.forEach((e,a)=>{0===a?l.webname.domain=e:l.webname.domainlist.push(t[a])}),l.webname.count=l.webname.domainlist.length,l.webname=JSON.stringify(l.webname),delete l.domains,delete l.datauser,delete l.datapassword,delete l.codeing,l})(P.value);(await F({loading:q,request:B(a),message:!0})).status&&(k.value=!0,e())}}),(e,a)=>{const l=M,n=b,c=h,_=re,V=y,k=g,C=x,I=N;return u(),d("div",null,[t(C,{ref_key:"addUniversalSiteFormRef",ref:U,disabled:p(q),model:p(P),rules:p(ve)},{default:r(()=>[t(c,{label:"绑定域名",prop:"domains"},{default:r(()=>[t(n,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:p(S),"onUpdate:visible":a[2]||(a[2]=e=>i(S)?S.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:r(()=>[t(l,{onInput:J,modelValue:p(P).domains,"onUpdate:modelValue":a[0]||(a[0]=e=>p(P).domains=e),type:"textarea",width:"52rem",rows:4,resize:"none",onFocus:a[1]||(a[1]=e=>S.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),default:r(()=>[a[15]||(a[15]=m("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[s(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),m("br"),s(" IP地址格式：192.168.1.199 "),m("br"),s(" 泛解析添加方法 *.domain.com "),m("br"),s(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1}),t(c,{label:"项目目录",prop:"site_path"},{default:r(()=>[t(_,{modelValue:p(P).site_path,"onUpdate:modelValue":a[3]||(a[3]=e=>p(P).site_path=e),placeholder:"请输入项目目录",icon:"el-folder-opened",width:"52rem",onFocus:a[4]||(a[4]=e=>O.value=!0),onIconClick:Q},null,8,["modelValue"])]),_:1}),t(c,{label:"PHP版本"},{default:r(()=>[t(k,{class:"!w-[16rem]",modelValue:p(P).php_version,"onUpdate:modelValue":a[5]||(a[5]=e=>p(P).php_version=e)},{default:r(()=>[(u(!0),d(o,null,v(p(H),e=>(u(),f(V,{key:e.value,label:e.name,value:e.version},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"数据库"},{default:r(()=>[m("div",Ce,[t(k,{class:"!w-[16rem]",modelValue:p(P).sql,"onUpdate:modelValue":a[6]||(a[6]=e=>p(P).sql=e),disabled:!p(j).database},{default:r(()=>[t(V,{label:"不创建",value:!1}),t(V,{label:"MySQL",value:"MYSQL"})]),_:1},8,["modelValue","disabled"]),p(j).database?w("",!0):(u(),d("span",{key:0,onClick:a[7]||(a[7]=e=>(async e=>{const{data:a}=await D({sName:e});pe({name:a.name,type:"i",pluginInfo:a})})("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装数据库，点击安装")),p(P).sql?(u(),f(k,{key:1,class:"ml-[8px] !w-[16rem]",modelValue:p(P).codeing,"onUpdate:modelValue":a[8]||(a[8]=e=>p(P).codeing=e)},{default:r(()=>[t(V,{label:"utf8mb4",value:"utf8mb4"}),t(V,{label:"utf8",value:"utf8"}),t(V,{label:"gbk",value:"gbk"}),t(V,{label:"big5",value:"big5"})]),_:1},8,["modelValue"])):w("",!0)])]),_:1}),p(P).sql?(u(),f(c,{key:0,label:"数据库账号"},{default:r(()=>[m("div",De,[t(c,{prop:"datauser"},{default:r(()=>[t(l,{placeholder:"创建数据库账号",class:"w-[24rem]",modelValue:p(P).datauser,"onUpdate:modelValue":a[9]||(a[9]=e=>p(P).datauser=e)},null,8,["modelValue"])]),_:1}),t(c,{label:"密码",class:"!mt-0"},{default:r(()=>[t(l,{placeholder:"数据库密码",class:"w-[24rem]",modelValue:p(P).datapassword,"onUpdate:modelValue":a[10]||(a[10]=e=>p(P).datapassword=e)},null,8,["modelValue"])]),_:1})]),a[16]||(a[16]=m("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))]),_:1})):w("",!0),t(c,{label:"运行用户"},{default:r(()=>[t(k,{class:"!w-[16rem]",modelValue:p(P).run_user,"onUpdate:modelValue":a[11]||(a[11]=e=>p(P).run_user=e)},{default:r(()=>[(u(!0),d(o,null,v(p(T),e=>(u(),f(V,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a[17]||(a[17]=m("span",{class:"text-[#999] text-[1.2rem] ml-[.4rem]"},"* 无特殊需求请选择www用户",-1))]),_:1}),t(c,{label:"启动命令",prop:"project_cmd"},{default:r(()=>[t(l,{modelValue:p(P).project_cmd,"onUpdate:modelValue":a[12]||(a[12]=e=>p(P).project_cmd=e),width:"52rem",placeholder:"请输入项目的启动命令，例：php serve.php"},null,8,["modelValue"])]),_:1}),t(c,{label:"依赖安装"},{default:r(()=>[t(k,{class:"!w-[16rem]",modelValue:p(P).composer_version,"onUpdate:modelValue":a[13]||(a[13]=e=>p(P).composer_version=e),"empty-values":[null,void 0]},{default:r(()=>[t(V,{label:"不安装",value:""}),t(V,{label:"用2.7.3安装",value:"2.7.3"}),t(V,{label:"用1.10.27安装",value:"1.10.27"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"备注"},{default:r(()=>[t(l,{modelValue:p(P).project_ps,"onUpdate:modelValue":a[14]||(a[14]=e=>p(P).project_ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])]),_:1})]),_:1},8,["disabled","model","rules"]),t(I,{class:"mt-2rem pl-1rem",options:z})])}}}),[["__scopeId","data-v-cfac3988"]]),Le={class:"pb-0 w-full"},He={class:"py-[8px] px-[12px] text-[#666] bg-[#e8f6eb] !w-full block flex items-center"},Fe={class:"inline-grid grid-cols-3 text-[1.2rem] gap-x-6 gap-y-2 !w-[60rem] !h-[12.3rem]"},Me=["onClick"],Te={class:"flex flex-col text-[#666]"},Ne={class:"w-full flex items-center"},Oe={class:"flex flex-col items-start leading-9 w-full"},Re={class:"truncate font-bold"},ze={class:"w-[14rem] truncate"},Qe={class:"flex items-center"},Ee={key:0,class:"svgtofont-el-success-filled text-[3.2rem] mr-[8px]"},Je={class:"flex flex-col items-start leading-9 w-full"},$e={key:0,class:"truncate font-bold"},Ae={class:"flex flex-col bg-[#f8f8f8] p-[12px] px-[16px] text-[1.2rem] w-full"},We={class:"flex items-center justify-between"},Be={class:"text-[#999] flex items-center"},Ye={class:"p-[20px]"},Ke={class:"flex items-center mb-[4px]"},Ge=O(e({__name:"index",props:{compData:{default:{}}},setup(e,{expose:P}){const S=e,{panel:D}=C(),{isRefreshList:I}=me(),H=R(),F=l([]),N=l(0),O=l(!1),A=l(),W=l(!1),B=k("popupClose");let Y="/www/wwwroot/";const K=l({menuType:"addDeployment",path:"/www/wwwroot",ftp:!1,type:"PHP",type_id:0,ps:"",port:"",version:"",need_index:0,need_404:0,sql:!1,codeing:"utf8mb4",webname:"",ftp_username:"",ftp_password:"",datauser:"",datapassword:""}),X=l({ftp:!0,ftpData:{username:"",password:""},sql:!0,databaseStatus:!0,sqlData:{username:"",password:""},siteStatus:!1,site:{name:""}}),te=l({isSetup:!1,versions:[],version:"",code:"utf8mb4"}),se=l({title:"111",version:"222"}),oe=a({datauser:"",datapassword:"",type:"MySQL",code:"utf8mb4",version:""}),ne=l(null),ue=l([]),de=l(!1),ce=l(!1),_e=l([]),we=()=>{ie({type:"dir",path:K.value.path,change:e=>{K.value.path=e}})},fe=e=>{var a,l,t;"string"==typeof e&&(K.value.ps=e.split("\n")[0],K.value.path=(null==Y?void 0:Y.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim()),K.value.datapassword=L(),K.value.datauser=null==(t=e.split("\n")[0])?void 0:t.replace(/\W/g,"_").substring(0,16))},be=()=>{z({isAsync:!0,title:"模板",area:84,component:()=>Q(()=>import("./other-template.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{templateData:ne.value,templateId:N.value,selectTemplate:xe}})},he=()=>{de.value=!0,oe.datauser=K.value.datauser,oe.datapassword=K.value.datapassword,oe.version=te.value.version},ye=async e=>{const a=null==e?void 0:e.php.split(","),l=te.value.versions.filter(e=>a.includes(e.version)).map(e=>e.version);_e.value=a.map(e=>({name:"PHP-"+e,version:e,status:l.includes(e)})),te.value.version=l[l.length-1],oe.version=te.value.version,K.value.version=te.value.version},ge=async()=>{de.value=!1,K.value.datauser=oe.datauser,K.value.datapassword=oe.datapassword,K.value.codeing=oe.code,te.value.version=oe.version,te.value.code=oe.code,K.value.version=te.value.version},xe=e=>{N.value=e;const a=ue.value.findIndex(a=>a.id===e);a<5?(se.value={},ye(ue.value[a])):(se.value=ue.value.find(a=>a.id===e),ye(se.value)),K.value.datauser="sql"+L(6),K.value.datapassword=L(6,"password")};j(()=>te.value.version,()=>{K.value.version=te.value.version});const Ve=async()=>{var e,a,l;try{ce.value=!0,await(async()=>{try{const e=await S.compData.getStatus(),a=await G();te.value.isSetup=e.mysql,te.value.versions=a.data.filter(e=>"00"!==e.version)}catch(e){}})(),await(async()=>{try{const{data:e}=await ae();F.value=e.list,ue.value=e.list,ne.value=e}catch(e){}})(),N.value=null==(e=ue.value[0])?void 0:e.id,await ye(ue.value[0]),xe(null==(a=ue.value[0])?void 0:a.id),ce.value=!1,K.value.sql="MySQL",se.value={};const t=D.value.sitePath;t&&(K.value.path=t,Y=null==(l=t+"/")?void 0:l.replace(/\/\//g,"/"))}catch(t){ce.value=!1}};return n(Ve),P({init:Ve,onConfirm:async e=>{let a=Object.assign({},K.value);a.ftp?(X.value.ftpData.username=a.ftp_username,X.value.ftpData.password=a.ftp_password):(delete a.ftp_username,delete a.ftp_password,X.value.ftp=!1),a.sql?(X.value.sqlData.username=a.user,X.value.sqlData.password=a.password):(delete a.datauser,delete a.datapassword,X.value.sql=!1),-1!==a.webname.split("\n")[0].indexOf(":")?a.port=a.webname.split("\n")[0].split(":")[1]:a.port=80;let l=a.webname.split("\n");l.shift(),a.webname=JSON.stringify({domain:a.webname.split("\n")[0],domainlist:l,count:l.length}),delete a.menuType;let t=null;await A.value.validate();try{O.value=!0,t=H.load("正在部署中...");const e=await Z(a);if(!1===e.data.status)return H.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.status?"添加网站成功":e.msg,type:e.status?"success":"error",duration:e.status?3e3:0,showClose:!e.status});e.status&&B();const{data:l}=await ee({source:1,site_name:JSON.parse(a.webname).domain,php_version:a.version,dname:F.value.find(e=>e.id===N.value).name});t.close(),e.data.siteStatus&&(X.value.siteStatus=!0,X.value.site.name=JSON.parse(a.webname).domain+l.msg.success_url),a.ftp||a.sql?(X.value.sqlData.username=a.datauser,X.value.sqlData.password=a.datapassword,X.value.databaseStatus=e.data.databaseStatus,z({isAsync:!0,title:"网站添加结果",area:46,component:()=>Q(()=>import("./add-result.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:X.value})):H.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.data.status?"添加网站成功":e.data.msg,type:e.data.status?"success":"error",duration:e.data.status?3e3:0,showClose:!e.data.status}),I.value=!0}catch(s){E(s)}finally{O.value=!1}}}),(e,a)=>{const l=T,n=$,k=b,j=h,P=M,S=re,C=x,D=y,I=g,L=J,H=V;return u(),d("div",Le,[m("span",He,[a[12]||(a[12]=s(" 快速的部署网站程序，商城、论坛、博客、框架等程序， ",-1)),t(l,{href:"https://www.bt.cn/bbs/thread-33063-1-1.html"},{default:r(()=>[...a[11]||(a[11]=[s(" 免费入驻平台 ",-1)])]),_:1})]),t(C,{model:p(K),rules:p(ve),class:"pt-[12px]",ref_key:"addDeploySiteFormRef",ref:A},{default:r(()=>[t(j,{label:"模板部署",class:""},{default:r(()=>{var e,i;return[m("div",Fe,[(u(!0),d(o,null,v(p(ue),(e,o)=>c((u(),d("div",{key:e.id,class:U([{"template-focus":p(N)===e.id},"mb-[4px] w-full flex items-center border border-[#ccc] py-[4px] px-[8px] rounded-[4px] cursor-pointer template-hover"]),onClick:a=>(e=>{N.value=e.id,xe(e.id)})(e)},[t(k,{ref_for:!0,ref:"popover",placement:"top-start",width:"200","popper-class":"white-tips-popover",trigger:"hover"},{reference:r(()=>[m("div",Ne,[t(n,{src:"/site_dep_ico/".concat(e.name.toLowerCase(),".png"),class:"w-[3.6rem] mr-[4px]"},null,8,["src"]),m("div",Oe,[m("span",Re,_(e.title)+" "+_(e.version),1),m("span",ze,_(e.ps.split("<")[0]),1)])])]),default:r(()=>[m("div",Te,[m("span",null,"名称："+_(e.title),1),m("span",null,"版本："+_(e.version),1),m("span",null,"简介："+_(e.ps.split("<")[0]),1),m("span",null,[a[13]||(a[13]=s("官网：",-1)),t(l,{href:e.official,target:"_blank"},{default:r(()=>[s(_(e.official),1)]),_:2},1032,["href"])]),m("span",null,"评价："+_(e.score),1)])]),_:2},1536)],10,Me)),[[q,o<5]])),128)),m("div",{onClick:be,class:U([{"justify-center":!p(se).id,"template-focus":p(se).id},"mb-[4px] w-full flex items-center border border-[#ccc] py-[4px] px-[12px] rounded-[4px] cursor-pointer template-hover"])},[m("div",Qe,[(null==(e=p(se))?void 0:e.id)?(u(),d("i",Ee)):w("",!0),m("div",Je,[(null==(i=p(se))?void 0:i.id)?(u(),d("span",$e,_(p(se).title)+" "+_(p(se).version),1)):w("",!0),t(l,null,{default:r(()=>[...a[14]||(a[14]=[s("更多模板 >>",-1)])]),_:1})])])],2)])]}),_:1}),t(j,{label:"域名",prop:"webname"},{default:r(()=>[t(k,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:p(W),"onUpdate:visible":a[2]||(a[2]=e=>i(W)?W.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:r(()=>[c(t(P,{onInput:fe,modelValue:p(K).webname,"onUpdate:modelValue":a[0]||(a[0]=e=>p(K).webname=e),type:"textarea",width:"52rem",rows:4,resize:"none",onFocus:a[1]||(a[1]=e=>W.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"]),[[H,void 0,"popover"]])]),default:r(()=>[a[15]||(a[15]=m("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[s(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),m("br"),s(" IP地址格式：192.168.1.199 "),m("br"),s(" 泛解析添加方法 *.domain.com "),m("br"),s(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1}),t(j,{label:"备注"},{default:r(()=>[t(P,{modelValue:p(K).ps,"onUpdate:modelValue":a[3]||(a[3]=e=>p(K).ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])]),_:1}),t(j,{label:"根目录",prop:"path"},{default:r(()=>[t(S,{modelValue:p(K).path,"onUpdate:modelValue":a[4]||(a[4]=e=>p(K).path=e),placeholder:"请输入根目录",icon:"el-folder-opened",width:"52rem",onIconClick:we},null,8,["modelValue"])]),_:1}),t(j,{label:"其他配置",prop:"other"},{default:r(()=>[m("div",Ae,[m("div",We,[m("span",{class:U({"text-danger":!p(te).isSetup})}," 数据库："+_(p(te).isSetup?"MySQL数据库":"数据库未安装！"),3),m("span",null,"编码："+_(p(te).code),1),m("span",null,"账号："+_(p(K).datauser),1),m("span",null,"密码："+_(p(K).datapassword),1),m("span",null,"PHP版本："+_(p(te).version),1)])]),m("span",Be,[a[17]||(a[17]=s(" 其他配置初始状态为默认选择的配置项，如需修改请点击 ",-1)),t(l,{onClick:he},{default:r(()=>[...a[16]||(a[16]=[s("编辑配置",-1)])]),_:1})])]),_:1})]),_:1},8,["model","rules"]),t(L,{title:"编辑配置",modelValue:p(de),"onUpdate:modelValue":a[10]||(a[10]=e=>i(de)?de.value=e:null),showFooter:"",area:62,onConfirm:ge},{default:r(()=>[m("div",Ye,[t(C,{model:p(oe),rules:p(ve),ref:"editFormRef"},{default:r(()=>[t(j,{label:"数据库"},{default:r(()=>[t(I,{class:"!w-[16rem]",modelValue:p(K).sql,"onUpdate:modelValue":a[5]||(a[5]=e=>p(K).sql=e)},{default:r(()=>[t(D,{label:"MySQL",value:"MySQL"})]),_:1},8,["modelValue"]),t(I,{modelValue:p(oe).code,"onUpdate:modelValue":a[6]||(a[6]=e=>p(oe).code=e),class:"ml-[8px] !w-[16rem]"},{default:r(()=>[t(D,{label:"utf8mb4",value:"utf8mb4"}),t(D,{label:"utf8",value:"utf8"}),t(D,{label:"gbk",value:"gbk"}),t(D,{label:"big5",value:"big5"})]),_:1},8,["modelValue"])]),_:1}),t(j,{label:"数据库账号"},{default:r(()=>[m("div",Ke,[t(j,{prop:"datauser",label:""},{default:r(()=>[t(P,{placeholder:"创建数据库账号",modelValue:p(oe).datauser,"onUpdate:modelValue":a[7]||(a[7]=e=>p(oe).datauser=e),width:"17rem"},null,8,["modelValue"])]),_:1}),t(j,{label:"",class:"!mt-0"},{default:r(()=>[t(P,{class:"ml-[8px]",width:"16rem",placeholder:"数据库密码",modelValue:p(oe).datapassword,"onUpdate:modelValue":a[8]||(a[8]=e=>p(oe).datapassword=e)},null,8,["modelValue"])]),_:1})]),a[18]||(a[18]=m("span",{class:"text-[#999] text-[1.2rem]"}," 创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。 ",-1))]),_:1}),t(j,{label:"PHP版本"},{default:r(()=>[t(I,{class:"!w-[16rem]",modelValue:p(oe).version,"onUpdate:modelValue":a[9]||(a[9]=e=>p(oe).version=e)},{default:r(()=>[(u(!0),d(o,null,v(p(_e),e=>(u(),f(D,{key:e.value,label:e.name,disabled:!e.status,value:e.version},{default:r(()=>[m("span",null,_(e.name),1),e.status?w("",!0):(u(),d(o,{key:0},[a[20]||(a[20]=s(" [ ",-1)),t(l,{class:"my-4px",onClick:a=>(async e=>{try{const a="php-"+(Number(e)/10).toFixed(1),{data:l}=await le({sName:a});pe({name:a,type:"i",pluginInfo:l})}catch(a){}})(e.version)},{default:r(()=>[...a[19]||(a[19]=[s("未安装",-1)])]),_:2},1032,["onClick"]),a[21]||(a[21]=s(" ] ",-1))],64))]),_:2},1032,["label","disabled","value"]))),128))]),_:1},8,["modelValue"]),a[22]||(a[22]=m("span",{class:"text-[#999] text-[1.2rem] ml-1rem"},"* 仅显示选中模板所支持的PHP版本",-1))]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-9466f457"]]),Xe=e({__name:"index",setup(e,{expose:a}){const{isRefreshList:o}=me(),n=R(),r=l("域名|1|0|0|0\n域名|1|0|0|0\n域名|1|0|0|0"),c=k("popupClose"),v=e=>e.replace(/\s+/g,""),_=e=>/^([\w\u4e00-\u9fa5\-\*]{1,100}\.){1,10}([\w\u4e00-\u9fa5\-]{1,24}|[\w\u4e00-\u9fa5\-]{1,24}\.[\w\u4e00-\u9fa5\-]{1,24})$/.test(v(e)),w=e=>/^([1-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(e),f=[{label:"名称",prop:"name"},{label:"FTP",prop:"db_status",render:e=>"boolean"==typeof e.db_status?P("span",{class:e.db_status?"text-primary":""},e.db_status?"已配置":"未配置"):P("span",e.db_status)},{label:"数据库",prop:"ftp_status",render:e=>"boolean"==typeof e.ftp_status?P("span",{class:e.ftp_status?"text-primary":""},e.ftp_status?"已配置":"未配置"):P("span",e.ftp_status)},{label:"结果",render:e=>P("span",{class:e.status?"text-primary":"text-danger truncate !w-[9.6rem] inline-block"},e.status?"操作成功":e.msg)}];return a({onConfirm:async e=>{let a=r.value.split("\n"),l=[];for(let o=0;o<a.length;o++){let e=a[o],t=e.split("|"),s=[];if(""!==e){for(let e=0;e<t.length;e++){let a=o+1,l=v(t[e]);switch(s.push(l),e){case 0:let e=l.split(",");for(let l=0;l<e.length;l++){let t=e[l].trim().split(":");if(!_(t[0]))return n.error("第"+a+"行,域名格式错误【"+t[0]+"】"),!1;if(void 0!==t[1]&&!w(t[1]))return n.error("第"+a+"行,端口格式错误【"+t[1]+"】"),!1}break;case 1:if("1"!==l&&l.indexOf("/")<-1)return n.error("第"+a+"行,站点目录格式错误【"+l+"】"),!1}}l.push(s.join("|").replace(/\r|\n/,""))}}let t=n.load("正在批量添加站点,请稍后...");try{const{data:e}=await te({create_type:"txt",websites_content:JSON.stringify(l)});let a=[];Object.keys(e.success).forEach(l=>{a.push({name:l,status:!0,ftp_status:e.success[l].ftp_status,db_status:e.success[l].db_status})}),Object.keys(e.error).forEach(l=>{a.push({name:l,status:!1,ftp_status:"--",db_status:"--",msg:e.error[l]})}),o.value=!0,c(),_e({resultColumn:f,resultData:a,resultTitle:"添加站点"},46),r.value="域名|1|0|0|0\n域名|1|0|0|0\n域名|1|0|0|0"}catch(s){}finally{t.close()}}}),(e,a)=>{const l=M;return u(),d("div",null,[t(l,{type:"textarea",modelValue:p(r),"onUpdate:modelValue":a[0]||(a[0]=e=>i(r)?r.value=e:null),rows:12,resize:"none",width:"72rem"},null,8,["modelValue"]),a[1]||(a[1]=m("ul",{class:"mt-[8px] text-[#999] leading-10"},[m("li",null,"批量格式：域名|根目录|FTP|数据库|PHP版本"),m("li",null,"域名参数：多个域名用 , 分割"),m("li",null,"根目录参数：填写 1 为自动创建，或输入具体目录"),m("li",null,"FTP参数：填写 1 为自动创建，填写 0 为不创建"),m("li",null,"数据库参数：填写 1 为自动创建，填写 0 为不创建"),m("li",null,"PHP版本参数：填写 0 为静态，或输入PHP具体版本号列如：56、71、74"),m("li",null,"如需添加多个站点，请换行填写"),m("li",null,[s(" 案例： "),m("span",null,"bt.cn,test.cn:8081|/www/wwwroot/bt.cn|1|1|56")])],-1))])}}}),Ze={class:"p-[20px]"},ea=["innerHTML"],aa=e({__name:"index",props:{compData:{default:{}}},setup(e,{expose:a}){const s=e,{plugin:o}=C(),i=l(!0),c=l(!1),v=l(""),_=R(),b=l("addSiteDefault");l(null);const h=k("popupSetFooter",e=>{}),y=async()=>{try{const{data:e}=await oe();return{ftp:e.ftp,mysql:e.mysql}}catch(e){E(e)}},{typeList:g,refresh:x}=s.compData,{BtTabs:V,tabsRefs:U}=A({type:"card",value:b,options:[{label:"传统项目",name:"addSiteDefault",lazy:!0,render:t(de,{compData:{getStatus:y,typeList:g,refresh:x}},null)},{label:"swoole异步项目",name:"addSwoole",lazy:!0,render:t(Ve,{compData:{getStatus:y}},null)},{label:"thinkphp异步项目",name:"addThinkphp",lazy:!0,render:t(Se,{compData:{getStatus:y}},null)},{label:"异步项目",name:"addUniversal",lazy:!0,render:t(Ie,{compData:{getStatus:y}},null)},{label:"一键部署",name:"addDeployment",lazy:!0,render:t(Ge,{compData:{getStatus:y}},null)},{label:"批量创建",name:"batchAddSite",lazy:!0,render:t(Xe,null,null)}]});j(()=>b.value,e=>{h("addPack"!==e)});const q=async()=>{ne(),i.value=!0};return n(async()=>{"addPack"===b.value&&h(!1);const{data:e}=await se(),a=!(null==e?void 0:e.status);v.value=(null==e?void 0:e.msg)||"";const l=await ue({});i.value=!a&&!l}),a({onConfirm:async e=>{if(("addSwoole"===b.value||"addThinkphp"===b.value||"addUniversal"===b.value)&&"nginx"!==o.value.webserver)return _.error("当前仅支持nginx服务器使用");U()[b.value].onConfirm(e)},getStatus:y}),(e,a)=>{const l=S;return u(),d("div",Ze,[p(i)?w("",!0):(u(),f(l,{key:0,class:"!mb-[1rem]",type:"info",closable:p(c),"close-text":"不再显示","show-icon":"",onMouseenter:a[0]||(a[0]=e=>c.value=!0),onMouseleave:a[1]||(a[1]=e=>c.value=!1),onClose:q},{default:r(()=>[m("div",{class:"flex",innerHTML:p(v)},null,8,ea)]),_:1},8,["closable"])),t(p(V))])}}});export{aa as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
