import{c as a,r as e,p as s,n as r,aD as l,x as t,q as n,M as i,A as u,y as o,z as v,e as c,B as m,C as p,D as d,ax as f,aW as y}from"./base-lib.js?v=1756369731";import{fo as g,K as b,fD as w,fE as x}from"./utils-lib.js?v=1756369731";const _={class:"text-[1.3rem]"},h=["innerHTML"],M=a({__name:"version-compare",setup(a){const M=e(!1),k=e(!1),A=e(!1),{version:C,cloudVersionInfo:D,getInfo:I,getCloudVersionInfo:T}=g(),V=()=>{D.value&&D.value.version&&""!==D.value.version.trim()?M.value=!((a,e)=>{const{versionArr:s,cloudVersionArr:r}=x(a,e);for(let l=0;l<s.length;l++){const a=s[l],e=r[l];if(a>e)return!0;if(a<e)return!1}return!0})(C.value,D.value.version):M.value=!1},j=()=>{b({loading:"更新中...",request:w(),message:!0,success:async()=>{await I(),await T(),V()}})};return s(async()=>{V(),await r(),setTimeout(()=>{(async()=>{if(!A.value&&!k.value){k.value=!0;try{await T(),A.value||V()}catch(a){A.value||(M.value=!1)}finally{A.value||(k.value=!1)}}})()},100)}),l(()=>{A.value=!0}),(a,e)=>{const s=d,r=f,l=y;return t(M)?(n(),i(l,{key:0,type:"warning",class:"!mb-[1.2rem] !p-[1.2rem]",closable:!1,"show-icon":""},{title:u(()=>{var a,l,d;return[o("span",_,[o("span",null," 提示：有一个新版本（"+v(null==(a=t(D))?void 0:a.version)+"）可更新，更新时间："+v(null==(l=t(D))?void 0:l.uptime),1),c(s,{class:"!ml-[1.2rem]",type:"primary",onClick:j},{default:u(()=>[...e[0]||(e[0]=[m("立即更新",-1)])]),_:1}),(null==(d=t(D))?void 0:d.updateMsg)?(n(),i(r,{key:0,placement:"bottom-start",width:"200",trigger:"hover"},{default:u(()=>{var a;return[o("div",{class:"update-details",innerHTML:null==(a=t(D))?void 0:a.updateMsg},null,8,h)]}),reference:u(()=>[...e[1]||(e[1]=[o("span",{class:"!ml-[1.2rem] bt-link text-[12px]"},"详情",-1)])]),_:1})):p("",!0)])]}),_:1})):p("",!0)}}});export{M as _};
