import{M as a,e4 as e,e5 as t,a3 as l,e as s,d4 as n,L as o,dW as i,l as r,o as u,e6 as c,e7 as d,e8 as p,b as m,e9 as v,N as _,c as f,ea as y,eb as h,ec as g,ed as w,K as b,ee as k,ef as x,k as C,eg as I,eh as P,ei as E,_ as O,ej as L,ek as V,el as T,a8 as R,d7 as S,em as M,en as j,eo as D,ep as A,a6 as q,a7 as z,$ as F,W as U,eq as B,er as H,es as N,et as W,ag as G,R as K,eu as $,ev as J,ew as Q,ex as X,ai as Y,dP as Z,ey as aa,ez as ea,eA as ta,eB as la,r as sa,eC as na,al as oa,H as ia}from"./utils-lib.js?v=1756369731";import{j as ra,r as ua,s as ca,c as da,q as pa,v as ma,y as va,z as _a,L as fa,a4 as ya,M as ha,A as ga,e as wa,B as ba,x as ka,P as xa,ag as Ca,af as Ia,S as Pa,D as Ea,k as Oa,g as La,T as Va,J as Ta,C as Ra,F as Sa,al as Ma,p as ja,G as Da,H as Aa,X as qa,I as za,a9 as Fa,a7 as Ua,aV as Ba,a5 as Ha,aQ as Na}from"./base-lib.js?v=1756369731";import{a as Wa,u as Ga,b as Ka,o as $a,e as Ja}from"./useMethod7.js?v=1756369731";import{getCliVersion as Qa}from"./site.js?v=1756369731";import{B as Xa,u as Ya,c as Za,a as ae}from"./column.js?v=1756369731";import{_ as ee}from"./index103.js?v=1756369731";import{o as te,f as le}from"./validator.js?v=1756369731";import{r as se}from"./useMethod6.js?v=1756369731";import{m as ne,i as oe}from"./useMethod9.js?v=1756369731";const ie=ra("MAIL_SETTING_TIME",()=>{const a=ua(0),e=ua(null);return{type:a,days:e,reset:()=>{a.value=0,e.value=null}}}),{type:re,days:ue}=ca(ie()),ce=async()=>{if(!ue.value&&0!==ue.value&&1===re.value)return void a.error("请输入保存时间");const{data:t}=await e({save_day:0===re.value?0:ue.value});a.request(t),de()},de=async()=>{const{data:a}=await t();l(a)&&(0===a.data||null===a.data?(re.value=0,ue.value=null):(re.value=1,ue.value=a.data))},pe=a=>{const e=a.replace(/[^\d]/g,"");ue.value=""===e||"0"===e?"":e},me={class:"setting-card"},ve={class:"setting-title"},_e=s(da({__name:"setting-card",props:{title:{default:""}},setup:a=>(a,e)=>(pa(),ma("div",me,[va("div",ve,_a(a.title),1),fa(a.$slots,"default",{},void 0,!0)]))}),[["__scopeId","data-v-125476a8"]]),fe={class:"flex items-center"},ye={class:"w-250px"},he=da({__name:"index",setup(a){const{type:e,days:t}=ca(ie()),{reset:l}=ie();return n().install&&de(),ya(()=>{l()}),(a,l)=>{const s=Ca,n=Ia,o=Pa,i=Ea;return pa(),ha(_e,{title:"邮件保存时间"},{default:ga(()=>[va("div",fe,[wa(n,{modelValue:ka(e),"onUpdate:modelValue":l[0]||(l[0]=a=>xa(e)?e.value=a:null)},{default:ga(()=>[wa(s,{value:0},{default:ga(()=>[...l[2]||(l[2]=[ba("永久",-1)])]),_:1}),wa(s,{class:"ml-24px",value:1},{default:ga(()=>[...l[3]||(l[3]=[ba("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),va("div",ye,[wa(o,{modelValue:ka(t),"onUpdate:modelValue":l[1]||(l[1]=a=>xa(t)?t.value=a:null),class:"flex-1 ml-16px",type:"number",min:1,max:999999,onInput:ka(pe),disabled:0===ka(e),controls:!1,placeholder:"请输入保存时间"},{append:ga(()=>[...l[4]||(l[4]=[ba("天",-1)])]),_:1},8,["modelValue","onInput","disabled"])]),wa(i,{class:"ml-24px",type:"primary",ghost:"",onClick:ka(ce)},{default:ga(()=>[...l[5]||(l[5]=[ba(" 保存 ",-1)])]),_:1},8,["onClick"])])]),_:1})}}}),ge=ra("MAIL_SETTING_WEB",()=>{const a=Oa({id:0,site_name:"",status:!1,ssl_status:!1}),e=La(()=>"".concat(a.ssl_status?"https":"http","://").concat(a.site_name)),t=Wa("安装 WebMail",{onRefresh:async()=>{const{getInfo:a}=await o(()=>Promise.resolve().then(()=>He),void 0,import.meta.url);a()}}),l=Wa("添加已部署的网络邮件",{onRefresh:async()=>{const{getInfo:a}=await o(()=>Promise.resolve().then(()=>He),void 0,import.meta.url);a()}}),s=ua(null),n=Oa({domain:"",php_version:null}),i={domain:{trigger:"change",validator:()=>""!==n.domain.trim()||new Error("请输入域名")},php_version:{trigger:"change",validator:()=>null!==n.php_version||new Error("请选择PHP版本")}},r=ua([]),{loading:u,setLoading:c}=Ga(),d=ua(null),p=Oa({id:0,domain:null,path:""}),m={domain:{trigger:"change",validator:()=>null!==p.domain||new Error("请选择站点")}},v=ua([]),{loading:_,setLoading:f}=Ga();return{info:a,url:e,installModal:t,configModal:l,reset:()=>{a.id=0,a.site_name="",a.status=!1,a.ssl_status=!1},resetInstallForm:()=>{n.domain="",n.php_version=null},installForm:n,installRules:i,phpOptions:r,installFormRef:s,installLoading:u,installSetLoading:c,configForm:p,configRules:m,configFormRef:d,configLoading:_,configSetLoading:f,domainOptions:v,resetConfigForm:()=>{p.id=0,p.domain=null,p.path=""}}}),{info:we,installModal:be,configModal:ke,phpOptions:xe,installForm:Ce,installFormRef:Ie,configForm:Pe,configFormRef:Ee,domainOptions:Oe}=ca(ge()),{installSetLoading:Le,configSetLoading:Ve}=ge(),Te=m(),Re=async()=>{const{data:a}=await i();l(a)&&(we.value.id=a.id,we.value.status=a.status,we.value.site_name=a.site_name,we.value.ssl_status=a.ssl_status)},Se=()=>{be.value.data.onRefresh=Re,r({title:be.value.title,area:48,showFooter:!0,compData:be.value.data,confirmText:"安装",component:()=>o(()=>import("./install.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},Me=()=>{const a=ua(!1);u({title:"卸载 WebMail",width:70,content:()=>wa("div",null,[wa("div",{class:"mb-16px"},[ba("卸载WebMail后，【"),we.value.site_name,ba("】已从网站列表中删除，网站无法访问，是否继续?")]),wa(Va,{checked:a.value,onChange:e=>{a.value=e}},{default:()=>[wa("div",{class:"text-desc leading-[1.4]"},[ba("FTP、数据库、文档根目录在选择后将被完全删除，请谨慎！")])]})]),onConfirm:async()=>{const{data:e}=await c({id:we.value.id,site_name:we.value.site_name,force:a.value?1:0});Te.request(e),Re()}})},je=()=>{r({title:ke.value.title,area:48,showFooter:!0,compData:ke.value.data,component:()=>o(()=>import("./config2.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},De=async()=>{const{data:a}=await Qa();l(a)&&(xe.value=a.versions.reverse().map(a=>({label:a.name,value:a.version})),Ce.value.php_version=a.versions[0].version)},Ae=async()=>{try{Le(!0),await Promise.all([De()])}finally{Le(!1)}},qe=async a=>{var e;await(null==(e=Ie.value)?void 0:e.validate());const{data:t}=await d({site_name:Ce.value.domain||"",php_version:Ce.value.php_version||""});Te.request(t),t.status&&(be.value.data.onRefresh&&"function"==typeof be.value.data.onRefresh&&be.value.data.onRefresh(),a())},ze=async()=>{var a;const{data:e}=await v();_(e.data)&&(Oe.value=e.data.map(a=>({label:a.name,value:a.name,data:a})),(null==(a=e.data)?void 0:a.length)&&(Pe.value.domain=e.data[0].name,Pe.value.path=e.data[0].path,Pe.value.id=e.data[0].id))},Fe=a=>{const e=Oe.value.find(e=>e.value===a),{data:t}=e;l(t)&&(Pe.value.id=t.id,Pe.value.path=t.path)},Ue=async()=>{try{Ve(!0),await Promise.all([ze()])}finally{Ve(!1)}},Be=async a=>{var e;await(null==(e=Ee.value)?void 0:e.validate());const{data:t}=await p({id:Pe.value.id,site_name:Pe.value.domain||"",path:Pe.value.path});Te.request(t),t.status&&(a(),ke.value.data.onRefresh&&"function"==typeof ke.value.data.onRefresh&&ke.value.data.onRefresh())},He=Object.freeze(Object.defineProperty({__proto__:null,configInit:Ue,configOnConfirm:Be,getDomainOptions:ze,getInfo:Re,getPhpOptions:De,goSite:()=>{location.href="/site/php"},installInit:Ae,installOnConfirm:qe,onInstall:Se,onShowConfig:je,onUninstall:Me,onUpdateDomain:Fe},Symbol.toStringTag,{value:"Module"})),Ne={class:"flex items-center"},We={class:"flex items-center mr-32px text-13px"},Ge={key:0,class:"flex items-center mr-24px text-13px"},Ke=da({__name:"index",setup(a){const{info:e,url:t}=ca(ge()),{reset:l}=ge();return Re(),ya(()=>{l()}),(a,l)=>{const s=f,n=Ea;return pa(),ha(_e,{title:"WebMail"},{default:ga(()=>[va("div",Ne,[va("div",We,[l[0]||(l[0]=va("span",{class:"mr-10px"},"安装状态:",-1)),va("span",{class:Ta(ka(e).status?"text-primary":"text-[#dc2626]")},_a(ka(e).status?"已安装":"未安装"),3)]),ka(e).status?(pa(),ma("div",Ge,[l[1]||(l[1]=va("span",{class:"mr-10px"},"URL:",-1)),wa(s,{href:ka(t),target:"_blank"},{default:ga(()=>[ba(_a(ka(t)),1)]),_:1},8,["href"])])):Ra("",!0),ka(e).status?(pa(),ha(n,{key:1,onClick:ka(Me)},{default:ga(()=>[...l[2]||(l[2]=[ba(" 卸载 ",-1)])]),_:1},8,["onClick"])):(pa(),ma(Sa,{key:2},[wa(n,{type:"primary",ghost:"",onClick:ka(Se)},{default:ga(()=>[...l[3]||(l[3]=[ba(" 安装 ",-1)])]),_:1},8,["onClick"]),wa(n,{class:"ml-10px",onClick:ka(je)},{default:ga(()=>[...l[4]||(l[4]=[va("span",null,"添加已有的服务",-1)])]),_:1},8,["onClick"])],64))])]),_:1})}}}),$e=ra("MAIL_SETTING_MONITOR",()=>{const a=ua(!1),{loading:e,setLoading:t}=Ga();return{status:a,loading:e,setLoading:t,reset:()=>{a.value=!1,t(!1)}}}),{status:Je}=ca($e()),{setLoading:Qe}=$e(),Xe=m(),Ye=async a=>{u({title:a?"启用服务状态监控":"关闭服务状态监控",content:a?"检查邮局服务的状态，并在停止时自动重新启动":"关闭后，系统将不再监控邮局服务状态",onConfirm:async()=>{try{const{data:e}=await(a?y():h());Xe.request(e),Ze()}catch(e){Je.value=!a,Xe.error("操作失败")}},onCancel:()=>{Je.value=!a}})},Ze=async()=>{try{Qe(!0);const{data:a}=await g();Je.value=!!a.status}catch(a){Je.value=!1}finally{Qe(!1)}},at={class:"flex items-center"},et=da({__name:"index",setup(a){const e=n(),{status:t,loading:l}=ca($e()),{reset:s}=$e();return e.install&&Ze(),ya(()=>{s()}),(a,e)=>{const s=Ma;return pa(),ha(_e,{title:"监控"},{default:ga(()=>[va("div",at,[e[0]||(e[0]=va("div",{class:"text-13px mr-[3rem]"},"服务停止后自动启动",-1)),wa(s,{"model-value":ka(t),loading:ka(l),onChange:ka(Ye)},null,8,["model-value","loading","onChange"])])]),_:1})}}}),tt=ra("MAIL_SETTING_SERVICE",()=>{const{table:a,columns:e}=Ka([{prop:"name",label:"名称"},{prop:"status",label:"状态",render:a=>wa(Xa,{modelValue:a.status,onClick:async()=>{const{onChangeStatus:e}=await o(()=>Promise.resolve().then(()=>it),void 0,import.meta.url);e(a)}},null)},Ya(a=>[{title:a.status?"停止":"开启",onClick:async a=>{const{onChangeStatus:e}=await o(()=>Promise.resolve().then(()=>it),void 0,import.meta.url);e(a)}},{title:"重启",onClick:async a=>{const{onRestart:e}=await o(()=>Promise.resolve().then(()=>it),void 0,import.meta.url);e(a)}},{title:"修复",onClick:async a=>{const{onRepair:e}=await o(()=>Promise.resolve().then(()=>it),void 0,import.meta.url);e(a)}},{title:"设置",onClick:async a=>{const{onShowConfig:e}=await o(()=>Promise.resolve().then(()=>it),void 0,import.meta.url);e(a)}}])]),t=Wa(),{loading:l,setLoading:s}=Ga();return{table:a,columns:e,loading:l,setLoading:s,configModal:t,reset:()=>{s(!1),a.data=[],a.total=0}}}),{table:lt,configModal:st}=ca(tt()),{setLoading:nt}=tt(),ot=async()=>{try{nt(!0);const{data:a}=await w();l(a)&&(lt.value.data=[],lt.value.data.push({key:"dovecot",name:"Dovecot",status:a.dovecot}),a.change_rspamd?lt.value.data.push({key:"opendkim",name:"Opendkim",status:a.opendkim}):lt.value.data.push({key:"rspamd",name:"Rspamd",status:a.rspamd}),lt.value.data.push({key:"postfix",name:"Postfix",status:a.postfix}))}finally{nt(!1)}},it=Object.freeze(Object.defineProperty({__proto__:null,getList:ot,onChangeStatus:a=>{u({title:a.status?"正在停止 ".concat(a.key," 服务"):"正在启动 ".concat(a.key," 服务"),content:a.status?"确定要停止 ".concat(a.key," 服务吗？"):"确定要启动 ".concat(a.key," 服务吗？"),onConfirm:async()=>{b({request:k({service:a.key,type:a.status?"stop":"start"}),message:!0,success:()=>{ot()}})}})},onRepair:a=>{let e="确定要修复 ".concat(a.key," 服务吗？");"dovecot"===a.key?e="配置将恢复为默认设置，并使以下配置失效：SSL。确认继续吗？":"postfix"===a.key&&(e="配置将恢复为默认设置，并使以下配置失效：SSL、防垃圾邮件、BCC、SMTP 中继、邮件转发。确认继续吗？"),u({title:"修复 ".concat(a.key," 服务"),content:e,onConfirm:async()=>{b({request:x({service:a.key,type:"repair"}),message:!0,success:()=>{ot()}})}})},onRestart:a=>{u({title:"重启 ".concat(a.key," 服务"),content:"确定要重启 ".concat(a.key," 服务吗？"),onConfirm:async()=>{b({request:k({service:a.key,type:"restart"}),message:!0,success:()=>{ot()}})}})},onShowConfig:a=>{st.value.data.row=a,st.value.title="在线编辑 【".concat(a.key,"_配置文件】"),st.value.show=!0,r({title:st.value.title,area:[80,60],component:()=>o(()=>import("./config3.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:st.value.data,showFooter:!0,confirmText:"保存"})}},Symbol.toStringTag,{value:"Module"})),rt=da({__name:"index",setup(a){const{table:e,loading:t}=ca(tt()),{columns:l,reset:s}=tt();return n().install&&ot(),ya(()=>{s()}),(a,s)=>{const n=C;return pa(),ha(_e,{title:"服务状态"},{default:ga(()=>[wa(n,{loading:ka(t),"loading-num":3,data:ka(e).data,column:ka(l)},null,8,["loading","data","column"])]),_:1})}}}),ut=ua(!1),ct=ua(!1),dt=a=>{u({title:"".concat(a?"开启":"关闭","自动续期SSL证书"),content:"".concat(a?"开启后，系统将自动续期SSL证书":"关闭后，系统将不再自动续期SSL证书"),onConfirm:async()=>{b({loading:"正在".concat(a?"开启":"关闭","自动续期SSL证书"),message:!0,request:a?I():P(),success:()=>{pt()}})},onCancel:()=>{ut.value=!a}})},pt=async()=>{ct.value=!0;try{const{data:a}=await E();ut.value=a.status,ct.value=!1}catch(a){ut.value=!1}},mt={class:"flex items-center"},vt=da({__name:"index",setup:a=>(ja(()=>{pt()}),(a,e)=>{const t=Ma;return pa(),ha(_e,{title:"自动续期SSL证书"},{default:ga(()=>[va("div",mt,[e[0]||(e[0]=va("div",{class:"text-13px mr-[3rem]"},"自动续期",-1)),wa(t,{"model-value":ka(ut),loading:ka(ct),onChange:ka(dt)},null,8,["model-value","loading","onChange"])])]),_:1})})}),_t=s(da({__name:"index",setup:a=>(a,e)=>(pa(),ma("div",null,[wa(Ke),wa(he),wa(et),wa(vt),wa(rt)]))}),[["__scopeId","data-v-3a9ea978"]]),ft=ra("MAIL_BCC",()=>{const a=Oa({p:1,size:10}),e=Wa("添加密抄",{isEdit:!1,row:void 0,onRefresh:async()=>{const{getList:a}=await o(()=>Promise.resolve().then(()=>Ct),void 0,import.meta.url);a()}}),t=new Map([["sender","发送时抄送"],["recipient","接收时抄送"]]),{table:l,columns:s}=Ka([{prop:"user",label:"被抄送者",showOverflowTooltip:!0},{prop:"forward_user",label:"抄送到",showOverflowTooltip:!0},{prop:"domain",label:"域名",showOverflowTooltip:!0},{prop:"type",label:"抄送类型",render:a=>t.get(a.type)},{prop:"active",label:"状态",render:a=>wa("div",{class:"w-[2rem]"},[1===a.active?wa(O,{icon:"el-circle-check",class:"!text-primary"},null):wa(O,{icon:"el-circle-close",class:"!text-[#dc2626]"},null)])},Ya([{title:"编辑",onClick:async a=>{const{onShowEdit:e}=await o(()=>Promise.resolve().then(()=>Ct),void 0,import.meta.url);e(a)}},{title:"删除",onClick:async a=>{const{onDel:e}=await o(()=>Promise.resolve().then(()=>Ct),void 0,import.meta.url);e(a)}}])]);return{search:a,formModal:e,table:l,columns:s,reset:()=>{a.p=1,a.size=10,l.data=[],l.total=0}}}),{search:yt,table:ht,formModal:gt}=ca(ft()),wt=m(),bt=()=>{gt.value.data.isEdit=!1,gt.value.title="添加密抄",gt.value.show=!0,r({title:gt.value.title,area:54,component:()=>o(()=>import("./index336.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:gt.value.data,showFooter:!0})},kt=async()=>{try{ht.value.loading=!0;const{data:a}=await L();ht.value.data=[],l(a.data)&&Object.entries(a.data).forEach(([a,e])=>{_(e)&&ht.value.data.push(...e.map(e=>({...e,type:a})))})}finally{ht.value.loading=!1}},xt=()=>{yt.value.p=1,kt()},Ct=Object.freeze(Object.defineProperty({__proto__:null,getList:kt,onDel:async a=>{try{await u({title:"删除转发",content:"是否删除转发设置?"});const{data:e}=await V({type:a.type,user:a.user,forward_user:a.forward_user});wt.request(e),kt()}catch(e){}},onShowAdd:bt,onShowEdit:a=>{gt.value.data.isEdit=!0,gt.value.data.row=a,gt.value.title="编辑密抄",gt.value.show=!0,r({title:gt.value.title,area:54,component:()=>o(()=>import("./index336.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:gt.value.data,showFooter:!0})},refresh:xt},Symbol.toStringTag,{value:"Module"})),It=da({__name:"index",setup(a){const{table:e}=ca(ft()),{columns:t,reset:l}=ft();return kt(),ya(()=>{l()}),(a,l)=>{const s=Ea,n=C,o=ee,i=Da("bt-loading");return pa(),ha(o,null,{"header-left":ga(()=>[wa(s,{type:"primary",onClick:ka(bt)},{default:ga(()=>[...l[0]||(l[0]=[ba("添加密抄",-1)])]),_:1},8,["onClick"])]),"header-right":ga(()=>[wa(s,{onClick:ka(xt)},{default:ga(()=>[...l[1]||(l[1]=[ba("刷新",-1)])]),_:1},8,["onClick"])]),content:ga(()=>[Aa(wa(n,{data:ka(e).data,column:ka(t)},null,8,["data","column"]),[[i,ka(e).loading]])]),_:1})}}}),Pt=ua(0),Et=ua(!1),Ot=ua(!1),Lt=ua([]),Vt=ua([]),Tt=ua({type:"mail",forward_type:0,rule:"all",rule_str:"",receiver:"",status:!0,domain:""}),Rt=async()=>{try{const{data:a}=await T({dtype:Pt.value});return{data:a.data,total:a.total}}catch(a){return{data:[],total:0}}},St=R([{label:"删除",value:"delete",event:async(a,e,t,l,s,n)=>{const{label:o,value:i}=l,r=new Map([["delete","批量删除已选的转发规则"]]);await a({title:"批量".concat(o),content:"".concat(r.get(i),"，是否继续操作！"),column:[{label:"转发规则",prop:"address"},Za()],onConfirm:async()=>{const a=await(async()=>{const a=new Map([["delete",D]]).get(i);if("delete"===i){const e=t.value.map(a=>a.address).join(",");if(a)return await a({forward_type:Pt.value,address:e})}})();Et.value=!0;const e=[];a.status?t.value.forEach(a=>{e.push({name:a.address,status:!0,msg:"删除成功"})}):t.value.forEach(a=>{e.push({name:a.address,status:!1,msg:"删除失败"})}),s&&s(),te(e,{title:"".concat(o,"转发规则")})}})}}]),Mt=async(a,e)=>{Tt.value.forward_type=Pt.value,r({title:a?"编辑转发规则".concat(e.forwarder):"添加转发规则",area:54,component:()=>o(()=>import("./index337.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{isEdit:a,row:e},showFooter:!0})},jt=a=>(Tt.value.type=""===a.rule?"mail":"wildcard",Tt.value.status=!!a.active,Tt.value.domain=a.domain,Tt.value.rule=a.rule,Tt.value.receiver=a.goto,Tt.value.forward_type=Pt.value,""===a.rule?Tt.value.rule_str=a.address:Tt.value.rule_str=a.rule_str,Tt.value),Dt=async()=>{Ot.value=!0;try{const{data:{data:a}}=await S();Lt.value=a.map(a=>({label:a,value:a}))}catch(a){}finally{Ot.value=!1}},At=async a=>{try{const{data:{data:e}}=await A({domain:a});Vt.value=e.map(a=>({label:a.username,value:a.username}))}catch(e){}},qt=()=>{Tt.value={type:"mail",forward_type:0,rule:"all",rule_str:"",receiver:"",status:!0,domain:""}},zt=a=>{let e={...a};return e.status=e.status?1:0,"wildcard"!==e.type&&(e.rule=""),1===e.forward_type&&(delete e.rule_str,delete e.rule),delete e.type,e},Ft=async a=>{try{let e=zt(a);const t=await b({request:M(e),loading:"添加中...",message:!0});return t.status&&(Et.value=!0),t.status}catch(e){return!1}},Ut=async(a,e)=>{try{let t=zt(a);const l=await b({request:j({...t,address:e}),loading:"编辑中...",message:!0});return l.status&&(Et.value=!0),l.status}catch(t){return!1}},Bt=da({__name:"index",setup(a){const e=[{content:'<span class="text-[#dc2626]">转发优先级：准确的邮箱转发>域名转发到域名>捕获前缀、后缀、全部邮箱>捕获不存在的邮箱</span>',isHtml:!0},{content:'<span class="text-[#dc2626]">捕获所有的邮箱和捕获不存在的邮箱不能同时存在</span>',isHtml:!0},{content:'<span class="text-[#dc2626]">除准确的邮箱转发外，其它所有转发均支持在邮箱不存在时也能转发（可用于实现“无限邮”）</span>',isHtml:!0}],{BtTable:t,BtBatch:l,BtRefresh:s}=q({request:Rt,columns:[ae({key:"address"}),{label:"被转发者",prop:"forwarder",showOverflowTooltip:!0},{label:"转发到",prop:"goto",showOverflowTooltip:!0},{label:"域名",prop:"domain",isHide:()=>0===Pt.value,showOverflowTooltip:!0},{label:"创建时间",prop:"created"},{label:"修改时间",prop:"modified"},{label:"状态",prop:"active",render:a=>wa(Ma,{modelValue:a.active,"onUpdate:modelValue":e=>a.active=e,size:"small",activeValue:1,inactiveValue:0,onChange:async e=>{a.active=e,await Ut(jt(a),a.address)}},null)},Ya([{title:"编辑",onClick:a=>{Mt(!0,a)}},{title:"删除",onClick:a=>{(async a=>{u({title:"删除转发规则【".concat(a.forwarder,"】"),content:"是否确认删除该转发规则？",onConfirm:async()=>{b({request:D({forward_type:Pt.value,address:a.address}),loading:"删除中...",message:!0,success:()=>{Et.value=!0}})}})})(a)}}])],extension:[St,z(Et)]});return(a,n)=>{const o=Ea,i=F,r=ee,u=U;return pa(),ma("div",null,[wa(r,null,{"header-left":ga(()=>[wa(o,{type:"primary",onClick:n[0]||(n[0]=a=>ka(Mt)(!1))},{default:ga(()=>[...n[3]||(n[3]=[ba("添加",-1)])]),_:1})]),"header-right":ga(()=>[wa(i,{type:"button",size:"default",modelValue:ka(Pt),"onUpdate:modelValue":n[1]||(n[1]=a=>xa(Pt)?Pt.value=a:null),options:[{label:"转发到邮箱",value:0},{label:"转发到域名",value:1}],onChange:n[2]||(n[2]=()=>{Et.value=!0}),class:"mr-[1rem]"},null,8,["modelValue"]),wa(ka(s))]),content:ga(()=>[wa(ka(t))]),"footer-left":ga(()=>[wa(ka(l))]),_:1}),wa(u,{class:"mt-[1rem]",options:e})])}}}),Ht=ra("MAIL_BACKUP_PLAN",()=>{const a=ua(!1),e=Oa({open:!1,cycle:"week",week:"1",hour:1,minute:30,backupTo:"localhost",save:3}),t=ua([{label:"服务器磁盘",value:"localhost"}]);return{open:a,form:e,toOptions:t,weekOptions:[{label:"周一",value:"1"},{label:"周二",value:"2"},{label:"周三",value:"3"},{label:"周四",value:"4"},{label:"周五",value:"5"},{label:"周六",value:"6"},{label:"周日",value:"0"}],cycleOptions:[{label:"每周",value:"week"},{label:"每天",value:"day"}],reset:()=>{e.cycle="week",e.week="1",e.hour=1,e.minute=30,e.backupTo="localhost",e.save=3,e.open=!1,a.value=!1}}}),{form:Nt,open:Wt,toOptions:Gt}=ca(Ht()),Kt=async()=>{const{data:e}=await B((()=>{let a={type:Nt.value.cycle,hour:Nt.value.hour,minute:Nt.value.minute,backupTo:Nt.value.backupTo,save:Nt.value.save};return"week"===Nt.value.cycle&&(a=Object.assign(a,{week:Nt.value.week})),a})());a.request(e),Jt()},$t=e=>{Wt.value&&!1===e&&u({title:"关闭邮件备份",content:"确认关闭当前备份计划?",onConfirm:async()=>{const{data:e}=await H();a.request(e),Nt.value.open=!1},onCancel:()=>{Nt.value.open=!e}})},Jt=async()=>{try{const{data:a}=await W();l(a)&&a.hasOwnProperty("type")&&(Wt.value=!0,Nt.value.open=!0,Nt.value.cycle=a.type,Nt.value.week=a.where1,Nt.value.hour=a.where_hour,Nt.value.minute=a.where_minute,Nt.value.backupTo=a.backupTo,Nt.value.save=a.save)}catch(a){Wt.value=!1,Nt.value.open=!1}},Qt=a=>{const e=parseInt(a);isNaN(e)||e<1?Nt.value.save=1:Nt.value.save=e},Xt=a=>{const e=parseInt(a);isNaN(e)||e<0?Nt.value.hour=0:Nt.value.hour=e>23?23:e},Yt=a=>{const e=parseInt(a);isNaN(e)||e<0?Nt.value.minute=0:Nt.value.minute=e>59?59:e},Zt={class:"flex items-center"},al={class:"w-100px"},el={class:"w-120px ml-16px"},tl=da({__name:"period",props:{value:{default:()=>({cycle:"week",week:"1",hour:1,minute:30})},valueModifiers:{}},emits:["update:value"],setup(a){const{weekOptions:e,cycleOptions:t}=Ht(),l=qa(a,"value");return(a,s)=>{const n=G,o=Pa;return pa(),ma("div",Zt,[va("div",al,[wa(n,{modelValue:l.value.cycle,"onUpdate:modelValue":s[0]||(s[0]=a=>l.value.cycle=a),options:ka(t)},null,8,["modelValue","options"])]),Aa(va("div",el,[wa(n,{modelValue:l.value.week,"onUpdate:modelValue":s[1]||(s[1]=a=>l.value.week=a),options:ka(e)},null,8,["modelValue","options"])],512),[[za,"week"===l.value.cycle]]),va("div",null,[wa(o,{modelValue:l.value.hour,"onUpdate:modelValue":s[2]||(s[2]=a=>l.value.hour=a),class:"ml-16px !w-140px",type:"number",min:0,max:23,controls:!1,onInput:ka(Xt)},{append:ga(()=>[...s[4]||(s[4]=[ba("小时",-1)])]),_:1},8,["modelValue","onInput"])]),va("div",null,[wa(o,{modelValue:l.value.minute,"onUpdate:modelValue":s[3]||(s[3]=a=>l.value.minute=a),class:"ml-16px !w-140px",type:"number",min:0,max:59,controls:!1,onInput:ka(Yt)},{append:ga(()=>[...s[5]||(s[5]=[ba("分钟",-1)])]),_:1},8,["modelValue","onInput"])])])}}}),ll={class:"p-20px"},sl={class:"flex-1"},nl={class:"flex items-center"},ol={class:"w-140px"},il=da({__name:"index",setup(a){const{form:e,toOptions:t}=ca(Ht()),{reset:l}=Ht();return Jt(),(async()=>{const{data:a}=await N();_(a.data)&&(Gt.value=a.data.map(a=>({label:a.name,value:a.value})),Gt.value.unshift({label:"服务器磁盘",value:"localhost"}))})(),ya(()=>{l()}),(a,l)=>{const s=Ma,n=Fa,o=G,i=Pa,r=Ea,u=Ua,c=Ba;return pa(),ha(c,{class:"mb-16px",shadow:"never"},{header:ga(()=>[...l[4]||(l[4]=[va("div",{class:"card-header"},[va("span",null,"备份计划")],-1)])]),default:ga(()=>[va("div",ll,[wa(u,{model:ka(e)},{default:ga(()=>[wa(n,{label:"邮件备份"},{default:ga(()=>[wa(s,{modelValue:ka(e).open,"onUpdate:modelValue":l[0]||(l[0]=a=>ka(e).open=a),onChange:ka($t)},null,8,["modelValue","onChange"])]),_:1}),wa(n,{label:"执行周期"},{default:ga(()=>[va("div",sl,[wa(tl,{value:ka(e),"onUpdate:value":l[1]||(l[1]=a=>xa(e)?e.value=a:null)},null,8,["value"])])]),_:1}),va("div",nl,[wa(n,{label:"备份到"},{default:ga(()=>[va("div",ol,[wa(o,{modelValue:ka(e).backupTo,"onUpdate:modelValue":l[2]||(l[2]=a=>ka(e).backupTo=a),options:ka(t)},null,8,["modelValue","options"])])]),_:1}),wa(n,{label:"保留最新","label-width":"auto"},{default:ga(()=>[wa(i,{modelValue:ka(e).save,"onUpdate:modelValue":l[3]||(l[3]=a=>ka(e).save=a),class:"!w-140px",type:"number",min:1,controls:!1,onInput:ka(Qt)},{append:ga(()=>[...l[5]||(l[5]=[ba("份",-1)])]),_:1},8,["modelValue","onInput"])]),_:1})]),wa(n,{label:" ","show-feedback":!1},{default:ga(()=>[wa(r,{type:"primary",onClick:ka(Kt)},{default:ga(()=>[...l[6]||(l[6]=[ba("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1})}}}),rl=ra("MAIL_BACKUP_IMPORT",()=>{const a=Oa({path:"/www/backup/path/"}),{table:e,columns:t}=Ka([{prop:"name",label:"文件名"},{prop:"mtime",label:"导入时间",render:a=>K(a.mtime)},Ya([{title:"恢复",onClick:async a=>{const{onRestore:e}=await o(()=>Promise.resolve().then(()=>fl),void 0,import.meta.url);e(a)}},{title:"删除",onClick:async a=>{const{onDelete:e}=await o(()=>Promise.resolve().then(()=>fl),void 0,import.meta.url);e(a)}}],{width:120,fixed:"right",label:"操作"})]),{loading:l,setLoading:s}=Ga();return{search:a,table:e,columns:t,loading:l,setLoading:s,reset:()=>{e.data=[],e.total=0}}}),{search:ul,table:cl}=ca(rl()),{setLoading:dl}=rl(),pl=()=>{$a({path:ul.value.path,uploadData:{accept:".gz,.tar,.tar.gz,.zip",multiple:!0},refreshEvent:(a,e)=>{_l(),e()}})},ml=()=>{le({type:"file",change:async a=>{b({request:$({file_path:a}),message:!0})}})},vl=async()=>{const{data:a}=await X();l(a)&&(ul.value.path=Y(a.data)?a.data:"")},_l=async()=>{try{dl(!0),await vl();const{data:a}=await J(Ha(ul.value));cl.value.data=_(a.data)?a.data:[]}finally{dl(!1)}},fl=Object.freeze(Object.defineProperty({__proto__:null,getList:_l,getPath:vl,onDelete:async e=>{await u({title:"删除备份",content:"确认删除当前备份?"});const{data:t}=await Q({path:"".concat(ul.value.path,"/").concat(e.name)});a.request(t),_l()},onRestore:async e=>{await u({title:"恢复备份",content:"确认恢复当前备份?"});const{data:t}=await $({file_path:"".concat(ul.value.path,"/").concat(e.name)});a.request(t)},onSelect:ml,onUpload:pl},Symbol.toStringTag,{value:"Module"})),yl={class:"px-20px py-16px"},hl=da({__name:"index",setup(a){const{loading:e,table:t}=ca(rl()),{columns:l,reset:s}=rl();return _l(),ya(()=>{s()}),(a,s)=>{const n=Ea,o=C,i=ee,r=Ba,u=Da("bt-loading");return pa(),ha(r,{shadow:"never"},{header:ga(()=>[...s[0]||(s[0]=[va("div",{class:"card-header"},[va("span",null,"邮件导入")],-1)])]),default:ga(()=>[va("div",yl,[wa(i,null,{"header-left":ga(()=>[wa(n,{onClick:ka(pl)},{default:ga(()=>[...s[1]||(s[1]=[ba("本地上传",-1)])]),_:1},8,["onClick"]),wa(n,{onClick:ka(ml)},{default:ga(()=>[...s[2]||(s[2]=[ba("在服务器中选择",-1)])]),_:1},8,["onClick"])]),content:ga(()=>[Aa(wa(o,{"max-height":340,bordered:!0,data:ka(t).data,column:ka(l)},null,8,["data","column"]),[[u,ka(e)]])]),_:1})])]),_:1})}}}),gl=da({__name:"index",setup:a=>(a,e)=>(pa(),ma("div",null,[wa(il),wa(hl)]))}),wl=ua(!1);Wa("添加IP标签",{isEdit:!1,row:void 0,onRefresh:async()=>{wl.value=!0}});const bl=ua({tag:"",ip:"",syslog:"",helo:"",ipv:4,binds:""}),kl=ua([]);ua([]);const xl=ua(!1),Cl=R([{label:"批量删除",value:"delete",event:async(a,e,t,l,s,n)=>{const{label:o,value:i}=l,r=new Map([["delete","批量删除已选的IP标签"]]);await a({title:"批量".concat(o),content:"".concat(r.get(i),"，是否继续操作！"),column:[{label:"标签名",prop:"tag"},Za()],onConfirm:async()=>{const a=await(async()=>{const a=new Map([["delete",la]]).get(i);if("delete"===i){const e=t.value.map(a=>a.tag).join(",");if(a)return await a({tags:e})}})();wl.value=!0;const e=[];a.status?t.value.forEach(a=>{e.push({name:a.tag,status:!0,msg:"删除成功"})}):t.value.forEach(a=>{e.push({name:a.tag,status:!1,msg:"删除失败"})}),s&&s(),te(e,{title:"".concat(o,"标签")})}})}}]),Il=async()=>{try{const{data:a}=await Z();return{data:a.data||[],total:0}}catch(a){return{data:[],total:0}}},Pl=async a=>{r({title:"添加IP标签",area:50,component:()=>o(()=>import("./index338.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{isEdit:!1},btn:!0})},El=async()=>{try{xl.value=!0;const{data:a}=await aa();if(Object.keys(a).length>0){const e=Object.values(a).flatMap(a=>Object.entries(a));kl.value=e.map(([a,e])=>({label:"".concat(e.public_ip),value:"".concat(e.addr),type:e.type}))}}catch(a){}finally{xl.value=!1}},Ol=a=>{var e;const t=null==(e=kl.value.find(e=>e.value===a))?void 0:e.type;return t?"IPv4"===t?4:6:4},Ll=()=>{bl.value={tag:"",ip:"",syslog:"",helo:"",ipv:4,binds:""}},Vl=async a=>!!(await b({request:ea(a),loading:"添加中...",message:!0})).status&&(wl.value=!0,!0),Tl=async a=>!!(await b({request:ta(a),loading:"编辑中...",message:!0})).status&&(wl.value=!0,!0),Rl=async a=>{bl.value=(a=>({tag:a.tag,ip:a.ip,syslog:a.syslog,helo:a.helo,ipv:"ipv6"===a.preference?6:4,binds:_(a.binds)?a.binds:[]}))(a),r({title:"编辑【".concat(a.tag,"】标签"),area:50,component:()=>o(()=>import("./index338.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{isEdit:!0},btn:!0})},Sl=da({__name:"index",setup(a){const e=[{content:'<span class="text-[#dc2626]">IP池中的IP标签可作为某个域名发送邮件的出口IP，在域名列表里配置</span>',isHtml:!0},{content:'<span class="text-[#dc2626]">每个IP可以有多个标签但是标签名不能重复</span>',isHtml:!0},{content:'<span class="text-[#dc2626]">调整完发送IP注意修改SPF记录，避免收件方退信或认定为垃圾邮件</span>',isHtml:!0}],t=()=>{sa.push("/mail/maildomain")},{BtTable:l,BtRefresh:s,BtBatch:n}=q({request:Il,columns:[ae({key:"tag"}),{label:"标签名",prop:"tag"},{renderHeader:()=>wa("div",null,[wa("span",null,[ba("IP")]),wa(Na,{placement:"top",effect:"light"},{default:()=>wa("span",{class:"ml-4px bt-ico-ask"},[ba("?")]),content:()=>wa("div",null,[wa("div",{class:"text-[#dc2626]"},[ba("• 只能选择由系统从网卡扫描出的IP，此处展示IP地址是通过网络请求获取的公网IP")]),wa("div",{class:"text-[#dc2626]"},[ba("• 不支持虚拟网卡，如docker、lo、veth、br-、tun、tap、virb等")]),wa("div",{class:"text-[#dc2626]"},[ba("• 若没有找到想要的IP请检查：")]),wa("div",{class:"text-[#dc2626]",style:"margin-left: 20px;"},[ba("1.IP绑定的网卡（ipa）")]),wa("div",{class:"text-[#dc2626]",style:"margin-left: 20px;"},[ba("2.是否能正常访问宝塔官网获取公网IP")]),wa("div",{class:"text-[#dc2626]",style:"margin-left: 20px;"},[ba("（curl --interface【网卡上的IP】https://www.bt.cn/api/getIpAddress）")])])})]),prop:"ip"},{renderHeader:()=>se("HELO/EHLO","用于HELO/EHLO的域名，绑定之后也可用于其它域名，不影响发送邮件"),prop:"helo"},Ya([{title:"编辑",onClick:a=>Rl(a)},{title:"删除",onClick:a=>(async a=>{u({title:"删除【".concat(a.tag,"】标签"),content:"确定删除【".concat(a.tag,"】标签吗？"),onConfirm:async()=>{try{await la({tags:a.tag}),wl.value=!0}catch(e){}}})})(a)}])],extension:[Cl,z(wl)]});return(a,s)=>{const o=Ea,i=ee,r=U;return pa(),ma("div",null,[wa(i,null,{"header-left":ga(()=>[wa(o,{type:"primary",onClick:ka(Pl)},{default:ga(()=>[...s[0]||(s[0]=[ba("添加IP标签",-1)])]),_:1},8,["onClick"])]),"header-right":ga(()=>[wa(o,{onClick:t},{default:ga(()=>[...s[1]||(s[1]=[ba("去使用",-1)])]),_:1})]),content:ga(()=>[wa(ka(l))]),"footer-left":ga(()=>[wa(ka(n))]),_:1}),wa(r,{class:"mt-[1rem]",options:e})])}}}),Ml={key:0,class:"software-mask"},jl={key:1,class:"software-install"},Dl={key:0,class:"software-view"},Al={class:"relative"},ql={class:"absolute right-0 top-0"},zl=s(da({__name:"index",setup(a){const e=na(),{install:t}=ca(e),l=[{name:"common",label:"通用设置",lazy:!0,render:()=>wa(_t,null,null)},{name:"ip",label:"IP池",lazy:!0,render:()=>wa(Sl,null,null)},{name:"bcc",label:"密件抄送",lazy:!0,render:()=>wa(It,null,null)},{name:"forward",label:"邮件转发",lazy:!0,render:()=>wa(Bt,null,null)},{name:"backup",label:"备份",lazy:!0,render:()=>wa(gl,null,null)}];return(a,e)=>{const s=O,n=oa,o=ia;return pa(),ma("div",null,[ka(t)?Ra("",!0):(pa(),ma("div",Ml)),ka(t)?Ra("",!0):(pa(),ma("div",jl,[ka(t)?Ra("",!0):(pa(),ma("div",Dl,[wa(s,{icon:"el-warning",size:30,class:"mr-[8px]",color:"orange"}),e[2]||(e[2]=va("span",{class:"text-[1.4rem] font-black"},"未安装邮件服务器",-1)),va("span",{class:"bt-link text-[1.3rem] ml-8px",onClick:e[0]||(e[0]=a=>ka(Ja)("mail_sys","i"))},"点击安装")]))])),va("div",null,[va("div",Al,[wa(n,{type:"card",options:l,modelValue:ka(ne),"onUpdate:modelValue":e[1]||(e[1]=a=>xa(ne)?ne.value=a:null)},null,8,["modelValue"]),va("div",ql,[wa(o,{onClick:ka(oe)},{default:ga(()=>[...e[3]||(e[3]=[ba("环境初始化",-1)])]),_:1},8,["onClick"])])])])])}}}),[["__scopeId","data-v-437876b2"]]),Fl=Object.freeze(Object.defineProperty({__proto__:null,default:zl},Symbol.toStringTag,{value:"Module"}));export{ge as M,Tt as a,Ft as b,Dt as c,Lt as d,Ut as e,Pt as f,At as g,jt as h,Ot as i,bl as j,Ol as k,kl as l,Vt as m,Tl as n,Vl as o,El as p,Ll as q,qt as r,xl as s,Ae as t,qe as u,Ue as v,Be as w,Fe as x,Fl as y};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
