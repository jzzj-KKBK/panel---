var e,a;import{R as l,v as t,k as s,e as u}from"./utils-lib.js?v=1756369731";import{j as o,r as n,c as i,s as r,w as v,p,G as c,H as d,x as m,q as b,v as f,F as x,y as _,e as y,A as h,a_ as j,P as g,B as k,aj as w,bM as S,M as T,z as F,ai as I,bN as D}from"./base-lib.js?v=1756369731";import{u as E,S as P}from"./useStore4.js?v=1756369731";import{getLoadInfo as z}from"./site.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const O=o("SITE-LOAD-STATE-STORE",()=>{const{siteInfo:e,siteType:a}=E();return{getLoadDataEvent:async e=>{try{const l=await z(e,a.value);return{status:l.status,data:l.data}}catch(l){return{status:!1,msg:"获取负载状态失败"}}}}}),{getLoadDataEvent:C}=O(),{siteInfo:A,siteType:L}=E(),V=n(""),H=n("java"===L.value?null!==(null==(e=A.value)?void 0:e.pid):null==(a=A.value)?void 0:a.run),M=n(!1),N=n(),R=n(),U=n(),q=n(),B=n(),G=[{label:"名称",value:"name"},{label:"状态",value:"status"},{label:"用户",value:"user"},{label:"启动时间",value:"create_time",isTime:!0},{label:"PID",value:"pid"},{label:"PPID",value:"ppid"},{label:"线程",value:"threads"},{label:"Socket",value:"connects"},{label:"CPU",value:"cpu_percent"},{label:"内存",value:"memory_used",isSize:!0},{label:"io读",value:"io_read_bytes",isSize:!0},{label:"io写",value:"io_write_bytes",isSize:!0},{label:"命令",value:"exe"}],J=n([{label:"文件",prop:"path"},{label:"mode",prop:"mode",width:50},{label:"position",prop:"position",width:100},{label:"flags",prop:"flags",width:80},{label:"fd",prop:"fd",width:60}]),K=n([{label:"客户端地址",prop:"client_addr",render:e=>e.client_addr||"--"},{label:"客户端端口",prop:"client_rport"},{label:"协议",prop:"family"},{label:"FD",prop:"fd"},{label:"本地地址",prop:"local_addr"},{label:"本地端口",prop:"local_port"},{label:"状态",prop:"status"}]),Q=e=>B.value?e.isTime?l(B.value[e.value]):e.isSize?t(B.value[e.value]):B.value[e.value]:"",W=async e=>{M.value=!0,R.value=N.value[e].open_files,U.value=N.value[e].connections,B.value=N.value[e],M.value=!1},X=e=>{try{const a=(null==e?void 0:e.load_info)||(null==e?void 0:e.data);Object.keys(a).length&&(q.value=Object.keys(a).map(e=>e),V.value=q.value[0],R.value=a[V.value].open_files,U.value=a[V.value].connections,B.value=a[V.value],N.value=a),"java"!==L.value&&(H.value=e.run)}catch(a){}},Y=async()=>{(async()=>{try{M.value=!0;let e={project_name:A.value.name};const a=L.value;"go"===a&&(e.has_load_info=1),"nodejs"===L.value&&(e.project_type=A.value.project_config.project_type||"nodejs");const l={java:e,default:{data:JSON.stringify(e)}},{data:t}=await C(l[a]||l.default);await X(t),M.value=!1}catch(e){return{status:!1,msg:"获取负载状态失败"}}})()},Z={class:"relative h-full"},$={key:0,class:"h-[68rem] overflow-auto"},ee={class:"flex items-center"},ae={class:"text-[#666] text-[1.2rem] font-bold"},le={class:"text-[1.2rem]"},te={key:1,class:"bg-[#7F7F7F] flex items-center justify-center h-full",style:{"min-height":"600px"}},se={key:1,class:"bg-[#7F7F7F] flex items-center justify-center h-full",style:{"min-height":"600px"}},ue={class:"bg-white px-[48px] py-[16px] text-[#333] flex"},oe=u(i({__name:"index",setup(e,{expose:a}){const{siteInfo:l,siteType:t}=r(P()),{jumpTabEvent:u}=P();return v(()=>l.value,e=>{var a,s;H.value="java"===t.value?null!==(null==(a=l.value)?void 0:a.pid):null==(s=l.value)?void 0:s.run},{immediate:!0}),p(Y),a({init:Y}),(e,a)=>{const l=I,t=w,o=D,n=S,i=s,r=c("bt-loading");return d((b(),f("div",Z,[m(H)?(b(),f("div",$,[m(V)?(b(),f(x,{key:0},[_("div",ee,[a[2]||(a[2]=_("span",{class:"mr-[1.6rem] font-bold text-[1.4rem]"},"进程",-1)),y(t,{modelValue:m(V),"onUpdate:modelValue":a[0]||(a[0]=e=>g(V)?V.value=e:null),onChange:m(W),class:"!w-[14rem]"},{default:h(()=>[(b(!0),f(x,null,j(m(q),e=>(b(),T(l,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),a[3]||(a[3]=_("span",{class:"text-[#666] mt-[1.6rem] mb-[.8rem] block font-bold text-[1.4rem]"},"基础信息",-1)),y(n,{class:"mt-[20px] table-descriptions",column:3,border:""},{default:h(()=>[(b(!0),f(x,null,j(m(G),(e,a)=>(b(),T(o,{key:a,"label-class-name":["!bg-[#fff]"]},{label:h(()=>[_("span",ae,F(e.label),1)]),default:h(()=>[_("div",le,F(m(Q)(e)),1)]),_:2},1024))),128))]),_:1}),a[4]||(a[4]=_("span",{class:"text-[#666] mt-[1.6rem] mb-[.8rem] block font-bold text-[1.4rem]"},"网络",-1)),y(i,{"max-height":160,column:m(K),data:m(U)},null,8,["column","data"]),a[5]||(a[5]=_("span",{class:"text-[#666] mt-[1.6rem] mb-[.8rem] block font-bold text-[1.4rem]"},"打开的文件列表",-1)),y(i,{height:210,column:m(J),data:m(R)},null,8,["column","data"])],64)):(b(),f("div",te,[...a[6]||(a[6]=[_("div",{class:"bg-white px-[48px] py-[16px] text-[#333] flex"}," 监听PID失败，请检查项目状态是否开启 ",-1)])]))])):(b(),f("div",se,[_("div",ue,[a[7]||(a[7]=k(" 请开启 ",-1)),_("span",{class:"mx-[.4rem] bt-link",onClick:a[1]||(a[1]=e=>m(u)("state"))},"项目状态"),a[8]||(a[8]=k(" 后查看负载状态 ",-1))])]))])),[[r,m(M)]])}}}),[["__scopeId","data-v-0437306a"]]);export{oe as default};
