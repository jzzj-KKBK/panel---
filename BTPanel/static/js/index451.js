import{u as a,L as e,at as t,K as s,o as u,M as l,al as r}from"./utils-lib.js?v=1756369731";import{getWebdavConf as i,removeAuth as o,setNginxAuth as n,setWebdav as m,removeWebdav as d,addWebdav as v,getXfsDisk as c,getPathQuota as g,setSiteQuota as _,setClientMaxBodySize as p}from"./site.js?v=1756369731";import{e as h,g as b,r as y,k as z,c as f,q,v as w,x as N,P as j}from"./base-lib.js?v=1756369731";import{p as x}from"./validator.js?v=1756369731";import{u as S}from"./useStore4.js?v=1756369731";import E from"./cataluge-setting.js?v=1756369731";const{siteInfo:I}=S(),{payment:T,enterpriseRec:O}=a(),{authType:P}=T.value,V=[{label:"网站目录",name:"catalugeTab",lazy:!0,render:()=>h(E,null,null)},...O.value?[{label:"网站配额",lazy:!0,name:"flowQuota",render:()=>e(()=>import("./capacity-quota.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)}]:[],{label:"nginx WebDav",lazy:!0,name:"nginxWebDav",render:()=>e(()=>import("./nginx-web-dav.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)}],D=b(()=>{var a;return(null==(a=I.value)?void 0:a.tabName)||"catalugeTab"}),L=y(!1),M=y(!1),B=y(!1),R=y({auth:!1,site_name:"",site_path:"",domain:"",status:!1,user:"",pass:"",client_max_body_size:""}),k=y({domain:""}),A=async()=>{try{const{data:a}=await i({site_name:I.value.name});if(B.value=!a.need_create||!1,M.value=a.status,a.need_create)return;R.value=Object.assign(R.value,a),R.value.auth=!!a.auth,a.auth&&(R.value.user=a.auth.auth_name,R.value.pass=a.auth.auth_value)}catch(a){t(a)}},U=async a=>{R.value.auth=Boolean(a),a||(R.value.user="",R.value.pass="",s({loading:"正在设置状态，请稍后...",request:o({site_name:I.value.name}),message:!0}))},W=async()=>{s({loading:"正在保存,请稍后...",request:n({site_name:I.value.name,auth_name:R.value.user,auth_value:R.value.pass}),message:!0})},C=async a=>{R.value.status=!Boolean(a);(await s({loading:"正在设置状态,请稍后...",request:m({site_name:I.value.name,option:a?1:0}),message:!0})).status&&(R.value.status=Boolean(a))},F=async()=>{const{name:a}=I.value;await u({title:"删除【".concat(a,"】webdav"),content:"是否删除【".concat(a,"】webdav，删除后将不再对域名进行限制?"),icon:"warning-filled"});(await s({loading:"正在删除webdav，请稍后...",request:d({site_name:a}),message:!0})).status&&A()},H=async()=>{await s({loading:"正在添加,请稍后...",request:v({domain:k.value.domain,site_id:I.value.id}),message:!0}),J(),A()},J=()=>{L.value=!1,k.value.domain=""},K=y(),Q=y(!1),G=y(!1),X=y([]),Y={size:[{required:!0,message:"容量不能为空",trigger:["blur"]},{validator:(a,e,t)=>{Number.isInteger(1*Z.size)?t():t(new Error("容量必须为整数"))},trigger:["blur","change"]}],alarmSize:[{required:!0,message:"触发告警大小不能为空",trigger:["blur"]},{validator:(a,e,t)=>{Z.status?Number.isInteger(1*Z.alarmNum)?t():t(new Error("触发告警大小必须为整数")):t()},trigger:["blur","change"]}],alarmNum:[{required:!0,message:"告警次数不能为空",trigger:["blur"]},{validator:(a,e,t)=>{Z.status?Number.isInteger(1*Z.alarmNum)?t():t(new Error("告警次数必须为整数")):t()},trigger:["blur","change"]}],module:[{required:!0,validator:(a,e,t)=>{Z.status&&0===Z.module.length?t(new Error("请选择告警方式")):t()},trigger:["blur","change"]}]},Z=z({used:0,size:0,status:!1,alarmSize:0,alarmNum:0,alarmModel:[],module:[],option:{}}),$=y(),aa=y(!1),ea=async a=>{var e;Q.value=!0;try{G.value=!1,X.value=[];let{quota:u}=a||I.value;if(!a)try{let{data:a}=await c({path:I.value.path});if(!a.status)return G.value=!0,void(X.value=null==(e=a.msg)?void 0:e.split("\n"));u=(await g({path:I.value.path})).data}catch(s){t(s)}let{quota_storage:l,quota_push:r}=u;l&&(Z.used=l.used,Z.size=l.size),r&&void 0!==r.module&&(Z.status=r.status,Z.alarmSize=r.size,Z.alarmNum=r.push_count,Z.module=""===r.module?[]:r.module.split(",")),(()=>{if(0===Z.size)return void($.value="未配置");const a=1024*Z.size*1024;Z.size>0&&Z.used>=a?$.value="当前容量已用完":$.value=(Z.used/1024/1024).toFixed(2)||0})(),Q.value=!1}catch(s){t(s)}finally{Q.value=!1}},ta=async()=>{const{path:a}=I.value;if("ltd"!==P)return void x({sourceId:183,disablePro:!0});let e={path:a,quota_type:"site",quota_push:{status:Z.status,size:Number(Z.alarmSize),push_count:Number(Z.alarmNum),module:Z.module.join(",")},quota_storage:{size:Number(Z.size)}};if(Z.status&&0===e.quota_push.module.length)return l.error("请选择至少一种告警方式");if(e.quota_storage.size<e.quota_push.size)return l.error("容量配额必须大于触发告警大小");await K.value.validate();try{aa.value=!0;const a=await _({data:JSON.stringify(e)});a.status?l.request(a):l.msg({dangerouslyUseHTMLString:!0,message:a.msg,type:"error",duration:0,showClose:!0})}catch(s){t(s)}finally{aa.value=!1}},sa=async()=>{const a=l.load("正在设置,请稍后...");try{const a=await p({site_name:I.value.name,client_max_body_size:R.value.client_max_body_size});l.request(a),A()}catch(e){}finally{a.close()}},ua=f({__name:"index",setup:a=>(a,e)=>{const t=r;return q(),w("div",null,[h(t,{type:"card",modelValue:N(D),"onUpdate:modelValue":e[0]||(e[0]=a=>j(D)?D.value=a:null),options:N(V)},null,8,["modelValue","options"])])}}),la=Object.freeze(Object.defineProperty({__proto__:null,default:ua},Symbol.toStringTag,{value:"Module"}));export{K as a,X as b,Z as c,F as d,U as e,sa as f,A as g,C as h,ea as i,L as j,k,J as l,G as m,R as n,ta as o,H as p,la as q,Y as r,W as s,$ as u,Q as v,B as w};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
