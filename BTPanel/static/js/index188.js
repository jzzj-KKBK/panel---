import{c as e,ay as a,r as s,U as t,g as l,k as o,w as r,q as n,v as i,e as u,A as p,B as c,x as d,y as f,z as m,F as v,M as _,H as b,I as h,D as w,b0 as g,au as z,b3 as y,av as k,aw as x}from"./base-lib.js?v=1756369731";import{u as q,v as j,b as D}from"./utils-lib.js?v=1756369731";import{u as E}from"./useStore2.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const O={class:"p-[2rem]"},C={class:"h-[40rem] border border-[#EBEEF5] mt-[1rem]"},F={class:"ml-[0.5rem]"},I=e({__name:"index",props:{compData:{default:()=>({path:"",refreshEvent:()=>{}})}},setup(e,{expose:I}){const B=D(),{panel:H}=q();E();const M=e,S=a("popupSetFooter"),A=a("buttonText");let P=!0;const T=s(),U=s([]),G=t([".sql",".zip",".bak",".gz"].join(",")),J={"x-http-token":window.vite_public_request_token},K=window.location.protocol+"//"+window.location.host+"/files?action=upload",L=l(()=>{var e;return M.compData.path?M.compData.path:null==(e=H.value.backupPath+"/database")?void 0:e.replace(/\/\//g,"/")}),N=o({f_size:0,f_path:L.value,f_name:"",f_start:0}),Q=()=>{B.success("导入成功"),M.compData.refreshEvent()},R=(e,a,s)=>{s.push(a),B.error("导入失败")},V=e=>{N.f_size=e.size,N.f_name=e.name,N.f_start=0},W=(e,a)=>{const s=e.name.substring(e.name.lastIndexOf(".")+1),t=["sql","zip","bak","gz"];if(-1===t.indexOf(s))return!1;U.value=a.filter(e=>{let a=e.name.substring(e.name.lastIndexOf(".")+1);return-1!==t.indexOf(a)})||[]},X=(e,a,s)=>{N.f_start=e.percent,U.value=s.map(s=>(s.uid===a.uid&&(s.percentage=e.percent),s))};return r(()=>U.value.length,e=>{if(0===e)return void S(!1);const a=["success","fail","ready"];for(let s=0;s<U.value.length;s++)if(!a.includes(U.value[s].status))return void S(!1);U.value.some(e=>"success"!==e.status)&&(A.value=P?"开始上传":"重新上传",S(!0))}),I({onConfirm:()=>{U.value.map(e=>{"success"!==e.status&&(e.status="ready")}),P=!1,T.value.submit(),S(!1)}}),(e,a)=>{const s=w,t=g,l=z,o=y,r=k,q=x;return n(),i("div",O,[u(t,{class:"upload-demo",ref_key:"upload",ref:T,name:"blob",data:d(N),action:K,headers:J,accept:d(G),multiple:!0,"show-file-list":!1,"auto-upload":!1,"file-list":d(U),"on-error":R,"on-success":Q,"on-progress":X,"on-change":W,"before-upload":V},{default:p(()=>[u(s,{type:"primary"},{default:p(()=>[...a[0]||(a[0]=[c("导入",-1)])]),_:1})]),_:1},8,["data","accept","file-list"]),f("div",C,[u(q,{height:"400",data:d(U)},{empty:p(()=>[u(r,{description:"只支持'.sql', '.zip', '.bak', '.gz'文件格式导入"})]),default:p(()=>[u(l,{prop:"name","show-overflow-tooltip":!0,label:"名称"},{default:p(e=>[a[1]||(a[1]=f("i",{style:{color:"#409eff"},class:"svgtofont-el-document"},null,-1)),f("span",F,m(e.row.name),1)]),_:1}),u(l,{prop:"name",label:"是否成功",width:"300"},{default:p(e=>["success"===e.row.status?(n(),i(v,{key:0},[c("上传成功！")],64)):"fail"===e.row.status?(n(),i(v,{key:1},[c("上传失败!")],64)):"ready"===e.row.status?(n(),i(v,{key:2},[c("等待上传")],64)):(n(),_(o,{key:3,percentage:Math.floor(e.row.percentage)},null,8,["percentage"]))]),_:1}),u(l,{width:"120",prop:"size",label:"大小"},{default:p(e=>[c(m(d(j)(e.row.size)),1)]),_:1}),u(l,{prop:"name",width:"180",align:"right","show-overflow-tooltip":!0,label:"操作"},{default:p(e=>[b(u(s,{type:"text",size:"small",onClick:a=>{return s=e.row,void(U.value=U.value.filter(e=>e.name!==s.name));var s}},{default:p(()=>[...a[2]||(a[2]=[c("删除",-1)])]),_:2},1032,["onClick"]),[[h,"ready"===e.row.status||"fail"===e.row.status]])]),_:1})]),_:1},8,["data"])]),a[3]||(a[3]=f("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-2rem"},[f("li",null,"仅支持sql、zip、sql.gz、(tar.gz|gz|tgz)")],-1))])}}});export{I as default};
