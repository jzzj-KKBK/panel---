import{_ as e}from"./index116.js?v=1756369731";import{getBackupSize as a,getImportSize as s}from"./database.js?v=1756369731";import{M as l}from"./utils-lib.js?v=1756369731";import{c as t,r,p as i,aD as c,q as n,v as o,y as m,z as u,x as p,e as d,C as v}from"./base-lib.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const f={class:"relative w-full text-[1.6rem] flex items-center mb-2rem"},x={class:"flex flex-col ml-1rem leading-2rem"},g={class:"text-[1.2rem] mt-[8px]"},y={class:"grid grid-cols-3 leading-3rem py-1rem text-[1.4rem]"},D={class:"flex items-center mr-1rem"},b={class:"truncate flex-1"},h={class:"flex items-center mr-1rem"},_={class:"truncate flex-1"},j={class:"flex items-center"},w={class:"truncate flex-1"},F={key:0,class:"pl-2rem mt-2re leading-8 text-[1.2rem] list-disc"},C=t({__name:"index",props:{compData:{default:()=>({type:"",refreshFn:()=>{},successFlag:!1,config:{id:"",name:"",path:""}})}},emits:["close","onCancel"],setup(t,{expose:C,emit:k}){const T=t,O=k,{id:S,name:q,path:z}=T.compData.config,H=r(""),M=r(""),N=r("获取中...\t"),A=r(!0),B=r(null),E=r("import"===T.compData.type?"导入":"recover"===T.compData.type?"恢复":"压缩"),G=r(),I=async()=>{try{const{data:e}="backup"===T.compData.type?await a({id:Number(S)}):await s({name:q});if(G.value&&(A.value=!0),!e.status)return K(),A.value=!1,void(N.value=e.msg);N.value!==e.msg&&(N.value=e.msg),(null==e?void 0:e.total)&&(H.value=e.total,M.value=e.speed);let l=(-1!==e.msg.indexOf("成功!")||-1!==e.msg.indexOf("successful"))&&e.status;if(l)return void J();(null==e?void 0:e.speed)&&A.value&&!l&&(B.value=setTimeout(function(){I()},1e3))}catch(e){K()}},J=()=>{A.value=!1,"repair"===T.compData.type&&(l.success("修复完成，请按 Ctrl+F5 刷新缓存，或等待2s自动刷新！"),setTimeout(()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},2e3)),O("close"),K(),T.compData.refreshFn&&T.compData.refreshFn()},K=()=>{B.value=null,clearTimeout(B.value),A.value=!1};return i(I),c(K),C({onCancel:K}),(a,s)=>{const l=e;return n(),o("div",{class:"p-2rem flex-wrap",ref_key:"progressDialog",ref:G},[m("div",f,[s[0]||(s[0]=m("i",{class:"svgtofont-el-loading text-3rem animate-spin"},null,-1)),m("div",x,[m("span",null,"正在"+u(p(E))+"数据库文件，请稍后...",1),m("span",g,"当前"+u(p(E))+"任务为后台"+u(p(E))+"，可关闭此页面进行其他操作",1)])]),s[2]||(s[2]=m("hr",{class:"!border-[#dedede]"},null,-1)),m("div",y,[m("div",D,[m("span",null,u(p(E))+"数据库：",1),m("div",b,u(a.compData.config.name),1)]),m("div",h,[m("div",null,u(p(E))+"大小：",1),m("div",_,u(p(H)||"--"),1)]),m("div",j,[m("div",null,u(p(E))+"速度：",1),m("div",w,u(p(M)||"--"),1)])]),d(l,{class:"h-[30rem]",content:p(N)},null,8,["content"]),"import"===a.compData.type?(n(),o("ul",F,[...s[1]||(s[1]=[m("li",null,"导入完成后，可到导入->导入日志查看导入结果",-1)])])):v("",!0)],512)}}});export{C as default};
