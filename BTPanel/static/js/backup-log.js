import{_ as e}from"./index116.js?v=1756369731";import{c as a,r as s,w as l,p as t,aD as i,q as n,v as c,y as r,z as o,x as m,e as u,A as d,B as p,D as v}from"./base-lib.js?v=1756369731";import{b as f,o as g,K as x}from"./utils-lib.js?v=1756369731";import{getBackupLogs as w,stopBackup as _}from"./site.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const b={class:"p-2rem flex-wrap"},y={class:"relative w-full text-[1.6rem] flex items-center leading-4rem mb-1rem justify-between"},j={class:"ml-1rem"},D={class:"grid grid-cols-3 leading-3rem py-1rem text-[1.4rem]"},C={class:"flex items-center mr-1rem"},h={class:"truncate flex-1"},T={class:"flex items-center mr-1rem"},k={class:"truncate flex-1"},q={class:"flex items-center"},H={class:"truncate flex-1"},M=a({__name:"backup-log",props:{compData:{default:()=>({type:"scan",endMsg:"扫描结束",logPath:"",successMsg:"修复成功",isClear:!1,completeEvent:null,id:""})}},emits:["close","onCancel"],setup(a,{expose:M,emit:z}){const A=a,B=z,E=s(""),K=s(""),P=s(""),F=s("");l(()=>A.compData,e=>{J.value=!0,O()});const G=f(),I=s("获取中...\t"),J=s(!0),L=s(null);let N=!1;const O=async()=>{if(!N)try{const{data:e}=await w({id:A.compData.id});if(I.value!==e.msg&&(I.value=e.msg),(null==e?void 0:e.total)&&(E.value=e.total,K.value=e.speed,P.value=e.site_name,F.value=e.title),e.stop)return J.value=!1,void(e.status?(G.success(e.title),B("close"),R()):(G.error(e.title),J.value=!1));!e.stop&&J.value&&(L.value=setTimeout(function(){O()},1e3))}catch(e){J.value&&O()}},Q=async()=>{await g({width:"40rem",title:"取消备份",content:'<p>取消选中站点备份文件后，<span class="text-danger">该站点备份文件将永久消失</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0}),await x({loading:"正在取消备份，请稍后...",request:_({id:A.compData.id}),message:!0}),B("close")},R=()=>{L.value&&clearTimeout(L.value)},S=()=>{A.compData.isClear&&clearTimeout(L.value)};return B("onCancel",S),t(()=>{O()}),i(()=>{R(),N=!0}),M({onCancel:S}),(a,s)=>{const l=v,t=e;return n(),c("div",b,[r("div",y,[r("div",null,[s[0]||(s[0]=r("i",{class:"svgtofont-el-loading text-3rem"},null,-1)),r("span",j,o(m(F)||"正在备份，请稍后..."),1)]),u(l,{type:"warning",plain:"",onClick:Q},{default:d(()=>[...s[1]||(s[1]=[p("取消备份",-1)])]),_:1})]),s[5]||(s[5]=r("hr",{class:"!border-[#dedede]"},null,-1)),r("div",D,[r("div",C,[s[2]||(s[2]=r("span",null,"备份网站：",-1)),r("div",h,o(m(P)||"--"),1)]),r("div",T,[s[3]||(s[3]=r("div",null,"已备份：",-1)),r("div",k,o(m(E)||"--"),1)]),r("div",q,[s[4]||(s[4]=r("div",null,"备份速度：",-1)),r("div",H,o(m(K)||"--"),1)])]),u(t,{class:"h-[30rem]",content:m(I)},null,8,["content"])])}}});export{M as default};
