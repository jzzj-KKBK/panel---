!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",u=a.toStringTag||"@@toStringTag";function l(n,a,o,u){var l=a&&a.prototype instanceof i?a:i,s=Object.create(l.prototype);return r(s,"_invoke",function(n,r,a){var o,u,l,i=0,s=a||[],f=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(e,n){return o=e,u=0,l=t,p.n=n,c}};function v(n,r){for(u=n,l=r,e=0;!f&&i&&!a&&e<s.length;e++){var a,o=s[e],v=p.p,d=o[2];n>3?(a=d===r)&&(l=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=t):o[0]<=v&&((a=n<2&&v<o[1])?(u=0,p.v=r,p.n=o[1]):v<d&&(a=n<3||o[0]>r||r>d)&&(o[4]=n,o[5]=r,p.n=d,u=0))}if(a||n>1)return c;throw f=!0,r}return function(a,s,d){if(i>1)throw TypeError("Generator is already running");for(f&&1===s&&v(s,d),u=s,l=d;(e=u<2?t:l)||!f;){o||(u?u<3?(u>1&&(p.n=-1),v(u,l)):p.n=l:p.v=l);try{if(i=2,o){if(u||(a="next"),e=o[a]){if(!(e=e.call(o,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,u<2&&(u=0)}else 1===u&&(e=o.return)&&e.call(o),u<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=t}else if((e=(f=p.n<0)?l:n.call(r,p))!==c)break}catch(e){o=t,u=1,l=e}finally{i=1}}return{value:e,done:f}}}(n,o,u),!0),s}var c={};function i(){}function s(){}function f(){}e=Object.getPrototypeOf;var p=[][o]?e(e([][o]())):(r(e={},o,function(){return this}),e),v=f.prototype=i.prototype=Object.create(p);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,r(t,u,"GeneratorFunction")),t.prototype=Object.create(v),t}return s.prototype=f,r(v,"constructor",f),r(f,"constructor",s),s.displayName="GeneratorFunction",r(f,u,"GeneratorFunction"),r(v),r(v,u,"Generator"),r(v,o,function(){return this}),r(v,"toString",function(){return"[object Generator]"}),(n=function(){return{w:l,m:d}})()}function r(t,e,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}r=function(t,e,n,a){function u(e,n){r(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!a,configurable:!a,writable:!a}):t[e]=n:(u("next",0),u("throw",1),u("return",2))},r(t,e,n,a)}function a(t,e,n,r,a,o,u){try{var l=t[o](u),c=l.value}catch(t){return void n(t)}l.done?e(c):Promise.resolve(c).then(r,a)}function o(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var u=t.apply(e,n);function l(t){a(u,r,o,l,c,"next",t)}function c(t){a(u,r,o,l,c,"throw",t)}l(void 0)})}}System.register(["./utils-lib-legacy.js?v=1756369731","./base-lib-legacy.js?v=1756369731","./index-legacy104.js?v=1756369731","./validator-legacy.js?v=1756369731","./index-legacy103.js?v=1756369731","./index-legacy100.js?v=1756369731","./index-legacy116.js?v=1756369731","./__commonjsHelpers__-legacy.js?v=1756369731","./column-legacy.js?v=1756369731"],function(e,r){"use strict";var a,u,l,c,i,s,f,p,v,d,m,y,g,h,b,x,w,k,A,_,j,T,S,I,O,C,B,L,E,G,R,P,Z,z,F,q,M,V,J,K,Q,U,X,D,N,H,Y,W,$,tt,et,nt,rt,at,ot;return{setters:[function(t){a=t.u,u=t.b3,l=t.a3,c=t.fR,i=t.ah,s=t.c,f=t.ai,p=t.a5,v=t.L,d=t.o,m=t.fS,y=t.b,g=t.e,h=t.cY,b=t.K,x=t.fT,w=t.aj,k=t._,A=t.d,_=t.fU,j=t.l,T=t.fV,S=t.a2,I=t.cp},function(t){O=t.c,C=t.r,B=t.ay,L=t.p,E=t.G,G=t.H,R=t.x,P=t.q,Z=t.v,z=t.y,F=t.e,q=t.A,M=t.B,V=t.C,J=t.F,K=t.a_,Q=t.n,U=t.av,X=t.a$,D=t.z,N=t.J,H=t.M,Y=t.ar,W=t.g,$=t.w,tt=t.Z},function(t){et=t._},function(t){nt=t.A},function(t){rt=t._},function(t){at=t.B},function(t){ot=t._},null,null],execute:function(){var ut={class:"w-full h-full flex flex-col justify-center content-center"},lt={key:0,class:"h-full"},ct={class:"flex align-middle justify-center h-full"},it={key:1,class:"taskList pr-[10px] mb-[10px]"},st={key:0,class:"taskTips flex justify-between"},ft={class:"taskItemHeader"},pt={class:"taskItemName"},vt=["onClick"],dt={key:0,id:"taskRealTimeLogs",class:"taskRealTimeLog"},mt=O({__name:"task-list",setup:function(e,g){var h=g.expose,b=a().panel,x=y(),w=C(!0),k=C(!0),A=C([]),_=C(""),j=C(!1),T=C(B("msgBoxSockShell",null)),S=[],I=null,O=function(){var t=o(n().m(function t(){var e,r,a,o,i,s,f;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,w.value=!0,t.n=1,u();case 1:e=t.v,r=e.data,l(r)&&void 0!==r.task?(a=r.task,o=r.msg,b.value.msgBoxTaskCount=a.length,a.length>0&&(k.value=!0,A.value=a,i=a[0],s=i.type,f=i.status,"execshell"===s?"-1"===f?(H(),_.value="",_.value=o,Q(function(){return c("#taskRealTimeLogs")}),j.value=!0):(setTimeout(function(){O()},2e3),j.value=!0):j.value=!1)):(b.value.msgBoxTaskCount=0,k.value=!1),t.n=3;break;case 2:t.p=2,t.v;case 3:return t.p=3,w.value=!1,t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}));return function(){return t.apply(this,arguments)}}(),H=function(){var t=o(n().m(function t(){return n().w(function(t){for(;;)switch(t.n){case 0:if(!T.value){t.n=1;break}return t.a(2);case 1:T.value=i({route:"/sock_shell",onMessage:function(){var t=o(n().m(function t(e,r){var a;return n().w(function(t){for(;;)switch(t.n){case 0:if(!((a=r.data).indexOf("|-Successify --- 命令已执行! ---")>-1)){t.n=3;break}return t.n=1,O();case 1:return t.n=2,W();case 2:setTimeout(o(n().m(function t(){var e;return n().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,O();case 1:if(!j.value){t.n=2;break}return t.a(2);case 2:null===(e=T.value)||void 0===e||e.close(),T.value=null,_.value="";case 3:return t.a(2)}},t)})),2e3),t.n=5;break;case 3:if(!f(a)){t.n=5;break}if(S.push(a),(null==S?void 0:S.length)>50&&S.shift(),!p(I)){t.n=4;break}return t.a(2);case 4:I=setTimeout(function(){_.value=S.join(""),I=null},500);case 5:return t.a(2)}},t)}));return function(e,n){return t.apply(this,arguments)}}()}),T.value.send("tail -n 100 -f /tmp/panelExec.log");case 2:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}(),Y=function(){var t=o(n().m(function t(e){var r,a,o;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return r=null,t.p=1,t.n=2,d({icon:"warning-filled",title:"删除任务",content:"删除当前选中任务，删除后将取消任务执行，是否继续操作？"});case 2:return r=x.load("正在删除任务，请稍后..."),t.n=3,m({id:e});case 3:o=t.v,x.request(o),o.status&&O(),null===(a=T.value)||void 0===a||a.close(),t.n=5;break;case 4:t.p=4,t.v;case 5:return t.p=5,r.close(),t.f(5);case 6:return t.a(2)}},t,null,[[1,4,5,6]])}));return function(e){return t.apply(this,arguments)}}(),W=function(){var t=o(n().m(function t(){var e,a,o;return n().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,v(function(){return r.import("./validator-legacy.js?v=1756369731").then(function(t){return t.aN})},void 0,r.meta.url);case 1:e=t.v,a=e.useSoftStore,o=a(),(0,o.refreshRouteData)("1");case 2:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}();return h({init:O}),L(O),function(e,n){var r=U,a=s,o=X,u=et,l=E("scroll-bottom"),c=E("bt-loading");return G((P(),Z("div",ut,[R(k)?(P(),Z("div",it,[R(A).length>0?(P(),Z("div",st,[n[3]||(n[3]=z("span",null," 提示：若任务长时间未执行，请尝试点击【重启面板】来重置任务队列 ",-1)),F(a,{onClick:R(nt)},{default:q(function(){return t(n[2]||(n[2]=[M("重启面板",-1)]))}),_:1},8,["onClick"])])):V("",!0),F(o,{class:"!my-1rem"}),(P(!0),Z(J,null,K(R(A),function(t,e){return P(),Z("div",{key:e,class:"taskItem"},["execshell"===t.type?(P(),Z(J,{key:0},[z("div",ft,[z("span",pt,D(t.name),1),z("span",null,[z("span",{class:N({leaveOut:"-1"===t.status})},D("0"===t.status?"等待":"正在安装"),3),F(u),z("span",{class:"bt-link",onClick:function(e){return Y(t.id)}}," 删除 ",8,vt)])]),"-1"===t.status&&"execshell"===t.type?G((P(),Z("pre",dt,[M(D(R(_)),1)])),[[l]]):V("",!0)],64)):V("",!0)])}),128))])):(P(),Z("div",lt,[z("div",ct,[F(r,{class:"flex"},{image:q(function(){return t(n[0]||(n[0]=[z("i",{class:"!text-[#999] svgtofont-empty !text-7rem"},null,-1)]))}),description:q(function(){return t(n[1]||(n[1]=[z("span",{class:"text-[16px] text-medium"},"当前没有任务执行",-1)]))}),_:1})])]))])),[[c,R(w)]])}}}),yt=g(mt,[["__scopeId","data-v-2845c920"]]),gt={class:"mt-8px leading-8 text-[1.2rem] list-disc ml-20px"},ht={id:"wechat-customer",class:"wechat-customer"},bt={class:"customer-title"},xt={class:"flex border-solid border-b-1 border-[#20a53a] text-[#20a53a] justify-center items-center"},wt={class:"qrcode-wechat w-[128px] h-[128px] mt-[8px] mb-[4px]"},kt={id:"wechatCustomerQrcode"},At=O({__name:"completed-list",setup:function(e,a){var u=a.expose,l=C([{label:"名称",prop:"name",showOverflowTooltip:!0,render:function(t){return F("div",null,[F("span",{class:"mr-2 font-bold !text-[12px] ".concat(t.install_status?"text-primary svgtofont-el-check":"text-danger svgtofont-el-close")},null),t.name])}},{label:"创建时间",prop:"addtime",width:110,render:function(t){return F("span",null,[t.addtime.replace(/^\d{4}-/,"")])}},{label:"任务耗时",width:80,render:function(t){return F("span",null,[_(t.end-t.start)])}},{label:"安装详情",width:140,showOverflowTooltip:!0,render:function(t){return F("span",{class:t.install_status?"text-primary":"text-danger"},[t.msg||"安装成功"])}},{label:"操作",align:"right",width:55,render:function(t){return null!==t.msg_info?F("span",{class:"text-primary cursor-pointer",onClick:function(){return i(t)}},[M("详情")]):""}}]),c=function(){var t=o(n().m(function t(e){var r,a,o;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,b({request:x({table:"tasks",search:"1",limit:10,p:e.p}),data:{page:String,data:Array}});case 1:return r=t.v,a=r.data,o=r.page,t.a(2,{data:a,total:w(o),other:{}});case 2:return t.p=2,t.v,t.a(2,{data:[],total:0,other:{}})}},t,null,[[0,2]])}));return function(e){return t.apply(this,arguments)}}(),i=function(t){return j({title:"当前状态：".concat(t.msg_info.title),area:[72,50],compData:t.msg_info,component:function(){return v(function(){return r.import("./details-legacy.js?v=1756369731")},void 0,r.meta.url)}})},f=h({request:c,columns:l.value}),p=f.BtTable,d=f.BtPage;return u({init:f.refresh}),function(e,n){var r=k,a=s,o=A,u=at,l=rt;return P(),H(l,null,{content:q(function(){return[F(R(p)),z("ul",gt,[z("li",null,[n[4]||(n[4]=M(" 如安装或启动失败，请点击详情，截图相关错误信息 ",-1)),F(u,{placement:"bottom-start",effect:"light","popper-class":"!p-0",trigger:"hover",width:"160px"},{reference:q(function(){return t(n[3]||(n[3]=[z("span",{class:"inline-block bt-link"},"咨询客服",-1)]))}),default:q(function(){return[z("div",ht,[z("div",bt,[F(a,{target:"_blank",href:"https://www.bt.cn/new/wechat_customer",class:"text-[16px] cursor-pointer flex flex-row items-center flex-nowrap"},{default:q(function(){return[z("div",xt,[n[0]||(n[0]=M(" 点击咨询客服 ",-1)),F(r,{icon:"arrow",size:16,color:"#20a53a",class:"ml-[5px]"})])]}),_:1})]),z("div",wt,[z("div",kt,[F(o,{src:"/customer/customer-qrcode.png"})])]),n[1]||(n[1]=z("div",{class:"wechat-title flex"},[z("img",{class:"w-[14px] h-[14px]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAATlJREFUSEvtVrFOw0AMfed8AxJsZWGAgQHBXP4DCQa+Ioou7g18BRIg9T/KDGJggIGFbiDxDXGQowSBuGvrFISEmtF+7/nis312RVEMiWgIoMT375aIjpj5KeJrTMy8JSJjAPsRzEhErl1Zlhd1XZ8kRKZEdMjM0xlBBiIyATCIYZxzl857X6uTiHaY+TElZrUz87aIPCjvI0gIwVmF5uG7H1gFmZepxv85XTdqCCEcLMQ0gLz3jbbTOm/rPdkLBt0v0E77xysq2it9T2nhuTzPN4ho10KyYEXkXvvkBcC6hWjEvmqQMwCnANZa8p1RJAbfa41vAM7/0cUzczOiZ43zvunrtPVOntuO3+wrluJ12qspvFBm/+bR+u03nhPrkKZk2ZVINUZO964sy44Ta9FSK5GuQ1VVXb0DLf+sHQ9tLL0AAAAASUVORK5CYII="}),z("div",{class:"text-[14px] font-black"},"扫一扫")],-1)),n[2]||(n[2]=z("span",{class:"layui-layer-setwin wechat-close",style:{display:"block"}},[z("a",{href:"javascript:;",class:"layui-layer-ico layui-layer-close layui-layer-close2"})],-1))])]}),_:1}),n[5]||(n[5]=M(" 求助 ",-1))])])]}),"footer-right":q(function(){return[F(R(d),{"pager-count":5,layout:"prev, pager, next, total, jumper"})]}),_:1})}}}),_t=g(At,[["__scopeId","data-v-e78a2174"]]),jt=O({__name:"perform-log",setup:function(t,e){var r=e.expose,a=C(!1),u=C("获取中..."),l=function(){var t=o(n().m(function t(){var e;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,b({loading:a,request:T(),data:String});case 1:e=t.v,u.value=e.trim()||"暂无执行日志",t.n=3;break;case 2:t.p=2,t.v;case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}();return r({init:l}),L(l),function(t,e){var n=ot,r=E("bt-loading");return G((P(),H(n,{class:"h-50rem",content:R(u)},null,8,["content"])),[[r,R(a)]])}}}),Tt=function(t){return t.taskList="taskList",t.completedList="completedList",t.performLog="performLog",t}(Tt||{});e("default",O({__name:"index",setup:function(t,e){var r=e.expose,u=a().panel,l=Y(u.value,"msgBoxTaskCount"),c=C(0),i=C(null),s=W(function(){return"任务列表(".concat(l.value,")")}),f=W(function(){return"消息列表(".concat(c.value,")")});$(l,function(t,e){e>t&&(c.value+=e-t)});var p=S({type:"left-bg-card",options:[{label:function(){return F(J,null,[s.value])},name:Tt.taskList,lazy:!0,render:yt},{label:function(){return F(J,null,[f.value])},name:"completedList",lazy:!0,render:_t},{label:"执行日志",name:"performLog",lazy:!0,render:jt}]}).BtTabs,v=function(){var t=o(n().m(function t(){var e,r;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,b({request:I({table:"tasks",search:"1",limit:11}),data:{page:String}});case 1:e=t.v,r=e.page,c.value=w(r),t.n=3;break;case 2:t.p=2,t.v;case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}();return L(v),tt("msgBoxSockShell",i),r({onCancel:function(){i.value&&(i.value.close(),i.value=null)}}),function(t,e){return P(),H(R(p))}}}))}}})}();
