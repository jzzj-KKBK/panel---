import{K as a,h$ as e,i0 as n,v as t,i1 as s,o as i,M as o,k as l,a0 as r,W as c}from"./utils-lib.js?v=1756369731";import{_ as m}from"./index103.js?v=1756369731";import{r as d,k as p,c as u,p as f,aD as _,G as b,q as y,v as w,e as g,A as h,x as k,B as v,H as C,D as j}from"./base-lib.js?v=1756369731";import{p as x}from"./useMethods.js?v=1756369731";import{c as q,a as W,u as D}from"./column.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const z=d(),A=p({loading:!1,list:[]}),H=[{label:"删除",value:"delete",event:async(a,e,n,t)=>{const{label:i,value:o}=t,l=async(a,e)=>{const{container_id:n,container_name:t,name:i}=a;if("delete"===o)return await s({data:JSON.stringify({container_id:n,container_name:t,name:i})})};await a({title:"批量".concat(i,"容器备份"),content:"批量".concat(i,"已选的容器备份，删除后备份文件将无法恢复，是否继续操作！"),column:[{label:"文件名",prop:"name"},q()],onConfirm:async()=>(await e(l),I(),!1)})}}],M=async()=>{a({request:e({container_id:z.value.id}),message:!0,success:async a=>{a.status&&(await I(),await x(!0))}})},B=async e=>{try{await i({icon:"warning-filled",title:"删除备份文件",width:"45rem",content:"删除[".concat(e.name,"]备份文件后，该备份文件将永久消失，是否继续操作？")}),a({loading:"正在删除...",request:s({container_id:e.container_id,container_name:e.container_name,name:e.name}),success:async({status:a})=>{a&&(await I(),o.success("删除成功"))},error:a=>{o.request(a)}})}catch(n){}},G=async a=>{window.open("/download?filename="+encodeURIComponent(a.filename),"_blank","noopener,noreferrer")},I=async()=>{A.loading=!0,a({request:n({container_id:z.value.id}),data:Array,success:a=>{A.list=a,A.loading=!1}})},J={class:"p-[1.6rem]"},K=u({__name:"index",props:{compData:{default:()=>({})}},setup(a){const e=a,n=d(),s=[W({key:"name"}),{label:"文件名",prop:"name",minWidth:140},{label:"存储位置",prop:"filename",minWidth:180,isCustom:!0},{label:"文件大小",prop:"size",minWidth:86,isCustom:!0,render:a=>t(a.size)},{label:"备份时间",prop:"addtime",minWidth:120,isCustom:!0},D([{onClick:G,title:"下载"},{onClick:B,title:"删除"}])];return f(()=>{(a=>{z.value=a.compData.row,I()})(e)}),_(()=>{A.list=[],A.loading=!1,z.value={}}),(a,e)=>{const t=j,i=l,o=r,d=m,p=c,u=b("bt-loading");return y(),w("div",J,[g(d,null,{"header-left":h(()=>[g(t,{type:"primary",onClick:k(M)},{default:h(()=>[...e[0]||(e[0]=[v("容器备份",-1)])]),_:1},8,["onClick"])]),content:h(()=>[C(g(i,{ref_key:"backupTable",ref:n,column:k(s),"max-height":"420",data:k(A).list,description:"备份列表为空"},null,8,["column","data"]),[[u,k(A).loading],[u,"正在加载镜像列表，请稍后...","title"]])]),"footer-left":h(()=>[g(o,{"table-ref":k(n),options:k(H)},null,8,["table-ref","options"])]),_:1}),g(p,{class:"mt-[2rem] ml-[1rem]",options:[{content:"备份任务创建成功后后台进行，可以关闭黑色窗口，备份完成可能需要1分钟以上！"}]})])}}});export{K as default};
