import{_ as a}from"./index103.js?v=1756369731";import{u as e,K as l,M as t,j as s,k as n,a0 as o,c as i,W as r,h as u,o as d,at as c}from"./utils-lib.js?v=1756369731";import{B as m}from"./index140.js?v=1756369731";import{c as p,r as f,e as v,p as w,G as b,q as g,v as h,y as x,x as y,P as _,A as j,F as V,a_ as k,B as C,H as q,aj as U,D as A,aB as S,M as B,ai as D}from"./base-lib.js?v=1756369731";import{a as E,u as T}from"./column.js?v=1756369731";import{o as F}from"./useController6.js?v=1756369731";import{S as H,u as M}from"./useStore4.js?v=1756369731";import{getDirBinding as N,addDirBinding as R,getFileBody as G,deleteDirBindMultiple as I,delDirBinding as K,getDirRewrite as O}from"./site.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./ace.js?v=1756369731";import"./index104.js?v=1756369731";import"./validator.js?v=1756369731";const P={class:"flex items-center"},W={class:"flex items-center mr-[16px]"},z={class:"flex items-center mr-[16px]"},J={class:"p-[20px]"},L={class:"flex items-center justify-between"},Q={class:"flex items-center"},X=p({__name:"index",props:{compData:{default:()=>({})}},setup(p,{expose:X}){const{saveFileEvent:Y}=H(),{plugin:Z}=e(),{siteInfo:$}=M(),aa=f(),ea=f(""),la=f([]),ta=f("");f([]);const sa=f(!1),na=f(""),oa=f(""),ia=f([]),ra=f(""),ua=f(!1),da=[{content:"请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default"},{content:"您可以对伪静态规则进行修改，修改完后保存即可。"}],ca=f([]),ma=f(!1),pa=async()=>{await l({loading:ma,request:N({id:$.value.id}),data:{dirs:[Array,la],binding:[Array,ca]}}),ta.value=la.value[0]||""},fa=async()=>{if(!ta.value||!ea.value)return void t.error("域名和子目录都不可为空！");(await l({loading:"正在添加子目录中,清稍后...",request:R({id:$.value.id,domain:ea.value,dirName:ta.value}),message:!0})).status&&(ea.value="",pa())},va=async()=>{await Y({data:na.value,encoding:"utf-8",path:ra.value})},wa=async a=>{let e=t.load("正在获取伪静态内容，请稍候..."),l={id:a.id};a.add&&(l.add=1);try{const t=await O(l);e.close(),t.data.status?(na.value=t.data.data,ia.value=t.data.rlist,oa.value=t.data.rlist[0],ra.value=t.data.filename,sa.value=!0):(await d({title:"创建伪静态",icon:"warning-filled",content:"你真的要为这个子目录创建独立的伪静态规则吗？"}),wa({...a,add:1}))}catch(s){c(s)}finally{e.close()}},ba=async a=>{l({loading:ua,request:G({path:"/www/server/panel/rewrite/".concat(Z.value.webserver,"/").concat(a,".conf")}),data:{data:[String,na]}})},ga=f([E(),{prop:"domain",label:"域名",render:a=>v("span",{class:"cursor-pointer bt-link",onClick:()=>{window.open("http://".concat(a.domain,":").concat(a.port),"_blank","noopener,noreferrer")}},[a.domain])},{prop:"port",label:"端口"},{width:220,label:"子目录",render:a=>v("span",null,[a.path])},T([{onClick:wa,title:"伪静态",width:60},{onClick:async a=>{await d({title:"删除【".concat(a.domain,"】"),content:"删除选中的子目录绑定后，将无法访问该子目录绑定的域名，是否继续操作？",icon:"warning-filled"});(await l({loading:"正在删除，请稍后...",request:K({id:a.id}),message:!0})).status&&pa()},title:"删除"}])]),ha=[{label:"删除",value:"delete",event:async(a,e,l,t,s)=>{await d({title:"批量删除",width:"35rem",icon:"warning-filled",content:"批量删除，该操作可能会存在风险，是否继续？"});let n=[l.value.map(a=>a.id)];const{data:o}=await I({bind_ids:n,id:$.value.id});let i=[];await o.success.forEach(a=>{i.push({name:a,msg:"删除成功",status:!0})}),await Object.keys(o.error).forEach(a=>{i.push({name:a,msg:o.data.error[a],status:!1})}),await F({resultData:i,resultTitle:"删除",resultColumn:[{label:"域名",prop:"name"},{label:"结果",render:a=>S("span",{class:a.status?"text-primary":"text-danger"},a.status?a.msg||"操作成功":a.msg||"操作失败")}]}),pa(),s()}}];return w(pa),X({init:pa}),(e,l)=>{const t=s,d=D,c=U,p=A,f=n,w=o,S=i,E=m,T=r,F=u,H=a,M=b("bt-loading");return g(),h("div",null,[x("div",P,[x("div",W,[l[5]||(l[5]=x("span",{class:"mr-[16px] w-[4rem]"},"域名",-1)),v(t,{modelValue:y(ea),"onUpdate:modelValue":l[0]||(l[0]=a=>_(ea)?ea.value=a:null),placeholder:"请输入域名"},null,8,["modelValue"])]),x("div",z,[l[6]||(l[6]=x("span",{class:"mr-[16px]"},"子目录",-1)),v(c,{class:"!w-[15rem]",filterable:"",modelValue:y(ta),"onUpdate:modelValue":l[1]||(l[1]=a=>_(ta)?ta.value=a:null)},{default:j(()=>[(g(!0),h(V,null,k(y(la),(a,e)=>(g(),B(d,{key:e,value:a,label:a},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),v(p,{type:"primary",onClick:fa},{default:j(()=>[...l[7]||(l[7]=[C("添加",-1)])]),_:1})]),v(H,null,{"header-left":j(()=>[...l[8]||(l[8]=[])]),"header-right":j(()=>[...l[9]||(l[9]=[])]),content:j(()=>[q(v(f,{ref_key:"subTableRef",ref:aa,"max-height":"500",column:y(ga),data:y(ca)},null,8,["column","data"]),[[M,y(ma)]])]),"footer-left":j(()=>[v(w,{"table-ref":y(aa),options:y(ha)},null,8,["table-ref","options"])]),"footer-right":j(()=>[...l[10]||(l[10]=[])]),popup:j(()=>[v(F,{title:"伪静态规则",modelValue:y(sa),"onUpdate:modelValue":l[4]||(l[4]=a=>_(sa)?sa.value=a:null),area:50},{default:j(()=>[x("div",J,[x("div",L,[v(c,{class:"!w-[15rem]",modelValue:y(oa),"onUpdate:modelValue":l[2]||(l[2]=a=>_(oa)?oa.value=a:null),onChange:ba},{default:j(()=>[(g(!0),h(V,null,k(y(ia),(a,e)=>(g(),B(d,{key:e,value:a,label:a},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),x("span",Q,[l[12]||(l[12]=C(" 规则转换工具： ",-1)),v(S,{class:"flex items-center",href:"https://www.bt.cn/Tools",target:"_blank"},{default:j(()=>[...l[11]||(l[11]=[C("Apache转Nginx ",-1),x("i",{class:"svgtofont-el-link"},null,-1)])]),_:1})])]),q(v(E,{id:"statictRef",class:"!h-[40rem] !w-full my-[12px]",modelValue:y(na),"onUpdate:modelValue":l[3]||(l[3]=a=>_(na)?na.value=a:null),onSave:va},null,8,["modelValue"]),[[M,y(ua)]]),x("div",null,[v(p,{type:"primary",onClick:va},{default:j(()=>[...l[13]||(l[13]=[C("保存",-1)])]),_:1})]),v(T,{options:da,class:"ml-[20px] mt-[20px]"})])]),_:1},8,["modelValue"])]),_:1})])}}});export{X as default};
