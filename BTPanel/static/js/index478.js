import{_ as e}from"./index116.js?v=1756369731";import{K as l,b as a,o as t,W as o,j as s,ag as n,h as i,A as d,e as m}from"./utils-lib.js?v=1756369731";import{r,k as c,c as u,p,G as v,H as f,x as g,q as y,v as _,e as C,A as k,B as b,y as x,F as w,a_ as V,Q as j,J as h,z as E,I as q,P as U,D as L,a9 as A,a7 as B,C as F,M as H}from"./base-lib.js?v=1756369731";import{B as I}from"./column.js?v=1756369731";import{getServiceLog as S,modifyService as z,addService as J,getServicesInfo as R,delService as D,handleService as G}from"./site.js?v=1756369731";import{u as K}from"./useStore4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const M=a(),{siteInfo:N}=K(),O=r([]),P=r(!1),Q=r(),W=r(!1),T=c({name:"",command:"",sid:"",level:11,log_type:"append",isEdit:!1}),X=r(!1),Y=r(!1),Z=r([{label:"追加记录",value:"append"},{label:"启动时清空",value:"cover"}]),$=r(!1),ee=c({logContent:"",logLoading:!1,title:"",sid:""}),le=c({name:[{required:!0,message:"请输入服务名称",trigger:"blur"}],command:[{required:!0,message:"请输入启动命令",trigger:"blur"}],level:[{required:!0,message:"请输入优先级",trigger:"blur"}]}),ae=r([{content:"协同服务用于管理那些与web服务同时运行的，用于处理一些事务的服务，如：任务队列、定时队列等，例如：celery等。"},{content:"当前工作方式为启动项目时检测这些服务，若未启动则执行启动，若已启动则不进行操作；停止项目时执行所有服务的停止操作"}]),te=e=>{T.log_type=e},oe=()=>{ue(),P.value=!0},se=e=>{T.name=e.name,T.command=e.command,T.sid=e.sid,T.level=e.level,T.log_type=e.log_type,T.isEdit=!0,P.value=!0},ne=async e=>{try{!e&&(ee.logLoading=!0);const{data:l}=await S({project_name:N.value.name,sid:ee.sid});ee.logContent=l.data,ee.logLoading=!1,e&&M.success("刷新成功")}catch(l){}},ie=e=>{ee.sid=e.sid,ee.title="main"===e.sid?"项目主服务":e.name,$.value=!0,ne(!1)},de=async e=>{await t({icon:"warning-filled",title:"删除服务【".concat(e.name,"】"),content:"删除服务【".concat(e.name,"】后，将无法管理该服务，是否继续？")});(await l({loading:"正在删除服务，请稍后...",request:D({project_name:N.value.name,sid:e.sid}),message:!0})).status&&pe()},me=async(e,a)=>{(await l({loading:"正在修改服务状态，请稍后...",request:G({project_name:N.value.name,sid:a.sid,option:e}),message:!0})).status&&pe()},re=()=>{P.value=!1,ue()},ce=async()=>{await Q.value.validate();let e={project_name:N.value.name,service_conf:JSON.stringify({name:T.name,command:T.command,level:T.level,log_type:T.log_type})};T.isEdit&&(e.sid=T.sid);const a=T.isEdit?z:J;(await l({loading:W,request:a(e),message:!0})).status&&(P.value=!1,ue(),pe())},ue=()=>{T.name="",T.command="",T.sid="",T.level=11,T.log_type="append",T.isEdit=!1},pe=async(e=!1)=>{e&&(Y.value=!0),await l({request:R({project_name:N.value.name}),data:{data:[Array,O]}}),e&&(Y.value=!1)},ve={class:"overflow-auto mt-1rem max-h-[61rem]"},fe={class:"flex flex-col p-[16px]"},ge={class:"service-info"},ye={class:"item-info"},_e={class:"flex items-center"},Ce={class:"item-info"},ke={key:0},be={key:1},xe={key:0,class:"item-info"},we={class:"!w-[100%]"},Ve=["onClick"],je={class:"flex items-center mt-[16px]"},he={class:"p-2rem"},Ee={class:"ml-[1rem] text-[#20a53a] w-[16rem] select-none"},qe={class:"py-[2rem] pt-[0]"},Ue={class:"p-2rem flex flex-col"},Le=m(u({__name:"index",setup:l=>(p(()=>{pe(!0)}),(l,a)=>{const t=L,m=o,r=s,c=A,u=n,p=B,S=i,z=e,J=v("bt-loading");return f((y(),_("div",null,[C(t,{type:"primary",onClick:g(oe)},{default:k(()=>[...a[9]||(a[9]=[b("添加服务",-1)])]),_:1},8,["onClick"]),x("div",ve,[(y(!0),_(w,null,V(g(O),(e,l)=>(y(),_("div",{class:"border rounded-[2px] border-[#EBEEF5] mb-[16px]",key:l},[x("div",fe,[x("div",ge,[x("div",ye,[x("div",null,"服务："+E(e.name),1),x("div",_e,[a[10]||(a[10]=b("状态：",-1)),C(g(I),{modelValue:!!e.pid},null,8,["modelValue"])])]),x("div",Ce,[e.pid?(y(),_("div",ke,"pid："+E(e.pid),1)):F("",!0),e.ports.length?(y(),_("div",be,"端口："+E(e.ports.join(", ")),1)):F("",!0)]),e.sid&&"main"!==e.sid?(y(),_("div",xe,[x("div",we,[b(" 启动命令："+E(e.command)+" ",1),x("i",{class:"svgtofont-el-document-copy cursor-pointer text-[#333] text-[1.5rem] copy ml-[4px]",title:"复制启动命令",onClick:()=>g(d)({value:e.command})},null,8,Ve)])])):F("",!0)]),x("div",je,[e.pid?(y(),H(t,{key:1,type:"default",onClick:l=>g(me)("stop",e)},{default:k(()=>[...a[12]||(a[12]=[b("停止",-1)])]),_:2},1032,["onClick"])):(y(),H(t,{key:0,type:"default",onClick:l=>g(me)("start",e)},{default:k(()=>[...a[11]||(a[11]=[b("启动",-1)])]),_:2},1032,["onClick"])),C(t,{type:"default",onClick:l=>g(me)("restart",e)},{default:k(()=>[...a[13]||(a[13]=[b("重启",-1)])]),_:2},1032,["onClick"]),"main"!==e.sid?(y(),_(w,{key:2},[C(t,{type:"default",onClick:l=>g(se)(e)},{default:k(()=>[...a[14]||(a[14]=[b("编辑",-1)])]),_:2},1032,["onClick"]),C(t,{type:"default",onClick:l=>g(ie)(e)},{default:k(()=>[...a[15]||(a[15]=[b("日志",-1)])]),_:2},1032,["onClick"]),C(t,{type:"default",onClick:l=>g(de)(e)},{default:k(()=>[...a[16]||(a[16]=[b("删除",-1)])]),_:2},1032,["onClick"])],64)):F("",!0)])])]))),128))]),C(m,{options:g(ae)},null,8,["options"]),C(S,{title:"".concat(g(T).isEdit?"编辑":"添加","服务"),modelValue:g(P),"onUpdate:modelValue":a[6]||(a[6]=e=>U(P)?P.value=e:null),area:50,"show-footer":!0,onConfirm:g(ce),onCancel:g(re)},{default:k(()=>[x("div",he,[C(p,{rules:g(le),"label-width":"90px",model:g(T),ref_key:"servicesFormRef",ref:Q,disabled:g(W),size:"small",onSubmit:a[5]||(a[5]=j(()=>{},["prevent"]))},{default:k(()=>[C(c,{label:"名称",prop:"name"},{default:k(()=>[C(r,{modelValue:g(T).name,"onUpdate:modelValue":a[0]||(a[0]=e=>g(T).name=e),name:"name",width:"32rem"},null,8,["modelValue"])]),_:1}),C(c,{label:"启动命令",prop:"command"},{default:k(()=>[C(r,{modelValue:g(T).command,"onUpdate:modelValue":a[1]||(a[1]=e=>g(T).command=e),name:"command",width:"32rem"},null,8,["modelValue"])]),_:1}),x("div",{class:"more flex items-center cursor-pointer pl-[10rem] my-[2rem] px-[2rem]",onClick:a[2]||(a[2]=e=>X.value=!g(X))},[x("i",{class:h(g(X)?"svgtofont-el-arrow-down":"svgtofont-el-arrow-right")},null,2),x("div",Ee,E("更多设置，".concat(g(X)?"点击收回":"点击查看")),1)]),f(x("div",qe,[C(c,{label:"优先级",prop:"level"},{default:k(()=>[C(r,{modelValue:g(T).level,"onUpdate:modelValue":a[3]||(a[3]=e=>g(T).level=e),type:"number",name:"level",width:"32rem"},null,8,["modelValue"])]),_:1}),C(c,{label:"日志管理",prop:"log_type"},{default:k(()=>[C(u,{modelValue:g(T).log_type,"onUpdate:modelValue":a[4]||(a[4]=e=>g(T).log_type=e),options:g(Z),onChange:g(te),class:"!w-32rem"},null,8,["modelValue","options","onChange"])]),_:1})],512),[[q,g(X)]])]),_:1},8,["rules","model","disabled"]),f(C(m,{class:"pl-4rem",options:[{content:"【优先级】执行项目启动时，会按照优先级从高到低一次启动服务，主服务的优先级为10"}]},null,512),[[q,g(X)]])])]),_:1},8,["title","modelValue","onConfirm","onCancel"]),C(S,{title:"【".concat(g(ee).title,"】服务日志"),modelValue:g($),"onUpdate:modelValue":a[8]||(a[8]=e=>U($)?$.value=e:null),area:70},{default:k(()=>[f((y(),_("div",Ue,[x("div",null,[C(t,{onClick:a[7]||(a[7]=e=>g(ne)(!0)),type:"default",class:"!mb-1rem"},{default:k(()=>[...a[17]||(a[17]=[b("刷新日志",-1)])]),_:1})]),C(z,{content:g(ee).logContent,isHtml:!0,class:"h-41rem","full-screen":{title:"全屏查看【".concat(g(ee).title,"】服务日志"),onRefresh:()=>g(ne)}},null,8,["content","full-screen"])])),[[J,g(ee).logLoading]])]),_:1},8,["title","modelValue"])])),[[J,g(Y)]])})}),[["__scopeId","data-v-a6a782c4"]]);export{Le as default};
