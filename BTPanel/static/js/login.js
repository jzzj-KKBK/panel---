var t,e=Object.defineProperty,n=(t,n,o)=>(((t,n,o)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o})(t,"symbol"!=typeof n?n+"":n,o),o);function o(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const s=class t{constructor(){n(this,"autoLoginParams",{password:"",username:""})}checkAutoLogin(){return new Promise((t,e)=>{const n=new URL(window.location.href);if(""!==n.search){new URLSearchParams(n.search).forEach((t,e)=>{this.autoLoginParams[e]=t}),this.autoLoginParams.username&&this.autoLoginParams.password&&t(this.autoLoginParams)}})}bindEvent(t,e,n){t&&t.addEventListener?t.addEventListener(e,n,!1):t&&t.attachEvent?t.attachEvent("on".concat(e),n||null):t["on".concat(e)]=n||null}delegateEvent(t,e,n,o){"string"==typeof n&&t?t.addEventListener(e,function(t){const e=t.target.closest(n);this.contains(e)&&o&&o.call(e,t)},!1):"string"!=typeof n&&this.bindEvent(t,e,n)}convertType(t,e){if(typeof t===e)return t;if("string"===e)return String(t);if("number"===e)return Number(t);throw new Error("Unsupported target type: ".concat(e))}renderSelect(t){const{el:e,options:n,active:o,change:s,size:i}=t,r=document.createElement("div"),c=document.createElement("div");if(e.classList.add("form-select-module"),e.innerHTML="",i&&e.classList.add(i),c.classList.add("select-list"),n.length>0){let t=o;void 0===o&&(t=n[0].key);for(let e=0;e<n.length;e++){const o=document.createElement("div");o.classList.add("select-item"),"boolean"==typeof n[e].disabled&&n[e].disabled&&o.classList.add("disabled"),o.innerText=n[e].label,o.dataset.key=n[e].key,o.dataset.disabled="".concat(Number(n[e].disabled)),n[e].key===t&&(o.classList.add("active"),r.innerText=n[e].label),c.appendChild(o)}}r.classList.add("select-display"),e.appendChild(r),e.appendChild(c);const l=t=>{t.target.classList.contains("disabled")&&t.target.classList.contains("select-item")?this.message({message:"当前选项不可选",type:"error",time:2e3}):(e.classList.remove("active"),window.removeEventListener("click",l))};return this.delegateEvent(r,"click",t=>{t.stopPropagation(),e.classList.toggle("active"),e.classList.contains("active")?window.addEventListener("click",l):window.removeEventListener("click",l)}),this.delegateEvent(c,"click",".select-item",t=>{const o=t.target,{key:i,disabled:l}=o.dataset,a=o.innerText;if(Number(l))return!1;const d=n.findIndex(t=>t.key===this.convertType(i,typeof t.key));c.querySelectorAll(".select-item").forEach((t,e)=>{d===e?t.classList.add("active"):t.classList.remove("active")}),r.innerText=a,e.classList.remove("active"),e.dataset.key=i,s&&s(i,d)}),window.removeEventListener("click",l),e.dataset.key}validateForm(t){const{rules:e}=t,n={},o={};for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){o[s]=document.querySelector('[name="'.concat(s,'"]'));const t=e[s];t.trigger&&t.trigger.forEach(i=>{let r=!1;n[s]=e=>{const n=o[e];return t.validator(n.value.trim(),function(t){var e,o,s,i;try{throw new Error(t)}catch(c){r=!1;const t=c.message.replace("Error: ","");null==(o=null==(e=n.parentElement)?void 0:e.querySelector(".error-tips"))||o.remove(),null==(s=n.parentElement)||s.classList.remove("error"),t&&(r=!0,null==(i=n.parentElement)||i.classList.add("error"),n.insertAdjacentHTML("afterend",'<div class="error-tips">'.concat(t,"</div>")))}}),!r||new Error("".concat(e,":").concat(o[e].vlaue))},this.bindEvent(o[s],i,function(){if("isShow"in e[s]&&!e[s].isShow())return!0;const t=this.getAttribute("name");n[t](t)})})}return t=>{let s=0;for(const r in n)if(Object.prototype.hasOwnProperty.call(n,r)){const t=n[r];try{if("isShow"in e[r]&&!e[r].isShow())continue;const n=t(r);if("object"==typeof n)throw n}catch(i){return s++,o[r].focus(),!1}}if(!s){const e={};for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t)){const n=o[t],{value:s}=n;e[t]=s.trim()}t(e)}}}handleTransformRequest(t){let e="";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const o=t[n];e+="".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(o),"&")}return e=e.slice(0,-1),e}async request({url:t,data:e,method:n}={method:"post",data:{},url:""}){return new Promise((o,s)=>{const i=new XMLHttpRequest;i.open(n,t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.timeout=25e4,i.onreadystatechange=()=>{if(4===i.readyState)if(i.status>=200&&i.status<300)try{o({...i,data:JSON.parse(i.responseText)})}catch(t){o({...i,data:i.responseText,error:t})}else s(new Error(i.statusText))},i.ontimeout=()=>s(new Error("Request timed out")),i.onerror=()=>s(new Error("Network error")),i.send(this.handleTransformRequest(e))})}async rsaEncrypt(t){const{JSEncrypt:e}=window,n=window.vite_public_encryption;if(n.length<10)return t;const o=new e;return o.setPublicKey(n),o.encrypt(t)}async encryptionData(t){const{md5:e}=window;return t.username=await this.rsaEncrypt(e(e(t.username+window.vite_public_login_token))),t.password=await this.rsaEncrypt(e("".concat(e(t.password),"_bt.cn"))),t}removeEmpty(t){return Object.entries(t).reduce((t,[e,n])=>(null!=n&&""!==n&&(t[e]=n),t),{})}loading(e){const n='<div id="full-loading" class="el-loading-mask login-loading" style="background-color: rgba(0, 0, 0, 0.3); z-index: 3006;">\n\t\t\t<div class="el-loading-spinner">\n\t\t\t\t<i class="svgtofont-loading">'.concat(t.svgLogin,'</i>\n\t\t\t\t<p class="el-loading-text">').concat(e,"</p>\n\t\t\t</div>\n\t\t</div>");return window.document.body.insertAdjacentHTML("beforeend",n),{close(){const t=document.getElementById("full-loading");t&&t.remove()}}}message({message:t,type:e,time:n=3e3,close:o=!1}){var s;null==(s=document.getElementById("el-message"))||s.remove();const i="success"===e?"circle-check-filled":"circle-close-filled",r='<div id="el-message" class="el-message el-message--'.concat(e,'" style="z-index: 4001;">\n\t\t\t\t').concat(o?'<div class="el-dialog-close"></div>':"",'\n\t\t\t\t<div class="el-message__icon loading-icon svgtofont-el-').concat(i,'"></div>\n\t\t\t\t<div class="el-message__content">').concat(t||"","</div>\n\t\t\t</div>");window.document.body.insertAdjacentHTML("beforeend",r),n&&setTimeout(()=>{const t=document.getElementById("el-message");t&&t.remove()},n),o&&this.bindEvent(document.querySelector(".el-dialog-close"),"click",()=>{var t;null==(t=document.getElementById("el-message"))||t.remove()})}tooltip({el:t,text:e}){var n;null==(n=document.getElementById("el-tooltip"))||n.remove();const o='<div  id="el-tooltip" x-placement="top" class="el-tooltip__popper is-dark el-tooltip-white overview-popover w-[40rem] custom-login-popover" style="transform-origin: center bottom; z-index: 3009; display: none;">\n\t\t\t\t<div class="leading-8 p-[8px]">'.concat(e,'</div>\n\t\t\t\t<div class="popper__arrow" style="left: 154px;"></div>\n\t\t</div>');window.document.body.insertAdjacentHTML("beforeend",o);const s=document.getElementById("el-tooltip");let i=0;this.bindEvent(t,"mouseenter",t=>{clearTimeout(i),s.style.display="block",s.style.left="".concat(t.clientX-t.offsetX-150,"px"),s.style.top="".concat(t.clientY-t.offsetY-s.clientHeight-10,"px")}),this.bindEvent(t,"mouseleave",()=>{clearTimeout(i),i=setTimeout(()=>{s.style.display="none"},100)}),this.bindEvent(s,"mouseenter",()=>{clearTimeout(i),s.style.display="block"}),this.bindEvent(s,"mouseleave",()=>{clearTimeout(i),i=setTimeout(()=>{s.style.display="none"},100)}),s.style.left="calc(50% - ".concat(s.offsetWidth/2,"px)"),s.style.top="calc(50% - ".concat(s.offsetHeight/2,"px)")}};n(s,"svgLogin",'<img src="'.concat((null==(t=window.vite_public_icon_info)?void 0:t.login_logo)||"/static/icons/logo-green.svg",'" alt="logo" />'));let i=s;class r extends i{constructor(t){super(),n(this,"el"),n(this,"formData"),n(this,"formVerify"),n(this,"node"),n(this,"codeCheck"),n(this,"hostCheck"),n(this,"googleCheck"),n(this,"loginErrorTimer"),n(this,"timer"),n(this,"submitError"),this.initData(t),this.nodeMout(),this.render(),this.event()}initData(t){const e=localStorage.getItem("safeMode");this.el="string"==typeof t?document.querySelector(null==t?void 0:t.el):t,this.formData={},this.node={},this.formData.safe_mode=Number(e||1),this.el.innerHTML=r.template(),this.codeCheck=window.vite_public_login_check,this.formVerify={form:null,vcode:null}}static template(){return'<div class="w-full">\n\t\t\t<div class="login-title"><span class="title-text" title="'.concat(window.vite_public_title,'">').concat(window.vite_public_title,'</span></div>\n\t\t\t<div class="login-form">\n\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<input class="login-form-input" name="username" autocomplete="off" type="text" autofocus placeholder="账号" />\n\t\t\t\t\t\t<div class="input-action-icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<input class="login-form-input" name="password" autocomplete="off" type="password" placeholder="密码" />\n\t\t\t\t\t\t<div class="input-action-icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<div class="login-safe-mode !w-[230px]"></div>\n\t\t\t\t\t\t<div class="loading-icon svgtofont-el-question-filled cursor-pointer !text-warning h-[20px] ml-[15px] text-[20px]"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-item flex login-code-view !hidden"> \n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<input class="login-form-input !w-[230px] mr-[15px]" name="code" type="code" placeholder="验证码" />\n\t\t\t\t\t\t<div class="input-action-icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="cut-login-code"><img title="点击切换验证码" class="w-[100%] h-[40px]" /></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<button class="login-form-button login-submit">登录</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-footer">\n\t\t\t\t\t<div class="flex">\n\t\t\t\t\t\t<div class="cdn-node"> 加速节点 </div>\n\t\t\t\t\t\t<div class="login-cdn-accelerate"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<a class="bt-link noreferrer_tips" href="https://www.bt.cn/new/wechat_customer" target="_blank" rel="noreferrer noopener">无法登录？联系客服</a>\n\t\t\t\t\t\t<div class="el-divider el-divider--vertical"></div>\n\t\t\t\t\t\t<a class="bt-link" href="https://www.bt.cn/bbs/thread-1172-1-1.html" target="_blank" rel="noreferrer noopener">忘记密码</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="login-form google-verify-view !hidden">\n\t\t\t\t\t<div class="login-google-verify">\n\t\t\t\t\t\t<div class="close-popup-btn -right-[15px] -top-[15px]"></div>\n\t\t\t\t\t\t<div class="login-title !mt-0">动态口令认证</div>\n\t\t\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t<input class="login-form-input" name="vcode" type="text" placeholder="请输入动态口令" />\n\t\t\t\t\t\t\t\t<div class="input-action-icon"></div>\n\t\t\t\t\t\t\t</div>\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t\t\t<button class="login-form-button login-google-verify-submit">验证并登录</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ul class="mt-4x leading-8 text-[1.2rem]">\n\t\t\t\t\t\t\t<li>请使用宝塔APP或谷歌认证器获取验证代码</li>\n\t\t\t\t\t\t\t<li><a href="https://www.bt.cn/bbs/forum.php?mod=viewthread&tid=105839" target="_blank" rel="noreferrer noopener" class="bt-link" ><span class="el-link--inner"> 无法验证，点击帮助 </span></a></li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="google-verify-shade"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>')}nodeMout(){this.node={loginForm:this.el.querySelector(".login-form"),inputUsername:this.el.querySelector('[name="username"]'),inputPassword:this.el.querySelector('[name="password"]'),codeView:this.el.querySelector(".login-code-view"),inputCode:this.el.querySelector('[name="code"]'),cutCode:this.el.querySelector(".cut-login-code"),formSafeMode:this.el.querySelector(".login-safe-mode"),formSubmit:this.el.querySelector(".login-submit"),formGoogleVerifySubmit:this.el.querySelector(".login-google-verify-submit"),closePopupBtn:this.el.querySelector(".close-popup-btn"),formGoogleVerifyView:this.el.querySelector(".google-verify-view"),formGoogleVerifyInput:this.el.querySelector('[name="vcode"]'),formCdnAccelerate:this.el.querySelector(".login-cdn-accelerate"),formTipsQuestion:this.el.querySelector(".svgtofont-el-question-filled")}}render(){const{formSafeMode:t}=this.node;this.renderSelect({el:t,options:[{key:1,label:"安全登录模式(推荐)"},{key:0,label:"普通登录模式(不推荐)"}],active:this.formData.safeMode,change:t=>{this.formData.safe_mode=Number(t)}}),this.renderHostsList(),this.codeVerify(this.codeCheck),this.cutCheckCode()}event(){const{cutCode:t,formSubmit:e,inputPassword:n,inputUsername:o,formGoogleVerifyInput:s,formGoogleVerifySubmit:i,formTipsQuestion:r,inputCode:c}=this.node;this.formVerify.form=this.validateForm({el:this.node.loginForm,rules:{username:{validator:(t,e)=>{""===t?e(new Error("账号不能为空")):t.length<3?e(new Error("账号长度必须大于等于3位")):e()},trigger:["input","blur"]},password:{validator:(t,e)=>{""===t?e(new Error("密码不能为空")):e()},trigger:["input","blur"]},code:{isShow:()=>this.codeCheck,validator:(t,e)=>{""===t?e(new Error("验证码不能为空")):4!==t.length?e(new Error("验证码长度错误，必须为4位")):e()},trigger:["input","blur"]}}}),this.formVerify.vcode=this.validateForm({el:this.node.formGoogleVerifyView,rules:{vcode:{validator:(t,e)=>{""===t?e(new Error("动态口令不能为空")):t.length<6?e(new Error("动态口令长度必须为6位")):e()},trigger:["input","blur"]}}}),this.bindEvent(t,"click",this.cutCheckCode.bind(this)),this.bindEvent(this.node.closePopupBtn,"click",()=>{this.googleVerify(!1)}),this.bindEvent(e,"click",this.submitLoginInfo.bind(this,"form")),this.bindEvent(o,"keyup",t=>{13===t.keyCode&&(e.focus(),e.click())}),this.bindEvent(n,"keyup",t=>{13===t.keyCode&&(e.focus(),e.click())}),this.bindEvent(c,"keyup",t=>{13===t.keyCode&&(e.focus(),e.click())}),this.bindEvent(i,"click",this.submitLoginInfo.bind(this,"vcode")),this.bindEvent(s,"keyup",t=>{13===t.keyCode&&i.click()}),this.tooltip({el:r,text:'\n\t\t\t\t<div class="mb-[.8rem]">\n\t\t\t\t\t<div class="font-bold">安全登录模式（推荐）</div>\n\t\t\t\t\t<div>在安全模式下，将加强登录会话的安全性，防止“重放攻击”风险，强烈建议使用安全模式登录面板。</div>\n\t\t\t\t\t<div class="text-danger"> 注意：在安全模式下，极少数网络环境可能出现无限退出的情况。 </div>\n\t\t\t\t</div>\n\t\t\t\t<div class="font-bold">普通登录模式（不推荐）</div>\n\t\t\t\t<div>兼容性好，但存在“重放攻击”的风险，建议在开启面板SSL的情况下再使用普通模式。</div>'}),this.checkAutoLogin(),this.node.inputUsername.value=this.autoLoginParams.username,this.node.inputPassword.value=this.autoLoginParams.password,this.autoLoginParams.username&&this.autoLoginParams.password&&this.node.formSubmit.click()}async renderHostsList(){const{formCdnAccelerate:t}=this.node,e=window.vite_public_hosts_list||[];if(this.hostCheck=e.length>0,t.classList[this.hostCheck?"remove":"add"]("!hidden"),document.querySelector(".cdn-node").classList[this.hostCheck?"remove":"add"]("!hidden"),this.hostCheck&&(document.querySelector(".noreferrer_tips").innerText="联系客服"),!this.hostCheck)return!1;const n=[],o=[];for(let s=0;s<e.length;s++){const t=e[s];n.push({key:t.url,label:t.name}),o.push(this.getHostDelay(t.url))}this.monitorHostSpeed(n,o)}async monitorHostSpeed(t,e){const n=await Promise.all(e);t=t.map((t,e)=>({key:t.key,label:"".concat(t.label).concat(n[e]?"(".concat(n[e],"ms)"):""),state:n[e],disabled:!n[e]})).sort((t,e)=>!1===t.state?1:t.state-e.state),this.createHostSelect(t)}createHostSelect(t){const{formCdnAccelerate:e}=this.node;t&&(this.formData.cdn_url=t[0].key),this.renderSelect({el:e,size:"small",options:[{key:"",label:"不使用加速"},...t],active:t[0].key,change:t=>{this.formData.cdn_url=t}})}async getHostDelay(t){try{const e=(new Date).getTime(),{data:n}=await this.request({method:"get",url:"https://".concat(t,"/test.txt"),data:{time:e}});if("boolean"==typeof n){const t=(new Date).getTime();return Promise.resolve(t-e)}return Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}getUrlInfo(){const{formSubmit:t,inputUsername:e,inputPassword:n}=this.node,o=window.location.href.split("?")[1],s=new URLSearchParams("?".concat(o)),i=s.get("username"),r=s.get("password");i&&r&&(e.value=i,n.value=r,t.click())}cutCheckCode(){this.node.cutCode.querySelector("img").src="/code?t=".concat((new Date).getTime())}googleVerify(t){const{formGoogleVerifyView:e,formGoogleVerifyInput:n}=this.node;this.googleCheck=t,this.formData.vcode="",n.value="",t?(e.classList.remove("!hidden"),n.focus()):e.classList.add("!hidden")}codeVerify(t){const{inputCode:e,codeView:n}=this.node;this.codeCheck=t,this.formData.code="",n.classList[t?"remove":"add"]("!hidden"),e.value=""}setFormSubmitError(t){var e,n,o;const{formSubmit:s}=this.node;return null==(n=null==(e=s.parentElement)?void 0:e.querySelector(".error-tips"))||n.remove(),null==(o=s.parentElement)||o.classList.add("error"),s.insertAdjacentHTML("afterend",'<div class="error-tips">'.concat(t,"</div>")),{close:()=>{var t,e,n;null==(t=s.parentElement)||t.classList.remove("error"),null==(n=null==(e=s.parentElement)?void 0:e.querySelector(".error-tips"))||n.remove()}}}async submitLoginInfo(t){const{inputPassword:e}=this.node;this.formVerify[t](async n=>{const o=this.loading("正在登录面板，请稍候..."),s={...this.formData,...n};this.formData={...s},"string"==typeof t&&"vcode"===t&&(s.vcode=n.vcode);let i=await this.encryptionData(s);this.hostCheck&&(i.cdn_url=this.formData.cdn_url),this.googleCheck&&(i.vcode=this.formData.vcode),this.codeCheck&&(i.code=this.formData.code),i=this.removeEmpty(i);try{sessionStorage.setItem("sendXhr","1");const{data:n}=await this.request({method:"post",url:"/login",data:i});if(o.close(),this.submitError&&this.submitError.close(),this.loginErrorTimer=!1,"number"==typeof n&&1===n)this.googleVerify(!0);else if("object"==typeof n){const{status:o,msg:s}=n;o?(this.message({type:"success",message:s}),sessionStorage.setItem("loginInfo",JSON.stringify(n)),setTimeout(()=>{window.location.href="/"},500)):(this.message({type:"error",message:s}),"vcode"===t?this.googleVerify(!0):(e.value="",this.googleVerify(!1),this.codeVerify(!0),this.cutCheckCode(),-1!==s.indexOf("验证码错误")&&this.cutCheckCode(),this.countdownInfo(s)))}else this.message({message:n,type:"error",time:0,close:!0})}catch(r){this.message({type:"error",message:r,close:!0}),o.close()}})}countdownInfo(t){let e=0;if(!(t.indexOf("多次登录失败")>-1))return;const n=t.match(/\d+/g);n?(this.loginErrorTimer=!0,e=n[0],this.timer&&clearInterval(this.timer),this.timer=setInterval(()=>{e--,this.submitError=this.setFormSubmitError(t.replace(/\d+/g,e.toString())),(e<=0||!this.loginErrorTimer)&&(clearInterval(this.timer),this.submitError.close(),e=0)},1e3)):setTimeout(()=>{this.submitError.close()},3e3)}}class c extends i{constructor(t){super(),n(this,"el"),n(this,"node"),n(this,"pollingQuery",!0),this.el="string"==typeof t?document.querySelector(t.el):t,this.node={cutTips:null,loginAccount:null,loginScan:null},this.render()}template(){return'<div class="login-scan-view">\n\t\t\t<div class="login-scan-success">\n\t\t\t\t<div class="login-title">堡塔APP扫码登录</div>\n\t\t\t\t<div id="canvas" class="login-scan-canvas"></div>\n\t\t\t\t<div class="">\n\t\t\t\t\t<span><a href="https://www.bt.cn/bbs/thread-47408-1-1.html" target="_blank" title="点击查看链接信息" class="bt-link text-middle login-scan-tips">关于堡塔APP</a></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="login-scan-error !hidden">\n\t\t\t\t<span class="title">当前面板未绑定扫描登录，请按照以下顺序检查：</span>\n\t\t\t\t<span class="line ">1、检查堡塔APP插件(面板插件)是否安装，是否绑定</span>\n\t\t\t\t<span class="line">2、打开<a class="bt-link text-middle" rel="noreferrer noopener" href="https://www.bt.cn/bbs/thread-47408-1-1.html">堡塔APP(手机APP)</a>查看绑定情况</span>\n\t\t\t\t<span class="line">3、如果以上操作均无法解决问题，请<a target="_block" rel="noreferrer noopener" class="bt-link text-middle" href="https://www.bt.cn/new/wechat_customer">联系客服</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>'}render(){this.el.innerHTML=this.template(),this.getSacnLoginInfo()}async qrCodeRender(t){new window.QRCode(document.getElementById("canvas"),{text:t,width:140,height:140})}async getSacnLoginInfo(){var t,e,n,o;try{const{data:s}=await this.request({method:"post",url:"/public?name=app&fun=login_qrcode"});if("object"==typeof s){const{status:i,msg:r}=s;i?(this.qrCodeRender(i?r:"https://www.bt.cn/download/app.html"),this.pollingQuerySacnInfo(),null==(t=document.querySelector(".login-scan-success"))||t.classList.remove("!hidden"),null==(e=document.querySelector(".login-scan-error"))||e.classList.add("!hidden")):(null==(n=document.querySelector(".login-scan-success"))||n.classList.add("!hidden"),null==(o=document.querySelector(".login-scan-error"))||o.classList.remove("!hidden"))}}catch(s){}}async pollingQuerySacnInfo(){try{if(!this.pollingQuery)return!1;const{data:t}=await this.request({method:"post",url:"/public?name=app&fun=is_scan_ok"}),{status:e,msg:n}=t;"object"==typeof t&&e?this.loginAdmin(n):setTimeout(()=>{this.pollingQuerySacnInfo()},2500)}catch(t){}}async loginAdmin(t){try{const{data:e}=await this.request({method:"post",url:"/public?name=app&fun=set_login",data:{secret_key:t}}),{status:n}=e;"object"==typeof e&&n&&(this.message({type:"success",message:"登录成功,正在跳转中"}),window.location.href="/")}catch(e){}}}new class extends i{constructor(t){super(),n(this,"loginType"),n(this,"el"),n(this,"node"),n(this,"autoLoginParams"),this.loginType=localStorage.getItem("loginType")||"account",this.el=document.querySelector(t.el),this.node={cutTips:null,loginAccount:null,loginScan:null},this.autoLoginParams={password:"",username:""},this.render()}template(){var t,e;const n=null==(t=window.vite_public_icon_info)?void 0:t.show_login_bg_images,o=null==(e=window.vite_public_icon_info)?void 0:e.show_login_logo,{login_bg_images:s,login_bg_images_opacity:r}=window.vite_public_icon_info,c=n?"background-image: url('".concat(s,"');opacity:").concat(r/100):"";return'<div class="login-bg" >\n\t\t'.concat(n?'<div class="login-images" style="'.concat(c,'"></div>'):"",'\n\t\t<div class="login-main">\n\t\t\t<aside class="login-svg ').concat(o?"":"!hidden",'">').concat(i.svgLogin,'</aside>\n\t\t\t<aside class="cut-login-type ').concat(this.loginType,'" style="top:').concat(o?"120px":"20px",'">\n\t\t\t\t<div class="tips">\n\t\t\t\t\t<span class="account"></span>\n\t\t\t\t\t<span class="tips-text">切换扫码登录</span>\n\t\t\t\t</div>\n\t\t\t</aside>\n\t\t\t<aside class="login-account !hidden"></aside>\n\t\t\t<aside class="login-scan !hidden"></aside>\n\t\t</div>')}domMount(){this.node.cutTips=this.el.querySelector(".tips-text"),this.node.cutLoginType=this.el.querySelector(".cut-login-type"),this.node.loginAccount=this.el.querySelector(".login-account"),this.node.loginScan=this.el.querySelector(".login-scan")}eventMount(){const{cutLoginType:t,cutTips:e}=this.node;this.bindEvent(t,"click",()=>{t.classList.add("account"===this.loginType?"scan":"account"),t.classList.remove("account"===this.loginType?"account":"scan"),"account"===this.loginType?(this.setLoginScan(),e.innerText="切换账号登录",localStorage.setItem("loginType","scan")):(this.setLoginAccount(),e.innerText="切换扫码登录",localStorage.setItem("loginType","account"))})}setLoginScan(){const{loginScan:t,loginAccount:e}=this.node;this.loginType="scan",t.classList.remove("!hidden"),e.classList.add("!hidden"),new c(this.node.loginScan)}setLoginAccount(){const{loginScan:t,loginAccount:e}=this.node;this.loginType="account",t.classList.add("!hidden"),e.classList.remove("!hidden"),new r(this.node.loginAccount)}render(){this.el.innerHTML=this.template(),this.loginType=localStorage.getItem("loginType")||"account",this.domMount(),this.eventMount(),"account"===this.loginType?this.setLoginAccount():this.setLoginScan()}}({el:"#app"});export{o as __vite_legacy_guard};
