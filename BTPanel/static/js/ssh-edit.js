import{c as s,r as e,g as a,e as r,S as l,D as t,B as o,q as p,v as d,x as u}from"./base-lib.js?v=1756369731";import{G as i,aa as n,M as c,jA as m,K as w}from"./utils-lib.js?v=1756369731";import{b as y,i as _,h as v}from"./form-item.js?v=1756369731";import{u as f}from"./useStore9.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const h={class:"p-[2rem] node-ssh-edit-form"},g=s({__name:"ssh-edit",props:{compData:{default:()=>({node_id:0,server_ip:"",ssh_conf:{}})}},setup(s,{expose:g}){const{setNodeSSHisSet:k,setNodeInfo:S,isRefreshNodeList:b,sshTerminalVisible:x}=f(),j=e(s.compData||{}),H=e(!1),{BtForm:q,submit:N}=i({data:()=>({node_id:j.value.node_id||"",port:22,password_type:0,pkey:"",pkey_passwd:"",test_case:1}),options:s=>a(()=>[y("端口","port",{attrs:{placeholder:"请输入 SSH 端口",class:"!w-[8rem]"},rules:[n()]}),_("认证方式","password_type",[{label:"密码",value:0},{label:"私钥",value:1}],{attrs:{onChange:s=>{}},rules:[{required:!0,message:"请选择认证方式",trigger:["blur","change"]}]}),1===s.value.password_type&&v("私钥",()=>r("div",{class:"flex items-end w-full"},[r(l,{modelValue:s.value.pkey,"onUpdate:modelValue":e=>s.value.pkey=e,type:"textarea",placeholder:"请输入 SSH 私钥",class:"!w-[320px]",rows:4},null),r(t,{class:"ml-[8px]",type:"default",loading:H.value,onClick:()=>V(s)},{default:()=>[o("测试连接")]})]),"pkey",{rules:[{required:!0,message:"SSH 私钥不能为空",trigger:["blur","change"]}]}),1===s.value.password_type&&y("私钥密码","pkey_passwd",{attrs:{type:"password","show-password":!0,placeholder:"请输入 SSH 私钥密码",class:"!w-[320px]"}}),0==s.value.password_type&&v("密码",()=>r("div",{class:"flex items-center w-full"},[r(l,{modelValue:s.value.password,"onUpdate:modelValue":e=>s.value.password=e,type:"password","show-password":!0,placeholder:"请输入密码",class:"!w-[320px]"},null),r(t,{class:"ml-[8px]",type:"default",loading:H.value,onClick:()=>V(s)},{default:()=>[o("测试连接")]})]),"password",{rules:[{required:!0,message:"密码不能为空",trigger:["blur","change"]}]})]),submit:async(s,e,a)=>{const r=c.load("正在保存中，请稍后...");try{await e();const a={...s.value},{port:r,password:l,pkey:t,pkey_passwd:o}=a;0==a.password_type?(a.pkey_passwd="",a.pkey=""):a.password="",delete a.password_type,a.test_case=0;const p=await m(a);return p.status?(S.value.ssh_conf={host:j.value.server_ip,port:Number(r),password:l,pkey:t,pkey_passwd:o,username:"root"},k.value=!0,b.value=!0,x.value=!1,c.success("SSH 信息保存成功")):c.error(p.msg||"保存失败"),p.status}catch(l){return!1}finally{null==r||r.close()}}}),V=async s=>{try{H.value=!0;const{node_id:e,port:a,password:r,pkey:l,pkey_passwd:t}=s.value,o={port:Number(a),password:r,pkey:l,pkey_passwd:t,node_id:e,test_case:1};await w({request:m(o),message:!0})}catch(e){}finally{H.value=!1}};return g({onConfirm:N}),(s,e)=>(p(),d("div",h,[r(u(q))]))}});export{g as default};
