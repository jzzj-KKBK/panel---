import{B as a}from"./index140.js?v=1756369731";import{u as e,M as l,bU as t,o as s,K as i,aq as n,L as o,l as d,at as r,w as u,c,j as m,h as p,e as f}from"./utils-lib.js?v=1756369731";import{r as g,k as h,s as _,n as y,e as v,c as w,p as V,G as b,H as x,x as C,q as P,v as k,y as I,A as U,B as q,F as j,a_ as F,P as T,I as L,M as E,C as A,D,aj as N,al as R,a$ as S,a9 as B,a7 as G,ai as H}from"./base-lib.js?v=1756369731";import{_ as M}from"./index101.js?v=1756369731";import{f as O,k as z,p as K,l as W}from"./validator.js?v=1756369731";import{o as $}from"./useController6.js?v=1756369731";import{setHasPwd as J,closeHasPwd as Q,setPath as X,setSiteRunPath as Y,getSitesFtp as Z,setSitesFtp as aa,delSiteRsync as ea,removeSendTask as la,delGitTask as ta,getGitTask as sa,addGitTask as ia,runSiteTask as na,getFileBody as oa,setDirUserINI as da,writeAccessLog as ra,getCatalogueKey as ua,getDirUserINI as ca,getBtSyncStatus as ma}from"./site.js?v=1756369731";import{u as pa}from"./useStore4.js?v=1756369731";import"./ace.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const{payment:fa}=e(),{siteInfo:ga}=pa(),{authType:ha}=fa.value,_a=g(!1),ya=g(),va=g(),wa=h({path:"",runPath:"",dirs:[],userini:!1,sync_git:!1,logs:!1,pass:!1}),Va=g(!1),ba=h({ftp_status:!1,ftp_name:"",ftp_pwd:""}),xa=g(!1),Ca=g(""),Pa=g([]),ka=g(!1),Ia=h({git_addr:"",branch:"",cycle:1}),Ua=g(""),qa=g(!1),ja=g(!1),Fa={git_addr:[{required:!0,message:"请输入git地址",trigger:"blur"}]};g({mode:"ace/mode/nginx",theme:"ace/theme/monokai",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!0,fontSize:"12px"});const Ta=h({status:!1,username:"",password:"",rePass:""}),La={username:[{required:!0,message:"账号不能为空",trigger:["blur"]}],password:[{required:!0,message:"密码不能为空",trigger:["blur"]}],rePass:[{required:!0,message:"重复密码不能为空",trigger:["blur"]},{validator:(a,e,l)=>{e!==Ta.password?l(new Error("两次输入密码不一致")):l()},trigger:["blur","change"]}]},Ea=async()=>{ya.value.validate(async a=>{if(a){let a=l.load("正在设置,请稍后...");try{const a=await J({id:ga.value.id,username:Ta.username,password:Ta.password});l.request(a)}catch(e){}finally{a.close()}}})},Aa=async a=>{let e;try{if(!a){e=l.load("正在关闭密码访问,请稍后...");const a=await Q({id:ga.value.id});e.close(),l.request(a)}}catch(t){}finally{null==e||e.close()}},Da=()=>{O({type:"dir",path:wa.path,change:a=>{wa.path=a}})},Na=async()=>{try{const a=await ca({path:wa.path,id:ga.value.id});wa.dirs=a.data.runPath.dirs,wa.runPath=a.data.runPath.runPath,wa.sync_git=a.data.sync_git,wa.logs=a.data.logs,wa.userini=a.data.userini,Ta.status=a.data.pass}catch(a){}},Ra=async()=>{let a=l.load("正在保存中...");try{const a=await X({path:wa.path,id:ga.value.id});l.request(a),a.status&&(ga.value.path=wa.path),Na()}catch(e){}finally{a.close()}},Sa=async()=>{let a=l.load("正在设置,请稍后...");try{const a=await Y({runPath:wa.runPath,id:ga.value.id});l.request(a)}catch(e){}finally{a.close()}},Ba=async()=>{var a,e,l;try{const t=await Z({site_id:ga.value.id});(null==(a=t.data.info)?void 0:a.id)?(ba.ftp_status=!0,ba.ftp_id=null==(e=t.data.info)?void 0:e.id,ba.ftp_name=null==(l=t.data.info)?void 0:l.name,ba.ftp_pwd=t.data.info.password):(ba.ftp_status=!1,ba.ftp_name="",ba.ftp_pwd="",ba.ftp_id="")}catch(t){}},Ga=async(a,e)=>{if(e){let a=l.load("正在处理中,请稍后...");try{if(!ba.ftp_id)return void Ga(!0,!1);let a={site_id:ga.value.id,...ba,siteName:ga.value.name};delete a.ftp_status;const e=await aa(a);if(l.request(e),Ba(),!e.data.status)return!1;Va.value=!1}catch(n){}finally{a.close()}}else{a&&(ba.ftp_name=ba.ftp_name||t(12),ba.ftp_pwd=ba.ftp_pwd||t(12));let e={site_id:ga.value.id,...ba,siteName:ga.value.name};e.ftp_id||delete e.ftp_id,ba.ftp_status=!a,await s({title:"FTP状态",content:a?"创建FTP将会同步到FTP界面，是否继续操作？":"关闭FTP后，将会删除当前网站的FTP账号，是否继续操作？",icon:"warning-filled"}),await i({loading:"正在处理中,请稍后...",request:aa(e),message:!0}),Ba()}},Ha=async()=>{var a,e,l,t,s,i;try{const n=await ma({path:wa.path});xa.value=n.data.have_sync,xa.value&&(Pa.value=Array.isArray(null==(a=n.data)?void 0:a.data)?null==(e=n.data)?void 0:e.data:[],(null==(t=null==(l=n.data)?void 0:l.data)?void 0:t.name)&&(Ca.value=null==(i=null==(s=n.data)?void 0:s.data)?void 0:i.name))}catch(n){}},Ma=async a=>{try{if(xa.value=a,a){const{data:a}=await n({sName:"rsync"});if(a.setup&&a.endtime>=0)if(parseFloat(a.version)>=parseFloat("3.9.3")){const{default:a}=await o(()=>import("./store2.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),e=a(),{compData:l,isSuccess:t}=_(e);l.value={row:{path:ga.value.path,type:"site",refreshEvent:Ha}},d({isAsync:!0,title:"【".concat(ga.value.name,"】设置数据同步"),area:56,component:()=>o(()=>import("./index244.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{y(()=>{t.value||(xa.value=!1)})}})}else await s({title:"更新提示",content:"当前版本过低，无法使用此功能，是否继续更新？",icon:"warning-filled"}),await Oa(a);else a.endtime>=0?(await s({title:"安装提示",content:"检测到【".concat(a.title,"】未安装，是否立即安装开启使用？"),icon:"warning-filled"}),z({name:a.name,type:"i",pluginInfo:a})):K({sourceId:120}),y(()=>{xa.value=!1})}else{if(await s({title:"删除同步任务",content:"即将删除该同步任务，是否继续操作？",icon:"warning-filled"}),Pa.value.length){const a=l.load("正在删除同步任务，请稍后..."),e=Pa.value.map(async a=>{if("modules"===a.type){return{...(await ea({mName:a.data.name})).data,title:"接收任务",name:a.data.name}}return{...(await la({send_id:a.data.id})).data,title:"发送任务",name:a.data.name}}),t=await Promise.all(e);a.close(),t.length>1?$({title:"删除同步任务",autoTitle:"删除同步任务完成",resultData:t,resultColumn:[{label:"任务名称",prop:"name"},{label:"任务类型",prop:"title"},{label:"操作结果",prop:"msg",align:"rigth",render:a=>v("span",{class:a.status?"text-primary":"text-danger"},[a.msg])}]}):l.request(t[0])}else await i({loading:"正在删除同步任务，请稍后...",request:ea({mName:Ca.value}),message:!0});Ha()}}catch(e){xa.value=!a}},Oa=async a=>{},za=async()=>{try{const{data:a}=await n({sName:"rsync"});await W({name:"rsync",softData:a})}catch(a){}},Ka=async a=>{if("ltd"!==ha)return K({sourceId:310,disablePro:!0});if(a)wa.sync_git=!1,await $a();else{wa.sync_git=!0,await s({title:"关闭git同步",content:"关闭后将不在同步git文件到网站目录，是否继续操作？",icon:"warning-filled"});const a=await i({loading:"正在关闭，请稍后...",request:ta({site_id:ga.value.id}),message:!0});a.status&&(wa.sync_git=!a.status)}},Wa=async()=>{if("ltd"!==ha)return K({sourceId:310,disablePro:!0});await $a(),ka.value=!0},$a=async()=>{var a;try{const{data:e}=await sa({site_id:ga.value.id});(null==(a=e.msg)?void 0:a.git_addr)?(Ia.git_addr=e.msg.git_addr,Ia.branch=e.msg.branch,Ia.cycle=e.msg.cycle):(Ia.git_addr="",Ia.branch="",Ia.cycle=1,ka.value=!0)}catch(e){}},Ja=async()=>{await va.value.validate(),await s({title:"git同步覆盖提示",content:"从git同步文件到网站目录将覆盖网站目录的文件，是否继续操作？",icon:"warning-filled"});(await i({loading:"正在设置，请稍后...",request:ia({site_id:ga.value.id,...Ia}),message:!0})).status&&(ka.value=!1,Na())},Qa=async()=>{if("ltd"!==ha)return K({sourceId:310,disablePro:!0});i({request:na({site_id:ga.value.id}),message:!0})},Xa=async()=>{await Ya(),ja.value=!0},Ya=async()=>{qa.value=!0;try{const a=await oa({path:"/www/wwwlogs/syncsite/"+ga.value.id+".log"});Ua.value=a.data.data||"暂无日志数据"}catch(a){r(a)}finally{qa.value=!1}},Za=async()=>{(await i({loading:"正在设置防跨站，请稍后...",request:da({path:wa.path}),message:!0})).status&&Na()},ae=async()=>{(await i({loading:"正在设置写访问日志，请稍后...",request:ra({id:ga.value.id}),message:!0})).status&&Na()},ee=async()=>{_a.value=!0;try{await(async()=>{try{const a=await ua({table:"sites",key:"path",id:ga.value.id});wa.path=a.data}catch(a){}})(),await Na(),await Ba(),await Ha()}catch(a){}finally{_a.value=!1}},le={class:""},te={class:"formItem"},se={class:"formItem"},ie={class:"formItem"},ne={class:"formItem"},oe={class:"formItem"},de={class:"formItem"},re={class:"formItem"},ue={class:"flex items-center"},ce={class:"p-[20px]"},me={class:"p-[20px]"},pe={class:"p-[20px]"},fe={class:"flex items-center justify-between"},ge=f(w({__name:"cataluge-setting",setup(l,{expose:t}){const{enterpriseRec:s}=e();return V(ee),t({init:ee}),(e,l)=>{const t=M,i=D,n=H,o=N,d=R,r=c,f=S,g=m,h=B,_=G,y=p,w=a,V=b("bt-loading");return x((P(),k("div",le,[I("div",te,[l[26]||(l[26]=I("span",{class:"formLabel"},"网站目录",-1)),v(t,{class:"mr-[12px]",modelValue:C(wa).path,"onUpdate:modelValue":l[0]||(l[0]=a=>C(wa).path=a),icon:"el-folder-opened",onIconClick:C(Da),width:"32rem"},null,8,["modelValue","onIconClick"]),v(i,{type:"primary",onClick:C(Ra)},{default:U(()=>[...l[25]||(l[25]=[q("保存",-1)])]),_:1},8,["onClick"])]),l[50]||(l[50]=I("span",{class:"formTips"},"当前网站的部署目录，可以选择其他目录",-1)),I("div",se,[l[28]||(l[28]=I("span",{class:"formLabel"},"运行目录",-1)),v(o,{class:"mr-[12px] !w-[32rem]",modelValue:C(wa).runPath,"onUpdate:modelValue":l[1]||(l[1]=a=>C(wa).runPath=a)},{default:U(()=>[(P(!0),k(j,null,F(C(wa).dirs,a=>(P(),E(n,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),v(i,{type:"primary",onClick:C(Sa)},{default:U(()=>[...l[27]||(l[27]=[q("保存",-1)])]),_:1},8,["onClick"])]),l[51]||(l[51]=I("span",{class:"formTips"},"部分程序需要指定二级目录作为运行目录，如ThinkPHP5,Laravel",-1)),I("div",ie,[l[30]||(l[30]=I("span",{class:"formLabel"},"添加FTP",-1)),v(d,{class:"mr-[12px]",modelValue:C(ba).ftp_status,"onUpdate:modelValue":l[2]||(l[2]=a=>C(ba).ftp_status=a),onChange:C(Ga)},null,8,["modelValue","onChange"]),l[31]||(l[31]=I("span",{class:"text-[#999]"},"为当前目录添加一个FTP账号，以支持访问",-1)),v(r,{onClick:l[3]||(l[3]=a=>Va.value=!0)},{default:U(()=>[...l[29]||(l[29]=[q("点击配置>>",-1)])]),_:1})]),I("div",ne,[l[33]||(l[33]=I("span",{class:"formLabel"},"文件同步",-1)),v(d,{class:"mr-[12px]",modelValue:C(xa),"onUpdate:modelValue":l[4]||(l[4]=a=>T(xa)?xa.value=a:null),onChange:C(Ma)},null,8,["modelValue","onChange"]),l[34]||(l[34]=I("i",{class:"svgtofont-icon-ltd text-[2rem] text-[#9B7E48] mr-4px"},null,-1)),l[35]||(l[35]=I("span",{class:"text-[#999]"},"可以同步网站文件至其他服务节点",-1)),v(r,{onClick:C(za)},{default:U(()=>[...l[32]||(l[32]=[q("点击配置>>",-1)])]),_:1},8,["onClick"])]),x(I("div",oe,[l[39]||(l[39]=I("span",{class:"formLabel"},"git同步",-1)),v(d,{class:"mr-[12px]",modelValue:C(wa).sync_git,"onUpdate:modelValue":l[5]||(l[5]=a=>C(wa).sync_git=a),onChange:C(Ka)},null,8,["modelValue","onChange"]),l[40]||(l[40]=I("i",{class:"svgtofont-icon-ltd text-[2rem] text-[#9B7E48] mr-4px"},null,-1)),l[41]||(l[41]=I("span",{class:"text-[#999]"},"可以从git中下载文件到网站目录中",-1)),v(r,{onClick:C(Wa)},{default:U(()=>[...l[36]||(l[36]=[q("点击配置>>",-1)])]),_:1},8,["onClick"]),v(f,{direction:"vertical"}),v(r,{onClick:C(Xa)},{default:U(()=>[...l[37]||(l[37]=[q("查看日志",-1)])]),_:1},8,["onClick"]),v(f,{direction:"vertical"}),v(r,{onClick:C(Qa)},{default:U(()=>[...l[38]||(l[38]=[q("立即同步",-1)])]),_:1},8,["onClick"])],512),[[L,C(s)]]),v(f),I("div",de,[l[42]||(l[42]=I("span",{class:"formLabel"},"防跨站攻击",-1)),v(d,{class:"mr-[12px]",modelValue:C(wa).userini,"onUpdate:modelValue":l[6]||(l[6]=a=>C(wa).userini=a),onChange:C(Za)},null,8,["modelValue","onChange"]),l[43]||(l[43]=I("span",{class:"text-[#999]"},"防跨站攻击(open_basedir)，防止黑客通过其他网站目录进行入侵攻击",-1))]),I("div",re,[l[44]||(l[44]=I("span",{class:"formLabel"},"写访问日志",-1)),v(d,{class:"mr-[12px]",modelValue:C(wa).logs,"onUpdate:modelValue":l[7]||(l[7]=a=>C(wa).logs=a),onChange:C(ae)},null,8,["modelValue","onChange"]),l[45]||(l[45]=I("span",{class:"text-[#999]"},"允许当前日志增加访问日志",-1))]),v(f),I("div",ue,[l[46]||(l[46]=I("span",{class:"mr-[20px] w-[7rem] text-right"},"密码访问",-1)),v(d,{modelValue:C(Ta).status,"onUpdate:modelValue":l[8]||(l[8]=a=>C(Ta).status=a),onChange:C(Aa)},null,8,["modelValue","onChange"])]),C(Ta).status?(P(),E(_,{key:0,model:C(Ta),ref_key:"passVisitFormRef",ref:ya,rules:C(La),class:"mt-[20px]","label-width":"70px","label-position":"right"},{default:U(()=>[v(h,{label:"账号",prop:"username"},{default:U(()=>[v(g,{width:"20rem",modelValue:C(Ta).username,"onUpdate:modelValue":l[9]||(l[9]=a=>C(Ta).username=a),placeholder:"不修改请留空"},null,8,["modelValue"])]),_:1}),v(h,{label:"访问密码",prop:"password"},{default:U(()=>[v(g,{width:"20rem",modelValue:C(Ta).password,"onUpdate:modelValue":l[10]||(l[10]=a=>C(Ta).password=a),type:"password",placeholder:"不修改请留空"},null,8,["modelValue"])]),_:1}),v(h,{label:"重复密码",prop:"rePass"},{default:U(()=>[v(g,{width:"20rem",modelValue:C(Ta).rePass,"onUpdate:modelValue":l[11]||(l[11]=a=>C(Ta).rePass=a),type:"password",placeholder:"不修改请留空"},null,8,["modelValue"])]),_:1}),v(h,{label:" "},{default:U(()=>[v(i,{type:"primary",onClick:C(Ea)},{default:U(()=>[...l[47]||(l[47]=[q("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])):A("",!0),v(y,{title:"FTP配置",modelValue:C(Va),"onUpdate:modelValue":l[16]||(l[16]=a=>T(Va)?Va.value=a:null),area:42,showFooter:"",onConfirm:l[17]||(l[17]=a=>C(Ga)(!1,!0)),onClose:l[18]||(l[18]=a=>C(Ba)())},{default:U(()=>[I("div",ce,[v(_,{"label-position":"right",model:C(ba)},{default:U(()=>[v(h,{label:"用户名"},{default:U(()=>[v(g,{modelValue:C(ba).ftp_name,"onUpdate:modelValue":l[12]||(l[12]=a=>C(ba).ftp_name=a),placeholder:"请输入ftp用户名",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),v(h,{label:"密码"},{default:U(()=>[v(t,{modelValue:C(ba).ftp_pwd,"onUpdate:modelValue":l[13]||(l[13]=a=>C(ba).ftp_pwd=a),icon:"el-refresh",onIconClick:l[14]||(l[14]=()=>C(ba).ftp_pwd=C(u)(16)),width:"32rem"},null,8,["modelValue"])]),_:1}),v(h,{label:"根目录"},{default:U(()=>[v(g,{modelValue:C(wa).path,"onUpdate:modelValue":l[15]||(l[15]=a=>C(wa).path=a),disabled:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),v(y,{title:"配置GIT同步",modelValue:C(ka),"onUpdate:modelValue":l[22]||(l[22]=a=>T(ka)?ka.value=a:null),area:42,showFooter:"",onConfirm:C(Ja)},{default:U(()=>[I("div",me,[v(_,{"label-position":"right",ref_key:"gitFormRef",ref:va,model:C(Ia),rules:C(Fa)},{default:U(()=>[v(h,{label:"git地址",prop:"git_addr"},{default:U(()=>[v(g,{modelValue:C(Ia).git_addr,"onUpdate:modelValue":l[19]||(l[19]=a=>C(Ia).git_addr=a),placeholder:"请输入git地址",width:"24rem"},null,8,["modelValue"])]),_:1}),v(h,{label:"分支"},{default:U(()=>[v(g,{modelValue:C(Ia).branch,"onUpdate:modelValue":l[20]||(l[20]=a=>C(Ia).branch=a),placeholder:"请输入git分支,为空默认主分支",width:"24rem"},null,8,["modelValue"])]),_:1}),v(h,{label:"同步周期"},{default:U(()=>[v(g,{modelValue:C(Ia).cycle,"onUpdate:modelValue":l[21]||(l[21]=a=>C(Ia).cycle=a),"text-type":"天",type:"number",min:1,width:"24rem"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","onConfirm"]),v(y,{title:"Git日志",modelValue:C(ja),"onUpdate:modelValue":l[24]||(l[24]=a=>T(ja)?ja.value=a:null),area:70},{default:U(()=>[I("div",pe,[I("div",fe,[v(i,{type:"primary",onClick:C(Ya)},{default:U(()=>[...l[48]||(l[48]=[q("刷新",-1)])]),_:1},8,["onClick"]),l[49]||(l[49]=I("span",{class:"text-[#999] mt-[8px]"},"提示：支持Ctrl + F，快捷搜索日志内容",-1))]),x(v(w,{class:"!h-[54rem] !w-full my-[12px]",modelValue:C(Ua),"onUpdate:modelValue":l[23]||(l[23]=a=>T(Ua)?Ua.value=a:null),config:e.config},null,8,["modelValue","config"]),[[V,C(qa)]])])]),_:1},8,["modelValue"])])),[[V,C(_a)]])}}}),[["__scopeId","data-v-72250702"]]);export{ge as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
