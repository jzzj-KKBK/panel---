import{_ as a}from"./index103.js?v=1756369731";import{u as t,R as e,o as s,K as l,M as o,k as n,h as c,e as i}from"./utils-lib.js?v=1756369731";import{_ as r}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1756369731";import{_ as d}from"./index112.js?v=1756369731";import{c as u,r as p,k as m,e as _,aB as g,aQ as f,B as v,p as b,G as y,q as x,v as w,A as h,H as k,x as j,P as C,y as D,F as z,a_ as M,z as q,J as H,C as O,D as J}from"./base-lib.js?v=1756369731";import{u as R}from"./column.js?v=1756369731";import{ak as T,al as U,am as V}from"./config.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const B={class:"p-[2rem]"},L={class:"p-[2rem]"},N={class:"item"},S={key:0,class:"border border-[#ececec] rounded-[0.4rem] max-h-[20rem] overflow-y-auto"},A={key:0,class:"w-[50%]"},F={key:1,class:"w-[50%]"},G={class:"w-[50%] truncate"},I={key:1,class:"box"},K={class:"item"},P=["innerHTML"],Q=i(u({__name:"record",props:{compData:{default:()=>{}}},setup(i){const u=i,{push:Q}=t(),E=p({}),W=p(!1),X=p([]),Y=p(!1),Z=p([]),$=m({page:1,size:10,total:0}),aa=async a=>{try{await s({title:"清空记录【".concat(u.compData.title,"】"),content:"您真的要清空【".concat(u.compData.title,"】的所有告警记录吗？")}),await l({loading:"正在清空记录，请稍后...",request:T({task_id:u.compData.id,record_ids:JSON.stringify([a.id])}),message:!0}),ta()}catch(t){}},ta=async()=>{try{await l({loading:Y,request:V({task_id:u.compData.id,page:$.page,size:$.size}),success:({data:a})=>{Z.value=a.data.list,$.total=a.data.count}})}catch(a){}},ea=[{label:"发送时间",render:a=>_("span",null,[e(a.create_time)])},{label:"发送状态",render:a=>{let t=a.result.stop_msg;if(a.do_send){const e=Object.values(a.result.send_data).reduce((a,t)=>("number"==typeof t&&1===t?a.success++:"string"==typeof t&&a.fail++,a),{success:0,fail:0});t="发送成功"+e.success+"次，发送失败"+e.fail+"次"}return g(f,{popperClass:"softTooltip",effect:"light",enterable:!1,placement:"top-end",content:t},()=>g("span",{class:a.do_send?"text-primary":"text-danger"},a.do_send?"已发送":"未发送"))}},{label:"告警详情",render:a=>_("span",{class:"bt-link",onClick:()=>(a=>{E.value=a;let t=o.load("正在获取告警详情，请稍后...");try{const t=new Map([["wx_account","微信公众号"],["feishu","飞书"],["mail","邮箱"],["sms","短信通知"],["dingding","钉钉"],["weixin","企业微信"],["webhook","自定义消息通道"]]),e=Object.entries(a.result.send_data).map(a=>{const e=a.at(0),s=Q.value.config.find(a=>a.id===e);return{result:1===a.at(1),resultMsg:1===a.at(1)?"发送成功":a.at(1),accounts:{title:t.get(null==s?void 0:s.sender_type)||"",account:null==s?void 0:s.data.title}}});X.value=e,W.value=!0}catch(e){}finally{t.close()}})(a)},[v("点击查看")])},R([{onClick:async a=>{try{await s({title:"删除记录",content:"您真的要删除这条告警记录吗？"}),await l({loading:"正在删除记录，请稍后...",request:U({task_id:u.compData.id,record_ids:JSON.stringify([a.id])}),message:!0}),ta()}catch(t){}},title:"删除"}])];return b(()=>ta()),(t,e)=>{const s=J,l=n,o=d,i=r,u=c,p=a,m=y("bt-loading");return x(),w("div",B,[_(p,null,{"header-left":h(()=>[_(s,{onClick:aa},{default:h(()=>[...e[3]||(e[3]=[v("清空记录",-1)])]),_:1})]),content:h(()=>[k(_(l,{ref:"alarmRecordRef",column:ea,data:j(Z),description:"记录为空","max-height":"42rem"},null,8,["data"]),[[m,j(Y)],[m,"正在获取告警记录，请稍候...","title"]])]),"footer-right":h(()=>[_(o,{total:j($).total,page:j($).page,"onUpdate:page":e[0]||(e[0]=a=>j($).page=a),row:j($).size,"onUpdate:row":e[1]||(e[1]=a=>j($).size=a),onChange:ta},null,8,["total","page","row"])]),popup:h(()=>[_(u,{modelValue:j(W),"onUpdate:modelValue":e[2]||(e[2]=a=>C(W)?W.value=a:null),area:48,title:"告警详情"},{default:h(()=>[D("div",L,[D("div",N,[e[5]||(e[5]=D("div",{class:"title"},"发送情况",-1)),j(X).length>0?(x(),w("div",S,[e[4]||(e[4]=D("div",{class:"table-box"},[D("span",{class:"w-[50%]"},"发送账号"),D("span",{class:"w-[50%]"},"发送结果")],-1)),(x(!0),w(z,null,M(j(X),(a,t)=>(x(),w("div",{class:"table-box",key:t},[a.accounts.account&&a.accounts.title?(x(),w("span",A,q("".concat(a.accounts.account,"(").concat(a.accounts.title,")")),1)):(x(),w("span",F,q("".concat(a.accounts.title)),1)),D("span",G,[_(i,{popperClass:"w-[400px]",placement:"left",class:H(a.result?"text-primary":"text-danger"),text:a.resultMsg},null,8,["class","text"])])]))),128))])):O("",!0),0==j(X).length?(x(),w("div",I,q(j(E).result.stop_msg),1)):O("",!0)]),D("div",K,[e[6]||(e[6]=D("div",{class:"title"},"告警信息",-1)),D("div",{class:"box",innerHTML:j(E).send_data.msg_list.join("<br>")},null,8,P)])])]),_:1},8,["modelValue"])]),_:1})])}}}),[["__scopeId","data-v-b7b8586e"]]);export{Q as default};
