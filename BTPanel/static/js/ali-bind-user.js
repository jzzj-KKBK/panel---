import{c as e,r as a,k as l,p as t,aD as s,q as r,M as o,A as c,H as n,I as i,x as d,y as u,e as m,z as p,J as v,O as f,v as w,B as h,C as g,K as b,ax as y,a9 as x,S as k,D as _,a$ as D,a7 as C}from"./base-lib.js?v=1756369731";import{_ as V}from"./index104.js?v=1756369731";import{u as j,M as z,br as I,bn as q,q as B,bo as E,bp as H,c as M,e as K}from"./utils-lib.js?v=1756369731";import{_ as U}from"./bt_logo_new.js?v=1756369731";import{b as T,f as $}from"./useController.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const L={class:"flex !justify-center !w-full items-center"},O={class:"text-[2rem] text-dark inline-block mr-2 font-bold mt-12x"},A={key:0,class:"absolute el-form-item__error"},J={class:"flex justify-end items-centertext-[1.2rem] mt-[1rem]"},P={key:0,class:"view-con",style:{background:"#fff"}},S={key:1,class:"w-[100%] mt-[1.2rem] flex items-center justify-center text-[#20a53a]",size:"default"},F={key:2,class:"flex justify-end items-centertext-[1.2rem] mt-[1rem] h-[1.68rem]"},G={key:0},N={class:"more-bind"},Q=K(e({__name:"ali-bind-user",props:{compData:{default:null}},emits:["close"],setup(e,{expose:K,emit:Q}){const R=e,{aliyunEcsLtd:W}=j(),X=a(!1),Y=a("获取验证码"),Z=l({username:"",password:"",code:""}),ee=l({username:!1,password:!1,code:!1}),ae=a(""),le=a(0),te=a(),se=a(!1),re=a(1),oe=a(R.compData.authData),ce=a({username:[{validator:(e,a,l)=>{var t,s;if((null==(t=R.compData)?void 0:t.title)&&(se.value=!1),/^1[3456789]\d{9}$/.test(a))l();else if(""===a)l(new Error("请输入宝塔官网账号"));else{if(null==(s=R.compData)?void 0:s.title)return se.value=!0,void l(new Error(" "));l(new Error(" 请输入正确的手机号 "))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,a,l)=>{a.length>=8?l():l(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,a,l)=>{X.value||l(),6===a.length?l():l(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),ne=async()=>{await te.value.validate(),await T({isCheck:X,userInfo:Z,userToken:ae})},ie=async()=>{let e;try{e=z.load("正在绑定中......");const{data:a}=await I({client:2});a.status||a.success?$(R.compData.redirect):(e.close(),z.error(a.msg||a.res))}catch(a){null==e||e.close()}},de=async()=>{if(!Z.username||!Z.password)return z.error("请先输入手机号和密码");ee.username=!0,ee.password=!0,(e=>{le.value&&clearInterval(le.value);const a=()=>{if(--e<=0)return clearInterval(le.value),Y.value="获取验证码",void(ee.code=!1);Y.value="重新获取验证码(".concat(e,"s)")};a(),le.value=setInterval(a,1e3),ee.code=!0})(60);const e=await q({username:Z.username,token:ae.value});z.request(e)},ue=a(!1),me=e=>{var a;re.value=e,(null==(a=R.compData)?void 0:a.onChangeType)&&R.compData.onChangeType(1===e?"bind":"other")},pe=a(!1),ve=a(null),fe=a(null),we=async()=>{pe.value=!0;try{const e=await E();if(e.status){const a=600,l=500,t=window.screen.width/2-a/2,s=window.screen.height/2-l/2;ve.value=window.open(e.msg.replace("login.html","new/wxBindPanel.html"),"_blank","width=".concat(a,",height=").concat(l,",left=").concat(t,",top=").concat(s)),window.addEventListener("message",e=>{var a,l;switch(e.data.type){case"wechat_auth_error":z.error(e.data.msg);try{null==(a=ve.value)||a.close(),we()}catch(t){}break;case"wechat_auth_complete":const{code:s,state:r}=e.data.data;null==(l=ve.value)||l.close(),he(s,r)}})}}catch(e){}finally{pe.value=!1}},he=async(e,a)=>{var l;const t=z.load("正在配置面板用户信息，请稍后...");try{const t=await H({code:e,state:a});t.status?(z.success("微信绑定成功"),window.location.href=(null==(l=R.compData)?void 0:l.redirect)||"/"):z.error(t.msg||"微信绑定失败")}catch(s){z.error("微信绑定失败")}finally{t.close()}};return K({onOpen:()=>{B(te.value.$el,"username")},onCancel:()=>{te.value.clearValidate(),fe.value&&(clearInterval(fe.value),fe.value=null),ve.value&&!ve.value.closed&&(ve.value.close(),ve.value=null)}}),t(()=>{var e;(async()=>{try{ue.value=2===oe.value.client&&1===oe.value.login,2===oe.value.client&&1===oe.value.login?me(2):me(1)}catch(e){me(1)}})(),null==(e=te.value)||e.clearValidate()}),s(()=>{fe.value&&(clearInterval(fe.value),fe.value=null),ve.value&&!ve.value.closed&&(ve.value.close(),ve.value=null)}),(e,a)=>{var l;const t=y,s=x,j=k,z=M,I=_,q=M,B=V,E=D,H=C;return r(),o(H,{ref_key:"bindUserInfo",ref:te,size:"large",rules:d(ce),model:d(Z),autocomplete:"off",class:v(["bind-user-info",{"bind-form":!!(null==(l=e.compData)?void 0:l.title)}])},{default:c(()=>{var l,y,x,k,_,D,C,V,H,M,K,T,$;return[n(u("div",null,[m(s,{class:"text-center !mb-5 flex justify-center"},{default:c(()=>{var l;return[u("div",L,[u("h3",O,p((null==(l=e.compData)?void 0:l.title)||"切换宝塔官网账号"),1),m(t,{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:c(()=>[...a[9]||(a[9]=[u("a",{class:"bt-ico-ask align-middle",href:"javascript:;"},"?",-1)])]),_:1})])]}),_:1}),(r(),o(s,{key:1,prop:"username",class:v({"!mb-[3rem]":!!(null==(l=e.compData)?void 0:l.title)})},{default:c(()=>{var l;return[m(j,{modelValue:d(Z).username,"onUpdate:modelValue":a[0]||(a[0]=e=>d(Z).username=e),clearable:"",required:"",name:"username",autocomplete:"off",class:"!leading-[4rem] !h-[4rem]",placeholder:"宝塔官网账号",disabled:d(ee).username,onKeyup:a[1]||(a[1]=f(e=>ne(),["enter"]))},null,8,["modelValue","disabled"]),(null==(l=e.compData)?void 0:l.title)&&d(se)?(r(),w("span",A,[a[11]||(a[11]=u("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),m(z,{class:"!text-[12px]",href:"https://www.bt.cn/register"},{default:c(()=>[...a[10]||(a[10]=[h(" 免费注册 ",-1)])]),_:1})])):g("",!0)]}),_:1},8,["class"])),(r(),o(s,{key:2,prop:"password"},{default:c(()=>[m(j,{modelValue:d(Z).password,"onUpdate:modelValue":a[2]||(a[2]=e=>d(Z).password=e),clearable:"",required:"",type:"password",name:"password",class:"!leading-[4rem] !h-[4rem]",autocomplete:"off",placeholder:"密码","show-password":!0,disabled:d(ee).password,onKeyup:a[3]||(a[3]=f(e=>ne(),["enter","native"]))},null,8,["modelValue","disabled"])]),_:1})),n(m(s,{prop:"code"},{default:c(()=>[m(j,{modelValue:d(Z).code,"onUpdate:modelValue":a[4]||(a[4]=e=>d(Z).code=e),type:"text",clearable:"",autocomplete:"off",placeholder:"验证码",onKeyup:a[5]||(a[5]=f(e=>ne(),["enter","native"]))},{append:c(()=>[m(I,{class:"relative top-0 rounded-none rounded-r-[3px]",type:"primary",size:"default",disabled:d(ee).code,plain:"",onClick:de},{default:c(()=>[h(p(d(Y)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},512),[[i,d(X)]]),m(I,{type:"primary",class:"w-[100%] mt-[1.2rem]",size:"default",onClick:a[6]||(a[6]=e=>ne())},{default:c(()=>{var a,l;return[h(p((null==(a=e.compData)?void 0:a.btn)||((null==(l=e.compData)?void 0:l.title)?"绑定账号":"切换账号")),1)]}),_:1}),u("div",J,[m(q,{href:"https://www.bt.cn/register"},{default:c(()=>[...a[12]||(a[12]=[h("注册账号",-1)])]),_:1}),m(B),m(q,{href:"https://www.bt.cn/login.html?page=reset"},{default:c(()=>[...a[13]||(a[13]=[h("忘记密码",-1)])]),_:1}),m(B),m(q,{href:"https://www.bt.cn/bbs"},{default:c(()=>[...a[14]||(a[14]=[h("问题反馈",-1)])]),_:1})])],512),[[i,1===d(re)]]),n(u("div",null,[(null==(y=e.compData)?void 0:y.title)?g("",!0):(r(),w("div",{key:0,class:"view-con",style:b((null==(x=e.compData)?void 0:x.title)?"":"background:#fff;")},[u("div",{class:"app-box",style:b((null==(k=e.compData)?void 0:k.title)?"":"background:#fff;")},[...a[15]||(a[15]=[u("img",{alt:"",src:U},null,-1)])],4),a[17]||(a[17]=u("div",{class:"change-icon"},[u("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[u("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1)),u("div",{class:"app-box",style:b((null==(_=e.compData)?void 0:_.title)?"":"background:#fff;")},[...a[16]||(a[16]=[u("div",{class:"ali-icon"},null,-1)])],4)],4)),u("div",{class:v({"bg-white":null==(D=e.compData)?void 0:D.title,"rounded-[4px]":null==(C=e.compData)?void 0:C.title}),style:b({border:(null==(V=e.compData)?void 0:V.title)?"1px solid #ddd":"none","padding-top":(null==(H=e.compData)?void 0:H.title)?"2rem":"0"})},[(null==(M=e.compData)?void 0:M.title)?(r(),w("div",P,[...a[18]||(a[18]=[u("div",{class:"app-box",style:{background:"#fff"}},[u("img",{alt:"",src:U})],-1),u("div",{class:"change-icon"},[u("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[u("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1),u("div",{class:"app-box",style:{background:"#fff"}},[u("div",{class:"ali-icon"})],-1)])])):g("",!0),m(s,{class:v(["!mb-5 flex justify-center",{"p-[2.5rem]":null==(K=e.compData)?void 0:K.title,"!pt-0":null==(T=e.compData)?void 0:T.title}])},{default:c(()=>[m(E),a[19]||(a[19]=u("h3",{class:"text-[1.4rem] w-full text-[#666] inline-block font-bold"},"阿里云用户专享特权：",-1)),a[20]||(a[20]=u("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] flex items-center"},[u("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),h(" 免费使用原本需要付费的功能： ")],-1)),a[21]||(a[21]=u("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] ml-[1.9rem] flex items-center"},[u("img",{src:"/static/img/soft_ico/ico-msg_push.png",class:"w-[2rem] mr-[1rem]"}),h(" 异常监控推送 ")],-1)),a[22]||(a[22]=u("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1.5rem] flex items-center"},[u("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),h(" 宝塔官方付费软件均享额外折扣 ")],-1))]),_:1},8,["class"]),m(I,{type:"primary",class:"w-[85%] mt-[4rem] relative left-[7.5%]",style:{margin:"1rem auto 0"},size:"default",onClick:ie},{default:c(()=>[...a[23]||(a[23]=[h("一键激活专享特权",-1)])]),_:1}),d(W)?g("",!0):(r(),w("div",S,[u("span",{class:"cursor-pointer hover:text-[#1d9534]",onClick:a[7]||(a[7]=e=>me(1))},"已有宝塔账号登录")])),(null==($=e.compData)?void 0:$.title)?(r(),w("div",F)):g("",!0)],6)],512),[[i,2===d(re)]]),1===d(re)?(r(),w("div",G,[a[26]||(a[26]=u("div",{class:"more-title"},[u("span",null,"更多绑定方式")],-1)),u("div",N,[n(u("div",{class:"wechat-login-container",onClick:a[8]||(a[8]=e=>me(2))},[...a[24]||(a[24]=[u("div",{class:"wechat-icon-circle"},[u("i",{class:"wechat-icon tencent_ico"})],-1),u("div",{class:"wechat-text"},"阿里云",-1)])],512),[[i,1===d(re)&&d(ue)]]),n(u("div",{class:v(["wechat-login-container",{"ml-[1.4rem]":d(ue)}]),onClick:we},[...a[25]||(a[25]=[u("div",{class:"wechat-icon-circle"},[u("i",{class:"wechat-icon"},[u("svg",{t:"1749545795651",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"9096",width:"20",height:"20"},[u("path",{d:"M391.95 175.27c-159.03 0-289.29 108.4-289.29 246.04 0 79.45 43.35 144.67 115.74 195.2l-28.93 87.05 101.12-50.74c36.19 7.19 65.22 14.54 101.33 14.54 9.08 0 18.09-0.45 27.01-1.16-5.64-19.37-8.92-39.61-8.92-60.62 0-126.32 108.54-228.89 245.97-228.89 9.37 0 18.64 0.69 27.86 1.71C658.8 261.87 534.2 175.27 391.95 175.27z m-93.97 195.31c-21.67 0-43.56-14.52-43.56-36.21 0-21.77 21.89-36.09 43.56-36.09s36.12 14.33 36.12 36.09c-0.02 21.69-14.45 36.21-36.12 36.21z m202.46 0c-21.69 0-43.45-14.52-43.45-36.21 0-21.77 21.76-36.09 43.45-36.09 21.79 0 36.21 14.33 36.21 36.09 0 21.69-14.43 36.21-36.21 36.21z m0 0",fill:"#3CB034","p-id":"9097"}),u("path",{d:"M920.01 602.12c0-115.59-115.74-209.86-245.72-209.86-137.64 0-246.05 94.27-246.05 209.86 0 115.84 108.41 209.92 246.05 209.92 28.81 0 57.85-7.25 86.79-14.51l79.36 43.44-21.76-72.3c58.06-43.53 101.33-101.3 101.33-166.55z m-325.5-36.14c-14.41 0-28.95-14.31-28.95-28.92 0-14.44 14.54-28.96 28.95-28.96 21.89 0 36.21 14.52 36.21 28.96 0 14.61-14.33 28.92-36.21 28.92z m159.13 0c-14.31 0-28.74-14.31-28.74-28.92 0-14.44 14.43-28.96 28.74-28.96 21.67 0 36.21 14.52 36.21 28.96 0 14.61-14.54 28.92-36.21 28.92z m0 0",fill:"#3CB034","p-id":"9098"})])])],-1),u("div",{class:"wechat-text"},"微信",-1)])],2),[[i,1===d(re)]])])])):g("",!0)]}),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-e70be05f"]]);export{Q as default};
