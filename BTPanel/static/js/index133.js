import{_ as a}from"./index103.js?v=1756369731";import{R as e,v as s,K as t,o as l,gC as i,k as o,h as n}from"./utils-lib.js?v=1756369731";import{c as r,r as d,c1 as m,aB as p,p as u,G as c,q as f,v as g,e as y,A as v,B as w,H as _,x as b,P as h,y as x,F as j,a_ as k,D as q,aj as C,M as V,ai as O}from"./base-lib.js?v=1756369731";import{g as S}from"./useStore2.js?v=1756369731";import{getRedisBackupList as D,restoreModuleBack as B,backModuleDatabase as J}from"./database.js?v=1756369731";import{u as L}from"./column.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const N={class:"p-20px"},T={class:"flex items-center p-20px"},A=r({__name:"index",props:{compData:{default:()=>({sid:0,keyList:[]})}},setup(r){const A=r,{refreshTableList:H}=S(),U=d(!1),z=d([]),F=d(0),G=d(!1),K=m(A.compData,"keyList"),M=m(A.compData,"sid"),P=async()=>{await t({loading:U,request:D({data:JSON.stringify({sort:"desc"})}),data:[Array,z]})},R=async()=>{await t({loading:"正在备份数据库,请稍后...",request:J({},"redis"),message:!0}),P()},E=async()=>{await t({loading:"正在备份数据库,请稍后...",request:J({data:JSON.stringify({db_idx:String(F.value),sid:M.value})},"redis"),message:!0}),P(),G.value=!1},I=[{label:"名称",prop:"name",showOverflowTooltip:!0},{label:"路径",prop:"filepath",showOverflowTooltip:!0},{label:"备份时间",prop:"mtime",render:a=>p("span",e(a.mtime))},{label:"大小",render:a=>p("span",s(a.size))},L([{onClick:async a=>{await l({title:"覆盖数据",icon:"warning-filled",type:"input",input:{content:"覆盖数据"},content:"即将使用【"+a.name+"】对数据进行覆盖，是否继续?"}),await t({loading:"正在恢复备份中，请稍后...",request:B({data:JSON.stringify({file:a.filepath,sid:M.value})},"redis"),message:!0}),H()},title:"恢复"},{onClick:async a=>{await l({title:"删除备份【"+a.name+"】",content:"是否删除【"+a.name+"】备份?"}),await t({loading:"正在备份数据库,请稍后...",request:i({path:a.filepath}),message:!0}),P()},title:"删除"}])];return u(()=>P()),(e,s)=>{const t=q,l=o,i=O,r=C,d=n,m=a,p=c("bt-loading");return f(),g("div",N,[y(m,null,{"header-left":v(()=>[y(t,{type:"primary",onClick:R},{default:v(()=>[...s[3]||(s[3]=[w("立即备份",-1)])]),_:1}),y(t,{onClick:s[0]||(s[0]=a=>G.value=!0)},{default:v(()=>[...s[4]||(s[4]=[w("指定备份",-1)])]),_:1})]),content:v(()=>[_(y(l,{"max-height":"400",ref:"routeBackup",data:b(z),class:"h-full",column:I},null,8,["data"]),[[p,b(U)],[p,"正在加载备份列表，请稍后...","title"]])]),popup:v(()=>[y(d,{area:36,title:"指定备份数据库",onConfirm:E,"show-footer":"",modelValue:b(G),"onUpdate:modelValue":s[2]||(s[2]=a=>h(G)?G.value=a:null)},{default:v(()=>[x("div",T,[s[5]||(s[5]=w(" 数据库 ",-1)),y(r,{modelValue:b(F),"onUpdate:modelValue":s[1]||(s[1]=a=>h(F)?F.value=a:null),class:"ml-20px !w-[24rem]"},{default:v(()=>[(f(!0),g(j,null,k(b(K),(a,e)=>(f(),V(i,{key:e,value:a.id,label:a.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])]),_:1})])}}});export{A as default};
