import{ai as a,l as e,L as l,bU as t,K as s,aj as n,M as o,d as i,J as r,k as c,a0 as u,o as p,e as m}from"./utils-lib.js?v=1756369731";import{B as d}from"./index140.js?v=1756369731";import{_ as h}from"./index103.js?v=1756369731";import{_ as v}from"./index112.js?v=1756369731";import{_ as f}from"./index123.js?v=1756369731";import{c as b,r as _,p as y,G as x,q as k,v as g,y as w,F as q,a_ as j,J as C,x as D,e as V,z as T,A as U,B as E,C as I,M as L,H as O,D as P,av as z}from"./base-lib.js?v=1756369731";import{getSqliteTableList as F,getSqliteKeys as R,getSqliteTableInfo as S,querySql as A,deleteTableData as M}from"./database.js?v=1756369731";import{a as B,u as H,c as J}from"./column.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./ace.js?v=1756369731";import"./index104.js?v=1756369731";const W={class:"flex w-full h-full"},G={class:"man_l"},K={class:"man_db"},Y={class:"man_db_li"},N={class:"man_db_li_left"},Q=["title"],X={class:"cursor-pointer ml-8px"},Z={class:"man_t"},$=["onClick"],aa=["onClick"],ea={class:"flex items-center"},la={class:"inline-block max-w-[14rem] truncate"},ta={class:"man_r"},sa={key:0,class:"flex items-center justify-center h-full"},na=["onClick"],oa={class:"ul-item"},ia={class:"flex-1 flex items-center"},ra=["onClick"],ca={key:1,class:"nq_con"},ua={class:"p-[1.5rem]"},pa={class:"mt-[1rem]"},ma={key:0,class:"result_table table",border:"1"},da={key:1,class:"text-danger"},ha=m(b({__name:"index",props:{compData:{default:{}}},setup(m){const b=m,ha=_(),va=_(),fa=_(!0),ba=_(0),_a=_(""),ya=_(!1),xa=_(!0),ka=_({p:1,limit:10,total:0,search:"",data:[],path:"",table:"",emptyText:"暂无数据，您可以添加数据"});let ga=_({});const wa=_([]),qa=_([]),ja={mode:"ace/mode/nginx",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"},Ca=a=>{e({title:"更改数据【"+a.id+"】",component:()=>l(()=>import("./insert-data.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),area:48,compData:{keys:qa.value,row:a,path:ka.value.path,table:ka.value.table,refresh:Pa},showFooter:!0})},Da=async a=>{const e=qa.value.find(a=>1===a.pk).name;await p({title:"删除表数据 [ "+a[e]+" ]",content:"删除选中表【"+ka.value.table+"】的数据后，该条数据将彻底消失，是否继续操作？"}),await s({loading:"正在删除表数据，请稍后...",request:M({path:ka.value.path,table:ka.value.table,where_data:a}),message:!0}),Pa()},Va=_(),Ta=()=>{e({title:"添加数据",component:()=>l(()=>import("./insert-data.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),area:48,compData:{keys:qa.value,path:ka.value.path,table:ka.value.table,refresh:Ua},showFooter:!0})},Ua=()=>{Pa(),Ea(b.compData.path,!0)},Ea=async(a,e)=>{var l;try{if(!ga.value[a]||e){const{data:l}=await F({path:a});ga.value={...ga.value,[a]:l},!e&&l.length>0&&Ia({path:a,name:l[0].name})}else(null==(l=ga.value[a])?void 0:l.length)>0&&Ia({path:a,name:ga.value[a][0].name})}catch(t){}},Ia=a=>{const{name:e,path:l}=a;if(fa.value=!1,"sql"===e){const a=t(8);return xa.value=!1,wa.value.push({name:"新建查询",path:"nq_con_"+a,sql:"",status:0,queryPath:l}),void(_a.value="nq_con_"+a)}xa.value=!0,wa.value.find(a=>a.path===l&&a.name===e)||wa.value.push({name:e,path:l}),La(a)},La=a=>{const{name:e,path:l}=a;fa.value=!1,"新建查询"===e?_a.value=l:(xa.value=!0,Oa(a))},Oa=async a=>{try{const{path:e,name:l}=a,{data:t}=await R({path:e,table:l});qa.value=t;let s=[];t.forEach(a=>s.push({label:a.name,prop:a.name,showOverflowTooltip:!0})),Va.value=[B({key:s[0].prop}),...s,H([{onClick:Ca,title:"更改"},{onClick:Da,title:"删除"}])],ka.value.path=e,ka.value.table=l,Pa()}catch(e){}},Pa=async()=>{try{_a.value=ka.value.table;const{data:e}=await s({loading:ya,request:S({path:ka.value.path,table:ka.value.table,p:ka.value.p,search:ka.value.search})});ka.value.data=a(e.data)?[]:e.data,ka.value.emptyText=a(e.data)?e.data:"暂无数据，您可以添加数据",ka.value.total=n(e.page)}catch(e){}},za=a=>{a.deltaY>0?va.value.scrollLeft+=100:va.value.scrollLeft-=100},Fa=async()=>{await Ea(b.compData.path,!0),o.success("刷新成功")},Ra=async()=>{await Pa(),o.success("刷新成功")},Sa=[{label:"删除数据",value:"delete",event:async(a,e,l,t)=>{var s,n;await a({title:"批量删除备份文件",content:"批量删除已选备份文件，是否继续操作？",column:[{prop:null==(s=Va.value[1])?void 0:s.prop,label:null==(n=Va.value[1])?void 0:n.label},J()],onConfirm:async()=>(await e(a=>M({path:ka.value.path,table:ka.value.table,where_data:a})),Ua(),!1)})}}];return y(()=>{const{list:a,path:e}=b.compData;ba.value=a.findIndex(a=>a.path===e)||0,Ea(e)}),(e,l)=>{const t=i,s=P,n=z,o=r,p=f,m=c,b=u,_=v,y=h,F=d,R=x("bt-loading");return k(),g("div",W,[w("div",G,[w("ul",K,[(k(!0),g(q,null,j(e.compData.list,(a,n)=>(k(),g(q,null,[a.path===e.compData.path?(k(),g("li",{key:n,class:C(n===D(ba)?"active":"")},[w("div",Y,[w("div",N,[V(t,{src:"/database/database-icon.png",class:"w-[1.4rem] h-[1.4rem] mr-[4px] ml-[8px]"}),w("span",{title:a.name},T(a.name),9,Q)]),w("div",X,[V(s,{size:"small",onClick:Fa},{default:U(()=>[...l[3]||(l[3]=[w("i",{class:"svgtofont-el-refresh-right mr-4px"},null,-1),E(" 刷新 ",-1)])]),_:1})])]),w("ul",Z,[w("li",{class:C(["new_query flex items-center",-1!==D(_a).indexOf("nq_con_")?"active":""]),onClick:e=>Ia({path:a.path,name:"sql"})},[V(t,{src:"/database/select-icon.png",class:"w-[1.4rem] mr-[4px] align-text-bottom"}),l[4]||(l[4]=w("span",null,"新建查询",-1))],10,$),(k(!0),g(q,null,j(D(ga)[a.path],(e,l)=>(k(),g("li",{class:C(["flex items-center",e.name===D(_a)?"active":""]),key:l,onClick:l=>Ia({path:a.path,name:e.name})},[V(t,{src:"/database/table-icon.png",class:"w-[1.4rem] mr-[4px] align-text-bottom"}),w("span",ea,[w("span",la,T(e.name),1),E(" "+T("（"+e.count+"）"),1)])],10,aa))),128))])],2)):I("",!0)],64))),256))])]),w("div",ta,[D(fa)?(k(),g("div",sa,[V(n,{description:"请点击左侧表查看数据"})])):(k(),g(q,{key:1},[w("div",{ref_key:"scrollDiv",ref:va,class:"ul_scroll",onWheel:za},[w("ul",null,[(k(!0),g(q,null,j(D(wa),(a,e)=>(k(),g("li",{class:C(a.name===D(_a)||a.path===D(_a)?"active":""),key:e,onClick:e=>La(a)},[w("div",oa,[w("div",ia,[V(t,{src:"新建查询"===a.name?"/database/select-icon.png":"/database/table-icon.png",class:"w-[1.4rem] h-[1.4rem] mr-[4px] align-middle text-[1.2rem]"},null,8,["src"]),w("span",null,T(a.name),1)]),w("i",{class:"svgtofont-el-close ml-[4px]",onClick:a=>(a=>{wa.value.splice(a,1),wa.value.length?La(wa.value[a]||wa.value[a-1]):(fa.value=!0,xa.value=!1)})(e)},null,8,ra)])],10,na))),128))])],544),D(xa)?(k(),L(y,{key:0,class:"p-[1.2rem]"},{"header-left":U(()=>[V(s,{type:"primary",onClick:Ta},{default:U(()=>[...l[5]||(l[5]=[E("添加数据",-1)])]),_:1})]),"header-right":U(()=>[V(o,{class:"mr-4px",modelValue:D(ka).search,"onUpdate:modelValue":l[0]||(l[0]=a=>D(ka).search=a),onSearch:Pa,placeholder:"搜索所有字段"},null,8,["modelValue"]),V(p,{onRefresh:Ra})]),content:U(()=>[O(V(m,{ref_key:"mangerTableRef",ref:ha,"max-height":480,column:D(Va),data:D(ka).data,description:D(ka).emptyText},null,8,["column","data","description"]),[[R,D(ya)]])]),"footer-left":U(()=>[V(b,{"table-ref":D(ha),options:Sa},null,8,["table-ref"])]),"footer-right":U(()=>[V(_,{layout:"prev, pager, next,  total, jumper",type:"default",page:D(ka).p,"onUpdate:page":l[1]||(l[1]=a=>D(ka).p=a),row:D(ka).limit,"onUpdate:row":l[2]||(l[2]=a=>D(ka).limit=a),onChange:Pa,total:D(ka).total},null,8,["page","row","total"])]),_:1})):(k(),g("div",ca,[(k(!0),g(q,null,j(D(wa),(e,t)=>(k(),g(q,null,["新建查询"===e.name?(k(),g("div",{key:t,class:C(e.path===D(_a)?"":"hidden")},[w("div",ua,[V(F,{modelValue:e.sql,"onUpdate:modelValue":a=>e.sql=a,class:"!h-[21rem]","editor-option":ja},null,8,["modelValue","onUpdate:modelValue"]),V(s,{type:"default",class:"!mt-[1rem]",onClick:a=>(async a=>{try{if(a.status=1,a.sql){const{data:e}=await A({path:a.queryPath,sql_shell:a.sql});a.result=e.status?e.list:e.msg}else a.result="请输入sql语句查询";a.status=2}catch(e){}})(e),disabled:1===e.status},{default:U(()=>[E(T(1===e.status?"正在查询...":"运行"),1)]),_:2},1032,["onClick","disabled"])]),w("div",{class:C(["run_result p-[1.5rem]",e.status?"":"hidden"])},[l[6]||(l[6]=w("span",{class:"text-[1.4rem]"},"查询结果：",-1)),w("div",pa,[D(a)(e.result)?(k(),g("div",da,T(e.result),1)):(k(),g("table",ma,[w("tbody",null,[(k(!0),g(q,null,j(e.result,(a,e)=>(k(),g("tr",{key:e},[(k(!0),g(q,null,j(a,(a,e)=>(k(),g("td",{key:e},T(a),1))),128))]))),128))])]))])],2)],2)):I("",!0)],64))),256))]))],64))])])}}}),[["__scopeId","data-v-ec2811e7"]]);export{ha as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
