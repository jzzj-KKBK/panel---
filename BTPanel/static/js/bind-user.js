import{c as e,x as t,r as a,k as l,p as s,q as n,M as o,A as r,H as i,I as d,y as c,e as u,z as p,J as m,O as v,v as f,B as g,C as w,K as h,a$ as b}from"./base-lib.js?v=1756369731";import{_ as y}from"./bt_logo_new.js?v=1756369731";import{s as x,p as k,t as _,q as D,r as V,v as E}from"./api.js?v=1756369731";import{e as j}from"./utils-lib.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const I={class:"flex !justify-center !w-full items-center"},q={class:"text-[2rem] text-dark inline-block mr-2 font-bold mt-12x"},C={key:0,class:"absolute el-form-item__error"},z={class:"flex justify-end items-centertext-[1.2rem] mt-[1rem]"},M={key:0,class:"view-con",style:{background:"#fff"}},B={class:"w-full mt-[1.5rem]"},H={class:"w-full mt-[1.5rem]"},S={class:"w-[100%] mt-[1.2rem] flex items-center justify-center text-[#20a53a]",size:"default"},U={key:3,class:"flex justify-end items-centertext-[1.2rem] mt-[1rem] h-[1.68rem]"},L={key:0},K={class:"more-bind"},N=j(e({__name:"bind-user",props:{compData:{default:()=>({})}},setup(e,{expose:j}){const N=e,{BtLink:O,BtDivider:T,ElForm:J,ElFormItem:F,ElPopover:$,ElInput:A,ElButton:R}=t(N.compData.dependencies.components),{Message:P,isUndefined:X,inputFocus:Y,rsaEncrypt:G,useAxios:Q}=t(N.compData.dependencies.hooks);x(Q);const W=a(!1),Z=a("获取验证码"),ee=l({username:"",password:"",code:""}),te=l({username:!1,password:!1,code:!1}),ae=a(""),le=a(0),se=a(),ne=a(!1),oe=a(1),re=l({order:"",uin:""}),ie=a({username:[{validator:(e,t,a)=>{var l,s;if((null==(l=N.compData)?void 0:l.dependencies.title)&&(ne.value=!1),/^1[3456789]\d{9}$/.test(t))a();else if(""===t)a(new Error("请输入宝塔官网账号"));else{if(null==(s=N.compData)?void 0:s.dependencies.title)return ne.value=!0,void a(new Error(" "));a(new Error("请输入正确的手机号"))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,t,a)=>{t.length>=8?a():a(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,t,a)=>{W.value||a(),6===t.length?a():a(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),de=()=>{se.value.validate(async e=>{if(!e)return!1;{const e={...ee};if(W.value){if(!ee.code)return P.error("请输入验证码");e.token=ae.value,delete e.password}else delete e.code;const a=P.load("绑定堡塔账号，请稍候 ...");try{e.username=await G(e.username),e.password=await G(e.password);const t=await k({...e});if(P.request(t),t.status)return window.location.reload();if(X(t.data))return!1;if(!t.status&&"[]"===JSON.stringify(t.data))return P.request(t);-1===t.data.code&&(ae.value=t.data.token,W.value=!0)}catch(t){}finally{a.close()}}})},ce=a(3);let ue=null,pe=null;const me=e=>{"string"==typeof e.data&&JSON.parse(e.data).code&&(async e=>{const t=JSON.parse(e.data);let a;try{a=P.load("正在绑定中......");const{data:e}=await _({...t,client:1});e.success||e.status?(window.removeEventListener("message",me),window.location.href="/"):(a.close(),P.error(e.res||String(e.msg)),pe.parent.postMessage({msg:e.res||e.msg,success:!1},"*"))}catch(l){null==a||a.close()}})(e)},ve=async()=>{if(re.order){const e={client:1,order_no:re.order,uin:re.uin},t=await E(e);t.status&&"string"==typeof t.data.data?fe(t.data.data):P.error(t.data.res||t.data.msg||t.data.data)}else re.uin?P.error("请输入订单号"):P.error("请输入腾讯云账号ID")},fe=e=>{const t=(window.screen.width-600)/2,a=(window.screen.height-800)/2;window.removeEventListener("message",me),window.addEventListener("message",me),pe&&pe.close(),pe=window.open(e,"popup","width=600,height=800,left=".concat(t,",top=").concat(a,",noopener,noreferrer")),pe||P.error("授权弹窗被浏览器阻止，请允许弹窗以继续操作。")},ge=async()=>{var e;if(ye.value)return void ve();let t;try{ce.value=3,ue&&clearInterval(ue),t=P.load("正在绑定中......");const{data:a}=await _({client:1});if(a.status||a.success)window.location.href="/";else{t.close();const l=a.msg||a.res,s=document.querySelector(".location-con");let n=16;if(s){const e=s.getBoundingClientRect();n=e.top+window.scrollY-50}P.msg({customClass:(null==(e=N.compData)?void 0:e.dependencies.title)?"customMsgDiv":"",type:"warning",dangerouslyUseHTMLString:!0,duration:3e3,offset:n,message:"".concat(l,'<div style="align-items:center;"><span style="display:inline-block;color:#ef0808;" class="loginErrorNum">').concat(ce.value,"</span>秒后切换到宝塔账号登录</div>")}),setTimeout(()=>{if(s){const e=s.getBoundingClientRect().left+window.scrollX,t=document.querySelector(".customMsgDiv");t&&(t.style.left="".concat(e+143,"px"),t.style.opacity="1")}},0),ue=setInterval(()=>{if(ce.value<=1)return clearInterval(ue),void he(1);ce.value-=1;const e=document.querySelector(".loginErrorNum");e&&(e.innerHTML="".concat(ce.value))},1e3)}}catch(a){null==t||t.close()}},we=async()=>{if(!ee.username||!ee.password)return void P.error("请先输入手机号和密码");te.username=!0,te.password=!0,(e=>{le.value&&clearInterval(le.value);const t=()=>{if(--e<=0)return clearInterval(le.value),Z.value="获取验证码",void(te.code=!1);Z.value="重新获取验证码(".concat(e,"s)")};t(),le.value=setInterval(t,1e3),te.code=!0})(60);const e=await D({username:ee.username,token:ae.value});P.request(e)},he=e=>{var t;oe.value=e,(null==(t=N.compData)?void 0:t.dependencies.onChangeType)&&N.compData.dependencies.onChangeType(1===e?"bind":"other")},be=a(!1),ye=a(!1),xe=async e=>{try{if(1===e)return void he(1);if(2===e)return void he(2);const t=await V();t.status?(be.value=1===t.data.client&&1===t.data.login,1===t.data.client&&1===t.data.login?he(2):1===t.data.client&&0!==t.data.login?(he(2),ye.value=!0):he(1)):he(1)}catch(t){he(1)}};return xe(),j({onOpen:()=>{Y(se.value.$el,"username")},onCancel:()=>{se.value.clearValidate()}}),s(()=>{var e;null==(e=se.value)||e.clearValidate()}),(e,a)=>{var l;const s=b;return n(),o(t(J),{ref_key:"bindUserInfo",ref:se,size:"medium",rules:t(ie),model:t(ee),autocomplete:"off",class:m(["bind-user-info",{"bind-form":!!(null==(l=e.compData)?void 0:l.dependencies.title)}])},{default:r(()=>{var l,b,x,k,_,D,V,E,j,N,J,P,X,Y,G;return[i(c("div",null,[u(t(F),{class:"text-center !mb-5 flex justify-center"},{default:r(()=>{var l;return[c("div",I,[c("h3",q,p((null==(l=e.compData)?void 0:l.dependencies.title)||"切换宝塔官网账号"),1),u(t($),{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:r(()=>[...a[11]||(a[11]=[c("a",{class:"bt-ico-ask align-middle",href:"javascript:;"},"?",-1)])]),_:1})])]}),_:1}),(n(),o(t(F),{key:1,prop:"username",class:m({"!mb-[3rem]":!!(null==(l=e.compData)?void 0:l.dependencies.title)})},{default:r(()=>{var l;return[u(t(A),{modelValue:t(ee).username,"onUpdate:modelValue":a[0]||(a[0]=e=>t(ee).username=e),clearable:"",required:"",class:"!leading-[4rem] !h-[4rem]",name:"username",autocomplete:"off",placeholder:"宝塔官网账号",disabled:t(te).username,onKeyup:a[1]||(a[1]=v(e=>de(),["enter"]))},null,8,["modelValue","disabled"]),(null==(l=e.compData)?void 0:l.dependencies.title)&&t(ne)?(n(),f("span",C,[a[13]||(a[13]=c("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),u(t(O),{class:"!text-[12px]",href:"https://www.bt.cn/register"},{default:r(()=>[...a[12]||(a[12]=[g(" 免费注册 ",-1)])]),_:1})])):w("",!0)]}),_:1},8,["class"])),(n(),o(t(F),{key:2,prop:"password"},{default:r(()=>[u(t(A),{modelValue:t(ee).password,"onUpdate:modelValue":a[2]||(a[2]=e=>t(ee).password=e),clearable:"",required:"",type:"password",class:"!leading-[4rem] !h-[4rem]",name:"password",autocomplete:"off",placeholder:"密码","show-password":!0,disabled:t(te).password,onKeyup:a[3]||(a[3]=v(e=>de(),["enter","native"]))},null,8,["modelValue","disabled"])]),_:1})),i(u(t(F),{prop:"code"},{default:r(()=>[u(t(A),{modelValue:t(ee).code,"onUpdate:modelValue":a[4]||(a[4]=e=>t(ee).code=e),clearable:"",autocomplete:"off",placeholder:"验证码",type:"text",onKeyup:a[5]||(a[5]=v(e=>de(),["enter","native"]))},{append:r(()=>[u(t(R),{class:"relative top-0 rounded-none rounded-r-[3px]",type:"primary",size:"default",disabled:t(te).code,plain:"",onClick:we},{default:r(()=>[g(p(t(Z)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},512),[[d,t(W)]]),u(t(R),{class:"w-[100%] mt-[1.2rem]",type:"primary",size:"default",onClick:a[6]||(a[6]=e=>de())},{default:r(()=>{var t,a;return[g(p((null==(t=e.compData)?void 0:t.dependencies.btn)||((null==(a=e.compData)?void 0:a.dependencies.title)?"绑定账号":"切换账号")),1)]}),_:1}),c("div",z,[u(t(O),{href:"https://www.bt.cn/register"},{default:r(()=>[...a[14]||(a[14]=[g("注册账号",-1)])]),_:1}),u(t(T)),u(t(O),{href:"https://www.bt.cn/login.html?page=reset"},{default:r(()=>[...a[15]||(a[15]=[g("忘记密码",-1)])]),_:1}),u(t(T)),u(t(O),{href:"https://www.bt.cn/bbs"},{default:r(()=>[...a[16]||(a[16]=[g("问题反馈",-1)])]),_:1})])],512),[[d,1===t(oe)]]),i(c("div",null,[(null==(b=e.compData)?void 0:b.dependencies.title)?w("",!0):(n(),f("div",{key:0,class:"view-con",style:h((null==(x=e.compData)?void 0:x.dependencies.title)?"":"background:#fff;")},[c("div",{class:"app-box",style:h((null==(k=e.compData)?void 0:k.dependencies.title)?"":"background:#fff;")},[...a[17]||(a[17]=[c("img",{alt:"",src:y},null,-1)])],4),a[19]||(a[19]=c("div",{class:"change-icon"},[c("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[c("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1)),c("div",{class:"app-box",style:h((null==(_=e.compData)?void 0:_.dependencies.title)?"":"background:#fff;")},[...a[18]||(a[18]=[c("div",{class:"tencent-icon"},null,-1)])],4)],4)),c("div",{class:m({"bg-white":null==(D=e.compData)?void 0:D.dependencies.title,"rounded-[4px]":null==(V=e.compData)?void 0:V.dependencies.title}),style:h({border:(null==(E=e.compData)?void 0:E.dependencies.title)?"1px solid #ddd":"none","padding-top":(null==(j=e.compData)?void 0:j.dependencies.title)?"2rem":"0"})},[(null==(N=e.compData)?void 0:N.dependencies.title)?(n(),f("div",M,[...a[20]||(a[20]=[c("div",{class:"app-box",style:{background:"#fff"}},[c("img",{alt:"",src:y})],-1),c("div",{class:"change-icon"},[c("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[c("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1),c("div",{class:"app-box",style:{background:"#fff"}},[c("div",{class:"tencent-icon"})],-1)])])):w("",!0),t(ye)?w("",!0):(n(),o(t(F),{key:1,class:m(["!mb-5 flex justify-center",{"p-[2.5rem]":null==(J=e.compData)?void 0:J.dependencies.title,"!pt-0":null==(P=e.compData)?void 0:P.dependencies.title}])},{default:r(()=>[u(s),a[21]||(a[21]=c("h3",{class:"text-[1.4rem] w-full text-[#666] inline-block font-bold"}," 腾讯云用户专享特权： ",-1)),a[22]||(a[22]=c("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] flex items-center"},[c("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),g(" 免费使用原本需要付费的功能： ")],-1)),a[23]||(a[23]=c("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] ml-[1.9rem] flex items-center location-con"},[c("img",{src:"/static/img/soft_ico/ico-msg_push.png",class:"w-[2rem] mr-[1rem]"}),g(" 异常监控推送 ")],-1)),a[24]||(a[24]=c("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1.5rem] flex items-center"},[c("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),g(" 宝塔官方付费软件均享额外折扣 ")],-1))]),_:1},8,["class"])),t(ye)?(n(),o(t(F),{key:2,class:m(["!mb-0 flex justify-center",{"p-[2.5rem]":null==(X=e.compData)?void 0:X.dependencies.title,"!pt-0":null==(Y=e.compData)?void 0:Y.dependencies.title}])},{default:r(()=>[u(s),a[25]||(a[25]=c("h3",{class:"text-[1.4rem] w-full text-[#666] inline-block font-bold text-center"}," 腾讯云账号绑定 ",-1)),c("div",B,[u(t(A),{modelValue:t(re).uin,"onUpdate:modelValue":a[7]||(a[7]=e=>t(re).uin=e),size:"large",clearable:"",name:"uin",autocomplete:"off",placeholder:"请输入腾讯云账号ID"},null,8,["modelValue"])]),c("div",H,[u(t(A),{modelValue:t(re).order,"onUpdate:modelValue":a[8]||(a[8]=e=>t(re).order=e),size:"large",clearable:"",name:"order",autocomplete:"off",placeholder:"请输入腾讯云市场订单号",onKeyup:v(ve,["enter","native"])},null,8,["modelValue"])])]),_:1},8,["class"])):w("",!0),u(t(R),{type:"primary",class:"w-[85%] mt-[4rem] relative left-[7.5%]",style:{margin:"1rem auto 0"},size:"default",onClick:ge},{default:r(()=>[g(p(t(be)?"一键激活专享特权":"绑定腾讯云账号"),1)]),_:1}),c("div",S,[c("span",{class:"cursor-pointer hover:text-[#1d9534]",onClick:a[9]||(a[9]=e=>he(1))},"已有宝塔账号登录")]),(null==(G=e.compData)?void 0:G.dependencies.title)?(n(),f("div",U)):w("",!0)],6)],512),[[d,2===t(oe)]]),1===t(oe)&&(t(be)||t(ye))?(n(),f("div",L,[a[27]||(a[27]=c("div",{class:"more-title"},[c("span",null,"更多绑定方式")],-1)),c("div",K,[i(c("div",{class:"bind-box",onClick:a[10]||(a[10]=e=>xe(2))},[...a[26]||(a[26]=[c("i",{class:"tencent_ico"},null,-1),g(" 腾讯云账号 ",-1)])],512),[[d,1===t(oe)]])])])):w("",!0)]}),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-bdcd46ea"]]);export{N as default};
