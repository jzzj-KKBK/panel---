import{ay as e,K as a,c7 as l,M as s,ah as u,gD as n,ag as o,al as r,e as t}from"./utils-lib.js?v=1756369731";import{r as d,k as m,c,p as i,a4 as f,q as p,v as _,e as v,A as g,x as b,Q as y,O as h,B as V,y as x,P as w,a9 as k,D as C,S as j,a7 as U,aA as q}from"./base-lib.js?v=1756369731";import{_ as A}from"./index116.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const{refs:{isRefreshTableList:K}}=e();let R=null;const S=d(!1),T=d(""),z=d("common"),D=m({name:"",image:"",cmd:""}),E={model_index:"btdocker",mod_name:"image",def_name:"pull_from_some_registry",ws_callback:111,name:"",image:""},M=()=>{T.value=""},B=(e,a)=>{try{const e=a.data;if(T.value+="".concat(e),e.includes("bt_successful")||e.includes("bt_failed")){const a={status:e.includes("bt_successful"),msg:e.includes("bt_successful")?"拉取成功":"拉取失败"};s.request(a),a.status&&(K.value=!0),null==R||R.close(),S.value=!1}}catch(l){}},F=()=>{null==R||R.close(),T.value="",R=u({route:"/ws_model",onMessage:B}),null==R||R.send(E)},H={image:[{validator:(e,a,l)=>{""===a?l(new Error("请输入镜像名")):l()},trigger:["blur"]}]},I=()=>{K.value=!0},L=d([]),O=async e=>{try{if("cmd"===z.value)return void(async()=>{try{if(""===D.cmd)return void s.error("请输入命令");S.value=!0,E.name="",E.url="",E.image="",E.def_name="get_cmd_log";const e=await n({cmd:D.cmd},"image");e.status?F():(s.error(e.msg),S.value=!1)}catch(e){}})();if(""===D.name)return void s.error("请选择仓库名");S.value=!0,await e.value.validate(async e=>{e?(E.name=L.value.find(e=>e.url==D.name).name,E.url=L.value.find(e=>e.url==D.name).url,E.image=D.image,E.def_name="pull_from_some_registry",F()):S.value=!1})}catch(a){}},P={class:"flex flex-col p-[1.6rem] lib-box"},Q={class:"rounded-default bg-[#333] h-[45.6rem]"},G={class:"rounded-default bg-[#333] h-[45.6rem]"},J=t(c({__name:"index",setup(e,{expose:s}){const u=d(),n=()=>{O(u)};return i(()=>{(async()=>{a({request:l(),data:Array,success:e=>{var a;e.forEach(e=>{L.value.push({value:e.url,label:"".concat(e.name).concat("docker.io"===e.url?"":"(".concat(e.url,")")),url:e.url,name:e.name})}),D.name=null==(a=L.value[0])?void 0:a.value}})})()}),f(()=>{null==R||R.close(),R=null,L.value=[],D.name="",D.image="",D.cmd="",M()}),s({onConfirm:n,onCancel:I}),(e,a)=>{const l=o,s=k,t=C,d=j,m=A,c=U,i=q,f=r;return p(),_("div",P,[v(f,{modelValue:b(z),"onUpdate:modelValue":a[5]||(a[5]=e=>w(z)?z.value=e:null),type:"card",onChange:b(M)},{default:g(()=>[v(i,{name:"common",label:"常规拉取"},{default:g(()=>[v(c,{ref_key:"cmdFormRef",ref:u,size:"default",model:b(D),rules:b(H),disabled:b(S),class:"relative w-full","label-position":"right",onSubmit:a[2]||(a[2]=y(()=>{},["prevent"]))},{default:g(()=>[v(s,{prop:"name",label:"仓库名"},{default:g(()=>[v(l,{modelValue:b(D).name,"onUpdate:modelValue":a[0]||(a[0]=e=>b(D).name=e),options:b(L),class:"!w-[32rem]"},null,8,["modelValue","options"])]),_:1}),v(s,{prop:"image",label:"镜像名"},{default:g(()=>[v(d,{class:"!w-[32rem]",modelValue:b(D).image,"onUpdate:modelValue":a[1]||(a[1]=e=>b(D).image=e),onKeydown:h(n,["enter"]),placeholder:"请输入镜像名，按回车拉取,如:image:v1"},{append:g(()=>[v(t,{type:"default",onClick:n},{default:g(()=>[...a[6]||(a[6]=[V("拉取",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[7]||(a[7]=x("div",{class:"resultTitle px-[.2rem] py-[.4rem] mt-[1.6rem]"},"拉取结果：",-1)),x("div",Q,[v(m,{class:"h-[45.6rem] !rounded-none",content:b(T)},null,8,["content"])])]),_:1},8,["model","rules","disabled"])]),_:1}),v(i,{name:"cmd",label:"命令拉取"},{default:g(()=>[v(c,{ref:"cmdRef",size:"large",model:b(D),rules:b(H),disabled:b(S),class:"relative w-full","label-position":"right",onSubmit:a[4]||(a[4]=y(()=>{},["prevent"]))},{default:g(()=>[v(s,{prop:"cmd"},{default:g(()=>[v(d,{autofocus:"",modelValue:b(D).cmd,"onUpdate:modelValue":a[3]||(a[3]=e=>b(D).cmd=e),onKeyup:h(n,["enter"]),placeholder:"请输入需要执行的命令,docker pull redis:latest，按回车执行"},{append:g(()=>[v(t,{type:"default",onClick:n},{default:g(()=>[...a[8]||(a[8]=[V("执行命令",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[9]||(a[9]=x("div",{class:"resultTitle px-[.2rem] py-[.4rem] mt-[1.6rem]"},"拉取结果：",-1)),x("div",G,[v(m,{class:"h-[45.6rem] !rounded-none",content:b(T)},null,8,["content"])])]),_:1},8,["model","rules","disabled"])]),_:1})]),_:1},8,["modelValue","onChange"])])}}}),[["__scopeId","data-v-f6707562"]]);export{J as default};
