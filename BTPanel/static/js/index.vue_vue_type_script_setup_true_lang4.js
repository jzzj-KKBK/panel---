import{M as a,at as e,K as l,h as s}from"./utils-lib.js?v=1756369731";import{c as t,r as o,k as n,q as r,v as u,e as i,A as d,F as m,a_ as c,B as f,y as p,x as v,P as b,D as y,ao as _,an as x,aj as w,a9 as S,a7 as T,z as h,M as g,ap as j,ai as V}from"./base-lib.js?v=1756369731";import{g as k}from"./useStore2.js?v=1756369731";import{syncDataToPanel as M,syncModuleDataToPanel as q}from"./database.js?v=1756369731";import{r as L,n as C}from"./useMethod4.js?v=1756369731";const D={class:"inline-block flex flex-col py-[1.2rem] mb-[0.8rem]"},F={class:"text-[#666] text-[1.4rem] mb-[8px]"},A=["innerHTML"],H={class:"p-[16px]"},N=t({__name:"index",props:{compData:{default:()=>[]}},setup(t){var N;const P=t,{refs:{tabActive:R,isRefreshClassList:U},refreshTableList:z}=k(),B=o(P.compData),J=o((null==(N=B.value[0])?void 0:N.id)||""),K=n({}),O=o(),E=o(!1),G=[{label:"从面板同步到服务器",name:"SyncToServer",description:"将面板的数据库同步到本地服务器中"},{label:"从服务器同步到面板",name:"SyncToPanel",description:"从服务器获取所有数据库，并同步到面板中<br>（数据库密码无法同步，需在面板重新配置）"}],I=async a=>{if("SyncToServer"===a)Q();else{const a=await L();J.value=a[0].id,B.value=a,E.value=!0}},Q=async()=>{const l=a.load("正在同步...");try{const e=await C();a.request(e),z()}catch(s){e(s,"syncToServer")}finally{l.close()}},W=async()=>{await O.value.validate();let a={sid:Number(J.value)};await l({loading:"正在获取数据库,请稍候...",request:"mysql"===R.value?M(a):q({data:JSON.stringify(a)},R.value),message:!0}),U.value=!0,setTimeout(()=>{z()},1e3)};return(a,e)=>{const l=y,t=j,o=_,n=x,k=V,M=w,q=S,L=T,C=s;return r(),u("div",null,[i(n,{onCommand:I},{dropdown:d(()=>[i(o,null,{default:d(()=>[(r(),u(m,null,c(G,(a,e)=>i(t,{command:a.name,key:e},{default:d(()=>[p("div",D,[p("span",F,h(a.label),1),p("span",{class:"text-[#999] text-[1.2rem] leading-1.8rem",innerHTML:a.description},null,8,A)])]),_:2},1032,["command"])),64))]),_:1})]),default:d(()=>[i(l,{type:"default"},{default:d(()=>[...e[2]||(e[2]=[f(" 同步数据库 ",-1),p("i",{class:"svgtofont-el-arrow-down ml-4px"},null,-1)])]),_:1})]),_:1}),i(C,{title:"从服务器获取",modelValue:v(E),"onUpdate:modelValue":e[1]||(e[1]=a=>b(E)?E.value=a:null),area:46,onConfirm:W,showFooter:""},{default:d(()=>[p("div",H,[i(L,{ref_key:"syncFormRef",ref:O,model:v(K)},{default:d(()=>[i(q,{label:"数据库位置"},{default:d(()=>[i(M,{modelValue:v(J),"onUpdate:modelValue":e[0]||(e[0]=a=>b(J)?J.value=a:null),class:"!w-[28rem]"},{default:d(()=>[(r(!0),u(m,null,c(v(B),(a,e)=>(r(),g(k,{key:e,value:a.id,label:a.ps+"（服务器地址："+a.db_host+"）"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}});export{N as _};
