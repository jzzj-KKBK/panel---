import{at as a,K as t,cm as s,u as e,N as r,o as n,R as u,M as o}from"./utils-lib.js?v=1756369731";import{j as c,r as l,g as i}from"./base-lib.js?v=1756369731";import{u as v,S as p}from"./useStore4.js?v=1756369731";import{getRewriteTel as h,getComposerVersion as m}from"./site.js?v=1756369731";const y=c("SITE-CONFIG-FILE-STORE",()=>({viewFileHistoryEvent:async t=>{try{const a=await h({filename:t.path,history:t.row});return{status:a.data.status,data:a.data.data}}catch(s){return a(s),{status:!1,msg:"获取文件历史失败"}}},recoverFileEvent:async a=>{try{const e=await t({loading:"正在恢复，请稍后...",request:s({filename:a.path,history:a.row}),data:{status:Boolean}});return{msg:e.status?"恢复成功":"恢复失败",status:e.status}}catch(e){}},getComposerPathEvent:async a=>{try{const s=await t({request:m({path:a}),data:{file_path:String}});return{data:s.data.file_path,status:s.status}}catch(s){return{status:!1,msg:"获取composer路径失败"}}}})),{activeType:d,siteInfo:g,isBindExtranet:w,siteType:f}=v(),{getFileEvent:E,saveFileEvent:j}=p(),{viewFileHistoryEvent:b,recoverFileEvent:F,getComposerPathEvent:x}=y(),{plugin:S}=e(),_=l("config"),C=l([{label:"配置文件",name:"config",render:()=>{}},{label:"Composer配置文件",name:"composer",render:()=>{}}]),I=l(""),T=l(),q=l(""),B=i(()=>{const a="nodejs"===d.value?"node":d.value,t="php"!==d.value&&"proxy"!==d.value&&"proxy"!==d.value?"".concat(a,"_"):"",s="/www/server/panel/vhost/".concat(S.value.webserver,"/").concat(t).concat(g.value.name,".conf");return"config"===_.value?s.replace(/\/+/g,"/"):H.value}),H=l("");l(!1);const N=l(!1),O=async a=>{try{N.value=!0;const{data:t}=await E(a);I.value=t.data,r(t.historys)&&(T.value=t.historys),N.value=!1}catch(t){return{status:!1,msg:"获取配置文件失败"}}},P=(a,t)=>{_.value=t,O({path:B.value})},R=async(a={data:I.value,encoding:"utf-8",path:B.value})=>{try{(await j(a)).status&&O({path:a.path})}catch(t){return{status:!1,msg:"保存文件失败"}}},G=async a=>{try{const t=await b({row:a,path:B.value});return q.value=t.status?t.data:"文件不存在",t}catch(t){return{status:!1,msg:"获取文件历史失败"}}},K=async a=>{try{await n({title:"恢复历史文件",content:"是否恢复历史文件 ".concat(u(a))});const t=await F({row:a,path:B.value});return o.request({status:t.status,msg:t.status?"恢复成功":"恢复失败"}),t.status&&O({path:B.value}),t.status}catch(t){}},L=()=>{const{project_type:a,project_config:t,name:s}=g.value;w.value=!!(null==t?void 0:t.bind_extranet);["php","html","proxy"].includes(a)&&(w.value=!0),"php"===a&&M()},M=async()=>{try{const a=await x(g.value.path);return a.status&&(H.value=a.data),a}catch(a){return{status:!1,msg:"获取composer路径失败"}}},k=async()=>{L(),w.value&&await O({path:B.value})};export{y as S,P as a,N as b,H as c,_ as d,I as e,q as f,O as g,T as h,k as i,L as j,K as r,R as s,C as t,G as v};
