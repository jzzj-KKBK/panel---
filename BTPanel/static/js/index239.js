import{M as e,ah as l,j as s,ag as a,c as t,W as i,v as n,R as o,e as r}from"./utils-lib.js?v=1756369731";import{j as c,s as d,k as m,r as u,c as p,g as f,p as v,a4 as h,q as x,v as b,y as g,e as w,A as y,x as T,H as z,bp as _,O as L,J as S,B as C,z as k,F as V,a_ as D,C as j,I as M,M as I,ai as O,aj as H,D as U,T as F,b6 as B,Q as E,ba as P}from"./base-lib.js?v=1756369731";import{_ as R}from"./index101.js?v=1756369731";import{_ as A}from"./index104.js?v=1756369731";import{F as J,Y as N}from"./store.js?v=1756369731";import{f as K}from"./validator.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./files.js?v=1756369731";import"./column.js?v=1756369731";import"./store2.js?v=1756369731";const $=c("FILES-CONTENT-SEARCH-STORE",()=>{var s;const a=J(),{fileTabActiveData:t,authType:i}=d(a),n=m({load:!1,searchType:"expert",searchContentType:"file",regular:!1,case:!1,word:!1,searchContent:"",path:(null==(s=t.value)?void 0:s.param.path)||"",isDir:!0,suffix:"",time:"",customTime:[],size:"10",minSize:0,maxSize:10485760}),o=u(!0),r=u(""),c=m({fileList:[],activeIndex:0,type:"file"}),p=m({disabledDate:e=>{const l=new Date;l.setHours(23,59,59,999);const s=l.getTime();return e.getTime()>s},defaultTime:[new Date((new Date).setHours(0,0,0,0)),new Date((new Date).setHours(23,59,59,0))]}),f=m({show:!1,extList:[{title:"全部",value:"*"},{title:"无后缀文件",value:"no_ext"},{title:"PHP文件",value:"php"},{title:"Python文件",value:"py"},{title:"HTML文件",value:"html"},{title:"JS文件",value:"js"},{title:"JSON文件",value:"json"},{title:"Conf配置文件",value:"conf"},{title:"LOG日志",value:"log"}],selectList:[]});let v=null;const h=()=>{v=l({route:"routine"===n.searchType?"/ws_panel":"/ws_model",onMessage:x})},x=async(l,s)=>{if("token error"===s.data)return e.error("token error"),n.load=!1,void(null==v||v.close());const a=JSON.parse(s.data);a.name&&c.fileList.push(a),!0===a.result&&(null==v||v.close(),n.load=!1,e.success("搜索完成"))};return{authType:i,searchData:n,searchResult:c,suffix:f,timeList:[{label:"不限时间",value:""},{label:"最近3小时",value:"3"},{label:"最近1天",value:"1"},{label:"最近7天",value:"7"},{label:"最近30天",value:"30"},{label:"自定义",value:"custom"}],pickerOptions:p,sizeList:[{label:"不限大小",value:""},{label:"0 ~ 100KB",value:"100"},{label:"0 ~ 1MB",value:"1"},{label:"0 ~ 10MB",value:"10"},{label:"自定义",value:"custom"}],isfirst:o,searchCon:r,helpList:[{content:"文件较多时,搜索时间较长,请耐心等待"}],selectOptions:e=>{if(!n.load)switch(e){case"case":n.case=!n.case;break;case"word":n.word=!n.word;break;case"regular":n.regular=!n.regular}},setSizeMode:e=>{switch(n.size=e,e){case"custom":default:n.minSize="",n.maxSize="";break;case"100":n.minSize=0,n.maxSize=102400;break;case"1":n.minSize=0,n.maxSize=1048576;break;case"10":n.minSize=0,n.maxSize=10485760}},editFind:e=>{N(e,e=>{e&&e.execCommand("find"),e.find(n.searchContent)})},search:()=>{if(n.load)return n.load=!1,null==v||v.close(),!1;if(""===n.searchContent)return void e.error("请输入搜索内容");if(""===n.path)return void e.error("请选择目录");const l={search_content:n.searchContent,exts:""===n.suffix?"*":n.suffix,path:n.path,is_subdir:n.isDir,is_regular:n.regular,is_case:n.case,is_word:n.word,ws_callback:"111",model_index:"files",mod_name:"routine"===n.searchType?"panelSearch":"search",def_name:"get_search"};if("file"===n.searchContentType?l.search_content=n.searchContent:l.search_name=n.searchContent,""!==n.size&&"expert"===n.searchType)if("custom"===n.size){if(""===n.minSize||""===n.maxSize||n.minSize>n.maxSize||n.minSize<0||n.maxSize<0)return void e.error("请输入正确文件大小");l.min_size=(1024*n.minSize*1024).toString(),l.max_size=(1024*n.maxSize*1024).toString()}else l.min_size=n.minSize.toString(),l.max_size=n.maxSize.toString();if(""!==n.time&&"expert"===n.searchType){if("custom"===n.time&&0===n.customTime.length)return void e.error("请选择时间");l.start_time=n.customTime[0]/1e3,l.end_time=n.customTime[1]/1e3}n.load=!0,c.fileList=[],c.type=n.searchContentType,c.activeIndex=0,o.value=!1,r.value=n.searchContent,h(),null==v||v.send(l)},openFile:()=>{n.load||K({type:"dir",path:n.path,change:e=>{n.path=e}})},selectExt:e=>{0===e?f.selectList.includes(0)?(f.selectList=[],n.suffix=""):(f.selectList=[0],n.suffix="*"):(f.selectList=f.selectList.filter(e=>0!==e),f.selectList.includes(e)?f.selectList.splice(f.selectList.indexOf(e),1):f.selectList.push(e),n.suffix=f.selectList.map(e=>f.extList[e].value).join(","))},setTimeMode:e=>{switch(n.time=e,e){case"custom":default:n.customTime=[];break;case"3":n.customTime=[(new Date).getTime()-108e5,(new Date).getTime()];break;case"1":n.customTime=[(new Date).getTime()-864e5,(new Date).getTime()];break;case"7":n.customTime=[(new Date).getTime()-6048e5,(new Date).getTime()];break;case"30":n.customTime=[(new Date).getTime()-2592e6,(new Date).getTime()]}},toggleSelectMode:e=>{o.value=!0,c.fileList=[],c.activeIndex=0,n.load=!1,null==v||v.close(),"type"===e&&"name"===n.searchContentType&&(n.searchType="expert")},getSearchPath:()=>{var e;n.path=null==(e=t.value)?void 0:e.param.path},$reset:()=>{var e;null==v||v.close(),o.value=!0,r.value="",Object.assign(c,{fileList:[],activeIndex:0,type:"file"}),Object.assign(n,{load:!1,searchType:"expert",searchContentType:"file",regular:!1,case:!1,word:!1,searchContent:"",path:(null==(e=t.value)?void 0:e.param.path)||"",isDir:!0,suffix:"",time:"",customTime:[],size:"10",minSize:0,maxSize:10485760})}}}),q={class:"flex flex-col p-[2rem] relative"},G={class:"menu"},Q={class:"flex items-center h-[3.5rem]"},W={class:"flex items-center border border-[#DCDFE6] rounded-2px"},Y={class:"search-input"},X=["disabled"],Z={class:"flex items-center h-[3.5rem] mt-[1rem]"},ee={class:"flex items-center relative mr-[2.5rem]"},le={class:"flex items-center relative"},se={key:0,class:"ext-list"},ae={class:"mt5"},te=["onMousedown"],ie={class:"flex items-center h-[3.5rem] mt-[1rem]"},ne={class:"flex items-center relative mr-[1.5rem]"},oe={class:"flex items-center relative"},re={class:"size flex items-center"},ce={class:"content"},de={key:0,class:"empty"},me={class:"flex flex-col items-center"},ue={key:1,class:"flex w-full"},pe={class:"result-list"},fe={class:"search-num"},ve={class:"list"},he=["onClick"],xe=["title"],be={class:"log"},ge={class:"name flex justify-between"},we=["title"],ye={class:"con"},Te=["innerHTML"],ze={key:2,class:"flex w-full"},_e={class:"log"},Le={class:"result"},Se={class:"file-table"},Ce={class:"name"},ke={class:"msg"},Ve={class:"text-right w-[8rem]"},De=r(p({__name:"index",setup(e){const l=$(),{authType:r,searchData:c,searchResult:m,suffix:u,pickerOptions:p,isfirst:J,searchCon:K}=d(l),{helpList:De,timeList:je,sizeList:Me,setSizeMode:Ie,editFind:Oe,search:He,openFile:Ue,selectExt:Fe,setTimeMode:Be,toggleSelectMode:Ee,$reset:Pe,getSearchPath:Re,selectOptions:Ae}=l,Je=f(()=>m.value.fileList.reduce((e,l)=>e+l.search_num,0));return v(()=>{Re()}),h(()=>{Pe()}),(e,l)=>{const r=O,d=H,f=A,v=U,h=R,$=F,Pe=s,Re=a,Ne=B,Ke=P,$e=t,qe=i;return x(),b("div",q,[g("div",G,[g("div",Q,[l[18]||(l[18]=g("span",{class:"title"},"搜索内容",-1)),g("div",W,[g("div",null,[w(d,{class:"file_select !w-[8rem]",modelValue:T(c).searchContentType,"onUpdate:modelValue":l[0]||(l[0]=e=>T(c).searchContentType=e),disabled:T(c).load,onChange:l[1]||(l[1]=e=>T(Ee)("type"))},{default:y(()=>[w(r,{label:"文件",value:"file"}),w(r,{label:"文件名",value:"name"})]),_:1},8,["modelValue","disabled"])]),g("div",Y,[z(g("input",{type:"text",class:"w-[59rem] h-[3rem] border-none outline-none shadow-none",placeholder:"请输入搜索内容","onUpdate:modelValue":l[2]||(l[2]=e=>T(c).searchContent=e),disabled:T(c).load,onKeydown:l[3]||(l[3]=L((...e)=>T(He)&&T(He)(...e),["enter"]))},null,40,X),[[_,T(c).searchContent]]),w(f),g("div",{class:S(["inputOption",{disabled:T(c).load}])},[g("span",{class:S(T(c).case?"active":""),title:"区分大小写",onClick:l[4]||(l[4]=e=>T(Ae)("case"))},"Aa",2),g("span",{class:S(T(c).word?"active":""),title:"全词匹配",onClick:l[5]||(l[5]=e=>T(Ae)("word"))},"[ab]",2),g("span",{class:S(T(c).regular?"active":""),title:"正则表达式",onClick:l[6]||(l[6]=e=>T(Ae)("regular"))},".*",2)],2)])]),w(v,{class:"!ml-[2rem] w-[8.5rem] h-[3rem] !rounded-[2px]",onClick:T(He),type:T(c).load?"info":"primary"},{default:y(()=>[C(k(T(c).load?"取消搜索":"搜索"),1)]),_:1},8,["onClick","type"])]),g("div",Z,[l[21]||(l[21]=g("span",{class:"title"},"目录",-1)),g("div",ee,[w(h,{modelValue:T(c).path,"onUpdate:modelValue":l[7]||(l[7]=e=>T(c).path=e),width:"48rem",class:"file-input",disabled:T(c).load,icon:"icon-file_mode",onIconClick:T(Ue),placeholder:"请选择目录"},null,8,["modelValue","disabled","onIconClick"]),w($,{class:"!absolute top-0 left-[33rem]",modelValue:T(c).isDir,"onUpdate:modelValue":l[8]||(l[8]=e=>T(c).isDir=e),disabled:T(c).load},{default:y(()=>[...l[19]||(l[19]=[C("包含子目录",-1)])]),_:1},8,["modelValue","disabled"])]),g("div",le,[l[20]||(l[20]=g("span",{class:"title"},"文件后缀",-1)),w(Pe,{modelValue:T(c).suffix,"onUpdate:modelValue":l[9]||(l[9]=e=>T(c).suffix=e),width:"32rem",spellcheck:"false",disabled:T(c).load,onFocus:l[10]||(l[10]=e=>T(u).show=!0),onBlur:l[11]||(l[11]=e=>T(u).show=!1),placeholder:"选择或填写后缀类型，使用逗号分隔"},null,8,["modelValue","disabled"]),T(u).show?(x(),b("div",se,[g("div",ae,[g("ul",null,[(x(!0),b(V,null,D(T(u).extList,(e,l)=>(x(),b("li",{key:e.value,class:S(T(u).selectList.indexOf(l)>-1?"active":""),onMousedown:E(e=>T(Fe)(l),["stop","prevent"])},k(e.title),43,te))),128))])])])):j("",!0)])]),z(g("div",ie,[l[25]||(l[25]=g("span",{class:"title"},"修改时间",-1)),g("div",ne,[w(Re,{modelValue:T(c).time,"onUpdate:modelValue":l[12]||(l[12]=e=>T(c).time=e),disabled:T(c).load,options:T(je),onChange:T(Be),class:S(["mr-[1rem]","custom"===T(c).time?"!w-[9rem]":"!w-[20rem]"]),"empty-values":[null,void 0]},null,8,["modelValue","disabled","options","onChange","class"]),"custom"===T(c).time?(x(),I(Ne,{key:0,class:"!w-[26rem]",align:"right",type:"daterange",modelValue:T(c).customTime,"onUpdate:modelValue":l[13]||(l[13]=e=>T(c).customTime=e),disabled:T(c).load,"range-separator":"","start-placeholder":"开始日期","end-placeholder":"结束日期",ref:"player","default-time":T(p).defaultTime,"value-format":"x","disabled-date":T(p).disabledDate},null,8,["modelValue","disabled","default-time","disabled-date"])):j("",!0)]),g("div",oe,[l[24]||(l[24]=g("span",{class:"title"},"文件大小",-1)),w(Re,{modelValue:T(c).size,"onUpdate:modelValue":l[14]||(l[14]=e=>T(c).size=e),disabled:T(c).load,onChange:T(Ie),options:T(Me),class:S(["mr-[1rem]","custom"===T(c).size?"w-[9rem]":"!w-[20rem]"]),"empty-values":[null,void 0]},null,8,["modelValue","disabled","onChange","options","class"]),z(g("div",re,[l[22]||(l[22]=g("div",{class:"title !w-[4rem]"},"大于",-1)),w(Pe,{modelValue:T(c).minSize,"onUpdate:modelValue":l[15]||(l[15]=e=>T(c).minSize=e),modelModifiers:{number:!0},type:"number",class:"w-[10rem] num-input","text-type":"MB",disabled:T(c).load},null,8,["modelValue","disabled"]),l[23]||(l[23]=g("div",{class:"title !w-[4rem]"},"小于",-1)),w(Pe,{modelValue:T(c).maxSize,"onUpdate:modelValue":l[16]||(l[16]=e=>T(c).maxSize=e),modelModifiers:{number:!0},type:"number",class:"w-[10rem] num-input","text-type":"MB",disabled:T(c).load},null,8,["modelValue","disabled"])],512),[[M,"custom"===T(c).size]])])],512),[[M,"expert"===T(c).searchType]])]),g("div",ce,[0==T(m).fileList.length?(x(),b("div",de,[z(g("div",null,"正在搜索中...",512),[[M,T(c).load]]),z(g("div",me,[...l[26]||(l[26]=[g("div",null,"键入查找内容以在文件中查询",-1),g("div",{class:"text-[1.4rem]"},"细致的选项可以有效地缩短检索时间",-1)])],512),[[M,!T(c).load&&T(J)]]),z(g("div",null,"抱歉没有找到“"+k(T(K))+"”相关的结果",513),[[M,!T(c).load&&!T(J)]])])):j("",!0),T(m).fileList.length>0&&"file"===T(m).type?(x(),b("div",ue,[g("div",pe,[g("div",fe,[z(g("div",null,[...l[27]||(l[27]=[C("文件搜索中",-1),g("span",{class:"svgtofont-el-loading"},null,-1)])],512),[[M,T(c).load]]),z(g("div",null,"搜索完成:",512),[[M,!T(c).load]]),g("div",null,"在"+k(T(m).fileList.length)+"个文件中有"+k(T(Je))+"个匹配项",1)]),g("div",ve,[(x(!0),b(V,null,D(T(m).fileList,(e,l)=>(x(),b("div",{class:S(["file-item",T(m).activeIndex===l?"active":""]),key:l,onClick:e=>T(m).activeIndex=l},[g("span",{class:"ellipsis w-[16rem]",title:e.name},k(e.name),9,xe),w(Ke,{type:"info"},{default:y(()=>[C(k(e.search_num),1)]),_:2},1024)],10,he))),128))])]),g("div",be,[g("div",ge,[g("span",{class:"ellipsis w-[65rem]",title:T(m).fileList[T(m).activeIndex].path},k(T(m).fileList[T(m).activeIndex].path),9,we),w($e,{class:"ml-[1rem]",onClick:l[17]||(l[17]=e=>T(Oe)(T(m).fileList[T(m).activeIndex]))},{default:y(()=>[...l[28]||(l[28]=[C("编辑",-1)])]),_:1})]),g("div",ye,[(x(!0),b(V,null,D(T(m).fileList[T(m).activeIndex].search_result,(e,l)=>(x(),b("span",{key:l,innerHTML:"行".concat(e.row_num,"：").concat(e.line)},null,8,Te))),128))])])])):j("",!0),T(m).fileList.length>0&&"name"===T(m).type?(x(),b("div",ze,[g("div",_e,[g("div",Le,[z(g("div",null,[...l[29]||(l[29]=[C("文件搜索中",-1),g("span",{class:"svgtofont-el-loading"},null,-1)])],512),[[M,T(c).load]]),z(g("div",null,k("搜索结果，共".concat(T(m).fileList.length,"个文件")),513),[[M,!T(c).load]])]),g("div",Se,[(x(!0),b(V,null,D(T(m).fileList,(e,s)=>(x(),b("div",{class:"file",key:s},[g("div",Ce,k(e.path),1),g("div",ke,[g("span",Ve,k(T(n)(e.size)),1),g("span",null,k(T(o)(e.mtime)),1),w($e,{onClick:l=>T(N)(e)},{default:y(()=>[...l[30]||(l[30]=[C("编辑",-1)])]),_:2},1032,["onClick"])])]))),128))])])])):j("",!0)]),z(w(qe,{options:T(De),class:"pl-2rem list-disc"},null,8,["options"]),[[M,"routine"===T(c).searchType]])])}}}),[["__scopeId","data-v-460ec90e"]]);export{De as default};
