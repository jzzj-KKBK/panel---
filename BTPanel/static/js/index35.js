import{ay as e,K as t,c9 as a,o as s,ca as l,M as r,l as o,cb as n,cc as i,cd as c,L as u,ce as m,cf as p,G as d,cg as v,ch as g,ci as y,Q as _,ah as h,v as x,c as k,h as f,e as w}from"./utils-lib.js?v=1756369731";import{B as b}from"./index140.js?v=1756369731";import{r as C,c as D,aB as V,p as q,a4 as S,g as T,bm as P,G as j,H as U,x as O,q as N,v as H,y as z,e as B,F as E,a_ as I,A as J,P as R,B as A,D as F,al as L,S as M,z as G,M as K,N as $,C as Q}from"./base-lib.js?v=1756369731";import{h as W,c as X,b as Y,f as Z,F as ee,d as te,g as ae,i as se}from"./form-item.js?v=1756369731";import{m as le}from"./validator.js?v=1756369731";import{_ as re}from"./index116.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./ace.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const{refs:{settingData:oe,loading:ne},getSet:ie,getDockerState:ce}=e(),ue=C(!1),me=C(""),pe=C({}),de=[{name:"主机名",key:"Name"},{name:"系统版本",key:"OperatingSystem"},{name:"架构",key:"Architecture"},{name:"内核版本",key:"KernelVersion"},{name:"CPU核心",key:"NCPU"},{name:"内存大小",key:"MemTotal"},{name:"Docker版本",key:"ServerVersion"},{name:"docker-compose版本",key:"DockerComposeVersion",append:D({name:"UpdateButton",setup:()=>()=>V("span",{class:"bt-link ml-[1rem]",onClick:async()=>{await s({title:"更新docker-compose版本",content:"是否更新docker-compose版本？"}),t({request:l(),loading:"正在更新docker-compose版本,请稍后...",success:e=>{e.status?o({title:"更新日志",area:56,btns:!1,component:D({setup(){let e=null;const t=C(""),a=P(),s=(s,l)=>{try{const s=l.data;t.value+=s,(s.includes("bt_successful")||s.includes("bt_failed"))&&(null==e||e.close(),a("close"),ce())}catch(r){null==e||e.close()}};return q(()=>{e=h({route:"/sock_shell",onMessage:s}),null==e||e.send("tail -f /tmp/update_dk-compose.log")}),S(()=>{null==e||e.close()}),()=>V("div",{class:"overflow-y-auto"},V(re,{class:"!h-[40rem]",content:t.value,isHtml:!0}))}})}):r.error(e.msg)}})}},"更新")})},{name:"unix地址",key:"DockerUnixSocket"},{name:"数据目录",key:"DockerRootDir"}],ve=e=>{switch(e){case"MemTotal":return x(pe.value.MemTotal);case"DockerUnixSocket":return oe.value.socket;case"DockerComposeVersion":return oe.value.docker_compose_version;default:return pe.value[e]}},ge=()=>{t({request:a({data:JSON.stringify({daemon_json:me.value})}),message:!0,success:({status:e})=>{e&&(ue.value=!1)}})},ye=async e=>{try{(oe.value.service_status||"toggle"!==e)&&await s({title:"".concat("reset"===e?"重启":"关闭","Docker服务"),content:"是否".concat("reset"===e?"重启":"关闭","Docker服务？")}),ne.value=!0,"reset"===e?(await n({data:JSON.stringify({act:"restart"})}),window.location.reload()):t({request:n({data:JSON.stringify({act:oe.value.service_status?"stop":"start"})}),message:!0,success:e=>{e.status&&window.location.reload()}})}catch(a){}finally{ne.value=!1}},_e=async()=>{try{await s({title:"修复docker模块",content:"修复docker可能会导致容器异常，修复大约5分钟，是否继续修复？"}),t({request:i(),message:!0,success:e=>{e.status&&le()}})}catch(e){}},he=async()=>{try{const e=await c();o({component:()=>u(()=>import("./index229.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{needForce:!e.status,msg:e.msg},title:"卸载Docker",btn:"确定",area:45})}catch(e){}},xe=async e=>{oe.value.monitor_status=e,t({request:m({data:JSON.stringify({act:e?"start":"stop"})}),message:!0,success:ie})},ke=async()=>{o({component:()=>u(()=>import("./index231.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),title:"设置Compose路径",area:45,btn:!0})},fe=async e=>{try{if(e)return void we();await s({icon:"question-filled",title:e?"开启日志切割":"关闭日志切割",content:"".concat(e?"开启":"关闭","日志切割后需要重启docker，请确保可以重启docker再操作。是否继续？")}),await t({loading:"正在设置日志切割,请稍后...",request:v({log_cutting:e?JSON.stringify({"max-file":oe.value.log_cutting.file,"max-size":"".concat(oe.value.log_cutting.size,"m")}):JSON.stringify({})}),message:!0,success:ce,error:()=>{oe.value.log_cutting.status=!e}})}catch(a){oe.value.log_cutting.status=!e}},we=()=>{const{BtForm:e,submit:a}=d({data:()=>({"max-file":Number(oe.value.log_cutting.file)||1,"max-size":Number(oe.value.log_cutting.size)||10}),options:()=>T(()=>[Y("文件大小","max-size",{attrs:{placeholder:"文件大小",style:"width:27rem;"},slots:{unit:()=>V("div",{class:"inline-block w-[3rem] text-[#999] mt-[2px] leading-[2rem] text-[12px] ml-[20px]"},"MB")},rules:[{required:!0,message:"请输入文件大小",trigger:"blur"},{validator:(e,t,a)=>{t&&/^\d+$/.test(t)?a():a(new Error("请输入正整数"))}}]}),Y("保留份数","max-file",{attrs:{placeholder:"保留份数",style:"width:27rem;"},slots:{unit:()=>V("div",{class:"inline-block w-[3rem] text-[#999] mt-[2px] leading-[2rem] text-[12px] ml-[20px]"},"份")},rules:[{required:!0,message:"请输入保留份数",trigger:"blur"},{validator:(e,t,a)=>{t&&/^\d+$/.test(t)?a():a(new Error("请输入正整数"))}}]}),Z("",[{content:"当前配置只会影响新创建的容器,已经创建的容器需要重新创建使配置生效"},{content:"如果你的容器中有重要数据，确保在执行重建操作之前进行备份"}])]),submit:async(e,a)=>{try{await a();return!!(await t({request:v({log_cutting:JSON.stringify({"max-file":e.value["max-file"],"max-size":"".concat(e.value["max-size"],"m")})}),message:!0,loading:"正在设置日志切割,请稍后..."})).status&&(ce(),!0)}catch(s){return!1}}});return o({component:()=>V("div",{class:"p-[1.6rem]"},V(e)),title:"设置日志切割",area:45,btn:!0,onConfirm:a,onCancel:()=>{ce()}})},be=async(e,a)=>{try{let l="";switch(e){case"iptables":l="iptables";break;case"live_restore":l="live_restore"}await s({icon:"question-filled",title:a?"开启".concat(l):"关闭".concat(l),content:"".concat(a?"开启":"关闭").concat(l,"后需要重启docker，请确保可以重启docker再操作。是否继续？")}),await t({loading:"正在设置".concat(l,",请稍后..."),request:v({[e]:a?1:0}),message:!0,success:ce,error:()=>{oe.value[e]=!a}})}catch(l){oe.value[e]=!a}},Ce=()=>o({component:()=>u(()=>import("./index232.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),title:"ipv6设置",btn:"确定",area:60}),De=async e=>{try{await s({icon:"question-filled",title:e?"开启IPV6":"关闭IPV6",content:"".concat(e?"开启":"关闭","IPV6后需要重启docker，请确保可以重启docker再操作。是否继续？")}),await t({loading:"正在设置IPV6,请稍后...",request:v({status:e?1:0}),message:!0,success:ce,error:()=>{oe.value.ipv6=!e}})}catch(a){oe.value.ipv6=!e}},Ve=async e=>{if(!1!==e){const{BtForm:e,submit:a}=d({data:()=>({http_proxy:oe.value.proxy.http_proxy||"http://",https_proxy:oe.value.proxy.https_proxy||"https://",no_proxy:oe.value.proxy.no_proxy||"localhost,127.0.0.1"}),options:e=>T(()=>[Y("HTTP代理","http_proxy",{attrs:{placeholder:"请输入HTTP代理地址",style:"width:32rem",onInput:t=>{const a=t.replace(/^http:\/\//,"");e.value.https_proxy="https://".concat(a)}},rules:[{required:!0,message:"请输入HTTP代理地址",trigger:"blur"},{pattern:/^http:\/\/.+/,message:"HTTP代理必须以http://开头",trigger:"blur"}]}),Y("HTTPS代理","https_proxy",{attrs:{placeholder:"请输入HTTPS代理地址",style:"width:32rem"},rules:[{required:!0,message:"请输入HTTPS代理地址",trigger:"blur"},{pattern:/^https?:\/\/.+/,message:"HTTPS代理必须以http://或https://开头",trigger:"blur"}]}),Y("不代理的地址","no_proxy",{attrs:{placeholder:"请输入无需代理的地址,多个地址用逗号分隔",style:"width:32rem"}}),ee(()=>V("span",{class:"text-[#999] mt-[2px] leading-[2rem] text-[12px] ml-[20px]"},"*设置代理后需要重启Docker服务才能生效")),ee(()=>V("div",{class:"text-[#999] mt-[2px] leading-[2rem] text-[12px] ml-[20px]"},"*http示例：http://127.0.0.1:8888")),ee(()=>V("div",{class:"text-[#999] mt-[2px] leading-[2rem] text-[12px] ml-[20px]"},"*https示例：https://127.0.0.1:8888"))]),submit:async(e,a)=>{try{await a(),await s({icon:"question-filled",title:"设置Docker代理",content:"设置代理后需要重启docker，请确保可以重启docker再操作。是否继续？"});const l={http_proxy:e.value.http_proxy,https_proxy:e.value.https_proxy,no_proxy:e.value.no_proxy};return(await t({loading:"正在设置Docker代理,请稍后...",request:v({proxy_settings:JSON.stringify(l)}),message:!0,success:ce})).status}catch(l){return!1}}});return o({component:()=>V("div",{class:"p-2rem"},V(e)),title:"Docker代理设置",area:50,btn:"确定",onConfirm:a,onCancel:()=>{ce()}})}try{await s({icon:"question-filled",title:"关闭Docker代理",content:"是否关闭Docker代理？"}),await t({loading:"正在关闭Docker代理？,请稍后...",request:v({proxy_settings:JSON.stringify({})}),message:!0,success:ce,error:()=>{ce()}})}catch(a){oe.value.proxy.status=!e}},qe=e=>W("",()=>V("span",{class:"text-[#999] mt-[2px] leading-[2rem] text-[12px] ml-[20px]"},"".concat(e))),Se=()=>{ie(!1),t({request:g(),success:e=>{pe.value=e.data}})},Te={class:"module-ui mb-16px !mt-0",shadow:"never",header:"全局设置","body-style":{padding:0,display:"flex",minHeight:"5.2rem"}},Pe={class:"module-ui mb-16px",shadow:"never",header:"系统信息","body-style":{padding:0,display:"flex",minHeight:"5.2rem"}},je={class:"leading-[3.2rem]"},Ue={key:0},Oe={class:"h-[50rem] p-2rem"},Ne=w(D({__name:"index",setup(a){const{refs:{settingData:l,loading:n}}=e(),i=T(()=>!l.value.docker_installed||!l.value.docker_compose_installed),{BtForm:c}=d({data:()=>l.value,options:e=>T(()=>[W("服务状态",()=>B("div",null,[i.value?B("span",null,[A("当前状态：未安装")]):B("span",{class:"flex items-center text-[1.2rem]"},[A("当前状态："),l.value.service_status?"开启":"停止",B("span",{class:l.value.service_status?"svgtofont-icon-start text-[#20a53a]":"svgtofont-icon-stop text-[#ff0000]"},null),B(F,{class:"!ml-[2rem]",onClick:()=>ye("toggle")},{default:()=>[l.value.service_status?"停止":"开启"]}),B(F,{onClick:()=>ye("reset")},{default:()=>[A("重启")]}),!l.value.service_status&&B(F,{onClick:_e},{default:()=>[A("修复")]})])])),...l.value.monitor_status?[te([W("容器监控",()=>B(L,{modelValue:l.value.monitor_status,"onUpdate:modelValue":e=>l.value.monitor_status=e,onChange:xe},null),"monitor_status"),qe("*设置容器页面监控开关,关闭后CPU使用率将不再监控")]),te([Y("监控天数","monitor_save_date",{attrs:{class:"!w-[32rem]",placeholder:"请输入保存天数"}}),ae("保存",{attrs:{class:"!ml-4px",type:"primary",onClick:()=>(async e=>{"date"===e&&t({request:p({data:JSON.stringify({save_date:oe.value.monitor_save_date})}),message:!0,success:ie()})})("date")}}),qe("*设置容器页面监控保存天数")])]:[],te([Y("加速URL","url",{attrs:{class:"!w-[32rem]",placeholder:"加速URL",disabled:!0}}),ae("修改",{attrs:{class:"!ml-4px",type:"primary",onClick:()=>(async e=>{o({component:()=>u(()=>import("./index230.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),title:"设置加速URL",area:64,btn:!0,compData:{url:e}})})(e.value.url)}}),ee(()=>B(k,{class:"mx-[2rem] text-[#20a53a] cursor-pointer leading-[3.2rem] mb-[1.8rem]",target:"_blank",href:"https://www.bt.cn/bbs/thread-134771-1-1.html"},{default:()=>[A(">>帮助")]})),...l.value.bad_registry?[qe("*提示：检测到您上次拉取镜像出现异常，请尝试更换推荐的加速站: ".concat(l.value.bad_registry_path))]:[]]),te([Y("docker compose","docker_compose_path",{attrs:{class:"!w-[32rem]",placeholder:"docker compose路径",disabled:!0}}),ae("修改",{attrs:{class:"!ml-4px",type:"primary",onClick:ke}}),qe("*docker compose路径")]),te([X("私有仓库","warehouse",{attrs:{class:"!w-[32rem]",disabled:!0,rows:4,autosize:{minRows:4,maxRows:4},placeholder:"Docker私有仓库地址"}}),ae("修改",{attrs:{class:"!ml-4px self-end",type:"primary",onClick:()=>(e=>{const{BtForm:a,submit:l}=d({data:()=>({warehouse:e.replaceAll(/,/g,"\n")}),options:()=>T(()=>[X("私有仓库","warehouse",{attrs:{placeholder:"请输入私有仓库地址,一行一个,如:\n192.168.1.111:8087\n192.168.1.112:8087",style:"width:27rem;",rows:5},rules:[]}),qe("*设置后将重启Docker")]),submit:async(e,a)=>{try{return await a(),await s({title:"提示",content:"即将重启Docker，是否继续？"}),!!(await t({request:v({warehouse:e.value.warehouse.replace(/ /g,"").replaceAll(/\n/g,",")}),message:!0,loading:"正在设置私有仓库,请稍后..."})).status&&(ce(),!0)}catch(l){return!1}}});o({component:()=>V("div",{class:"p-[1.6rem]"},V(a)),title:"设置私有仓库",area:45,btn:!0,onConfirm:l})})(e.value.warehouse)}})]),te([W("日志切割",()=>B(L,{modelValue:l.value.log_cutting.status,"onUpdate:modelValue":e=>l.value.log_cutting.status=e,onChange:fe},null),"log_cutting",{onClick:e=>e.preventDefault()}),ae("设置",{attrs:{class:"!ml-[1rem]",type:"primary",onClick:()=>we()}}),W("",()=>V("span",{class:"text-[#999] mt-[2px] leading-[2rem] text-[12px] ml-[20px]"},"*切割文件大小".concat(l.value.log_cutting.size,"MB，保留份数").concat(l.value.log_cutting.file,"份")))]),te([W("ipv6",()=>B(L,{modelValue:l.value.ipv6,"onUpdate:modelValue":e=>l.value.ipv6=e,onChange:De},null),"ipv6",{onClick:e=>e.preventDefault()}),ae("ipv6地址配置",{attrs:{class:"!ml-[1rem]",type:"primary",onClick:Ce}}),qe("*此ipv6范围将会在默认的bridge网络中使用，启用或关闭ipv6后需要重启docker，请确保可以重启docker再操作")]),te([W("iptables",()=>B(L,{modelValue:l.value.iptables,"onUpdate:modelValue":e=>l.value.iptables=e,onChange:e=>be("iptables",e)},null),"iptables",{onClick:e=>e.preventDefault()}),qe("*Docker 对 iptables 规则的自动配置")]),te([W("live_restore",()=>B(L,{modelValue:l.value.live_restore,"onUpdate:modelValue":e=>l.value.live_restore=e,onChange:e=>be("live_restore",e)},null),"live_restore",{onClick:e=>e.preventDefault()}),qe("*开启后Docker守护进程发生意外停机或崩溃时保留正在运行的容器状态")]),te([se("cgroup driver","driver",[{label:"cgroupfs",value:"cgroupfs"},{label:"systemd",value:"systemd"}],{attrs:{onChange:e=>(async e=>{try{await s({icon:"question-filled",title:"设置cgroup driver",content:"设置cgroup driver后需要重启docker，请确保可以重启docker再操作。是否继续？"}),await t({loading:"正在设置cgroup driver,请稍后...",request:v({driver:e}),message:!0,success:ce})}catch(a){ce()}})(e)}})]),W("配置文件",()=>B(F,{type:"primary",title:"全局配置文件",onClick:()=>ue.value=!0},{default:()=>[A("打开配置文件")]})),W("Docker代理",()=>B("div",null,[B(L,{class:"mr-[1rem]",modelValue:l.value.proxy.status,"onUpdate:modelValue":e=>l.value.proxy.status=e,onChange:Ve},null),B(F,{type:"primary",onClick:Ve},{default:()=>[A("设置代理")]})]),"customProxy",{onClick:e=>e.preventDefault()}),W("应用商店目录",()=>B("div",{class:"flex items-center"},[B(M,{modelValue:l.value.dk_project_path,"onUpdate:modelValue":e=>l.value.dk_project_path=e,disabled:!l.value.allow_update_install_path,style:"width: 32rem",placeholder:"请输入目录"},null),B(F,{type:"primary",class:"ml-4px",disabled:!l.value.allow_update_install_path,onClick:()=>{(async e=>{try{if(!e||"string"!=typeof e||!/^\/.+/.test(e))return void r.error("请输入有效的目录路径！");await s({title:"设置应用商店目录",content:"修改应用商店目录将会重启面板，是否继续？"}),await t({request:y({path:e}),loading:"正在设置应用商店目录,请稍后...",success:e=>{e.status||r.error(e.msg)}}),await t({loading:"正在重启面板，请稍候...",request:_(),message:!0,success:e=>{e.status&&setTimeout(()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},1e3)}})}catch(a){return!1}})(l.value.dk_project_path)}},{default:()=>[A("修改")]}),l.value.allow_update_install_path?null:B("span",{class:"ml-[1.6rem] text-red-500 text-[1.2rem]"},[A("当前已有应用存在，无法修改")])]),"dk_project_path"),W("卸载Docker",()=>B(F,{type:"default",onClick:he},{default:()=>[A("卸载")]}))])});return q(()=>{Se()}),S(()=>{ue.value=!1,me.value="",pe.value={}}),(e,t)=>{const a=b,s=f,r=j("bt-loading");return U((N(),H("div",null,[z("div",Te,[B(O(c),{"label-position":"right",labelWidth:"9.6rem"})]),z("div",Pe,[z("div",je,[(N(!0),H(E,null,I(O(de),e=>(N(),H("div",{key:e.key,class:"line"},[z("div",null,G(e.name),1),z("div",null,G(O(ve)(e.key)),1),e.append?(N(),H("div",Ue,[(N(),K($(e.append)))])):Q("",!0)]))),128))])]),B(s,{title:"全局配置文件",modelValue:O(ue),"onUpdate:modelValue":t[1]||(t[1]=e=>R(ue)?ue.value=e:null),showFooter:"",area:64,onConfirm:O(ge)},{default:J(()=>[z("div",Oe,[B(a,{modelValue:O(me),"onUpdate:modelValue":t[0]||(t[0]=e=>R(me)?me.value=e:null),filePath:O(l).daemon_path,autoSave:!1,editorOption:{mode:"ace/mode/nginx"}},null,8,["modelValue","filePath"])])]),_:1},8,["modelValue","onConfirm"])])),[[r,O(n)],[r,"正在获取docker设置，请稍候...","title"]])}}}),[["__scopeId","data-v-7769023f"]]);export{Ne as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
