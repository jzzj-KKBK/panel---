import{l as a,L as e,K as s,at as t,c as l,J as o,k as r,a0 as n,S as i}from"./utils-lib.js?v=1756369731";import{_ as u}from"./index103.js?v=1756369731";import{_ as p}from"./index112.js?v=1756369731";import{c as d,k as c,r as m,U as _,g,w as f,p as v,G as y,q as b,v as h,x as j,M as x,A as w,e as k,C,y as q,B as S,P as V,J as L,F as U,a_ as A,H as D,D as J,ai as R,aj as T,z as H}from"./base-lib.js?v=1756369731";import{_ as O}from"./index130.js?v=1756369731";import{a as P,f as E,g as F,u as M}from"./column.js?v=1756369731";import{e as N}from"./validator.js?v=1756369731";import{getModulesCloudServer as z,getModulesList as B}from"./database.js?v=1756369731";import{o as G,a as I,d as K,f as Q,i as W,l as X,g as Y,c as Z,j as $}from"./useMethod4.js?v=1756369731";import{g as aa}from"./useStore2.js?v=1756369731";import{_ as ea}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1756369731";import{_ as sa}from"./index.vue_vue_type_script_setup_true_lang4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";const ta={class:"flex items-center"},la={class:"w-[20rem] truncate inline-block"},oa=d({__name:"index",setup(d){const{refs:{isRefreshTable:oa,isLoading:ra,envStatus:na,isHaveServer:ia},resetRefresh:ua,refreshTableList:pa}=aa(),da=c({total:0,page:1,row:10}),ca=m([]),ma=_([]),_a=m(null),ga=m("all"),fa=m(""),va=m([]),ya=K(),ba=g(()=>!na.value.setup&&!ia.value),ha=()=>{a({title:"管理员密码",area:42,component:()=>e(()=>import("./index136.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},ja=async()=>{try{return await s({request:z({data:JSON.stringify({type:"pgsql"})},"pgsql"),data:[Array,va]}),va.value.length||(ia.value=!1),va.value}catch(a){t(a,"pgsql-getServerList")}},xa=async()=>{try{let a={p:da.page,limit:da.row,tables:"databases",search:fa.value,sid:"all"===ga.value?"":ga.value};""===a.sid&&delete a.sid;await s({loading:ra,request:B({data:JSON.stringify(a)},"pgsql"),data:{data:[Array,ca],page:i(da)}})}catch(a){t(a,"pgsql-getDatabaseList")}},wa=async()=>{xa(),await ja(),ma.value=[P(),...Q(W),E({event:(a,e)=>X(a,e)}),Y(va.value,"pgsql"),F({table:"databases"}),M([{onClick:Z,title:"权限"},{onClick:W,title:"改密"},{onClick:$,title:"删除"}])]};return f(()=>oa.value,async a=>{a&&await xa(),ua()}),v(()=>wa()),(a,e)=>{const s=O,t=J,i=l,d=R,c=T,m=o,_=r,g=n,f=p,v=u,P=y("bt-loading");return b(),h("div",null,[j(ba)?(b(),x(s,{key:0},{content:w(()=>[k(ea,{type:"PgSql"})]),_:1})):C("",!0),k(v,null,{"header-left":w(()=>[q("div",ta,[k(t,{type:"primary",onClick:e[0]||(e[0]=a=>j(G)(ja))},{default:w(()=>[...e[6]||(e[6]=[S(" 添加数据库 ",-1)])]),_:1}),k(t,{onClick:ha},{default:w(()=>[...e[7]||(e[7]=[S("管理员密码",-1)])]),_:1}),k(t,{onClick:j(I)},{default:w(()=>[...e[8]||(e[8]=[S("远程数据库",-1)])]),_:1},8,["onClick"]),k(sa,{"comp-data":j(va),class:"mx-12px"},null,8,["comp-data"]),k(i,{onClick:e[1]||(e[1]=a=>j(N)({name:"数据库",type:12})),icon:"desired",iconClass:"text-1.6rem"},{default:w(()=>[...e[9]||(e[9]=[S(" 需求反馈 ",-1)])]),_:1})])]),"header-right":w(()=>[k(c,{modelValue:j(ga),"onUpdate:modelValue":e[2]||(e[2]=a=>V(ga)?ga.value=a:null),onChange:j(pa),class:L(["!w-[14rem] mr-[8px]",{"custom-types-bg-green":"all"!==j(ga)}])},{default:w(()=>[k(d,{label:"全部",value:"all"}),(b(!0),h(U,null,A(j(va),(a,e)=>(b(),x(d,{key:e,label:"".concat("all"!==j(ga)?"已选：":"").concat(a.ps),value:a.id},{default:w(()=>[q("span",la,H(a.ps),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange","class"]),k(m,{class:"w-[26rem]",modelValue:j(fa),"onUpdate:modelValue":e[3]||(e[3]=a=>V(fa)?fa.value=a:null),onSearch:j(pa),placeholder:"请输入数据库名称/备注"},null,8,["modelValue","onSearch"])]),content:w(()=>[D(k(_,{ref_key:"pgsqlDbTableRef",ref:_a,column:j(ma),data:j(ca)},null,8,["column","data"]),[[P,j(ra)]])]),"footer-left":w(()=>[k(g,{options:j(ya),"table-ref":j(_a)},null,8,["options","table-ref"])]),"footer-right":w(()=>[k(f,{total:j(da).total,page:j(da).page,"onUpdate:page":e[4]||(e[4]=a=>j(da).page=a),row:j(da).row,"onUpdate:row":e[5]||(e[5]=a=>j(da).row=a),onChange:j(pa)},null,8,["total","page","row","onChange"])]),_:1})])}}});export{oa as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
