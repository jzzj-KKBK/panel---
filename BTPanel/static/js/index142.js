import{_ as e}from"./index117.js?v=1756369731";import{k as s,c as t,p as a,aD as i,q as n,v as r,x as c,F as l,y as m,M as o,z as d,e as p,A as b,B as g,a_ as f,b3 as _,D as u,J as y,C as k,aQ as v}from"./base-lib.js?v=1756369731";import{M as x,ah as L,u as w,d as j,e as O}from"./utils-lib.js?v=1756369731";import"./validator.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const h={title:"容器安全一键检测-功能介绍",ps:"检测敏感信息、后门、漏洞、可疑操作等常见风险。",source:151,desc:["异常历史命令","敏感信息泄露","后门排查","容器逃逸"],tabImgs:[{title:"容器检测",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/docker/dockerContainerScan.png"}]},S=[{color:"#ff0000",percentage:20},{color:"#ff0000",percentage:40},{color:"#fc6d26",percentage:60},{color:"#fc6d26",percentage:80},{color:"#20a53a",percentage:100}],T=s({title:"立即进行镜像检测,确保您的项目安全。",isFirst:!0,isScan:!1,isEnd:!1,iconType:"normal",detect:0,imageList:[],msg:"",btnObj:{text:"一键检测",type:"primary",disabled:!1},score:100,scanTime:0});let H=[],C=0,F=null;const M=e=>e+"分",J=e=>{T.imageList[e].active=!T.imageList[e].active};let B=null;const N=()=>{null==B||B.close(),B=L({route:"/ws_model",onMessage:E})},E=(e,s)=>{var t;const a=JSON.parse(s.data);if(a.hasOwnProperty("image_list"))return T.imageList=a.image_list.map(e=>(e.active=!1,e)),void(H=JSON.parse(JSON.stringify(a.image_list)));if(a.hasOwnProperty("end")){T.msg=a.msg,T.score=T.score-a.score;const e=T.imageList[C-1];1!=a.status&&(T.detect++,null==e.riskList&&(e.riskList=[]),null==(t=e.riskList)||t.push(a)),a.end&&C>0&&(void 0===e.riskList&&(e.noWarring=!0),W())}},I=()=>{if(C=0,T.scanTime=0,T.detect=0,T.score=100,F=setInterval(()=>{T.scanTime++},1e3),T.isFirst){if(0==T.imageList.length)return x.error("请先添加镜像");T.isScan||N(),W(),T.isScan=!0,T.isFirst=!1,P("scan")}else T.isScan?(null==B||B.close(),D()):(T.imageList=JSON.parse(JSON.stringify(H)),W(),T.isScan=!0,P("scan"))},W=()=>{C<T.imageList.length?(null==B||B.send({model_index:"btdocker",mod_name:"security",def_name:"image_safe_scan",image_id:T.imageList[C].id,ws_callback:"123"}),C++):(T.isScan=!1,T.isEnd=!0,T.imageList=T.imageList.sort((e,s)=>e.noWarring?1:s.noWarring?-1:0),clearInterval(F),P("end"))},P=e=>{switch(e){case"scan":T.title="正在检测镜像，请稍候...",T.isEnd=!1,T.btnObj.text="取消检测",T.btnObj.type="default";break;case"restart":T.title="立即进行镜像检测,确保您的项目安全。",T.btnObj.text="重新检测",T.btnObj.type="primary";break;case"end":let e="";e=0==T.detect?"未发现安全漏洞":'一共发现<span class="text-[#fc6d26]">'.concat(T.detect,"</span>项风险"),T.title="检测完成,"+e,T.msg="检测完成，共耗时"+T.scanTime+"秒",T.btnObj.text="重新检测",T.btnObj.type="primary"}},D=()=>{T.title="立即进行镜像检测,确保您的项目安全。",T.msg="",T.isFirst=!0,T.isScan=!1,T.isEnd=!1,T.iconType="normal",T.detect=0,T.imageList=JSON.parse(JSON.stringify(H)),T.btnObj.text="一键检测",T.btnObj.type="primary",T.btnObj.disabled=!1,T.score=100},q=()=>{N(),null==B||B.send({model_index:"btdocker",mod_name:"security",def_name:"get_image_list",ws_callback:"123"})},z={class:"p-2rem"},A={class:"scanHead flex justify-between mb-2rem"},Q={class:"scanHead__left flex"},G={class:"w-[8rem] h-[8rem]"},K={class:"pt-[2rem] pl-2rem w-[40rem]"},R=["innerHTML"],U={class:"text-[#666] mt-1rem"},V={class:"scanHead__right pt-[2.6rem]"},X={class:"scanBody h-[50rem] overflow-auto"},Y=["onClick"],Z={class:"text-[1.4rem] font-bold leading-[3.5rem]"},$={key:0,class:"flex"},ee={key:0,class:"text-danger"},se={key:1},te={key:2,class:"text-primary"},ae={class:"scanBody__content mb-[2rem] mx-[2rem]"},ie={class:"scanBody__content__title border-b border-[#ececec] pb-[.4rem] mb-[.4rem]"},ne={class:"scanBody__content__desc flex border-b border-[#ececec] pb-[.4rem] mb-[.4rem]"},re=["innerHTML"],ce={class:"scanBody__content__repair flex"},le=["innerHTML"],me=O(t({__name:"index",setup(s){const{payment:t}=w();return a(()=>{q()}),i(()=>{D(),clearInterval(F)}),(s,a)=>{const i=j,x=_,L=u,w=v,O=e;return n(),r("section",z,["ltd"===c(t).authType?(n(),r(l,{key:0},[m("div",A,[m("div",Q,[m("div",G,[c(T).isFirst&&!c(T).isScan?(n(),o(i,{key:0,class:"w-full",src:"/firewall/icon-safe-detect.svg"})):(n(),o(x,{key:1,type:"circle",percentage:c(T).score,format:c(M),color:c(S),width:80},null,8,["percentage","format","color"]))]),m("div",K,[m("div",{class:"text-[1.8rem] font-bold",innerHTML:c(T).title},null,8,R),m("div",U,d(c(T).msg.length>35?c(T).msg.substring(0,35)+"...":c(T).msg),1)])]),m("div",V,[p(L,{type:c(T).btnObj.type,disabled:c(T).btnObj.disabled,onClick:c(I)},{default:b(()=>[g(d(c(T).btnObj.text),1)]),_:1},8,["type","disabled","onClick"])])]),m("div",X,[(n(!0),r(l,null,f(c(T).imageList,(e,s)=>(n(),r("div",{key:s,class:y(["bg-[#FCFCFC] mb-1rem",e.active?"active":""])},[m("div",{class:"scanBody__title flex justify-between cursor-pointer rounded-[0.4rem] px-[2rem] h-[3.5rem] leading-[3.5rem] text-[1.3rem]",onClick:e=>c(J)(s)},[p(w,{class:"item",effect:"dark",content:e.name,placement:"top-start"},{default:b(()=>[m("span",Z,d(e.name.length>50?e.name.substring(0,50)+"...":e.name),1)]),_:2},1032,["content"]),c(T).isEnd||c(T).isScan?(n(),r("div",$,[e.riskList&&e.riskList.length>0?(n(),r("span",ee,"发现"+d(e.riskList.length)+"项风险",1)):e.noWarring||e.riskList?(n(),r("span",te,"无风险项")):(n(),r("span",se,"检测中")),p(i,{src:"/firewall/arrow-down.svg",class:"w-[1.6rem] ml-2rem"})])):k("",!0)],8,Y),m("div",ae,[(n(!0),r(l,null,f(e.riskList,(e,s)=>(n(),r("div",{key:s,class:"bg-[#ff00000a] text-[#666] py-1rem px-[1.5rem] mb-[0.8rem] rounded-[0.4rem]"},[m("div",ie,d(e.msg),1),m("div",ne,[a[0]||(a[0]=m("span",{class:"w-[6rem] flex-shrink-0 inline-block"},"详情：",-1)),m("span",{innerHTML:e.detail},null,8,re)]),m("div",ce,[a[1]||(a[1]=m("span",{class:"w-[6rem] flex-shrink-0 inline-block"},"修复方案：",-1)),m("span",{innerHTML:e.repair},null,8,le)])]))),128))])],2))),128))])],64)):(n(),o(O,{key:1,data:c(h)},null,8,["data"]))])}}}),[["__scopeId","data-v-401ff323"]]);export{me as default};
