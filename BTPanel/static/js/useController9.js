import{eD as a,aj as e,I as t,K as s,eE as n,eF as l,eG as r,o,eH as c,eI as i,eJ as u,eK as d,b as m,eL as v}from"./utils-lib.js?v=1756369731";import{r as p,e as g}from"./base-lib.js?v=1756369731";import{c as y,h as f,i as w}from"./validator.js?v=1756369731";import{c as _}from"./column.js?v=1756369731";import{u as b}from"./useStore9.js?v=1756369731";p(!1);const h=async(a,e,t)=>{try{return(await s({loading:"正在".concat(e?"修改":"添加","节点，请稍后..."),request:e?n(a):l(a),data:{status:Boolean},message:!0,success:a=>{N.value=[],k.value=!0,t&&t(a)}})).status}catch(r){return!1}},{isRefreshNodeList:k,rowData:q,nodeCategory:j,nodeStatus:N,forcedFlushes:S}=b(),C=a=>({label:"状态",isCustom:!0,render:a=>g("span",{class:"node_state state_"+a.data.status},[["在线","","离线","异常","重启中..."][a.data.status]])});let J={};const x=async t=>{t.category_id||0===t.category_id||delete t.category_id;const s=JSON.stringify(t),n=Date.now();try{const{data:{data:l,page:r,error:o}}=await a({...t});return J[s]={data:{data:l,total:e(r),other:{error:o}},timestamp:n},J[s].data}catch(l){return"canceled"===l.message&&J[s]&&n-J[s].timestamp<100?J[s].data:{data:[],total:0}}finally{delete t.refresh,S.value=0}},D=async a=>{s({request:r({address:a.address,api_key:a.api_key}),loading:"正在前往访问节点，请稍后...",success:a=>{a.data.status&&window.open("".concat(a.data.msg.target_panel_url),"_blank")}})},L=async a=>{try{await o({icon:"warning-filled",title:"删除节点【".concat(a.address,"】"),content:"删除节点后，将失去该节点的访问权限，是否继续操作？"}),await s({loading:"正在删除节点，请稍后...",request:c({ids:a.id}),message:!0,success:a=>{N.value=[],k.value=!0}})}catch(e){}},O=async()=>{try{let a=[];return await s({request:i(),data:{msg:Array},success:({msg:e})=>{a=[{label:"全部分类",value:"all"},{label:"默认分类",value:"0"},...e.map(a=>({label:a.name,value:String(a.id)}))],j.value=a}}),a||[]}catch(a){return[]}},F=async(a,e,t,n)=>{await y({name:"节点分类",options:t.value.filter(a=>"all"!==a.value),selectList:a.value,request:async(t,l)=>{const r=a.value.map(a=>a.id),{enable:o,exclude:c}=n,i=f(a.value,c,o,{params:{category_id:Number(t.id),ids:JSON.stringify(r)}});await s({loading:"正在批量设置节点分类，请稍后...",request:d(i),message:!0}),e(),N.value=[],k.value=!0,l()}})},I=async(a,e,t,s,n,l)=>{const{label:r,value:o}=s,{enable:c,exclude:i}=l,d=new Map([["delete","批量删除已选的节点，删除后将失去该节点的访问和操作权限"],["panel","批量重启已选的节点面板"],["server","批量重启已选的节点服务器"]]);if("panel"===o||"server"===o)for(const u of t.value)if("local"===u.api_key&&"local"===u.app_key)return void m().error("本机节点无法操作");await a({title:"批量".concat(r),content:"".concat(d.get(o),"，是否继续操作！"),column:[{label:"地址",prop:"address"},_()],onConfirm:async()=>{var a;if("panel"===o||"server"===o)return await e(a=>(async(a,e)=>{const{id:t}=a;return await u(t,e)})(a,o)),void(k.value=!0);const s=await(async()=>{const a=new Map([["delete",v]]).get(o);switch(o){case"start":case"stop":const e="start"===o?1:0,s=f(t.value,i,c,{params:{status:e}});if(a)return await a(s);break;case"delete":const n=f(t.value,i,c,{params:{ids:JSON.stringify(t.value.map(a=>a.id))}});if(a)return await a(n)}})();N.value=[],k.value=!0;const{data:l,msg:r}=w(s.data);n&&n(),(null==s?void 0:s.status)||(null==(a=null==s?void 0:s.data)?void 0:a.status)?m().success(r||"操作成功！"):m().error(r||"操作失败，请重试")}})},K=()=>({isCustom:!0,label:"CPU/内存",render:a=>{var e,t;return 4==(null==(e=null==a?void 0:a.data)?void 0:e.status)?"--":2==(null==(t=null==a?void 0:a.data)?void 0:t.status)?"-- / --":"".concat(a.data.cpu_usage,"核 (").concat(a.data.cpu,"%) / ").concat(a.data.memNewTotal," (").concat(a.data.memory,"%)")}}),M=()=>{J={},t(["/mod/node/node/get_category_list","/panel/public/get_soft_status","/mod/node/node/get_node_list"])},A=async(a,e)=>{await o({icon:"warning-filled",title:"重启".concat("panel"===e?"面板":"服务器"),content:"即将重启节点【".concat(a.remarks,"】").concat("panel"===e?"面板":"服务器","，是否继续操作？")}),await s({request:u(a.id,e),loading:"正在重启".concat("panel"===e?"面板":"服务器","，请稍后..."),message:!0,success:()=>{k.value=!0}})};export{C as a,K as b,O as c,D as d,L as e,I as f,x as g,h,A as r,F as s,M as u};
