import{_ as e}from"./index103.js?v=1756369731";import{u as t,a6 as a,a7 as s,cu as n,p as l,aj as i,bv as o,a8 as r,o as d,c,b as m}from"./utils-lib.js?v=1756369731";import{_ as u}from"./index145.js?v=1756369731";import{g as p}from"./useStore10.js?v=1756369731";import{e as v}from"./validator.js?v=1756369731";import{c as h,U as y,r as _,e as f,B as b,p as w,b as x,Z as g,q as j,M as C,A as k,y as S,x as B,n as D}from"./base-lib.js?v=1756369731";import{s as N,u as q,d as M,a as R,b as H}from"./useMethod12.js?v=1756369731";import{d as L,s as A}from"./useMethod10.js?v=1756369731";import{l as T,m as E,n as P,o as U,p as Z,q as z,s as F}from"./ssl.js?v=1756369731";import{a as G,u as I,c as J}from"./column.js?v=1756369731";import{u as K}from"./index141.js?v=1756369731";import"./index.vue_vue_type_style_index_0_scoped_b3c4124c_lang.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./index124.js?v=1756369731";const O={class:"flex items-center"},Q=h({__name:"index",setup(h){const Q=m(),{mainHeight:V}=t(),{refs:{tabActive:W,isRefreshDomainList:X,typeList:Y}}=p();y([]),_([]);const $=y([]);_(null);const ee=[{content:"从网站同步",active:!0,event:()=>{ye()}},{content:"DNS接口设置",dropdownClass:"bg-white",splitButton:!0,event:()=>{M()}}],te=[{label:"设置分类",value:"type",event:(e,t,a,s)=>A(a.value,"domain")},{label:"配置DNS接口",value:"dnsSet",event:(e,t,a,s)=>L(a.value[0],a.value)},{label:"设置到期时间",value:"dateSet",event:(e,t,a,s)=>N({},a.value)},{label:"删除",value:"delete",event:async(e,t,a,s)=>{const{label:n,value:l}=s,i=new Map([["delete","即将批量删除选中的域名"]]),o=async(e,t)=>{const{domain:a}=e;if("delete"===l)return await Z({domains:a})};await e({title:"批量".concat(n),content:"".concat(i.get(l),"，是否继续操作！"),column:[{label:"域名",prop:"domain"},J()],onConfirm:async()=>(await t(o),X.value=!0,!1)})}}],ae=K({key:"type",name:"域名分类",options:()=>[{label:"全部分类",value:"-1"}],event:{get:async()=>{const{data:e}=await E();return Y.value=e,Y.value=o(e,"array",[]).map(e=>({label:e.name,value:e.type_id})),Y.value.unshift({label:"全部分类",value:"all"}),Y.value},add:e=>P(e),delete:e=>U({type_id:e.id})},ignore:["0"],field:"name",showEdit:!1}),se=r(te),{BtTable:ne,BtPage:le,BtRefresh:ie,BtTableCategory:oe,BtRecommendSearch:re,BtColumn:de,BtBatch:ce,BtErrorMask:me,refresh:ue}=a({request:async e=>{try{let t={p:e.p,type_id:l(e.type)||"all"===e.type?"-1":e.type,search:e.search,limit:e.limit};"-1"===t.type_id&&delete t.type_id;const{data:a}=await T(t);return{data:a.data,total:i(a.page),other:{search_history:a.search_history}}}catch(t){return{data:[],total:0}}},columns:[G(),{label:"域名",prop:"domain",width:250},{label:"分组",width:180,isCustom:!0,render:e=>{const t=Y.value.find(t=>t.value==e.type_id);return t?t.label:"未分组"}},{label:"解析数量",prop:"sbd_count",isCustom:!0},{label:"DNS接口",width:200,isCustom:!0,render:e=>{var t;return f("div",{class:"flex items-center"},[(null==(t=e.dns)?void 0:t.dns_name)?f("span",null,[e.dns.dns_name]):f("span",{class:"bt-link cursor-pointer",onClick:()=>L(e)},[b("未配置")]),f("div",{class:"el-divider el-divider--vertical"},null),f("span",{class:"bt-link cursor-pointer",onClick:()=>L(e)},[b("点击配置")])])}},{label:"到期时间",isCustom:!0,render:e=>{const t=(new Date).setHours(0,0,0,0),a=e.endtime?new Date(e.endtime.replace(/-/g,"/")).getTime():0,s=0!==e.endtime&&a<t,n=0!==e.endtime&&a-Date.now()<6048e5;return f("span",{class:"cursor-pointer "+(s?"bt-danger":n?"bt-warn":"bt-link"),onClick:()=>{N(e)}},[s?"已过期":0===e.endtime?"未设置":e.endtime])}},I([{onClick:e=>{e.dns_id?R(e):(Q.error("请先配置DNS"),L(e))},title:"快速解析"},{onClick:e=>{var t;(null==(t=e.dns)?void 0:t.dns_name)?H(e):(Q.error("请先配置DNS"),L(e))},title:"解析记录管理",width:120},{onClick:e=>{ve(e)},title:"删除"}])],extension:[ae,se,s(X),n("search",{name:"ssl",key:"get_domain_list",list:[],showRecommend:!1})]});q({closeAlarm:e=>he(e),delDomain:e=>ve(e)});const pe=()=>{v({title:"SSL证书需求反馈收集",type:28,isNoRate:!0,softName:"1",isCard:!1,id:993})},ve=async(e,t=!1)=>{let a;try{t||await d({title:"删除【".concat(e.domain,"】域名"),content:"删除该域名，是否继续操作？",icon:"warning",width:45}),t||(a=Q.load("正在删除域名，请稍候..."));const s=await Z({domains:e.domain});return t||Q.request(s),s.status&&!t&&(X.value=!0),s}catch(s){}finally{a&&a.close()}},he=async e=>{let t=e.report_id;try{e.report_id="",await d({title:"删除【".concat(e.domain,"】到期告警"),content:"删除该域名到期告警，是否继续操作？",icon:"warning",width:45});let a=Q.load("正在删除域名到期告警，请稍候...");const s=await z({task_id:t});Q.request(s),s.status&&(X.value=!0),a&&a.close()}catch(a){a&&D(()=>{e.report_id=t})}},ye=async()=>{let e;try{e=Q.load("正在同步域名列表，请稍后...");const t=await F();Q.request(t),t.status&&(X.value=!0)}catch(t){}finally{e&&e.close()}};return w(()=>{W.value=x().name}),g("sslHistoryList",$),(t,a)=>{const s=u,n=c,l=e;return j(),C(l,null,{"header-left":k(()=>[S("div",O,[f(s,{options:ee}),a[1]||(a[1]=S("span",{class:"ml-[8px] text-[1.1rem]"},"当前域名列表仅显示顶级域名，配置DNS，可以快速解析域名和申请证书。",-1)),f(n,{class:"ml-[12px] flex items-center",onClick:pe},{default:k(()=>[...a[0]||(a[0]=[S("div",{class:"flex items-center"},[S("span",{class:"svgtofont-desired text-[1.6rem]"}),S("span",null,"需求反馈")],-1)])]),_:1})])]),"header-right":k(()=>[f(B(oe),{class:"!w-[140px] mr-[10px]"}),f(B(re),{type:"ssl-domain",placeholder:"请输入域名",class:"!w-[270px] mr-[10px]"}),f(B(de))]),content:k(()=>[f(B(ne),{"min-height":B(V)},null,8,["min-height"])]),"footer-left":k(()=>[f(B(ce))]),"footer-right":k(()=>[f(B(le))]),_:1})}}});export{Q as default};
