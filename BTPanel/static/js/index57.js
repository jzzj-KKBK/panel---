import{_ as a}from"./index103.js?v=1756369731";import{_ as t}from"./index112.js?v=1756369731";import{L as e,v as s,dT as n,M as i,o,dU as l,d7 as r,N as u,d4 as m,u as d,l as c,dV as _,a3 as p,aj as v,dW as f,A as w,dX as g,dY as h,k as b}from"./utils-lib.js?v=1756369731";import{j as y,aE as E,k as M,e as C,B as q,al as A,r as L,s as O,a5 as P,aB as k,c as j,n as D,a4 as T,G as x,q as I,M as V,A as R,x as B,H as z,D as S}from"./base-lib.js?v=1756369731";import{a as W,b as G,g as U}from"./useMethod7.js?v=1756369731";import{i as F,u as X}from"./column.js?v=1756369731";const H=y("MAIL_MAILBOX",()=>{const a=E(),t=M({p:1,size:10}),l=W("添加邮箱",{isEdit:!1,row:void 0,onRefresh:async()=>{const{getList:a}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);a()}}),r=M({id:0,site_name:"",status:!1,ssl_status:!1}),{table:u,columns:m}=G([{prop:"username",label:"用户名",showOverflowTooltip:!0},F(),{prop:"info",label:"登录信息",width:180,render:a=>C("a",{class:"bt-link",href:"javascript:;",onClick:async()=>{const{onCopy:t}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);t(a)}},[q("复制")])},{prop:"quota",label:"邮箱配额",render:a=>s(a.quota)},{prop:"is_admin",label:"类型",render:a=>1===a.is_admin?"管理员":"普通用户"},{prop:"active",label:"状态",render:a=>C(A,{modelValue:a.active,"onUpdate:modelValue":t=>a.active=t,size:"small",activeValue:1,inactiveValue:0,onChange:async t=>{const{data:e}=await n({username:a.username,full_name:a.full_name,quota:s(a.quota),active:t,is_admin:a.is_admin});a.active=t,i.request(e)}},null)},X([{title:"WebMail",onClick:async t=>{if(r.status){const{onLogin:a}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);a(t)}else try{await o({title:"WebMail未激活",content:()=>C("div",null,[q('WebMail尚未激活，请前往"'),C("a",{class:"bt-link",href:"javascript:;",onClick:()=>{a.push("/mail/setting")}},[q("邮局 > 设置")]),q('" 激活并安装它')])}),a.push({name:"mail-setting"})}catch(s){}}},{title:"编辑",onClick:async a=>{const{onShowEdit:t}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);t(a)}},{title:"删除",onClick:async a=>{const{onDel:t}=await e(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url);t(a)}}],{width:200,fixed:"right",label:"操作"})]);return{search:t,formModal:l,info:r,table:u,columns:m,reset:()=>{t.p=1,t.size=10,r.id=0,r.status=!1,r.ssl_status=!1,r.site_name="",l.data.row=void 0,l.data.isEdit=!1,u.data=[]}}}),Z=y("MAIL_MAILBOX_ADD",()=>{const a=L(null),t=M({full_name:"",domain:null,quota:5,quota_unit:"GB",is_admin:0,username:"",password:"",active:1}),e=L({}),o=L([]),m=()=>({full_name:t.full_name,quota:t.quota+" "+t.quota_unit,is_admin:t.is_admin,username:t.username+"@"+t.domain,password:t.password,active:t.active}),d=()=>{t.full_name="",t.domain=null,t.quota=5,t.quota_unit="GB",t.is_admin=0,t.username="",t.password="",t.active=1};return{form:t,domainOptions:o,unitOptions:[{label:"GB",value:"GB"},{label:"MB",value:"MB"}],typeOptions:[{label:"普通用户",value:0},{label:"管理员",value:1}],rules:{full_name:[{trigger:["blur","input"],validator:(a,t,e)=>{if(!t||""===t.trim())return e(new Error("用户名不能为空!"));e()}}],username:[{trigger:["blur","input"],validator:(a,t,e)=>{if(!t||""===t.trim())return e(new Error("邮箱地址不能为空!"));e()}}],quota:[{trigger:["blur","input"],validator:(a,t,e)=>{if(!t)return e(new Error("邮箱配额大小不能为空!"));e()}}],password:[{trigger:["blur","input"],validator:(a,t,s)=>{if(e.value.isEdit){if(t){if(t.trim().length<8)return s(new Error("当前邮箱用户密码长度小于8位，请重新输入"));if(!/^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z]).{8,}$/.test(t))return s(new Error("当前邮箱用户密码必须至少包含大小写字母和数字，请重新输入"))}}else{if(!t||t.trim().length<8)return s(new Error("当前邮箱用户密码长度小于8位，请重新输入"));if(!/^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z]).{8,}$/.test(t))return s(new Error("当前邮箱用户密码必须至少包含大小写字母和数字，请重新输入"))}s()}}]},getParams:m,onConfirm:async()=>{var t;await(null==(t=a.value)?void 0:t.validate());try{let a;a=e.value.isEdit?await n(m()):await l(m());const{data:t}=a;if(i.request(t),!t.status)return!1;e.value.onRefresh&&e.value.onRefresh(),d()}catch(s){}},getDomainOptions:async()=>{const{data:a}=await r();u(a.data)&&(o.value=a.data.map(a=>({label:a,value:a})),null===t.domain&&(t.domain=a.data[0]))},initForm:a=>{const{row:n,isEdit:i}=a;if(e.value=a,d(),i&&n){t.full_name=n.full_name,t.is_admin=n.is_admin,t.username=n.username.split("@")[0],t.active=n.active;const[a,e]=n.username.split("@");t.username=a,t.domain=e;const i=s(n.quota),[o,l]=i.split(" ");t.quota=U(o),t.quota_unit=l}},formRef:a}}),{refs:{tabActive:$}}=m(),{formModal:N,info:Y,table:J,search:K}=O(H()),{onConfirm:Q}=Z(),{payment:aa}=d(),ta=()=>{N.value.data.isEdit=!1,N.value.data.row=void 0,N.value.title="添加邮箱",c({title:N.value.title,area:48,showFooter:!0,component:()=>e(()=>import("./index335.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:N.value.data,onConfirm:Q})},ea=()=>{const a=E();return{onLoginMail:async()=>{if(!Y.value.site_name)return i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,type:"error",message:k("div",{class:"flex items-center leading-3rem mt-[4px]"},["请先在【系统设置】-【WebMail】中配置",k("span",{class:"bt-link",onClick:()=>{a.push("/mail/setting"),$.value="mail-setting"}}," WebMail")]),showClose:!0});window.open("".concat(Y.value.ssl_status?"https":"http","://").concat(Y.value.site_name),"_blank","noopener,noreferrer")}}},sa=async()=>{const{data:a}=await f();p(a)&&(Y.value.id=a.id,Y.value.status=a.status,Y.value.site_name=a.site_name,Y.value.ssl_status=a.ssl_status)},na=async()=>{try{J.value.loading=!0;const{data:a}=await _(P(K.value));p(a.data)&&(J.value.data=u(a.data.data)?a.data.data:[],J.value.total=v(a.data.page))}finally{J.value.loading=!1}},ia=async()=>{try{J.value.loading=!0,await sa(),await na()}finally{J.value.loading=!1}},oa=Object.freeze(Object.defineProperty({__proto__:null,getInfo:sa,getList:na,init:ia,onCopy:a=>{w({value:"WebMail: ".concat(Y.value.site_name?"".concat(Y.value.ssl_status?"https":"http","://").concat(Y.value.site_name):"未配置WebMail","\n用户名: ").concat(a.username,"\n密码: ").concat(a.password,"\nPOP 服务 [ 地址：").concat(a.mx," 端口：110/995 ]\nIMAP 服务 [ 地址：").concat(a.mx," 端口：143/993 ]\nSMTP 服务 [ 地址：").concat(a.mx," 端口：25/465/587 ]\n")})},onDel:async a=>{try{await o({title:"删除邮箱",content:"是否删除【".concat(a.username,"】邮箱?")});const{data:t}=await h({username:a.username});i.request(t),na()}catch(t){}},onLogin:async a=>{if("ltd"!==aa.value.authType)return i.warn("请先购买企业版");const{data:t}=await g({rc_user:a.username,rc_pass:a.password});p(t)&&window.open("".concat(Y.value.ssl_status?"https":"http","://").concat(t.data),"_blank","noopener,noreferrer")},onShowAdd:ta,onShowEdit:a=>{N.value.data.isEdit=!0,N.value.data.row=a,N.value.title="编辑邮箱 【".concat(a.username,"】"),c({title:N.value.title,area:48,showFooter:!0,component:()=>e(()=>import("./index335.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:N.value.data,onConfirm:Q})},useMailMethods:ea},Symbol.toStringTag,{value:"Module"})),la=j({__name:"index",setup(e){const{onLoginMail:s}=ea(),{search:n,table:i,columns:o}=O(H()),{reset:l}=H();return D(()=>{ia()}),T(()=>{l()}),(e,l)=>{const r=S,u=b,m=t,d=a,c=x("bt-loading");return I(),V(d,null,{"header-left":R(()=>[C(r,{type:"primary",onClick:B(ta)},{default:R(()=>[...l[2]||(l[2]=[q("添加邮箱",-1)])]),_:1},8,["onClick"]),C(r,{onClick:B(s)},{default:R(()=>[...l[3]||(l[3]=[q("WebMail",-1)])]),_:1},8,["onClick"])]),content:R(()=>[z(C(u,{data:B(i).data,column:B(o)},null,8,["data","column"]),[[c,B(i).loading]])]),"footer-right":R(()=>[C(m,{page:B(n).p,"onUpdate:page":l[0]||(l[0]=a=>B(n).p=a),row:B(n).size,"onUpdate:row":l[1]||(l[1]=a=>B(n).size=a),total:B(i).total,onChange:B(na)},null,8,["page","row","total","onChange"])]),_:1})}}}),ra=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"}));export{Z as M,ra as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
