import{c as e,r as a,p as l,G as t,q as o,M as s,A as r,e as u,x as i,v as d,a_ as p,F as m,C as n,H as c,B as f,y,ai as b,aj as _,a9 as g,T as v,a7 as V}from"./base-lib.js?v=1756369731";import{T as j,K as h,j as D}from"./utils-lib.js?v=1756369731";import{b0 as k,b1 as w,b2 as x}from"./firewall.js?v=1756369731";import{a as C,g as H}from"./useMethod6.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./column.js?v=1756369731";import"./index104.js?v=1756369731";import"./useStore5.js?v=1756369731";import"./validator.js?v=1756369731";const U={class:"mt-20px leading-8 text-[1.2rem] list-disc ml-24px"},q={key:0},E=e({__name:"add-area-rule",props:{compData:{default:()=>{}}},setup(e,{expose:E}){const I=e,P=a(),A=a(!1),F=a([]),M=a({country:["美国"],brief:"",types:"drop",ports:"",choose:"all",is_update:!1}),O=[{title:"所有端口",key:"all"},{title:"指定端口",key:"point"}],R={country:[{required:!0,message:"请选择国家或地区",trigger:"change"}],ports:[{validator:(e,a,l)=>{a.length>0&&(j(a)||l(new Error("端口格式错误，可用范围：1-65535")),l()),l(new Error("请输入源端口"))},trigger:["input"]}]};return l(()=>{if((async()=>{await h({loading:A,request:x(),data:[Array,F]})})(),I.compData.isEdit){const e=I.compData;Object.assign(M.value,{country:e.country,brief:e.brief,types:e.types,ports:e.ports,choose:e.ports?"point":"all"})}}),E({onConfirm:async e=>{await P.value.validate();let a={...M.value};const l=I.compData.isEdit;l&&(a.id=I.compData.id,a.addtime=I.compData.addtime,a.country=M.value.country,a.brief=F.value.find(e=>e.CH===M.value.country).brief),"all"===M.value.choose&&(a.ports=""),a={data:JSON.stringify(a)},await h({loading:"正在设置规则，请稍后...",request:l?k(a):w(a),message:!0}),e(),I.compData.refreshFn(),C(),H()}}),(e,a)=>{const l=b,j=_,h=g,k=D,w=v,x=V,C=t("bt-loading");return o(),s(x,{ref_key:"editAreaRulesRef",ref:P,model:i(M),rules:R,class:"p-[2rem] addfrom"},{default:r(()=>[u(h,{label:"策略"},{default:r(()=>[u(j,{modelValue:i(M).types,"onUpdate:modelValue":a[0]||(a[0]=e=>i(M).types=e),class:"!w-[24rem]"},{default:r(()=>[u(l,{label:"屏蔽",value:"drop"})]),_:1},8,["modelValue"])]),_:1}),u(h,{label:"端口"},{default:r(()=>[u(j,{modelValue:i(M).choose,"onUpdate:modelValue":a[1]||(a[1]=e=>i(M).choose=e),class:"!w-[24rem]"},{default:r(()=>[(o(),d(m,null,p(O,e=>u(l,{key:e.key,label:e.title,value:e.key},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),"point"===i(M).choose?(o(),s(h,{key:0,label:"指定端口",prop:"ports"},{default:r(()=>[u(k,{modelValue:i(M).ports,"onUpdate:modelValue":a[2]||(a[2]=e=>i(M).ports=e),type:"number",min:"1",max:"65535",width:"24rem",placeholder:"请输入指定端口"},null,8,["modelValue"])]),_:1})):n("",!0),u(h,{label:"地区",prop:"country"},{default:r(()=>[c((o(),s(j,{modelValue:i(M).country,"onUpdate:modelValue":a[3]||(a[3]=e=>i(M).country=e),class:"!w-[24rem]",multiple:!e.compData.id,filterable:!e.compData.id,"collapse-tags":!e.compData.id},{default:r(()=>[(o(!0),d(m,null,p(i(F),e=>(o(),s(l,{key:e.brief,label:e.CH,value:e.CH},null,8,["label","value"]))),128))]),_:1},8,["modelValue","multiple","filterable","collapse-tags"])),[[C,i(A)]])]),_:1}),e.compData.id?n("",!0):(o(),s(h,{key:1,label:" "},{default:r(()=>[u(w,{modelValue:i(M).is_update,"onUpdate:modelValue":a[4]||(a[4]=e=>i(M).is_update=e)},{default:r(()=>[...a[5]||(a[5]=[f("更新IP池",-1)])]),_:1},8,["modelValue"])]),_:1})),y("ul",U,[a[6]||(a[6]=y("li",null,"地区规则中IP数量较多，添加时可能耗时较长",-1)),e.compData.id?n("",!0):(o(),d("li",q,"勾选【更新IP池】会从云端获取指定地区近1个月最新的IP池")),a[7]||(a[7]=y("li",null,"添加【除中国之外】或多个地区时，可能会导致系统防火墙占用高，添加完成后会恢复",-1)),a[8]||(a[8]=y("li",null,"此操作将重载防火墙，未持久化的 iptables 规则会清空，请先备份保存！",-1))])]),_:1},8,["model"])}}});export{E as default};
