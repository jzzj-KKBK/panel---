import{a6 as a,R as e,K as t,M as l,o as s,A as n,h as i,W as u,e as o}from"./utils-lib.js?v=1756369731";import{c as r,r as m,e as d,q as p,v as c,x as _,A as v,y as f,P as b,B as g,z as h,bN as j,bM as y,D as w}from"./base-lib.js?v=1756369731";import{_ as k}from"./index116.js?v=1756369731";import{ao as q,ap as x,aq as V,ar as C}from"./config.js?v=1756369731";import{u as z}from"./column.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";const A={class:"p-2rem"},B={class:"p-[2rem]"},H={class:"p-[2rem]"},I={class:"flex justify-end mt-[1rem]"},M=o(r({__name:"migrate-history",setup(o){const r=m(!1),M=m(""),P=m(!1),R=m({}),U=m({}),D=async a=>{const e=await t({loading:"正在获取迁移日志，请稍后...",request:q({timestamp:U.value.timestamp})});M.value=e.data.data,a&&l.success("日志刷新成功")},K=()=>{n({value:"目标服务器信息：".concat(R.value.panel_info.panel_url,"\n登录账号：").concat(R.value.panel_info.username,"\n登录密码：").concat(R.value.panel_info.password)})},{BtTable:N,refresh:T}=a({request:async()=>{const a=await t({loading:"正在获取迁移历史，请稍后...",request:x()});return{data:a.data,total:a.data.length}},columns:[{label:"迁移时间",render:a=>d("span",null,[e(a.timestamp)])},{label:"服务器IP",prop:"migrate_ip"},z([{title:"日志",onClick:a=>{r.value=!0,U.value=a,D()}},{title:"信息",onClick:a=>{P.value=!0,U.value=a,(async()=>{const{data:a}=await t({loading:"正在获取迁移详情，请稍后...",request:V({timestamp:U.value.timestamp})});R.value.name=a.data.task_info.task_name,R.value.ip=a.data.server_ip,R.value.user=a.data.ssh_user,R.value.pass=a.data.password,R.value.start_time=a.data.start_time,R.value.last_update=a.data.last_update,R.value.panel_info=a.data.task_info.panel_info})()}},{title:"删除",onClick:a=>{U.value=a,(async()=>{await s({title:"删除迁移历史",content:"是否删除迁移历史？",type:"calc"}),await t({loading:"正在删除迁移历史，请稍后...",request:C({timestamp:U.value.timestamp}),message:!0}),T()})()}}])]});return(a,e)=>{const t=k,l=i,s=j,n=y,o=w,m=u;return p(),c("div",A,[d(_(N),{"max-height":400}),d(l,{modelValue:_(r),"onUpdate:modelValue":e[0]||(e[0]=a=>b(r)?r.value=a:null),area:54,title:"【".concat(_(U).migrate_ip,"】迁移日志")},{default:v(()=>[f("div",B,[d(t,{content:_(M),isHtml:!0,"full-screen":{title:"全屏查看服务日志",onRefresh:()=>D(!0)},class:"h-41rem"},null,8,["content","full-screen"])])]),_:1},8,["modelValue","title"]),d(l,{modelValue:_(P),"onUpdate:modelValue":e[1]||(e[1]=a=>b(P)?P.value=a:null),area:48,title:"详情信息"},{default:v(()=>[f("div",H,[d(n,{title:!1,column:1,size:"small",border:"",class:"table-descriptions"},{default:v(()=>[d(s,{label:"名称："},{default:v(()=>[g(h(_(R).name),1)]),_:1}),d(s,{label:"服务器："},{default:v(()=>{var a;return[g(h((null==(a=_(R).panel_info)?void 0:a.panel_url)||"--"),1)]}),_:1}),d(s,{label:"用户："},{default:v(()=>{var a;return[g(h((null==(a=_(R).panel_info)?void 0:a.username)||"--"),1)]}),_:1}),d(s,{label:"密码："},{default:v(()=>{var a;return[g(h((null==(a=_(R).panel_info)?void 0:a.password)||"--"),1)]}),_:1}),d(s,{label:"开始时间："},{default:v(()=>[g(h(_(R).start_time),1)]),_:1}),d(s,{label:"最后更新时间："},{default:v(()=>[g(h(_(R).last_update),1)]),_:1})]),_:1}),f("div",I,[d(o,{type:"default",onClick:K},{default:v(()=>[...e[2]||(e[2]=[g("复制服务器信息",-1)])]),_:1})]),d(m,{options:[{content:"迁移进度请在新服务器中的[面板设置] - [备份还原]中查看"}],class:"mt-[1rem]"})])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0ccb0b48"]]);export{M as default};
