import{u as a,fj as t,R as e,l as s,o as l,M as o,al as n,W as r}from"./utils-lib.js?v=1756369731";import{c as u,g as i,p as c,G as p,q as m,v as d,x as v,M as f,P as y,C as h,y as w,H as g,e as b,A as j,B as C,D as x,a$ as k}from"./base-lib.js?v=1756369731";import{aL as V}from"./validator.js?v=1756369731";import{S as _,d as F,c as S,t as q,a as E,b as H,e as B,h as D,g as U,f as M,j as N}from"./useController16.js?v=1756369731";import{B as A}from"./index140.js?v=1756369731";import{u as G,S as I}from"./useStore4.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./site.js?v=1756369731";import"./ace.js?v=1756369731";const L={class:"h-full"},O={class:"w-full"},P={class:"my-[12px]"},R=u({__name:"file",setup(u){const{viewFileHistoryEvent:R,recoverFileEvent:T}=_(),{siteInfo:W}=G(),{plugin:$}=a(),{saveFileEvent:z}=I(),J=()=>{const{BtTable:a}=t({request:()=>({data:D.value,total:D.value.length}),columns:[{label:"文件名",render:a=>e(Number(a))},{label:"操作",align:"right",render:a=>{let t=Number(a);return b("div",null,[b("span",{class:"cursor-pointer bt-link",onClick:()=>{Q(a)}},[C("查看")]),b(k,{direction:"vertical"},null),b("span",{class:"cursor-pointer bt-link",onClick:()=>{K(t)}},[C("恢复")])])}}]});s({title:"配置文件历史版本",area:42,showFooter:!0,component:()=>b("div",{class:"p-[20px]"},[b(a,null,null)])})},K=async a=>{try{await l({title:"恢复历史文件",content:"是否恢复历史文件 ".concat(e(a))});const t=await T({row:a,path:X.value});return o.request({status:t.status,msg:t.status?"恢复成功":"恢复失败"}),t.status&&U({path:X.value}),t.status}catch(t){}},Q=async a=>{await(async a=>{try{const t=await R({row:a,path:X.value});return M.value=t.status?t.data:"文件不存在",t}catch(t){return{status:!1,msg:"获取文件历史失败"}}})(a),s({title:"查看文件历史版本",area:64,showFooter:!1,component:()=>b("div",{class:"p-[20px]"},[b(x,{type:"primary",onClick:()=>K(a)},{default:()=>[C("恢复文件")]}),b(A,{class:"!h-[54rem] !w-full my-[12px]",modelValue:M.value,"onUpdate:modelValue":a=>M.value=a,editorOption:V({readonly:!0})},null)])})},X=i(()=>{const a="/www/server/panel/vhost/".concat($.value.webserver,"/").concat(W.value.name,".conf");return"config"===F.value?a.replace(/\/+/g,"/"):S.value}),Y=async(a={data:B.value,encoding:"utf-8",path:X.value})=>{try{(await z(a)).status&&U({path:a.path})}catch(t){return{status:!1,msg:"保存文件失败"}}};return c(async()=>{N(),await U({path:X.value})}),(a,t)=>{const e=n,s=r,l=p("bt-loading");return m(),d("div",L,[v(S)?(m(),f(e,{key:0,type:"card",modelValue:v(F),"onUpdate:modelValue":t[0]||(t[0]=a=>y(F)?F.value=a:null),options:v(q),onChange:v(E)},null,8,["modelValue","options","onChange"])):h("",!0),w("div",O,[t[6]||(t[6]=w("span",{class:"my-[4px] text-[#666]"},"提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换",-1)),w("div",P,[g(b(v(A),{class:"!h-[54rem] border border-[#DCDFE6] rounded-[4px]",modelValue:v(B),"onUpdate:modelValue":t[1]||(t[1]=a=>y(B)?B.value=a:null),request:!1,onSave:t[2]||(t[2]=a=>Y()),id:"configContent"},null,8,["modelValue"]),[[l,v(H)]])]),w("div",null,[b(v(x),{type:"primary",onClick:t[3]||(t[3]=a=>Y())},{default:j(()=>[...t[4]||(t[4]=[C("保存",-1)])]),_:1}),b(v(x),{onClick:J,type:"default"},{default:j(()=>[...t[5]||(t[5]=[C("历史文件",-1)])]),_:1})]),b(s,{options:[{content:"此处为站点主配置文件，若您不了解配置规则，请勿随意修改."}],"list-style":"none",class:"ml-[20px] mt-[20px]"})])])}}});export{R as default};
