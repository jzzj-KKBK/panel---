import{c as e,s as a,r as t,k as l,p as s,q as o,v as r,e as i,A as n,x as d,B as m,aB as u,S as c,aQ as p,a9 as f,a7 as v}from"./base-lib.js?v=1756369731";import{_ as y}from"./validator.js?v=1756369731";import{K as b,P as _,j as g,b as h}from"./utils-lib.js?v=1756369731";import{g as j}from"./useStore10.js?v=1756369731";import{L as w,M as x}from"./ssl.js?v=1756369731";import{r as V}from"./useMethod10.js?v=1756369731";import{u as D}from"./useStore11.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";const N={class:"p-2rem"},q=e({__name:"index",props:{compData:{default:()=>({isMulti:!1})}},emits:["close"],setup(e,{expose:q,emit:A}){const M=e,R=A,U=h(),{refs:{tabActive:E,isRefreshDomainList:I}}=j(),{activeTabs:S,sslIsRefresh:T,testIsRefresh:k,encryptIsRefresh:B,otherIsRefresh:C}=a(D()),L=t(),$=t(!1),H=l({domain:"",title:"",cycle:30,allSsl:!1,total:2,sender:[]}),K=t({cycle:[{required:!0,message:"请输入剩余天数",trigger:"blur"},{validator:(e,a,t)=>{/^[1-9]\d*$/.test(a)?t():t(new Error("请输入大于0的正整数"))},trigger:["blur","change"]}],total:[{required:!0,message:"请输入总发送上线",trigger:"blur"},{validator:(e,a,t)=>{/^\d+$/.test(a)?t():t(new Error("请输入大于等于0的正整数"))},trigger:["blur","change"]}],sender:[{required:!0,message:"请选择通知方式",trigger:"blur"},{validator:(e,a,t)=>{0===a.length?t(new Error("请选择通知方式")):t()},trigger:["blur","change"]}]});return s(()=>{var e;"domain"===E.value?H.domain=M.compData.domain:(null==(e=M.compData)?void 0:e.isMulti)?(H.title=M.compData.data.map(e=>e.title).join(","),H.domain=M.compData.data.map(e=>!e.domainName||Array.isArray(e.domainName)&&0===e.domainName.length?"":Array.isArray(e.domainName)?e.domainName.join(","):e.domainName).filter(e=>""!==e).join(",")):(H.title=M.compData.title,H.domain=M.compData.domainName.join(",")),b({request:_(),success:({data:e})=>{const a=e.data.find(e=>e.id===M.compData.report_id);a&&(H.sender=a.sender,H.cycle=a.task_data.cycle,H.total=a.number_rule.total)}})}),q({onConfirm:async()=>{var e,a,t;try{if(!(await L.value.validate()))return;if($.value=!0,null==(e=M.compData)?void 0:e.isMulti){const e=[],a=U.load("正在批量设置告警...");for(const t of M.compData.data)try{const a={cycle:H.cycle,total:H.total,sender:H.sender.join(","),ssl_id:t.ssl_id},l=await x(a);e.push({name:t.title,status:l.status})}catch(l){e.push({name:t.title,status:!1})}a.close();V({resultData:e,resultTitle:"设置告警",resultColumn:[{label:"名称",prop:"name"},{label:"结果",render:e=>{const a=e.status?"设置成功":"设置失败",t=e.status?"text-primary":"text-danger";return u("span",{class:t},a)}}]});const s={ssl:()=>T.value=!0,test:()=>k.value=!0,encrypt:()=>B.value=!0,other:()=>C.value=!0};null==(t=s[S.value])||t.call(s),R("close")}else{let e={cycle:H.cycle,total:H.total,sender:H.sender.join(",")};"domain"===E.value?e.domain=H.domain:e.ssl_id=M.compData.ssl_id;const t="domain"===E.value?await w(e):await x(e);if(U.request(t),t.status){if("domain"===E.value)I.value=!0;else{const e={ssl:()=>T.value=!0,test:()=>k.value=!0,encrypt:()=>B.value=!0,other:()=>C.value=!0};null==(a=e[S.value])||a.call(e)}R("close")}}}catch(s){}finally{$.value=!1}}}),(e,a)=>{const t=c,l=p,s=f,u=g,b=y,_=v;return o(),r("div",N,[i(_,{ref_key:"sslExpire",ref:L,disabled:d($),rules:d(K),model:d(H),"label-width":"100px"},{default:n(()=>[i(s,{label:"域名"},{default:n(()=>[i(l,{content:d(H).domain,placement:"top","popper-class":"!max-w-[300px]"},{default:n(()=>[i(t,{class:"!w-[28rem]",modelValue:d(H).domain,"onUpdate:modelValue":a[0]||(a[0]=e=>d(H).domain=e),disabled:""},null,8,["modelValue"])]),_:1},8,["content"])]),_:1}),i(s,{label:"证书"},{default:n(()=>[i(l,{content:d(H).title,placement:"top","popper-class":"!max-w-[300px]"},{default:n(()=>[i(t,{class:"!w-[28rem]",modelValue:d(H).title,"onUpdate:modelValue":a[1]||(a[1]=e=>d(H).title=e),disabled:""},null,8,["modelValue"])]),_:1},8,["content"])]),_:1}),i(s,{label:"剩余天数",prop:"cycle"},{default:n(()=>[i(u,{modelValue:d(H).cycle,"onUpdate:modelValue":a[2]||(a[2]=e=>d(H).cycle=e),width:"14rem",textType:"天",min:"1",type:"number"},{append:n(()=>[...a[5]||(a[5]=[m(" 天 ",-1)])]),_:1},8,["modelValue"])]),_:1}),i(s,{label:"总发送上限",prop:"total"},{default:n(()=>[i(u,{modelValue:d(H).total,"onUpdate:modelValue":a[3]||(a[3]=e=>d(H).total=e),width:"14rem",textType:"次",min:"0",type:"number"},{append:n(()=>[...a[6]||(a[6]=[m(" 次 ",-1)])]),_:1},8,["modelValue"])]),_:1}),i(s,{label:"通知方式",prop:"sender"},{default:n(()=>[i(b,{modelValue:d(H).sender,"onUpdate:modelValue":a[4]||(a[4]=e=>d(H).sender=e),limit:["sms"],class:"!w-[28rem]"},null,8,["modelValue"])]),_:1})]),_:1},8,["disabled","rules","model"])])}}});export{q as default};
