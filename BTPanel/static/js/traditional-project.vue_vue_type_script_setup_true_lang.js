import{c as e,r as l,ay as a,g as t,w as o,q as r,M as s,A as n,e as d,y as u,x as i,v as c,a_ as p,F as m,B as _,C as v,z as f,P as w,m as g,aj as j,a9 as y,aQ as x,T as b,ax as h,ai as V,K as k,D as U,J as C,ah as D,af as I,al as N}from"./base-lib.js?v=1756369731";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang13.js?v=1756369731";import{G as q,j as B,bV as F,K as M,bv as P,_ as W,H as z,c as S,fg as R,gx as E}from"./utils-lib.js?v=1756369731";import{_ as J}from"./index101.js?v=1756369731";import{u as K}from"./useStore4.js?v=1756369731";import{f as A}from"./validator.js?v=1756369731";import{n as G,g as H,i as Q,o as T,u as $,s as L}from"./index70.js?v=1756369731";import{checkPathStatus as X,getRunList as Y}from"./site.js?v=1756369731";import{B as Z}from"./index140.js?v=1756369731";const ee={class:"flex items-center"},le={class:"flex items-center"},ae={key:0,class:"text-1.2rem ml-[0.8rem] text-[#999]"},te={key:0,class:"text-danger text-[1.2rem]"},oe=e({__name:"advanced-config",props:{ps:{},rowData:{}},setup(e,{expose:k}){var U;const C=e,D=l(),I=l((null==(U=C.rowData)?void 0:U.project_name)||!1),N=l(!1),O=a("nodeData",{user_list:[]}),{BtForm:F,param:M}=q({data:()=>{var e,l,a,t,o;const r=(null==(l=null==(e=O.value)?void 0:e.user_list)?void 0:l.length)&&-1===(null==(a=O.value.user_list)?void 0:a.findIndex(e=>"www"===e));return{run_user:I.value?(null==(t=C.rowData)?void 0:t.run_user)||"":r?O.value.user_list[0]:"www",port:(null==(o=C.rowData)?void 0:o.port)||"",release_firewall:!1,project_ps:(null==C?void 0:C.ps)||"",domains:""}},options:()=>t(()=>[{type:"slots",key:"custom",rules:{run_user:[{required:!0,message:"请选择运行用户",trigger:"change"}]}}])});return o(()=>C.ps,e=>{M.value.project_ps=e||""},{immediate:!0}),k({formData:M,popover:D}),(e,l)=>{const a=V,t=j,o=y,k=B,U=x,q=b,P=h;return r(),s(i(F),g({class:"mt-2rem"},e.$attrs),{custom:n(()=>[d(o,{label:"运行用户",prop:"run_user"},{default:n(()=>[u("div",ee,[d(t,{modelValue:i(M).run_user,"onUpdate:modelValue":l[0]||(l[0]=e=>i(M).run_user=e),class:"mr-8px !w-[16rem]"},{default:n(()=>[(r(!0),c(m,null,p(i(O).user_list,(e,l)=>(r(),s(a,{key:l,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[7]||(l[7]=u("span",{class:"text-[1.2rem] text-[#666]"},"* 无特殊需求请选择www用户",-1))])]),_:1}),d(o,{label:"项目端口"},{default:n(()=>{var e,a,t,o,p,w;return[u("div",le,[d(k,{width:"20rem",type:"number",class:"mr-12px !w-[20rem]",min:1,max:65535,modelValue:i(M).port,"onUpdate:modelValue":l[1]||(l[1]=e=>i(M).port=e),placeholder:"请输入项目的真实端口"},null,8,["modelValue"]),i(I)?v("",!0):(r(),c(m,{key:0},[""===i(M).port?(r(),c("span",ae,"* 若不清楚端口可不填写")):(r(),s(q,{key:1,modelValue:i(M).release_firewall,"onUpdate:modelValue":l[2]||(l[2]=e=>i(M).release_firewall=e)},{default:n(()=>[l[9]||(l[9]=_(" 放行端口 ",-1)),d(U,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:n(()=>[...l[8]||(l[8]=[u("i",{class:"svgtofont-el-question text-warning"},null,-1)])]),_:1})]),_:1},8,["modelValue"]))],64))]),i(I)&&(null==(a=null==(e=C.rowData)?void 0:e.listen)?void 0:a.length)&&!(null==(o=null==(t=C.rowData)?void 0:t.listen)?void 0:o.includes(i(M).port))?(r(),c("span",te," 项目端口可能有误，检测到当前项目监听了以下端口[ "+f(null==(w=null==(p=C.rowData)?void 0:p.listen)?void 0:w.join(","))+" ]",1)):v("",!0)]}),_:1}),d(o,{label:"项目备注"},{default:n(()=>[d(k,{modelValue:i(M).project_ps,"onUpdate:modelValue":l[3]||(l[3]=e=>i(M).project_ps=e),placeholder:"请输入项目备注",width:"24rem"},null,8,["modelValue"])]),_:1}),i(I)?v("",!0):(r(),s(o,{key:0,label:"绑定域名"},{default:n(()=>[d(P,{ref_key:"popover",ref:D,placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:i(N),"onUpdate:visible":l[6]||(l[6]=e=>w(N)?N.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:n(()=>[d(k,{rows:6,resize:"none",width:"40rem",modelValue:i(M).domains,"onUpdate:modelValue":l[4]||(l[4]=e=>i(M).domains=e),onFocus:l[5]||(l[5]=e=>N.value=!0),type:"textarea",placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])]),default:n(()=>[l[10]||(l[10]=u("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[_(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),u("br"),_(" IP地址格式：192.168.1.199"),u("br"),_(" 泛解析添加方法 *.domain.com"),u("br"),_(" 如另加端口格式为 www.domain.com:88 ")],-1))]),_:1},8,["visible"])]),_:1}))]),_:1},16)}}}),re={key:0,class:"ml-8px text-[1.2rem] text-danger leading-[2rem]"},se={class:"flex items-center"},ne={class:"flex items-center"},de={class:"flex items-center custom-refresh-select"},ue={class:"el-input-group__append !h-3rem !flex items-center"},ie={class:"flex items-center"},ce={key:0,class:"pl-[12rem]"},pe=e({__name:"node-project",setup(e,{expose:o}){const{siteInfo:f}=K(),w=l(!1),g=l([]),x=l(""),h=l(G.value.nodejs_versions),C=l(G.value.package_managers),D=l(),I=a("getNodeData",e=>{}),N=async()=>{const e=await I(!0);h.value=e.nodejs_versions},R=()=>{A({type:"dir",path:pe.value.project_cwd,change:async e=>{var l;if(pe.value.project_cwd=e,!Q.value){let a=null==(l=e.substring(e.lastIndexOf("/")+1))?void 0:l.replace(/\W/g,"_");pe.value.project_name||(pe.value.project_name=a),x.value=a;const t=await le(pe.value.project_cwd);Object.assign(pe.value,t);const o=await E(e);o.node_modules&&(pe.value.not_install_pkg=!0),w.value=!o.package_json}}})},E=async e=>{const{data:l}=await M({request:X({path:e})});return l},Z=()=>{A({type:"file",path:pe.value.project_cwd,change:e=>{pe.value.userCmd=e}})},ee=async e=>{const l=await $(e);C.value=l,pe.value.pkg_manager=l[0]||""},le=async e=>{let l={};try{const a=await Y({data:JSON.stringify({project_cwd:e})}),t=P(a.data,"object",{});if(0===Object.keys(t).length)l.project_script="0";else{let e=Object.keys(t);g.value=e.map(e=>({label:e+":"+t[e],value:e})),l.project_script=e[0]||""}if(Q.value){let e=f.value.project_config.project_script;l.project_script=e,l.userCmd=e,!g.value.find(l=>l.value===e)&&(l.project_script="0")}return l}catch(a){return l}},{BtForm:ae,submit:te,param:pe}=q({data:async()=>{var e,l;if(await H(),C.value=G.value.package_managers,h.value=G.value.nodejs_versions,Q.value){const{project_config:e,ps:l}=f.value,a=await le(e.project_cwd);return x.value=l,{...e,project_type:e.project_type||"nodejs",userCmd:"",...a}}return{project_name:"",project_script:"",project_cwd:"/www/wwwroot",project_type:"nodejs",pkg_manager:(null==(e=C.value)?void 0:e.at(0))||"",not_install_pkg:!1,run_user:"www",nodejs_version:(null==(l=h.value)?void 0:l.at(0))||"",userCmd:""}},options:e=>t(()=>[{type:"slots",key:"custom",rules:{project_cwd:[F({message:"请输入项目启动目录"})],project_name:[F({message:"请输入项目名称"})],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_script:[F({message:"请选择项目启动脚本"})]}}]),submit:async(e,l)=>{await l();const a=D.value.formData;return{...e.value,project_script:"0"===e.value.project_script?e.value.userCmd:e.value.project_script,...a,domains:a.domains?a.domains.split("\n"):[]}}}),me=async()=>{const e=await te();L(e)};return o({submit:te}),(e,l)=>{const a=J,t=y,o=B,I=V,q=j,F=W,M=z,P=S,E=b,K=O,A=U;return r(),c("div",{class:"overflow-auto",style:k({"max-height":i(Q)?"76rem":"50rem"})},[d(i(ae),{"label-width":"80px"},{custom:n(()=>[d(t,{label:"项目目录",prop:"project_cwd"},{default:n(()=>[u("div",null,[d(a,{modelValue:i(pe).project_cwd,"onUpdate:modelValue":l[0]||(l[0]=e=>i(pe).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择Node项目目录",onIconClick:R,width:"32rem"},null,8,["modelValue"]),i(w)?(r(),c("div",re,"* 文件夹中未检测到package.json文件，建议前往传统项目进行项目添加")):v("",!0)])]),_:1}),d(t,{label:"项目名称",prop:"project_name"},{default:n(()=>[d(o,{disabled:i(Q),modelValue:i(pe).project_name,"onUpdate:modelValue":l[1]||(l[1]=e=>i(pe).project_name=e),width:"32rem",placeholder:"请输入Node项目名称"},null,8,["disabled","modelValue"])]),_:1}),d(t,{label:"启动选项",prop:"project_script"},{default:n(()=>[u("div",se,[d(q,{placeholder:"请选择项目目录进行操作",modelValue:i(pe).project_script,"onUpdate:modelValue":l[2]||(l[2]=e=>i(pe).project_script=e),class:"!w-[30rem]",disabled:"/www/wwwroot/"===i(pe).project_cwd||"/www/wwwroot"===i(pe).project_cwd},{default:n(()=>[d(I,{label:"自定义启动命令",value:"0"}),(r(!0),c(m,null,p(i(g),e=>(r(),s(I,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l[7]||(l[7]=u("span",{class:"ml-8px text-[1.2rem]"},"* 自动获取package.json文件中的启动模式",-1))])]),_:1}),"0"===i(pe).project_script?(r(),s(t,{key:0,label:" "},{default:n(()=>[d(a,{modelValue:i(pe).userCmd,"onUpdate:modelValue":l[3]||(l[3]=e=>i(pe).userCmd=e),placeholder:"请输入自定义启动命令",icon:"el-folder-opened",onIconClick:Z,width:"32rem"},null,8,["modelValue"])]),_:1})):v("",!0),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n(()=>[u("div",ne,[u("div",de,[d(q,{modelValue:i(pe).nodejs_version,"onUpdate:modelValue":l[4]||(l[4]=e=>i(pe).nodejs_version=e),class:"!w-[16rem]",onChange:ee},{default:n(()=>[(r(!0),c(m,null,p(i(h),e=>(r(),s(I,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u("div",ue,[d(M,{title:"刷新Node版本",class:"!flex",onClick:N},{default:n(()=>[d(F,{icon:"el-refresh",class:"!text-[14px]"})]),_:1})])]),l[9]||(l[9]=u("span",{class:"ml-8px text-[1.2rem] text-[#666]"},"* 请根据项目选择合适的Node版本，",-1)),d(P,{onClick:i(T)},{default:n(()=>[...l[8]||(l[8]=[_("安装其他版本",-1)])]),_:1},8,["onClick"])])]),_:1}),d(t,{label:"包管理器"},{default:n(()=>[u("div",ie,[d(q,{modelValue:i(pe).pkg_manager,"onUpdate:modelValue":l[5]||(l[5]=e=>i(pe).pkg_manager=e),class:"!w-[16rem]"},{default:n(()=>[(r(!0),c(m,null,p(i(C),(e,l)=>(r(),s(I,{key:l,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[11]||(l[11]=u("span",{class:"text-[1.2rem] text-[#666 mx-8px"},"* 请选择项目的包管理器",-1)),i(Q)?v("",!0):(r(),s(E,{key:0,modelValue:i(pe).not_install_pkg,"onUpdate:modelValue":l[6]||(l[6]=e=>i(pe).not_install_pkg=e)},{default:n(()=>[...l[10]||(l[10]=[_(" 不安装node_module ",-1)])]),_:1},8,["modelValue"]))])]),_:1})]),_:1}),d(K,{isShowDivider:!i(Q)},{config:n(()=>{var e,l;return[d(oe,{ref_key:"advancedConfigRef",ref:D,"label-width":"80px",type:"node",rowData:{...null==(e=i(f))?void 0:e.project_config,listen:null==(l=i(f))?void 0:l.listen},ps:i(x)},null,8,["rowData","ps"])]}),_:1},8,["isShowDivider"]),i(Q)?(r(),c("div",ce,[d(A,{type:"primary",onClick:me},{default:n(()=>[...l[12]||(l[12]=[_("保存修改",-1)])]),_:1})])):v("",!0),l[13]||(l[13]=u("ul",{class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-32px"},[u("li",null,"【启动选项】：默认读取package.json中的scripts列表，也可以选择[自定义启动命令]选项来手动输入启动命令"),u("li",null,"【自定义启动命令】：可以选择启动文件，或直接输入启动命令，支持的启动方式：例：npm/node/pm2/yarn"),u("li",null,"【项目端口】：错误的端口会导致访问502，若不知道端口，可先随意填写，启动项目后再改为正确端口"),u("li",null,"【运行用户】：为了安全考虑，默认使用www用户运行，root用户运行可能带来安全风险")],-1))],4)}}}),me={class:"flex items-center"},_e={class:"flex items-center custom-refresh-select"},ve={class:"el-input-group__append !h-3rem !flex items-center"},fe={key:2,class:"mt-2rem"},we={class:"flex items-center"},ge={class:"flex items-center"},je={class:"text-[1.2rem] text-[#666] ml-[0.8rem]"},ye={class:"flex items-center"},xe={key:3,class:"mt-2rem"},be={class:"flex items-center"},he={key:0,class:"mb-[2rem]"},Ve=e({__name:"pm-project",props:{compData:{default:()=>({isEdit:!1})}},setup(e,{expose:o}){const{siteInfo:w}=K(),g=l(G.value.nodejs_versions),x=l(G.value.package_managers),h=t(()=>Q.value?w.value.ps:te.value.project_name),M=l(),P=a("getNodeData",e=>{}),X=(e,l)=>{A({type:l,path:"file"===e?te.value.project_file:te.value.project_cwd,change:async l=>{var a,t;const o=te.value.project_name;if("cwd"===e){te.value.project_cwd=l;let e=null==(a=l.substring(l.lastIndexOf("/")+1))?void 0:a.replace(/\W/g,"_");o||(te.value.project_name=e)}else{te.value.project_cwd=l.substring(0,l.lastIndexOf("/"));let a=null==(t=te.value.project_cwd.substring(te.value.project_cwd.lastIndexOf("/")+1))?void 0:t.replace(/\W/g,"_");if(o||(te.value.project_name=a),"file"===e&&(te.value.project_file=l),"config_file"===e){te.value.config_file=l;const e=await(async e=>{try{const{data:l}=await E({path:e});return l.data}catch(l){}})(l);te.value.config_body=e}}}})},Y=e=>{re()},ee=async e=>{const l=await $(e);x.value=l,te.value.pkg_manager=l[0]||""},{BtForm:le,submit:ae,param:te,clearValidate:re}=q({data:async()=>{var e,l;if(await H(),x.value=G.value.package_managers,g.value=G.value.nodejs_versions,Q.value){const{project_config:e,ps:l}=w.value;return{...e,project_ps:R(l),watch:"true"===e.watch}}return{add_type:0,project_name:"",project_type:"pm2",project_cwd:"",project_file:"",pkg_manager:(null==(e=x.value)?void 0:e.at(0))||"yarn",not_install_pkg:!1,nodejs_version:(null==(l=g.value)?void 0:l.at(0))||"",cluster:1,max_memory_limit:1024,watch:!1,config_file:"",config_body:"",project_args:"",env:""}},options:()=>t(()=>[{type:"slots",key:"custom",rules:{project_name:[F({message:"请输入项目名称"})],project_file:[{required:!0,message:"请输入项目启动文件",trigger:["blur","change"]}],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_cwd:[F({message:"请输入项目启动目录"})],cluster:[{required:!0,message:"请输入负载实例数量",trigger:["blur","change"]}],max_memory_limit:[{required:!0,message:"请输入内存上限",trigger:["blur","change"]}]}}]),submit:async(e,l)=>{let a;await l();let t=M.value.formData;return a={...e.value,...t,domains:t.domains?t.domains.split("\n"):[]},0===a.add_type&&(delete a.config_file,delete a.config_body),delete a.add_type,a}}),se=async()=>{const e=await ae();L(e)};return o({submit:ae}),(e,l)=>{const a=B,t=y,o=V,q=j,F=W,R=z,E=S,K=D,A=I,H=J,$=N,L=b,ae=Z,re=O,ne=U;return r(),c("div",{class:"overflow-auto",style:k({"max-height":i(Q)?"68rem":"50rem"})},[d(i(le),{"label-width":"90px"},{custom:n(()=>[d(t,{label:"项目名称",prop:"project_name"},{default:n(()=>[d(a,{modelValue:i(te).project_name,"onUpdate:modelValue":l[0]||(l[0]=e=>i(te).project_name=e),width:"32rem",disabled:i(Q),placeholder:"请输入Node项目名称"},null,8,["modelValue","disabled"])]),_:1}),i(Q)&&i(te).pm2_name?(r(),s(t,{key:0,label:"PM2服务名"},{default:n(()=>[d(a,{modelValue:i(te).pm2_name,"onUpdate:modelValue":l[1]||(l[1]=e=>i(te).pm2_name=e),width:"32rem",disabled:""},null,8,["modelValue"])]),_:1})):v("",!0),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n(()=>[u("div",me,[u("div",_e,[d(q,{onChange:ee,modelValue:i(te).nodejs_version,"onUpdate:modelValue":l[2]||(l[2]=e=>i(te).nodejs_version=e),class:"!w-[16rem]"},{default:n(()=>[(r(!0),c(m,null,p(i(g),e=>(r(),s(o,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u("div",ve,[d(R,{title:"刷新Node版本",class:"!flex",onClick:l[3]||(l[3]=e=>i(P)(!0))},{default:n(()=>[d(F,{icon:"el-refresh",class:"!text-[14px]"})]),_:1})])]),l[22]||(l[22]=u("span",{class:"ml-8px text-[1.2rem] text-[#666]"},"* 请根据项目选择合适的Node版本，",-1)),d(E,{onClick:i(T)},{default:n(()=>[...l[21]||(l[21]=[_("安装其他版本",-1)])]),_:1},8,["onClick"])])]),_:1}),i(Q)?v("",!0):(r(),s(t,{key:1,label:"添加方式",prop:"add_type"},{default:n(()=>[d(A,{modelValue:i(te).add_type,"onUpdate:modelValue":l[4]||(l[4]=e=>i(te).add_type=e),onChange:Y},{default:n(()=>[d(K,{label:0},{default:n(()=>[...l[23]||(l[23]=[_("自定义添加",-1)])]),_:1}),d(K,{label:1},{default:n(()=>[...l[24]||(l[24]=[_("从文件/内容添加",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})),0===i(te).add_type?(r(),c("div",fe,[d(t,{label:"启动文件",prop:"project_file"},{default:n(()=>[d(H,{modelValue:i(te).project_file,"onUpdate:modelValue":l[5]||(l[5]=e=>i(te).project_file=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目启动文件",onIconClick:l[6]||(l[6]=e=>X("file","file")),width:"32rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n(()=>[d(H,{modelValue:i(te).project_cwd,"onUpdate:modelValue":l[7]||(l[7]=e=>i(te).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目运行目录",onIconClick:l[8]||(l[8]=e=>X("cwd","dir")),width:"32rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"负载实例数量",prop:"cluster"},{default:n(()=>[u("div",we,[d(a,{width:"10rem",class:"!w-[10rem]",type:"number",modelValue:i(te).cluster,"onUpdate:modelValue":l[9]||(l[9]=e=>i(te).cluster=e),min:1},null,8,["modelValue"]),l[25]||(l[25]=u("span",{class:"text-[1.2rem] text-[#666] ml-[0.8rem]"},"* 若实例数量大于1，则开启集群模式",-1))])]),_:1}),d(t,{label:"内存上限",prop:"max_memory_limit"},{default:n(()=>[u("div",ge,[d(a,{width:"16rem",class:"!w-[16rem]",type:"number","text-type":"MB",min:1,modelValue:i(te).max_memory_limit,"onUpdate:modelValue":l[10]||(l[10]=e=>i(te).max_memory_limit=e)},null,8,["modelValue"]),u("span",je,"* 超过上限PM2会自动重启项目，系统最大可用内存为["+f(i(G).maximum_memory)+"MB]",1)])]),_:1}),d(t,{label:"自动重载"},{default:n(()=>[d($,{modelValue:i(te).watch,"onUpdate:modelValue":l[11]||(l[11]=e=>i(te).watch=e)},null,8,["modelValue"])]),_:1}),d(t,{label:"包管理器"},{default:n(()=>[u("div",ye,[d(q,{modelValue:i(te).pkg_manager,"onUpdate:modelValue":l[12]||(l[12]=e=>i(te).pkg_manager=e),class:"!w-[16rem]"},{default:n(()=>[(r(!0),c(m,null,p(i(x),(e,l)=>(r(),s(o,{key:l,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[27]||(l[27]=u("span",{class:"text-[1.2rem] text-[#666 mx-8px"},"* 请选择项目的包管理器",-1)),i(Q)?v("",!0):(r(),s(L,{key:0,modelValue:i(te).not_install_pkg,"onUpdate:modelValue":l[13]||(l[13]=e=>i(te).not_install_pkg=e)},{default:n(()=>[...l[26]||(l[26]=[_(" 不安装node_module ",-1)])]),_:1},8,["modelValue"]))])]),_:1})])):(r(),c("div",xe,[d(t,{label:"配置文件"},{default:n(()=>[u("div",be,[d(H,{modelValue:i(te).config_file,"onUpdate:modelValue":l[14]||(l[14]=e=>i(te).config_file=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目配置文件",onIconClick:l[15]||(l[15]=e=>X("config_file","file")),width:"32rem"},null,8,["modelValue"]),l[28]||(l[28]=u("span",{class:"text-1.2rem text-#999 leading-[18px] ml-4px"},"* 请选择pm2的ecosystem配置文件或粘贴内容",-1))])]),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n(()=>[d(H,{modelValue:i(te).project_cwd,"onUpdate:modelValue":l[16]||(l[16]=e=>i(te).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目运行目录",onIconClick:l[17]||(l[17]=e=>X("cwd","dir")),width:"30rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"内容",prop:"config_body"},{default:n(()=>[d(ae,{modelValue:i(te).config_body,"onUpdate:modelValue":l[18]||(l[18]=e=>i(te).config_body=e),style:{height:"24rem"},class:"!h-[24rem] w-[58rem]"},null,8,["modelValue"])]),_:1})])),d(re,{"is-show-divider":!i(Q)},{config:n(()=>{var e;return[0===i(te).add_type?(r(),c("div",he,[d(t,{label:"参数"},{default:n(()=>[d(a,{width:"32rem ",placeholder:"请输入项目参数",modelValue:i(te).project_args,"onUpdate:modelValue":l[19]||(l[19]=e=>i(te).project_args=e)},null,8,["modelValue"])]),_:1}),d(t,{label:"环境变量"},{default:n(()=>[d(a,{width:"32rem",placeholder:"请输入项目环境变量，一行一个",resize:"none",rows:3,modelValue:i(te).env,"onUpdate:modelValue":l[20]||(l[20]=e=>i(te).env=e),type:"textarea"},null,8,["modelValue"])]),_:1})])):v("",!0),d(oe,{ref_key:"advanceConfigRef",ref:M,"label-width":"90px",rowData:null==(e=i(w))?void 0:e.project_config,ps:i(h)},null,8,["rowData","ps"])]}),_:1},8,["is-show-divider"])]),_:1}),i(Q)?(r(),s(ne,{key:0,type:"primary",class:"!mt-[1.2rem] !ml-10rem",onClick:se},{default:n(()=>[...l[29]||(l[29]=[_(" 保存修改 ",-1)])]),_:1})):v("",!0),u("ul",{class:C(["mt-[8px] leading-8 text-[1.2rem] list-disc ml-32px",{"mb-[20px]":i(Q)}])},[...l[30]||(l[30]=[u("li",null,"【启动文件】用于启动nodejs项目的启动文件，通常是一个js文件",-1),u("li",null,"【配置文件】用于pm2直接启动服务的文件，通常是名为ecosystem.config.cjs",-1),u("li",null,"【运行目录】运行项目时默认的运行目录，通常为启动文件或配置文件所在目录",-1),u("li",null,"【负载实例数】集群模式，有些项目可能不支持，实例数量>1时为开启集群模式",-1),u("li",null,"【负载均衡】开启集群模式后将根据实例数自动负载均衡",-1)])],2)],4)}}}),ke={class:"flex items-center"},Ue={class:"flex items-center custom-refresh-select"},Ce={class:"el-input-group__append !h-3rem !flex items-center"},De=e({__name:"traditional-project",props:{compData:{default:()=>({isEdit:!1})}},setup(e,{expose:o}){const{siteInfo:f}=K(),w=l(G.value.nodejs_versions);l(G.value.package_managers);const g=l(),x=a("getNodeData",e=>{}),b=async(e,l)=>{A({type:l,path:"file"===e?D.value.project_file:D.value.project_cwd,change:async l=>{var a,t;"file"===e?D.value.project_file=l:D.value.project_cwd=l;const o=D.value.project_name;if("cwd"===e&&""===o){let e=null==(a=l.substring(l.lastIndexOf("/")+1))?void 0:a.replace(/\W/g,"_");D.value.project_name=e}if("file"===e){D.value.project_cwd=l.substring(0,l.lastIndexOf("/"));let e=null==(t=D.value.project_cwd.substring(D.value.project_cwd.lastIndexOf("/")+1))?void 0:t.replace(/\W/g,"_");""===o&&(D.value.project_name=e)}}})},{BtForm:h,submit:C,param:D}=q({data:async()=>{var e,l;return await H(),w.value=G.value.nodejs_versions,Q.value?null==(e=f.value)?void 0:e.project_config:{project_name:"",nodejs_version:(null==(l=w.value)?void 0:l.at(0))||"",project_file:"",project_cwd:"",project_type:"general",project_args:"",env:""}},options:()=>t(()=>[{type:"slots",key:"custom",rules:{project_name:[F({message:"请输入项目名称"})],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_file:[{required:!0,message:"请输入项目启动文件",trigger:["blur","change"]}],project_cwd:[F({message:"请输入项目启动目录"})]}}]),submit:async(e,l)=>{let a=!1;await l();let t=g.value.formData;return a={...e.value,...t,domains:t.domains?t.domains.split("\n"):[]},a}}),I=async()=>{const e=await C();L(e)};return o({submit:C}),(e,l)=>{const a=B,t=y,o=V,C=j,N=W,q=z,F=S,M=J,P=O,R=U;return r(),c("div",{class:"overflow-auto",style:k({"max-height":i(Q)?"76rem":"52rem"})},[d(i(h),{"label-width":"80px"},{custom:n(()=>[d(t,{label:"项目名称",prop:"project_name"},{default:n(()=>[d(a,{modelValue:i(D).project_name,"onUpdate:modelValue":l[0]||(l[0]=e=>i(D).project_name=e),width:"32rem",disabled:i(Q),placeholder:"请输入项目名称"},null,8,["modelValue","disabled"])]),_:1}),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n(()=>[u("div",ke,[u("div",Ue,[d(C,{modelValue:i(D).nodejs_version,"onUpdate:modelValue":l[1]||(l[1]=e=>i(D).nodejs_version=e),class:"!w-[16rem]"},{default:n(()=>[(r(!0),c(m,null,p(i(w),e=>(r(),s(o,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u("div",Ce,[d(q,{title:"刷新Node版本",class:"!flex",onClick:l[2]||(l[2]=e=>i(x)(!0))},{default:n(()=>[d(N,{icon:"el-refresh",class:"!text-[14px]"})]),_:1})])]),l[10]||(l[10]=u("span",{class:"ml-8px text-[1.2rem] text-[#666]"},"* 请根据项目选择合适的Node版本，",-1)),d(F,{onClick:i(T)},{default:n(()=>[...l[9]||(l[9]=[_("安装其他版本",-1)])]),_:1},8,["onClick"])])]),_:1}),d(t,{label:"启动文件",prop:"project_file"},{default:n(()=>[d(M,{modelValue:i(D).project_file,"onUpdate:modelValue":l[3]||(l[3]=e=>i(D).project_file=e),readOnly:"",placeholder:"请选择项目启动文件",icon:"el-folder-opened",onIconClick:l[4]||(l[4]=e=>b("file","file")),width:"32rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n(()=>[d(M,{modelValue:i(D).project_cwd,"onUpdate:modelValue":l[5]||(l[5]=e=>i(D).project_cwd=e),readOnly:"",placeholder:"请选择项目运行目录",icon:"el-folder-opened",onIconClick:l[6]||(l[6]=e=>b("cwd","dir")),width:"32rem"},null,8,["modelValue"])]),_:1}),d(t,{label:"参数"},{default:n(()=>[d(a,{width:"32rem ",placeholder:"请输入项目参数",modelValue:i(D).project_args,"onUpdate:modelValue":l[7]||(l[7]=e=>i(D).project_args=e)},null,8,["modelValue"])]),_:1}),d(t,{label:"环境变量"},{default:n(()=>[d(a,{width:"32rem",placeholder:"请输入项目环境变量，一行一个，格式参照key=value",resize:"none",rows:3,modelValue:i(D).env,"onUpdate:modelValue":l[8]||(l[8]=e=>i(D).env=e),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),d(P,{"is-show-divider":!i(Q)},{config:n(()=>{var e,l;return[d(oe,{ref_key:"advanceConfigRef",ref:g,"label-width":"80px",rowData:{...null==(e=i(f))?void 0:e.project_config,listen:null==(l=i(f))?void 0:l.listen},ps:i(D).project_name},null,8,["rowData","ps"])]}),_:1},8,["is-show-divider"]),i(Q)?(r(),s(R,{key:0,type:"primary",class:"!mt-[1.2rem] !ml-10rem",onClick:I},{default:n(()=>[...l[11]||(l[11]=[_(" 保存修改 ",-1)])]),_:1})):v("",!0),l[12]||(l[12]=u("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-32px"},[u("li",null,"【启动文件】用于启动nodejs项目的启动文件，通常是一个js文件"),u("li",null,"【运行目录】运行项目时默认的运行目录，通常为启动文件或配置文件所在目录")],-1))],4)}}});export{pe as _,Ve as a,De as b};
