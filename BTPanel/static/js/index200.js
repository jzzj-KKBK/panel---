import{K as e,hb as t,M as a,at as n,hc as r,o as l,hd as o,he as s,l as i,L as c,ah as u,aj as p,hf as d,hg as v,hh as m,aM as h,a6 as g,R as b,a7 as f,a8 as y,e as w,a2 as _}from"./utils-lib.js?v=1756369731";import{j as x,r as k,U as E,s as C,c as O,aB as j,e as T,q as D,M as N,A as P,x as V,S as B,al as H,ac as q,ab as S,B as I,D as R,ay as A,ax as z,ba as M,i as W,p as L,v as U}from"./base-lib.js?v=1756369731";import{_ as J}from"./index103.js?v=1756369731";import{a as K,b as F,u as G,o as Y}from"./column.js?v=1756369731";import{l as Q,D as X,f as Z,m as $}from"./useController4.js?v=1756369731";import{f as ee}from"./validator.js?v=1756369731";import{h as te}from"./form-item.js?v=1756369731";import{_ as ae}from"./index104.js?v=1756369731";const ne=x("DOCKER-SITE-ENV-PHP-STORE",()=>{const u=k(!1),p=k(),d=k([]),v=k([]),m=k([]),h=E([]),g=E({}),b=k(!1),f=k(!1),y=()=>{f.value=!0};return{versionOptions:d,extendOptions:v,templateOptions:m,extendsupOptions:h,resetData:()=>{d.value=[],v.value=[],m.value=[],b.value=!1,u.value=!1,p.value={},h.value=[],g.value={}},getExtend:async(r="all")=>{try{const l={version:r},o=await e({loading:"正在获取版本，请稍后...",request:t(l),message:!1});o.status?g.value=o.data:(a.error(o.msg),n(o))}catch(l){n(l)}},getTemplate:async t=>{try{const l=await e({loading:"正在获取版本，请稍后...",request:r(t||{p:1,row:100}),message:!1});if(!l.status)return a.error(l.msg),n(l),!1;m.value=l.data.data.map(e=>({label:e.name,name:e.name,value:e.id,ext:e.exts,version:e.version,disabled:!1}))}catch(l){n(l)}},popoverFocus:b,isEdit:u,rowData:p,allData:g,refreshTemplateTable:f,setRefreshTemplateTable:y,delPhpTemplate:async(t,a,r)=>{try{await l({title:"删除【".concat(t.name,"】模板"),content:"删除【".concat(t.name,"】模板，此操作不可逆，是否继续操作？"),icon:"warning-filled"}),await e({loading:"正在删除，请稍后...",request:o({id:t.id}),message:!0,success:e=>{y(),r&&r(e)}})}catch(s){n(s)}},useBatchEventHandle:async(t,n,r,o,u)=>{await l({title:"删除模板",content:"删除选中的".concat(r.value.length,"个模板，此操作不可逆，是否继续操作？"),icon:"warning-filled"});const p={ids:r.value.map(e=>e.id).join(",")};await e({loading:"正在删除，请稍后...",request:s(p),success:async e=>{Array.isArray(e.data.data)?await i({title:"批量删除结果",area:42,component:()=>c(()=>import("./index118.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{resultData:e.data.data.map(e=>{const t=r.value.find(t=>t.id===Number(e.id));return{name:null==t?void 0:t.name,status:e.status,msg:e.msg}}),resultTitle:"删除扩展模板"}}):a.request(e),y(),u()}})}}});let re=null,le="";const oe=k(""),se=e=>{let t=[];re=u({route:"/sock_shell",onMessage:(n,r)=>{t.push(r.data),t.length>50?oe.value=null==t?void 0:t.slice(t.length-50).join(" "):oe.value=null==t?void 0:t.join(" "),(r.data.includes("bt_successful")||r.data.includes("bt_failed"))&&(null==re||re.close(),t=[]),r.data.includes("bt_successful")&&(e(),a.success("创建成功")),r.data.includes("bt_failed")&&a.error("创建失败")}}),null==re||re.send(le)},ie=()=>{null==re||re.close(),re=null,le="",oe.value=""},ce=(e,t)=>{le=e,i({title:"创建日志",area:60,component:()=>c(()=>import("./index428.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{t&&t()}})},ue=ne(),{getVersion:pe,setTypeRefreshTable:de}=Q(),{versionOptions:ve,extendOptions:me,allData:he,extendsupOptions:ge,isEdit:be,rowData:fe,templateOptions:ye}=C(ue),{resetData:we,getExtend:_e,getTemplate:xe,setRefreshTemplateTable:ke}=ue;k();const Ee=e=>(be.value=!!(null==e?void 0:e.name),fe.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./php-form.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{we(),e(!1)}})})),Ce=e=>(be.value=!!(null==e?void 0:e.name),fe.value=e||{},new Promise((e,t)=>{i({title:"创建",area:60,btn:["确认","取消"],component:()=>c(()=>import("./php-template-form.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})})),Oe=async t=>{try{const{data:a}=await e({request:r(t||{p:1,row:100})});return a.status?{data:a.data,total:p(a.page)}:{data:[],total:0}}catch(a){}},je=async e=>{try{await _e(),await xe();const t=await pe("php");t.status&&(ve.value=t.data.php.map(e=>({label:e,value:e})),me.value=t.data.repo_urls.map(e=>({label:e.name,value:e.repo})),ve.value.length>0&&(be.value||(e.value.version=ve.value[0].value),De(ve.value[0].value)),me.value.length>0&&!be.value&&(e.value.repo_url=me.value[0].value)),be.value&&De(fe.value.version)}catch(t){}},Te=async e=>{try{await _e();const t=await pe("php");t.status&&(ve.value=t.data.php.map(e=>({label:e,value:e})),ve.value.length>0&&(be.value||(e.value.version=ve.value[0].value),De(ve.value[0].value))),be.value&&De(fe.value.version)}catch(t){}},De=e=>{var t;try{e&&(ge.value=(null==(t=he.value[e])?void 0:t.map(e=>({label:e,value:e})))||[],ye.value=ye.value.map(t=>({...t,label:"".concat(t.name).concat(t.version!==e?"(当前PHP版本不支持)":""),disabled:t.version!==e})))}catch(a){}},Ne=(e,t,n,r,l)=>{var o,s,i;try{if(e.includes(",")){if(""===n)return r.value.exts=[],a.error("请先选择PHP版本");t.value=(null==(o=he.value[n])?void 0:o.filter(t=>t.includes(e)).map(e=>({label:e,value:e})))||[];const i=[],c=[];e.split(",").filter(e=>""!==e&&" "!==e).forEach(e=>{he.value[n].includes(e)?c.push(e):i.push(e)}),r.value.exts=c,null==(s=l.value)||s.blur(),i.length>0?a.success("已选中".concat(c.length,"个扩展，当前PHP版本不支持这").concat(i.length,"个扩展：【").concat(i.join(","),"】")):c.length>0&&a.success("已选中".concat(c.length,"个扩展"))}else t.value=(null==(i=he.value[n])?void 0:i.filter(t=>t.includes(e)).map(e=>({label:e,value:e})))||[]}catch(c){}},Pe=()=>{try{return be.value?{name:fe.value.name,version:fe.value.version,repo_url:fe.value.repo_url,template:"",exts:fe.value.exts.split(","),id:fe.value.id}:{name:"",version:"",repo_url:"",template:"",exts:""}}catch(e){}},Ve=()=>{try{return be.value?{name:fe.value.name,version:fe.value.version,exts:fe.value.exts.split(","),id:fe.value.id}:{name:"",version:"",exts:""}}catch(e){}},Be=async(t,n)=>{try{const r={runtime_name:t.name,runtime_version:t.version,repo_url:t.repo_url,exts:t.exts.join(","),runtime_type:"php",...t.id?{id:t.id}:{}};await e({request:d(r),success:e=>{e.status?(n(),ce("tail -f /www/dk_project/runtime/build/php/".concat(t.name,"/build.log"),()=>{de("php")})):a.error(e.msg)}})}catch(r){}},He=async(t,a)=>{try{const n={name:t.name,version:t.version,exts:t.exts.join(","),...t.id?{id:t.id}:{}};await e({request:v(n),message:!0,success:e=>{e.status&&(a(),ke())}})}catch(n){}},qe=x("DOCKER-SITE-LOG-STORE",()=>{const e=k("run"),t=k({compose:"",log_file:""}),n=k("");return{rowData:t,tabActive:e,logContent:n,getEnvLog:async()=>{try{const r={log_type:e.value,..."run"===e.value?{compose_file:t.value.compose}:{log_file:t.value.log_file}},l=a.load("正在获取日志，请稍后..."),{data:o}=await m(r);l.close(),o.status?n.value=o.data:(a.error(o.msg),n.value="暂无日志内容")}catch(r){}},resteData:()=>{n.value="",t.value.compose_file="",t.value.log_file="",e.value="run"}}}),Se=()=>C(qe()),Ie=qe(),{resteData:Re}=Ie,{rowData:Ae}=C(Ie),ze=(e,t)=>(Ae.value.compose=e.compose,Ae.value.log_file=e.log_file,new Promise((a,n)=>{i({title:"【".concat(e.name,"】日志"),area:65,component:()=>c(()=>import("./index429.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:t||"run",onCancel:()=>{Re(),a(!1)}})})),Me=w(O({__name:"index",setup(e,{expose:t}){const a=Q(),{getEnvList:n}=X(),{refreshEnvTable:r}=C(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,refreshTemplate:u}=a,{BtOperation:p}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Ee()}},{type:"button",label:"扩展模板",onClick:()=>{new Promise((e,t)=>{i({title:"扩展模板",area:90,component:()=>c(()=>import("./extend-template.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})})}},{type:"button",label:"清理构建缓存",onClick:()=>{s("php")}}]}),{BtOperation:d}=h({options:[{type:"button",label:"更新环境模板",onClick:()=>{u("php")}}]}),v=y([{label:"删除",value:"delete",event:o}]),{BtTable:m,BtPage:w,BtBatch:_,refresh:x}=g({request:e=>n({p:e.p||1,row:e.limit||20,runtime_type:"php"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:100},F({function:e=>{let t="异常",a="#ff0000";switch(e.status){case"normal":t="正常",a="#20a53a";break;case"initializing":t="构建中",a="#555"}return j("span",{style:{color:a},onClick:()=>{"normal"!==e.status&&ze(e,"build")},class:"normal"!==e.status?"cursor-pointer":""},T("span",{class:"flex items-center"},[t,T("i",{class:"svgtofont-el-loading !text-[1.2rem] animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))}}),{label:"创建时间",minWidth:100,prop:"addtime",render:e=>T("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},G([{width:80,isHide:e=>"normal"!==e.status,onClick:e=>{Z({type:"runEnv",formData:{type:"php",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{ze(e)},title:"日志"},{onClick:e=>{Ee(e)},title:"编辑"},{onClick:e=>{l(e,"php")},title:"删除"}])],extension:[v,f(r)]});return t({init:x}),(e,t)=>{const a=J;return D(),N(a,null,{"header-left":P(()=>[T(V(p))]),"header-right":P(()=>[T(V(d))]),content:P(()=>[T(V(m),{"min-height":300,class:"fix-table"})]),"footer-left":P(()=>[T(V(_))]),"footer-right":P(()=>[T(V(w))]),_:1})}}}),[["__scopeId","data-v-bc1da908"]]),We=x("DOCKER-SITE-ENV-JAVA-STORE",()=>{const a=k(!1),l=k(),o=k([]),s=k([]),i=k([]),c=E([]),u=E({}),p=k(!1);return{versionOptions:o,extendOptions:s,templateOptions:i,extendsupOptions:c,resetData:()=>{o.value=[],s.value=[],i.value=[],p.value=!1,a.value=!1,l.value={},c.value=[],u.value={}},getExtend:async(a="all")=>{try{const r={version:a},l=await e({loading:"正在获取版本，请稍后...",request:t(r),message:!1});l.status?(u.value=l.data,s.value=l.data.repo_urls.map(e=>({label:e.name,value:e.repo}))):n(l)}catch(r){n(r)}},getTemplate:async t=>{try{const a=await e({loading:"正在获取版本，请稍后...",request:r(t||{p:1,row:100}),message:!1});a.status?i.value=a.data.data.map(e=>({label:e.name,value:e.id,ext:e.exts})):n(a)}catch(a){n(a)}},popoverFocus:p,isEdit:a,rowData:l,allData:u}}),Le=We(),{getVersion:Ue,setTypeRefreshTable:Je}=Q(),{versionOptions:Ke,isEdit:Fe,rowData:Ge}=C(Le),{resetData:Ye}=Le,Qe=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},Xe=e=>(Fe.value=!!(null==e?void 0:e.name),Ge.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./java-form.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{Ye(),e(!1)}})})),Ze=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},$e=e=>{const{BtTable:t}=g({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>T(B,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>Ze(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>T(B,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>Ze(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,cellStyle:"{ textAlign: 'center' }",render:e=>T("div",{class:"h-[3rem]"},[T(H,{modelValue:e.access,"onUpdate:modelValue":t=>e.access=t,onChange:t=>Ze(t,e,"output")},null)])},{label:"协议",prop:"protocol",width:140,render:e=>T("div",{class:"h-[3rem]"},[T(q,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>Ze(t,e,"protocol")},{default:()=>[T(S,{value:"tcp"},{default:()=>[I("TCP")]}),T(S,{value:"udp"},{default:()=>[I("UDP")]})]})])},{label:" ",prop:"del",width:70,render:t=>T(R,{type:"default",class:"svgtofont-el-delete",onClick:()=>{if(1==e.length)return a.error("至少保留一条端口映射");e.splice(e.findIndex(e=>e.id===t.id),1)}},null)}]});return te("端口",()=>T("div",{class:"w-[90%]"},[T(t,null,null),T("div",{class:"text-[#999] text-[1.2rem]"},[I("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])]),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:["blur","change"],validator:(e,t,a)=>{et(t,a)}}]})},et=(e,t)=>{if(0==e.length)return!0;const n={};for(let r=0;r<e.length;r++){const l=e[r];switch(!0){case""==l.server:return!t&&a.error("端口表格第".concat(r+1,"行")+"本地端口不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!t&&a.error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围"),t&&t(new Error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!t&&a.error("端口表格第".concat(r+1,"行")+"容器端口不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!t&&a.error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围"),t&&t(new Error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!t&&a.error("端口表格第".concat(r+1,"行")+"协议不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"协议不能为空")),!1}n["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return t&&t(),n},tt=async e=>{try{const t=await Ue("java");t.status&&(Ke.value=t.data.java.map(e=>({label:e,value:e})),Ke.value.length>0&&!Fe.value&&(e.value.version=Ke.value[0].value))}catch(t){}},at=()=>{var e;try{if(Fe.value){const t=[];return null==(e=Object.entries(JSON.parse(Ge.value.ports||"{}")))||e.forEach((e,a)=>{if(e[1]){const[a,...n]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:n,output:"0.0.0.0"===e[1][0].HostIp})}}),{name:Ge.value.name,version:Ge.value.version,path:Ge.value.path,command:Ge.value.command,port:t,id:Ge.value.id}}return{name:"",version:"",path:"",command:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},nt=async(t,n)=>{try{const r=et(t.port);if(!r)return!1;const l={runtime_name:t.name,runtime_version:t.version,site_path:t.path,command:t.command,ports:!0===r?"":JSON.stringify(r),runtime_type:"java",...t.id?{id:t.id}:{}};await e({request:d(l),success:e=>{e.status?(n(),ce("tail -f /www/dk_project/runtime/run/java/".concat(t.name,"/create.log"),()=>{Je("java")})):a.error(e.msg)}})}catch(r){}};const rt=w(O({__name:"index",setup(e,{expose:t}){const a=Q(),{getEnvList:n}=X(),{refreshJavaEnvTable:r}=C(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:i}=a,{BtOperation:c}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Xe()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("java")}}]}),u=y([{label:"删除",value:"delete",event:o}]);A("popupClose",()=>{});const{BtTable:p,BtPage:d,BtBatch:v,refresh:m}=g({request:e=>n({p:e.p||1,row:e.limit||20,runtime_type:"java"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:60},F({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="#20a53a";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return T(z,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>T("div",{class:"flex items-center"},[T("span",{class:"bt-link cursor-pointer",onClick:()=>i("running"===e.status?"stop":"start",e,"java")},["running"===e.status?"停止":"启动"]),T(ae,null,null),T("span",{class:"bt-link cursor-pointer",onClick:()=>i("restart",e,"java")},[I("重启")])]),reference:()=>j("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{i("running"===e.status?"stop":"start",e,"java")}},T("span",{class:"flex items-center"},[t,T("i",{class:"svgtofont-el-loading !text-[1.2rem] animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"port",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let n=0;for(let r=0;r<t.length;r++){if(n>=10){a.push("......");break}const e=t[r];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),n++)}return T("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map(e=>{return T(M,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!W(t)?e:{default:()=>[e]});var t})])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>T("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>T("span",{class:"btlink truncate inline-block max-w-[20rem] cursor-pointer leading-[3.7rem]",title:e.path,onClick:()=>Y(e,"path")},[e.path])},G([{width:80,isHide:e=>"running"!==e.status,onClick:e=>{Z({type:"runEnv",formData:{type:"java",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{ze(e)},title:"日志"},{onClick:e=>{Xe(e)},title:"编辑"},{onClick:e=>{l(e,"java")},title:"删除"}])],extension:[u,f(r)]});return t({init:m}),(e,t)=>{const a=J;return D(),N(a,null,{"header-left":P(()=>[T(V(c))]),"header-right":P(()=>[...t[0]||(t[0]=[])]),content:P(()=>[T(V(p),{class:"fix-table"})]),"footer-left":P(()=>[T(V(v))]),"footer-right":P(()=>[T(V(d))]),_:1})}}}),[["__scopeId","data-v-a6acfac5"]]),lt=x("DOCKER-SITE-ENV-PYTHON-STORE",()=>{const a=k(!1),l=k(),o=k([]),s=k([]),i=k([]),c=E([]),u=E({}),p=k(!1);return{versionOptions:o,extendOptions:s,templateOptions:i,extendsupOptions:c,resetData:()=>{o.value=[],s.value=[],i.value=[],p.value=!1,a.value=!1,l.value={},c.value=[],u.value={}},getExtend:async(a="all")=>{try{const r={version:a},l=await e({loading:"正在获取版本，请稍后...",request:t(r),message:!1});l.status?u.value=l.data:n(l)}catch(r){n(r)}},getTemplate:async t=>{try{const a=await e({loading:"正在获取版本，请稍后...",request:r(t||{p:1,row:100}),message:!1});a.status?i.value=a.data.data.map(e=>({label:e.name,value:e.id,ext:e.exts})):n(a)}catch(a){n(a)}},popoverFocus:p,isEdit:a,rowData:l,allData:u}}),ot=lt(),{getVersion:st,setTypeRefreshTable:it}=Q(),{versionOptions:ct,extendOptions:ut,isEdit:pt,rowData:dt}=C(ot),{resetData:vt}=ot,mt=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},ht=()=>{var e;try{if(pt.value){const t=[];return null==(e=Object.entries(JSON.parse(dt.value.ports||"{}")))||e.forEach((e,a)=>{if(e[1]){const[a,...n]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:n,output:"0.0.0.0"===e[1][0].HostIp})}}),{name:dt.value.name,version:dt.value.version,path:dt.value.path,repo_url:dt.value.repo_url,command:dt.value.command,port:t,id:dt.value.id}}return{name:"",version:"",repo_url:"mirrors.aliyun.com",path:"",template:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},gt=async e=>{try{const t=await st("python");t.status&&(ct.value=t.data.python.map(e=>({label:e,value:e})),ut.value=t.data.repo_urls.map(e=>({label:e.name,value:e.repo})),ct.value.length>0&&!pt.value&&(e.value.version=ct.value[0].value),ut.value.length>0&&!pt.value&&(e.value.repo_url=ut.value[0].value))}catch(t){}},bt=e=>(pt.value=!!(null==e?void 0:e.name),dt.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./python-form.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{vt(),e(!1)}})})),ft=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},yt=e=>{const{BtTable:t}=g({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>T(B,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>ft(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>T(B,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>ft(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,render:e=>T("div",{class:"h-[3rem]"},[T(H,{modelValue:e.access,"onUpdate:modelValue":t=>e.access=t,onChange:t=>ft(t,e,"output")},null)])},{label:"协议",prop:"protocol",width:140,render:e=>T("div",{class:"h-[3rem]"},[T(q,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>ft(t,e,"protocol")},{default:()=>[T(S,{value:"tcp"},{default:()=>[I("TCP")]}),T(S,{value:"udp"},{default:()=>[I("UDP")]})]})])},{label:" ",prop:"del",width:70,render:t=>T(R,{type:"default",class:"svgtofont-el-delete",onClick:()=>{e.splice(e.findIndex(e=>e.id===t.id),1)}},null)}]});return te("端口",()=>T("div",{class:"w-[90%]"},[T(t,null,null),T("div",{class:"text-[#999] text-[1.2rem]"},[I("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])]),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(e,t,a)=>{wt(t,a)}}]})},wt=(e,t)=>{if(0==e.length)return!0;const n={};for(let r=0;r<e.length;r++){const l=e[r];switch(!0){case""==l.server:return!t&&a.error("端口表格第".concat(r+1,"行")+"本地端口不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!t&&a.error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围"),t&&t(new Error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!t&&a.error("端口表格第".concat(r+1,"行")+"容器端口不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!t&&a.error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围"),t&&t(new Error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!t&&a.error("端口表格第".concat(r+1,"行")+"协议不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"协议不能为空")),!1}n["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return t&&t(),n},_t=async(t,n)=>{try{const r=wt(t.port);if(!r)return!1;const l={runtime_name:t.name,runtime_version:t.version,site_path:t.path,command:t.command,ports:!0===r?"":JSON.stringify(r),repo_url:t.repo_url,runtime_type:"python",...t.id?{id:t.id}:{}};await e({request:d(l),success:e=>{e.status?(ce("tail -f /www/dk_project/runtime/run/python/".concat(t.name,"/create.log"),()=>{it("python")}),n()):a.error(e.msg)}})}catch(r){}};const xt=w(O({__name:"index",setup(e,{expose:t}){const a=Q(),{getEnvList:n}=X(),{refreshPythonEnvTable:r}=C(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:i}=a,{BtOperation:c}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{bt()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("python")}}]});A("popupClose",()=>{});const u=y([{label:"删除",value:"delete",event:o}]),{BtTable:p,BtPage:d,BtBatch:v,refresh:m}=g({request:e=>n({p:e.p||1,row:e.limit||20,runtime_type:"python"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:50},F({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="#20a53a";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return T(z,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>T("div",{class:"flex items-center"},[T("span",{class:"bt-link cursor-pointer",onClick:()=>i("running"===e.status?"stop":"start",e,"python")},["running"===e.status?"停止":"启动"]),T(ae,null,null),T("span",{class:"bt-link cursor-pointer",onClick:()=>i("restart",e,"python")},[I("重启")])]),reference:()=>j("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{i("running"===e.status?"stop":"start",e,"python")}},T("span",{class:"flex items-center"},[t,T("i",{class:"svgtofont-el-loading !text-[1.2rem] animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"port",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let n=0;for(let r=0;r<t.length;r++){if(n>=10){a.push("......");break}const e=t[r];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),n++)}return T("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map(e=>{return T(M,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!W(t)?e:{default:()=>[e]});var t})])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>T("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>T("span",{class:"btlink truncate inline-block max-w-[18rem] leading-[3.7rem] cursor-pointer",title:e.path,onClick:()=>Y(e,"path")},[e.path])},G([{width:60,isHide:e=>"running"!==e.status,onClick:e=>{Z({type:"runEnv",formData:{type:"python",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{ze(e)},title:"日志"},{onClick:e=>{i("stop",e,"python")},isHide:e=>"running"!==e.status,title:"停止"},{onClick:e=>{i("restart",e,"python")},isHide:e=>"running"!==e.status,title:"重启"},{onClick:e=>{bt(e)},title:"编辑"},{onClick:e=>{l(e,"python")},title:"删除"}])],extension:[u,f(r)]});return t({init:m}),(e,t)=>{const a=J;return D(),N(a,null,{"header-left":P(()=>[T(V(c))]),"header-right":P(()=>[...t[0]||(t[0]=[])]),content:P(()=>[T(V(p),{class:"fix-table"})]),"footer-left":P(()=>[T(V(v))]),"footer-right":P(()=>[T(V(d))]),_:1})}}}),[["__scopeId","data-v-c0540fee"]]),kt=x("DOCKER-SITE-ENV-GO-STORE",()=>{const a=k(!1),l=k(),o=k([]),s=k([]),i=k([]),c=E([]),u=E({}),p=k(!1);return{versionOptions:o,extendOptions:s,templateOptions:i,extendsupOptions:c,resetData:()=>{o.value=[],s.value=[],i.value=[],p.value=!1,a.value=!1,l.value={},c.value=[],u.value={}},getExtend:async(a="all")=>{try{const r={version:a},l=await e({loading:"正在获取版本，请稍后...",request:t(r),message:!1});l.status?(u.value=l.data,s.value=l.data.repo_urls.map(e=>({label:e.name,value:e.repo}))):n(l)}catch(r){n(r)}},getTemplate:async t=>{try{const a=await e({loading:"正在获取版本，请稍后...",request:r(t||{p:1,row:100}),message:!1});a.status?i.value=a.data.data.map(e=>({label:e.name,value:e.id,ext:e.exts})):n(a)}catch(a){n(a)}},popoverFocus:p,isEdit:a,rowData:l,allData:u}}),Et=kt(),{getVersion:Ct,setTypeRefreshTable:Ot}=Q(),{versionOptions:jt,isEdit:Tt,rowData:Dt}=C(Et),{resetData:Nt}=Et,Pt=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},Vt=e=>(Tt.value=!!(null==e?void 0:e.name),Dt.value=e||{},new Promise((e,t)=>{i({title:"创建",area:80,btn:["确认","取消"],component:()=>c(()=>import("./go-form.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),onCancel:()=>{Nt(),e(!1)}})})),Bt=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},Ht=e=>{const{BtTable:t}=g({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>T(B,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>Bt(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>T(B,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>Bt(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,render:e=>T("div",{class:"h-[3rem]"},[T(H,{modelValue:e.access,"onUpdate:modelValue":t=>e.access=t,onChange:t=>Bt(t,e,"output")},null)])},{label:"协议",prop:"protocol",width:140,render:e=>T("div",{class:"h-[3rem]"},[T(q,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>Bt(t,e,"protocol")},{default:()=>[T(S,{value:"tcp"},{default:()=>[I("TCP")]}),T(S,{value:"udp"},{default:()=>[I("UDP")]})]})])},{label:" ",prop:"del",width:70,render:t=>T(R,{type:"default",class:"svgtofont-el-delete",onClick:()=>{e.splice(e.findIndex(e=>e.id===t.id),1)}},null)}]});return te("端口",()=>T("div",{class:"w-[90%]"},[T(t,null,null),T("div",{class:"text-[#999] text-[1.2rem]"},[I("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])]),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(e,t,a)=>{qt(t,a)}}]})},qt=(e,t)=>{if(0==e.length)return!0;const n={};for(let r=0;r<e.length;r++){const l=e[r];switch(!0){case""==l.server:return!t&&a.error("端口表格第".concat(r+1,"行")+"本地端口不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!t&&a.error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围"),t&&t(new Error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!t&&a.error("端口表格第".concat(r+1,"行")+"容器端口不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!t&&a.error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围"),t&&t(new Error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!t&&a.error("端口表格第".concat(r+1,"行")+"协议不能为空"),t&&t(new Error("端口表格第".concat(r+1,"行")+"协议不能为空")),!1}n["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return t&&t(),n},St=async e=>{try{const t=await Ct("go");t.status&&(jt.value=t.data.go.map(e=>({label:e,value:e})),jt.value.length>0&&!Tt.value&&(e.value.version=jt.value[0].value))}catch(t){}},It=()=>{var e;try{if(Tt.value){const t=[];return null==(e=Object.entries(JSON.parse(Dt.value.ports||"{}")))||e.forEach((e,a)=>{if(e[1]){const[a,...n]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:n,output:"0.0.0.0"===e[1][0].HostIp})}}),{name:Dt.value.name,version:Dt.value.version,path:Dt.value.path,command:Dt.value.command,port:t,id:Dt.value.id}}return{name:"",version:"",path:"",command:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},Rt=async(t,n)=>{try{const r=qt(t.port);if(!r)return!1;const l={runtime_name:t.name,runtime_version:t.version,site_path:t.path,command:t.command,ports:!0===r?"":JSON.stringify(r),runtime_type:"go",...t.id?{id:t.id}:{}};await e({request:d(l),success:e=>{e.status?(n(),ce("tail -f /www/dk_project/runtime/run/go/".concat(t.name,"/create.log"),()=>{Ot("go")})):a.error(e.msg)}})}catch(r){}};const At=w(O({__name:"index",setup(e,{expose:t}){const a=Q(),{getEnvList:n}=X(),{refreshGoEnvTable:r}=C(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:i}=a,{BtOperation:c}=h({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Vt()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("go")}}]}),u=y([{label:"删除",value:"delete",event:o}]);A("popupClose",()=>{});const{BtTable:p,BtPage:d,BtBatch:v,refresh:m}=g({request:e=>n({p:e.p||1,row:e.limit||20,runtime_type:"go"}),columns:[K(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:60},F({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="#20a53a";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return T(z,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>T("div",{class:"flex items-center"},[T("span",{class:"bt-link cursor-pointer",onClick:()=>i("running"===e.status?"stop":"start",e,"go")},["running"===e.status?"停止":"启动"]),T(ae,null,null),T("span",{class:"bt-link cursor-pointer",onClick:()=>i("restart",e,"go")},[I("重启")])]),reference:()=>j("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{i("running"===e.status?"stop":"start",e,"go")}},T("span",{class:"flex items-center"},[t,T("i",{class:"svgtofont-el-loading !text-[1.6rem] animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"ports",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let n=0;for(let r=0;r<t.length;r++){if(n>=10){a.push("......");break}const e=t[r];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),n++)}return T("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map(e=>{return T(M,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!W(t)?e:{default:()=>[e]});var t})])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>T("span",null,[e.addtime?b(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>T("span",{class:"btlink truncate inline-block max-w-[20rem] leading-[3.7rem] cursor-pointer",title:e.path,onClick:()=>Y(e,"path")},[e.path])},G([{width:80,isHide:e=>"running"!==e.status,onClick:e=>{Z({type:"runEnv",formData:{type:"go",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{ze(e)},title:"日志"},{onClick:e=>{Vt(e)},title:"编辑"},{onClick:e=>{l(e,"go")},title:"删除"}])],extension:[u,f(r)]});return t({init:m}),(e,t)=>{const a=J;return D(),N(a,null,{"header-left":P(()=>[T(V(c))]),"header-right":P(()=>[...t[0]||(t[0]=[])]),content:P(()=>[T(V(p),{class:"fix-table"})]),"footer-left":P(()=>[T(V(v))]),"footer-right":P(()=>[T(V(d))]),_:1})}}}),[["__scopeId","data-v-fec5d0a3"]]),zt={class:"p-[20px]"},Mt=O({__name:"index",setup(e){const{tabActive:t}=$(),{BtTabs:a}=_({type:"card",value:t,options:[{label:"PHP",name:"php",render:()=>T(Me,null,null)},{label:"JAVA",name:"java",lazy:!0,render:()=>T(rt,null,null)},{label:"Python",name:"python",lazy:!0,render:()=>T(xt,null,null)},{label:"GO",name:"go",lazy:!0,render:()=>T(At,null,null)}]}),n=e=>{};return L(()=>{}),(e,t)=>(D(),U("div",zt,[T(V(a),{onChange:n})]))}}),Wt=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"}));export{Pt as A,Ht as B,Rt as C,ne as D,St as E,se as F,ie as G,oe as H,Wt as I,Oe as a,He as b,Be as c,Te as d,Ne as e,Pe as f,je as g,qe as h,We as i,at as j,Qe as k,$e as l,nt as m,tt as n,Ce as o,lt as p,ht as q,mt as r,De as s,Ve as t,Se as u,yt as v,_t as w,gt as x,kt as y,It as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
