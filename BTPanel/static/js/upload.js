import{c as e,ay as a,r as t,g as s,U as l,k as o,w as r,q as i,v as u,e as n,A as p,B as c,x as m,y as d,z as f,F as _,M as v,H as w,I as h,D as b,b0 as g,au as y,b3 as k,av as x,aw as D}from"./base-lib.js?v=1756369731";import{Y as z,v as j,b as q}from"./utils-lib.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const E={class:"p-[2rem]"},C={class:"h-[40rem] border border-[#EBEEF5] mt-[1rem]"},O={class:"ml-[0.5rem]"},F={class:"mt-8px leading-8 text-[1.2rem] list-disc ml-2rem"},I=e({__name:"upload",props:{compData:{default:()=>({path:"",size:100,uploadData:()=>({multiple:!0,limit:1e3}),refreshEvent:()=>{}})}},setup(e,{expose:I}){const B=q(),H=e,M=a("popupSetFooter"),A=a("buttonText"),S=a("popupClose");let T=!0;const U=t(),Y=t([]),G=s(()=>H.compData.uploadData.accept||l([".json"].join(","))),J=s(()=>H.compData.uploadData.multiple),K=s(()=>H.compData.uploadData.limit),L={"x-http-token":window.vite_public_request_token},N=z(),P=window.location.protocol+"//"+window.location.host+"/files?action=upload",Q=o({f_size:0,f_path:H.compData.path,f_name:"",f_start:0,request_time:N.request_time,request_token:N.request_token}),R=()=>{B.success("导入成功"),H.compData.refreshEvent&&H.compData.refreshEvent(Y.value,S)},V=(e,a,t)=>{t.push(a),B.error("导入失败")},W=e=>{Q.f_size=e.size,Q.f_name=e.name,Q.f_start=0},X=(e,a)=>{const t=e.name.substring(e.name.lastIndexOf(".")+1),s=G.value;if(-1===s.indexOf(t))return!1;Y.value=a.filter(e=>{let a=e.name.substring(e.name.lastIndexOf(".")+1);return-1!==s.indexOf(a)})||[]},Z=(e,a,t)=>{Q.f_start=e.percent,Y.value=t.map(t=>(t.uid===a.uid&&(t.percentage=e.percent),t))};return r(()=>Y.value.length,e=>{if(0===e)return void M(!1);const a=["success","fail","ready"];for(let t=0;t<Y.value.length;t++)if(!a.includes(Y.value[t].status))return void M(!1);Y.value.some(e=>"success"!==e.status)&&(A.value=T?"开始上传":"重新上传",M(!0))}),I({onConfirm:()=>{Y.value.map(e=>{"success"!==e.status&&(e.status="ready")}),T=!1,U.value.submit(),M(!1)}}),(e,a)=>{const t=b,s=g,l=y,o=k,r=x,z=D;return i(),u("div",E,[n(s,{class:"upload-demo",ref_key:"upload",ref:U,name:"blob",data:m(Q),action:P,headers:L,accept:m(G),limit:m(K),multiple:m(J),"show-file-list":!1,"auto-upload":!1,"file-list":m(Y),"on-error":V,"on-success":R,"on-progress":Z,"on-change":X,"before-upload":W},{default:p(()=>[n(t,{type:"primary"},{default:p(()=>[...a[0]||(a[0]=[c("选择文件",-1)])]),_:1})]),_:1},8,["data","accept","limit","multiple","file-list"]),d("div",C,[n(z,{height:"400",data:m(Y)},{empty:p(()=>[n(r,{description:"只支持'".concat(m(G),"'文件格式导入")},null,8,["description"])]),default:p(()=>[n(l,{prop:"name","show-overflow-tooltip":!0,label:"名称"},{default:p(e=>[a[1]||(a[1]=d("i",{style:{color:"#409eff"},class:"svgtofont-el-document"},null,-1)),d("span",O,f(e.row.name),1)]),_:1}),n(l,{prop:"name",label:"是否成功",width:"300"},{default:p(e=>["success"===e.row.status?(i(),u(_,{key:0},[c("上传成功！")],64)):"fail"===e.row.status?(i(),u(_,{key:1},[c("上传失败!")],64)):"ready"===e.row.status?(i(),u(_,{key:2},[c("等待上传")],64)):(i(),v(o,{key:3,percentage:Math.floor(e.row.percentage)},null,8,["percentage"]))]),_:1}),n(l,{width:"120",prop:"size",label:"大小"},{default:p(e=>[c(f(m(j)(e.row.size)),1)]),_:1}),n(l,{prop:"name",width:"180",align:"right","show-overflow-tooltip":!0,label:"操作"},{default:p(e=>[w(n(t,{type:"text",size:"small",onClick:a=>{return t=e.row,void(Y.value=Y.value.filter(e=>e.name!==t.name));var t}},{default:p(()=>[...a[2]||(a[2]=[c("删除",-1)])]),_:2},1032,["onClick"]),[[h,"ready"===e.row.status||"fail"===e.row.status]])]),_:1})]),_:1},8,["data"])]),d("ul",F,[d("li",null,"仅支持"+f(m(G)),1)])])}}});export{I as default};
