import{bU as a,M as e,at as l,K as t,k as s,W as o}from"./utils-lib.js?v=1756369731";import{_ as n}from"./index103.js?v=1756369731";import{_ as m}from"./index101.js?v=1756369731";import{c as r,r as i,k as c,U as u,g as p,p as d,G as b,q as _,v,e as f,A as g,H as y,x,y as j,M as h,B as q,C as k,ag as w,af as V}from"./base-lib.js?v=1756369731";import{g as S}from"./useStore2.js?v=1756369731";import{getTableInfo as C,getModulesTableInfo as U}from"./database.js?v=1756369731";import{y as z}from"./useMethod4.js?v=1756369731";import{a as D}from"./column.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./validator.js?v=1756369731";import"./index104.js?v=1756369731";const J={class:"p-[20px]"},M={class:"flex items-center mt-[16px] leading-[3rem]"},N={key:0,class:"flex items-center mt-16px"},O=r({__name:"table-back",props:{compData:{default:()=>({name:"",id:0})}},setup(r,{expose:O}){const A=r,{refs:{tabActive:H}}=S(),{name:L,id:Q}=A.compData,B=i("mongodb"===H.value?"bson":"db"),F=i(!1),G=i([]),I=i([]),K=c({id:Q,table_list:I.value,storage_type:B.value,file_type:B.value,password:""}),W=u([D({key:"mongodb"==H.value?"collection_name":"table_name"}),{prop:"mongodb"==H.value?"collection_name":"table_name",label:"表名"},{prop:"mongodb"==H.value?"count":"rows_count",label:"行数"},{prop:"mongodb"===H.value?"size":"pgsql"===H.value?"table_size":"data_size",label:"大小"}]),E=p(()=>{let a=[{content:"分表导出：一张表存储为一个SQL文件。"},{content:"合并导出：将选中的表导出到一个SQL文件内"},{content:"备份格式：打包后压缩包内的文件格式"}];return"mysql"==H.value&&a.push({content:"压缩密码：设置备份压缩密码后请注意保存好密码！",class:"text-warning"}),a}),P=a=>{I.value=a};return d(()=>{(async()=>{const{data:a}=await t({loading:F,request:"mysql"===H.value?C({db_name:L}):U({data:JSON.stringify({db_name:L})},H.value)});"mysql"===H.value&&(G.value=a.tables),"mongodb"===H.value&&(G.value=a.data.collection_list),"pgsql"===H.value&&(G.value=a.data.table_list)})()}),O({onConfirm:async a=>{var t,s;try{if(0===I.value.length)return void e.error("请至少选择一项要备份的表");let l={...K,collection_list:I.value.map(a=>a.collection_name),table_list:JSON.stringify(I.value.map(a=>"".concat(a.schema,".").concat(a.table_name)))};switch(H.value){case"mongodb":l.file_type=K.storage_type,l.storage_type="table";break;case"pgsql":l.table_list=I.value.map(a=>"".concat(a.schema,".").concat(a.table_name));break;case"mysql":l.table_list=JSON.stringify(I.value.map(a=>"".concat(a.table_name)))}const o=await z(l);e.request(o),null==(s=(t=A.compData).refreshFn)||s.call(t),a()}catch(o){l(o,"数据库-表备份-onConfirm")}}}),(e,l)=>{const t=s,r=w,i=V,c=m,u=n,p=o,d=b("bt-loading"),S=b("focus");return _(),v("div",J,[f(u,null,{content:g(()=>[y(f(t,{onSelectionChange:P,"max-height":"260",column:x(W),data:x(G)},null,8,["column","data"]),[[d,x(F)],[d,"正在加载列表，请稍后...","title"]])]),"footer-left":g(()=>[j("div",null,[j("div",M,[l[8]||(l[8]=j("span",{class:"mr-[16px]"},"备份方式",-1)),"mongodb"!==x(H)?(_(),h(i,{key:0,modelValue:x(K).storage_type,"onUpdate:modelValue":l[0]||(l[0]=a=>x(K).storage_type=a)},{default:g(()=>[f(r,{value:"db"},{default:g(()=>[...l[4]||(l[4]=[q("合并导出",-1)])]),_:1}),f(r,{value:"table"},{default:g(()=>[...l[5]||(l[5]=[q("分表导出",-1)])]),_:1})]),_:1},8,["modelValue"])):k("",!0),"mongodb"==x(H)?(_(),h(i,{key:1,modelValue:x(K).storage_type,"onUpdate:modelValue":l[1]||(l[1]=a=>x(K).storage_type=a)},{default:g(()=>[f(r,{value:"bson"},{default:g(()=>[...l[6]||(l[6]=[q("bson",-1)])]),_:1}),f(r,{value:"json"},{default:g(()=>[...l[7]||(l[7]=[q("json",-1)])]),_:1})]),_:1},8,["modelValue"])):k("",!0)]),"mysql"==x(H)?(_(),v("div",N,[l[9]||(l[9]=j("span",{class:"mr-16px !w-[6.4rem]"},"压缩密码",-1)),y(f(c,{placeholder:"请输入压缩密码，可为空",modelValue:x(K).password,"onUpdate:modelValue":l[2]||(l[2]=a=>x(K).password=a),icon:"el-refresh",onIconClick:l[3]||(l[3]=()=>x(K).password=x(a)(16))},null,8,["modelValue"]),[[S]])])):k("",!0)])]),_:1}),f(p,{options:x(E),"list-style":"disc",class:"ml-[20px] mt-[36px]"},null,8,["options"])])}}});export{O as default};
