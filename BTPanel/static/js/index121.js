import{r as e,s as a,g as l,e as t,bZ as s,c0 as u,c as o,k as n,aG as r,p as i,q as v,v as c,A as p,y as m,x as d,F as b,a_ as h,M as y,C as w,B as g,P as _,L as f,H as x,I as k,ai as L,aj as T,a9 as V,T as S,ax as N,a7 as A,z as U,t as C,a4 as I,au as j,aw as D,D as B}from"./base-lib.js?v=1756369731";import{l as E,L as q,ct as M,M as H,j as R,ag as P,e as O,u as F,bU as z,p as G,G as W}from"./utils-lib.js?v=1756369731";import{k as Q,d as K,c as $,g as J,f as X,l as Y,m as Z,h as ee,b as ae,i as le,j as te,F as se}from"./form-item.js?v=1756369731";import{F as ue,G as oe,H as ne,I as re,J as ie,K as ve,L as ce,M as pe,N as me,O as de}from"./useController3.js?v=1756369731";import{f as be,aG as he,aH as ye,l as we,p as ge}from"./validator.js?v=1756369731";import{C as _e,g as fe}from"./index14.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";import"./index104.js?v=1756369731";import"./column.js?v=1756369731";import"./index116.js?v=1756369731";import"./index103.js?v=1756369731";import"./index112.js?v=1756369731";import"./index123.js?v=1756369731";import"./index124.js?v=1756369731";const xe=e([]),ke=async e=>{E({title:"选择脚本",area:40,component:()=>q(()=>import("./index419.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{value:e.value.sBody,onConfirm:a=>{e.value.sBody=a.scriptText,e.value.version=a.args}},showFooter:!0})};(async()=>{try{const e=await(async()=>{try{const{data:e}=await ue({all_user:!0});return e.map(e=>({label:e,value:e}))||[]}catch(e){}})();xe.value=e}catch(e){}})();const{rowData:Le,typeInit:Te}=a(_e()),Ve=l(()=>!!Le.value.id),Se=l(()=>!Le.value.id&&!Le.value),Ne=e([{label:"全部",value:"ALL"}]),Ae=e=>{be({type:"dir",path:e.value.log_cut_path,change:a=>{e.value.log_cut_path=a}})},Ue=async e=>{Te.value=!1,Se.value&&(e.value.name="切割日志[所有]",e.value.save=180,e.value.log_cut_path||(e.value.log_cut_path="/www/wwwlogs"),(async e=>{try{const{data:a}=await oe({type:"sites"});Ne.value=[{label:"全部",value:"ALL"}].concat(a.data.map(e=>({label:e.name,value:e.name})))||[],e.value.sName="ALL"}catch(a){}})(e))},{rowData:Ce,typeInit:Ie}=a(_e()),je=e([{label:"全部",value:"ALL"}]),De=l(()=>!!Ce.value.id),Be=l(()=>!Ce.value.id&&!Ce.value);l(()=>Ce.value&&!Ce.value.id);const Ee=e=>{!De.value&&(async e=>{try{const{data:a}=await oe({type:"sites"});je.value=[{label:"全部",value:"ALL"}].concat(a.data.map(e=>({label:e.name,value:e.name})))||[],e.value.sName="ALL"}catch(a){}})(e),Ie.value=!1,Be.value&&(e.value.name="木马查杀[全部]")},{rowData:qe,typeInit:Me}=a(_e()),He=e([]),Re=e([]);l(()=>!!qe.value.id);const Pe=l(()=>!qe.value.id&&!qe.value),Oe=e=>{try{Me.value=!1,Pe.value?(e.value.name="定期同步服务器时间[Asia/Shangehai]",e.value.sName="Asia/Shanghai",Re.value=["Asia","Shanghai"]):Re.value=e.value.sName.split("/"),(async()=>{try{const e=await ne();He.value=Object.keys(e.data).map(a=>({value:a,label:a,children:e.data[a].map(e=>({value:e,label:e}))}))}catch(e){}})()}catch(a){}},{rowData:Fe}=a(_e());l(()=>!!Fe.value.id);const ze=l(()=>!Fe.value.id&&!Fe.value),Ge=async e=>{if(!M(e.value.urladdress))return H.error("请输入正确的url地址");{const l=H.load("正在测试，请稍候...");try{const a=await re({url:e.value.urladdress});E({title:"测试URL结果",area:59,component:()=>q(()=>import("./index420.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{result:a.data}})}catch(a){}finally{l.close()}}},We=e([{paramName:"",paramValue:""}]),{rowData:Qe}=a(_e());l(()=>!!Qe.value.id);const Ke=l(()=>!Qe.value.id&&!Qe.value),$e=e=>{e.row.xh=e.rowIndex+1},Je=e(),Xe=e=>{var a,l;e.length>1&&(null==(a=Je.value)||a.clearSelection(),null==(l=Je.value)||l.toggleRowSelection(e.pop()))},Ye=()=>{We.value.push({paramName:"",paramValue:""})},Ze=(e,a)=>{We.value.splice(a,1)},ea=e([{label:"所有[所有网站]",value:"ALL"}]),{rowData:aa,typeInit:la}=a(_e()),ta=e(""),sa=e(""),ua=l(()=>!!aa.value.id),oa=l(()=>!aa.value.id&&!aa.value),na=e=>{sa.value="",ta.value="",la.value=!1,!ua.value&&(async e=>{try{const{data:a}=await oe({type:"sites"});ea.value=[{label:"所有[所有网站]",value:"ALL"}].concat(a.data.map(e=>({label:e.name+"[".concat(e.ps,"]"),value:e.name})))||[],oa.value&&(e.value.sName="ALL")}catch(a){}})(e),oa.value&&(e.value.name="网站启停[所有]"),oa.value||(ta.value=e.value.special_time.split(",")[0],sa.value=e.value.special_time.split(",")[1],e.value.startTime=ta.value,e.value.stopTime=sa.value)},ra=e(1),{rowData:ia,typeInit:va}=a(_e()),ca=l(()=>!!ia.value.id),pa=l(()=>ia.value&&!ia.value.id),ma=[{value:"all",label:"所有日志"},{value:"system_log",label:"系统日志"},{value:"panel_log",label:"面板日志"},{value:"www_log",label:"网站日志"},{value:"usranalyse_log",label:"堡塔防入侵日志"},{value:"mysql_log",label:"MySQL日志"},{value:"Recycle",label:"回收站日志"},{value:"mail_log",label:"邮件日志"},{value:"php_session",label:"PHP会话日志"},{value:"total_log",label:"网站统计报表日志"},{value:"user_config",label:"用户配置日志"}],da=e=>{be({type:"dir",path:e.value.logText,change:a=>{e.value.logText=e.value.logText+(e.value.logText?"\n":"")+a,e.value.log_cut_path=e.value.logText.split("\n").filter(e=>""!==e).join(","),e.value.name=ba(e.value.logText,1)}})},ba=(e,a)=>{const l=e.split("\n").filter(e=>""!==e);return l.length<=a?"日志清理[".concat(l.join(","),"]"):"日志清理[".concat(l.slice(0,a).join(","),"...等").concat(l.length,"项]")},ha=e=>{va.value=!1,ca.value||pa.value||(ra.value=1,e.value.radioType=1,e.value.name="日志清理"),(ca.value||pa.value)&&(e.value.clearLogType=e.value.sName.split(","),e.value.radioType=""!==e.value.log_cut_path?2:1,ra.value=e.value.radioType,e.value.logText=e.value.log_cut_path.split(",").join("\n"))},ya={class:"flex items-center"},wa={class:"defineClass"},ga={class:"flex items-center"},_a={class:"flex items-center"},fa={class:"flex items-center"},xa={class:"flex items-center"},ka=O(o({__name:"alert-form-item",props:{isEdit:{type:Boolean,default:!1},showKeyword:{type:Boolean,default:!1},showNotice:{type:Boolean,default:!0},needAll:{type:Boolean,default:!1},showSecond:{type:Boolean,default:!1},labelWidth:{default:""},showStopWeb:{type:Boolean,default:!1},stopSite:{type:Boolean,default:!0}},emits:["crontab","siteWeb"],setup(l,{expose:s,emit:u}){const{rowData:o}=a(_e()),U=l,C=e("1"===o.value.stop_site||!1),I=u,j=e(),D=e(0),B=e(!1),E=e([{type:"day",text:"每天",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"day-n",text:"N天",showDay:!0,showHour:!0,showMinute:!0,showSecond:!1},{type:"hour",text:"每小时",showDay:!1,showHour:!1,showMinute:!0,showSecond:!1},{type:"hour-n",text:"N小时",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"minute-n",text:"N分钟",showDay:!1,showHour:!1,showMinute:!0,showSecond:!1},{type:"week",text:"每周",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1},{type:"month",text:"每月",showDay:!0,showHour:!0,showMinute:!0,showSecond:!1},{type:"second-n",text:"N秒",showDay:!1,showHour:!1,showMinute:!1,showSecond:!0},{type:"sweek",text:"自定义",showDay:!1,showHour:!0,showMinute:!0,showSecond:!1}]),q=n({where1:[{validator:(e,a,l)=>{"day-n"===Al.value.type||"month"===Al.value.type?Number.parseInt(a)>31||Number.parseInt(a)<1||!Number.isInteger(parseFloat(a))?l(new Error("请输入1-31的整数")):""===a?l(new Error("请输入天数")):l():l()},trigger:["blur","change"]}],hour:[{validator:(e,a,l)=>{"minute-n"!==Al.value.type&&"hour"!==Al.value.type&&"second-n"!==Al.value.type||l(),Number.parseInt(a)>23||Number.parseInt(a)<0||!Number.isInteger(parseFloat(a))?l(new Error("请输入0-23的整数")):""===a?l(new Error("请输入小时")):"hour-n"===Al.value.type&&0===Number.parseInt(a)?l(new Error("小时不能为0")):l()},trigger:["blur","change"]}],minute:[{validator:(e,a,l)=>{Number.parseInt(a)>59||Number.parseInt(a)<0||!Number.isInteger(parseFloat(a))?l(new Error("请输入0-59的整数")):""===a?l(new Error("请输入分钟")):"minute-n"===Al.value.type&&(Number.parseInt(a)<1||!/^[1-9]\d*$/.test(a))?l(new Error("请输入1-59的整数")):l()},trigger:["blur","change"]}],second:[{validator:(e,a,l)=>{"second-n"===Al.value.type?!Number.isInteger(parseFloat(a))||Number.parseInt(a)>59||Number.parseInt(a)<1?l(new Error("请输入1-59的整数")):""===a?l(new Error("请输入秒")):l():l()},trigger:["blur","change"]}],timeSet:[{validator:(e,a,l)=>{"sweek"!==Al.value.type||a.length?l():l(new Error("请选择时间"))},trigger:"change"}],specialHour:[{validator:(e,a,l)=>{"sweek"!==Al.value.type||a.length?l():l(new Error("请选择小时"))},trigger:"change"}],specialMinute:[{validator:(e,a,l)=>{"sweek"!==Al.value.type||a.length?l():l(new Error("请选择分钟"))},trigger:"change"}]}),M=e=>{Ul.value.notice_channel=e},H=e=>{j.value.clearValidate()},O=e=>{Ul.value.notice=e,1===e&&(Ul.value.notice_channel="all")},F=(e,a=!1)=>{U.isEdit||(Ul.value.notice=0,a&&Ml()),Al.value.type=e,D.value=E.value.findIndex(a=>a.type===e),"minute-n"===Al.value.type&&(Al.value.where1=Al.value.minute),"hour-n"===Al.value.type&&(Al.value.where1=Al.value.hour),"second-n"===Al.value.type?(Ul.value.flock=!1,B.value=!0):B.value=!1,j.value&&j.value.clearValidate(),I("crontab","custom"==e)};r(()=>{F(Al.value.type)}),i(()=>{F(Al.value.type,!0)});const z=e=>{I("siteWeb",e)};return s({validate:()=>{var e;return null==(e=j.value)?void 0:e.validate()},WebStopSite:C}),(e,a)=>{const l=L,s=T,u=V,o=R,n=S,r=N,i=P,U=ye,I=A;return v(),c("div",null,[t(I,{ref_key:"alertFormRef",ref:j,rules:d(q),"label-width":e.labelWidth,inline:!0,model:d(Al),class:"demo-form-inline"},{default:p(()=>[t(u,{class:"!w-full"},{default:p(()=>[t(u,{label:"执行周期"},{default:p(()=>{var n,r,i,_;return[m("div",ya,[t(u,{class:"el-form-item-item"},{default:p(()=>[t(s,{onChange:a[0]||(a[0]=e=>F(d(Al).type,!0)),class:"!w-[8rem]",modelValue:d(Al).type,"onUpdate:modelValue":a[1]||(a[1]=e=>d(Al).type=e)},{default:p(()=>[(v(!0),c(b,null,h(d(E),(a,t)=>(v(),c(b,null,["second-n"!==a.type||e.showSecond?(v(),y(l,{key:t,label:a.text,value:a.type},null,8,["label","value"])):w("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1}),"sweek"==d(Al).type?(v(),c(b,{key:0},[t(u,{class:"el-form-item-item"},{default:p(()=>[t(s,{class:"!w-[8rem]",modelValue:d(Al).timeType,"onUpdate:modelValue":a[2]||(a[2]=e=>d(Al).timeType=e),onChange:H},{default:p(()=>[t(l,{label:"每天",value:"sday"}),t(l,{label:"每周",value:"sweek"}),t(l,{label:"每月",value:"smonth"})]),_:1},8,["modelValue"])]),_:1}),"sweek"===d(Al).timeType?(v(),y(u,{key:0,class:"el-form-item-item",prop:"timeSet"},{default:p(()=>[t(s,{class:"!w-[16rem]",modelValue:d(Al).timeSet,"onUpdate:modelValue":a[3]||(a[3]=e=>d(Al).timeSet=e),multiple:"","collapse-tags":""},{default:p(()=>[t(l,{label:"周一",value:"1"}),t(l,{label:"周二",value:"2"}),t(l,{label:"周三",value:"3"}),t(l,{label:"周四",value:"4"}),t(l,{label:"周五",value:"5"}),t(l,{label:"周六",value:"6"}),t(l,{label:"周日",value:"7"})]),_:1},8,["modelValue"])]),_:1})):w("",!0),"smonth"===d(Al).timeType?(v(),y(u,{key:1,class:"el-form-item-item",prop:"timeSet"},{default:p(()=>[t(s,{class:"!w-[14rem] cycle-select",modelValue:d(Al).timeSet,"onUpdate:modelValue":a[4]||(a[4]=e=>d(Al).timeSet=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:p(()=>[(v(),c(b,null,h(30,(e,a)=>t(l,{key:e,label:e,value:"".concat(e)},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a[17]||(a[17]=m("span",{class:"el-input-group__append cycle-unit"},"号",-1))]),_:1})):w("",!0),t(u,{class:"el-form-item-item",prop:"specialHour"},{default:p(()=>[t(s,{class:"!w-[14rem] cycle-select",modelValue:d(Al).specialHour,"onUpdate:modelValue":a[5]||(a[5]=e=>d(Al).specialHour=e),multiple:"","collapse-tags":""},{default:p(()=>[(v(),c(b,null,h(24,(e,a)=>t(l,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a[18]||(a[18]=m("span",{class:"el-input-group__append cycle-unit"},"点",-1))]),_:1}),t(u,{class:"el-form-item-item",prop:"specialMinute"},{default:p(()=>[t(s,{class:"!w-[14rem] cycle-select",modelValue:d(Al).specialMinute,"onUpdate:modelValue":a[6]||(a[6]=e=>d(Al).specialMinute=e),multiple:"","collapse-tags":""},{default:p(()=>[(v(),c(b,null,h(60,(e,a)=>(v(),c(b,null,[a%5==0?(v(),y(l,{key:a,label:a,value:a},null,8,["label","value"])):w("",!0)],64))),64))]),_:1},8,["modelValue"]),a[19]||(a[19]=m("span",{class:"el-input-group__append cycle-unit"},"分",-1))]),_:1})],64)):(v(),c(b,{key:1},["week"==d(Al).type?(v(),y(u,{key:0,class:"el-form-item-item"},{default:p(()=>[t(s,{class:"!w-[8rem]",modelValue:d(Al).week,"onUpdate:modelValue":a[7]||(a[7]=e=>d(Al).week=e)},{default:p(()=>[t(l,{label:"周一",value:"1"}),t(l,{label:"周二",value:"2"}),t(l,{label:"周三",value:"3"}),t(l,{label:"周四",value:"4"}),t(l,{label:"周五",value:"5"}),t(l,{label:"周六",value:"6"}),t(l,{label:"周日",value:"7"})]),_:1},8,["modelValue"])]),_:1})):w("",!0),(null==(n=d(E)[d(D)])?void 0:n.showDay)?(v(),y(u,{key:1,class:"el-form-item-item",prop:"where1"},{default:p(()=>[t(o,{modelValue:d(Al).where1,"onUpdate:modelValue":a[8]||(a[8]=e=>d(Al).where1=e),min:1,width:"10rem",textType:"天",type:"number"},{append:p(()=>[...a[20]||(a[20]=[g(" 天 ",-1)])]),_:1},8,["modelValue"])]),_:1})):w("",!0),(null==(r=d(E)[d(D)])?void 0:r.showHour)?(v(),y(u,{key:2,class:"el-form-item-item",prop:"hour"},{default:p(()=>[t(o,{modelValue:d(Al).hour,"onUpdate:modelValue":a[9]||(a[9]=e=>d(Al).hour=e),width:"10rem",textType:"小时",max:"23",min:"0",type:"number"},{append:p(()=>[...a[21]||(a[21]=[g(" 小时 ",-1)])]),_:1},8,["modelValue"])]),_:1})):w("",!0),(null==(i=d(E)[d(D)])?void 0:i.showMinute)?(v(),y(u,{key:3,class:"el-form-item-item",prop:"minute"},{default:p(()=>{var e;return[(null==(e=d(E)[d(D)])?void 0:e.showMinute)?(v(),y(o,{key:0,modelValue:d(Al).minute,"onUpdate:modelValue":a[10]||(a[10]=e=>d(Al).minute=e),width:"10rem",max:"59",min:"0",type:"number"},{append:p(()=>[...a[22]||(a[22]=[g(" 分钟 ",-1)])]),_:1},8,["modelValue"])):w("",!0)]}),_:1})):w("",!0),(null==(_=d(E)[d(D)])?void 0:_.showSecond)?(v(),y(u,{key:4,class:"el-form-item-item",prop:"second"},{default:p(()=>{var e;return[(null==(e=d(E)[d(D)])?void 0:e.showSecond)?(v(),y(o,{key:0,modelValue:d(Al).second,"onUpdate:modelValue":a[11]||(a[11]=e=>d(Al).second=e),width:"10rem",max:"59",min:"0",type:"number"},{append:p(()=>[...a[23]||(a[23]=[g(" 秒 ",-1)])]),_:1},8,["modelValue"])):w("",!0)]}),_:1})):w("",!0)],64))])]}),_:1}),m("div",wa,[t(u,{label:" ",class:"!mt-0 defineClass"},{default:p(()=>[m("div",ga,[t(n,{modelValue:d(Ul).flock,"onUpdate:modelValue":a[12]||(a[12]=e=>d(Ul).flock=e),disabled:d(B)},{default:p(()=>[...a[24]||(a[24]=[g(" 开启进程锁",-1)])]),_:1},8,["modelValue","disabled"]),t(r,{placement:"right-start",width:"440","popper-class":"white-tips-popover",trigger:"hover",content:""},{default:p(()=>[...a[25]||(a[25]=[m("div",{class:"p-12x"},[m("span",{class:"text-[#666]"}," 在同一时间内只用一个进程在执行，若上一个进程未执行结束，下一次不执行 ")],-1),m("i",{slot:"reference",class:"el-icon-question text-warning ml-12x"},null,-1)])]),_:1})])]),_:1}),e.showStopWeb?(v(),y(u,{key:0,label:" ",class:"!mt-0 defineClass"},{default:p(()=>[m("div",_a,[t(n,{modelValue:d(C),"onUpdate:modelValue":a[13]||(a[13]=e=>_(C)?C.value=e:null),onChange:z},{default:p(()=>[...a[26]||(a[26]=[g(" 网站停用时是否停止备份",-1)])]),_:1},8,["modelValue"]),t(r,{placement:"right-start",width:"220","popper-class":"white-tips-popover",trigger:"hover",content:""},{reference:p(()=>[...a[27]||(a[27]=[m("i",{class:"svgtofont-el-question-filled text-warning ml-[12px]"},null,-1)])]),default:p(()=>[a[28]||(a[28]=m("span",{class:"text-[#666]"}," 该功能不支持反向代理和html项目 ",-1))]),_:1})])]),_:1})):w("",!0)])]),_:1}),f(e.$slots,"center",{},void 0,!0),e.showNotice?(v(),y(u,{key:0,label:"备份提醒",prop:"notice",class:"!mt-1.6rem"},{default:p(()=>[m("div",fa,[t(i,{class:"!w-[20rem]",modelValue:d(Ul).notice,"onUpdate:modelValue":a[14]||(a[14]=e=>d(Ul).notice=e),options:d(xl),onChange:O},null,8,["modelValue","options"]),1===d(Ul).notice?(v(),y(u,{key:0,label:"消息通道"},{default:p(()=>[t(U,{modelValue:d(Ul).notice_channel,"onUpdate:modelValue":a[15]||(a[15]=e=>d(Ul).notice_channel=e),"is-show-api":!1,multiple:!1,"all-alarm":!0,onChange:M,class:"!w-16rem"},null,8,["modelValue"])]),_:1})):w("",!0),x(t(u,{label:"关键词匹配",class:"!mt-0"},{default:p(()=>[m("div",xa,[t(r,{placement:"top-start",width:"290","popper-class":"white-tips-popover",trigger:"focus",content:""},{default:p(()=>[a[29]||(a[29]=m("div",{class:"p-[12px]"},[m("div",null,[g("1、在shell程序中不要"),m("span",{class:"text-danger"},"中断"),g("执行如（exit等）")]),m("div",null,[g("2、输出"),m("span",{class:"text-danger"},"关键词"),g("（建议5位且程序中不会出现）")]),m("div",null,[g("3、匹配到关键词"),m("span",{class:"text-danger"},"发送告警")])],-1)),t(o,{slot:"reference",class:"mr-[4px]",modelValue:d(Ul).keyword,"onUpdate:modelValue":a[16]||(a[16]=e=>d(Ul).keyword=e),disabled:e.isEdit,width:"16rem",placeholder:"请输入关键词",type:"text"},null,8,["modelValue","disabled"])]),_:1})])]),_:1},512),[[k,e.showKeyword&&1===d(Ul).notice]])])]),_:1})):w("",!0),f(e.$slots,"bottom",{},void 0,!0)]),_:3},8,["rules","label-width","model"])])}}}),[["__scopeId","data-v-426db468"]]),La={class:"flex items-center"},Ta={class:"text-[1.2rem] text-[#666] flex items-center"},Va=o({__name:"file-split-item",props:{rowData:{default:()=>{}},isEnterprise:{type:Boolean,default:!1}},setup(a){const l=a,s=[{name:"不拆分",value:"0"},{name:"按文件大小拆分",value:"size"},{name:"按数量拆分",value:"num"}],u=e(l.rowData.split_type||"0"),o=e(Boolean(l.rowData.save_local)||!1),n=e=>{"num"==e?Cl.value.split_value=5:"size"==e&&(Cl.value.split_value=1024),Cl.value.split_type=e},r=e=>{Cl.value.save_local=Number(e)},i=e=>{Cl.value.split_value=Number(e.target.value)};return(e,a)=>{const l=L,f=T,x=R,k=V,N=S;return v(),c("div",null,[e.isEnterprise?w("",!0):(v(),y(k,{key:0,label:"文件拆分",class:"!mb-[14px]"},{default:p(()=>[m("div",La,[t(f,{modelValue:d(u),"onUpdate:modelValue":a[0]||(a[0]=e=>_(u)?u.value=e:null),class:"mr-[4px] !w-[13rem]",onChange:n},{default:p(()=>[(v(),c(b,null,h(s,e=>t(l,{key:e.value,label:e.name,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),"0"!==d(u)?(v(),c("div",{key:0,onInput:i,class:"text-[1.2rem] flex items-center"},[t(x,{modelValue:d(Cl).split_value,"onUpdate:modelValue":a[1]||(a[1]=e=>d(Cl).split_value=e),type:"number",width:"14rem"},{append:p(()=>[g(U("num"==d(u)?"个":"MB"),1)]),_:1},8,["modelValue"])],32)):w("",!0),a[3]||(a[3]=m("span",{class:"text-[#666] text-[1.2rem] leading-8 ml-8x"},"*为避免文件过大导致上传失败，可以选择按大小或数量拆分。仅文件超过 5GB 时支持拆分，小文件请忽略 ",-1))])]),_:1})),t(k,{label:"备份设置"},{default:p(()=>[m("div",Ta,[t(N,{modelValue:d(o),"onUpdate:modelValue":a[2]||(a[2]=e=>_(o)?o.value=e:null),class:"!mr-12x",onChange:r},{default:p(()=>[...a[4]||(a[4]=[g(" 同时保留本地备份（和云存储保留份数一致） ",-1)])]),_:1},8,["modelValue"])])]),_:1})])}}}),{panel:Sa}=F(),{backupPath:Na}=C(Sa.value),{rowData:Aa,typeInit:Ua}=a(_e()),Ca=l(()=>!!Aa.value.id),Ia=l(()=>!Aa.value.id&&!Aa.value),ja=e(Na.value),Da=e([]),Ba=e=>{be({type:"dir",path:e.value.sName,change:a=>{e.value.sName=a,e.value.name="备份目录[".concat(a,"]")}})},Ea=e=>{Ua.value=!1,Ia.value&&(e.value.db_backup_path=ja.value,e.value.save=3,e.value.sName="/www/wwwroot",e.value.name="备份目录[/www/wwwroot]",e.value.more="ALL"),(async e=>{var a,l,s;try{const{data:u}=await oe({type:"sites"});Da.value=u.orderOpt.map(e=>({label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:e=>t("div",{class:"flex items-center justify-between"},[t("span",null,[e.label]),t("span",{onClick:()=>{we({name:e.value})},class:"float-right cursor-pointer text-[1.2rem] text-danger ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])})),Da.value&&"localhost"===(null==(a=Da.value[0])?void 0:a.value)||null==(l=Da.value)||l.unshift({label:"服务器磁盘",value:"localhost"}),Ia.value&&(e.value.backupTo=null==(s=Da.value)?void 0:s[0].value)}catch(u){}})(e)},{panel:qa}=F(),{backupPath:Ma}=C(qa.value),{rowData:Ha,typeInit:Ra}=a(_e()),Pa=e([]),Oa=e([{label:"所有[所有网站]",value:"ALL"}]),Fa=l(()=>!!Ha.value.id),za=l(()=>!Ha.value.id&&!Ha.value),Ga=e=>{try{return!("localhost"!==e.value.backupTo&&!Cl.value.save_local)}catch(a){}},Wa=e=>{Ra.value=!1,za.value&&(e.value.name="备份网站[ 所有 ]",e.value.save=3,e.value.db_backup_path=Ma.value,e.value.more="ALL"),(async e=>{var a,l,s;try{const{data:u}=await oe({type:"sites"});Pa.value=u.orderOpt.map(e=>({label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:e=>t("div",{class:"flex items-center justify-between"},[t("span",null,[e.label]),t("span",{onClick:()=>{we({name:e.value})},class:"float-right cursor-pointer text-[1.2rem] text-danger ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])})),Pa.value&&"localhost"===(null==(a=Pa.value[0])?void 0:a.value)||null==(l=Pa.value)||l.unshift({label:"服务器磁盘",value:"localhost"}),za.value&&(e.value.backupTo=null==(s=Pa.value)?void 0:s[0].value),Oa.value=[{label:"所有[所有网站]",value:"ALL"}].concat(u.data.map(e=>({label:e.name+"".concat(e.ps?"[".concat(e.ps,"]"):""),value:e.name})))||[],za.value&&(e.value.sName="ALL")}catch(u){}})(e)},Qa=e=>{be({type:"dir",path:e.value.db_backup_path,change:a=>{e.value.db_backup_path=a}})},{panel:Ka}=F(),{backupPath:$a}=C(Ka.value),{rowData:Ja,typeInit:Xa}=a(_e()),Ya=e([]),Za=e([{label:"所有[所有数据]",value:"ALL"}]),el=e(!1),al=e([]),ll=l(()=>!!Ja.value.id),tl=l(()=>!Ja.value.id&&!Ja.value),sl=[{value:"mysql",label:"MySQL"},{value:"mongodb",label:"MongoDB"},{value:"redis",label:"Redis"},{value:"pgsql",label:"PgSQL"}],ul=async e=>{Xa.value=!1,(async e=>{var a,l,s;try{const{data:u}=await oe({type:"sites"});Ya.value=u.orderOpt.map(e=>({label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:e=>t("div",{class:"flex items-center justify-between"},[t("span",null,[e.label]),t("span",{onClick:()=>{we({name:e.value})},class:"float-right text-[1.2rem] text-danger cursor-pointer ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])})),Ya.value&&"localhost"===(null==(a=Ya.value[0])?void 0:a.value)||null==(l=Ya.value)||l.unshift({label:"服务器磁盘",value:"localhost"}),tl.value&&(e.value.backupTo=null==(s=Ya.value)?void 0:s[0].value)}catch(u){}})(e),tl.value?(e.value.name="备份mysql数据库[ 所有 ]",e.value.db_type="mysql",e.value.backup_mode=0,e.value.sName="ALL",e.value.db_backup_path=$a.value,e.value.save=3,e.value.more="ALL",e.value.table_list="ALL",await ol("mysql"),e.value.table_list=al.value[0].value):""===e.value.table_list?e.value.table_list="ALL":e.value.table_list},ol=async e=>{var a,l;try{const t=await ie({db_type:e});Za.value=t.data.map(e=>({label:e.name+(e.ps?"[".concat(e.ps,"]"):""),value:e.name,table_list:e.table_list})),al.value=null==(a=Za.value[0].table_list)?void 0:a.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value})),null==(l=Za.value)||l.unshift({label:"所有[所有数据]",value:"ALL"})}catch(t){}},nl=e=>{be({type:"dir",path:e.value.db_backup_path,change:a=>{e.value.db_backup_path=a}})},rl=e([]),il=e([]),vl=e([]),{rowData:cl,typeInit:pl}=a(_e()),ml=l(()=>!!cl.value.id),dl=l(()=>!cl.value.id&&cl.value),bl=l(()=>!cl.value.id&&!cl.value),hl=e=>{pl.value=!1,bl.value?(e.value.name="[勿删]数据库增量备份[ --/-- ]",e.value.more="ALL"):(e.value.db_name=e.value.sName,e.value.tb_name=""===e.value.sBody?"ALL":e.value.sBody),(async e=>{var a,l,s;try{const{data:u}=await oe({type:"sites"});rl.value=u.orderOpt.map(e=>({label:e.name,value:e.value,status:Boolean(e.status),disabled:"localhost"!==e.value&&!e.status,render:e=>t("div",{class:"flex items-center justify-between"},[t("span",null,[e.label]),t("span",{onClick:()=>{we({name:e.value})},class:"float-right cursor-pointer text-[1.2rem] text-danger ml-12px ".concat("localhost"!==e.value?"":"!hidden")},[e.status?"":"[未配置]"])])})),rl.value&&"localhost"===(null==(a=rl.value[0])?void 0:a.value)||null==(l=rl.value)||l.unshift({label:"服务器磁盘",value:"localhost"}),bl.value&&(e.value.backupTo=null==(s=rl.value)?void 0:s[0].value)}catch(u){}})(e),yl(e)},yl=async e=>{var a,l,t,s,u,o;try{const{data:n}=await ve();il.value=n.data.map(e=>({label:e.name,value:e.name,table_list:e.table_list})),vl.value=(null==(a=n.data[0].table_list)?void 0:a.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value})))||[{label:"所有",value:"ALL"}],il.value.length>0&&bl.value?(e.value.db_name=null==(l=il.value[0])?void 0:l.value,e.value.tb_name=null==(t=vl.value[0])?void 0:t.value,e.value.name="[勿删]数据库增量备份[ ".concat(il.value[0].label," - ").concat(null==(s=vl.value[0])?void 0:s.label," ]")):ml.value||bl.value||(vl.value=null==(o=null==(u=il.value.find(a=>a.value===e.value.db_name))?void 0:u.table_list)?void 0:o.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value})))}catch(n){}},{payment:wl}=F(),{rowData:gl,typeInit:_l}=a(_e()),fl=[{value:"toShell",label:"Shell脚本"},{value:"site",label:"备份网站"},{value:"database",label:"备份数据库"},{label:"数据库增量备份",value:"enterpriseBackup",render:e=>t("div",{class:"flex items-center"},[t("span",null,[g("数据库增量备份")]),t("i",{class:"svgtofont-icon-ltd ml-[0.4rem] text-[#A88E5F] text-[1.4rem]"},null)])},{value:"logs",label:"网站日志切割"},{value:"path",label:"备份目录"},{value:"webshell",label:"木马查杀"},{value:"sync_time",label:"同步时间"},{value:"rememory",label:"释放内存"},{value:"toUrl",label:"访问URL-GET"},{value:"to_post",label:"访问URL-POST"},{value:"site_restart",label:"网站启停"},{value:"log_cleanup",label:"定时清理日志"}],xl=[{label:"不接收任何消息通知",value:0},{label:"任务执行失败接收通知",value:1}],kl=e=>["site","database","enterpriseBackup","path"].includes(e),Ll=e=>!isNaN(Number(e))&&Number(e)<10?"0"+e:e,Tl=l(()=>{var e,a,l,t,s;let u="",o={1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",7:"周日"},n=Al.value.type,r=(null==(e=Al.value.hour)?void 0:e.toString())||"--",i=(null==(a=Al.value.minute)?void 0:a.toString())||"--",v=(null==(l=Al.value.where1)?void 0:l.toString())||"--",c=(null==(t=Al.value.week)?void 0:t.toString())||"--",p=(null==(s=Al.value.second)?void 0:s.toString())||"--";if(["day","day-n","hour","week","month","minute-n","hour-n","second-n"].includes(n)){const e="".concat(Ll(r),":").concat(Ll(i)," 执行一次");switch(n){case"day":u="每天的 ".concat(e);break;case"day-n":u="每隔 ".concat(v," 天的 ").concat(e);break;case"hour":u="每小时的第 ".concat(i," 分钟执行一次");break;case"week":u="每周 ".concat(o[c]," 的 ").concat(e);break;case"month":u="每月 ".concat(v," 号 ").concat(e);break;case"minute-n":u="每小时的第0分钟开始，每隔 ".concat(i," 分钟执行一次");break;case"hour-n":u="每天0点开始，每隔 ".concat(r," 小时的第 ").concat(i," 分钟执行一次");break;case"second-n":u="每隔 ".concat(p," 秒执行一次")}}else u="";return u}),Vl=e(),Sl=e=>{const a="toShell"===e||"toUrl"===e||"to_post"===e;return ee("",()=>t(ka,{ref:e=>Vl.value=e,showNotice:kl(e),showKeyword:"toShell"===e,showStopWeb:"site"===e,showSecond:a,isEdit:!!gl.value},{center:()=>Tl.value?t("div",{class:"text-1.2rem ml-[10rem] mt-[1.6rem] leading-[1rem]",innerHTML:Tl.value},null):null,bottom:()=>Ul.value.notice&&["site","database","path"].includes(e)?t("div",{class:"text-1.2rem ml-10rem mt-1.2rem leading-[1rem]"},[g("检查到磁盘剩余空间小于备份文件的 5 倍或者小于 1GB 时会发送磁盘不足的提示")]):null}))},Nl=e=>ee("",()=>t(Va,{rowData:gl.value,isEnterprise:"enterpriseBackup"===e},null)),Al=e({type:"day",week:"1",hour:"1",minute:"30",second:"5",where1:"1",timeSet:["1"],timeType:"sday",specialHour:[0],specialMinute:[0]}),Ul=e({notice:0,notice_channel:"all",keyword:"",flock:!0}),Cl=e({split_value:5,split_type:"0",save_local:0}),Il=(e,a,l)=>{const t=Number(a);t<0||0===t?l(new Error("请输入不为0的数字")):l()},jl=e=>{let a=e.value.sType;switch(a||(a="toShell"),a){case"toShell":return l=e,[Q("执行用户","user",xe.value,{attrs:{class:"!w-[30rem]",placeholder:"默认使用root用户执行"}}),K([$("脚本内容","sBody",{attrs:{class:"w-[60rem]",rows:10,resize:"none",placeholder:"请输入脚本内容"},rules:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]}),J("选择脚本",{attrs:{class:"!ml-4px",onClick:()=>ke(l)}})]),X("温馨提示",[{content:"为了保证服务器的安全稳定，shell脚本中以下命令不可使用：shutdown, init 0, mkfs, passwd, chpasswd, --stdin, mkfs.ext, mke2fs"}])];case"logs":return(e=>(Te.value&&Ue(e),[Y("存储路径","log_cut_path",{attrs:{class:"w-[36rem]"},rules:[{required:!0,message:"请输入存储路径",trigger:"blur"}]},()=>Ae(e)),K([Q("切割日志","sName",Ne.value,{attrs:{class:"!w-[16rem] mr-[8px]",disabled:Ve.value,onChange:a=>{e.value.name="切割日志["+("ALL"===a?"全部":a)+"]"}}}),Z("","save","份",{attrs:{class:"w-[14rem]"},rules:[{required:!0,message:"请输入不为0的正整数",trigger:"blur"}]}),X("温馨提示",[{content:"只切分项目的访问日志，如需对项目日志进行切分，请前往【网站-**项目-项目日志】进行配置"},{content:"日志切割后会在选择的目录下产生/history_backups文件夹，切割后的日志存储在这个文件夹中"}])])]))(e);case"webshell":return(e=>(Ie.value&&Ee(e),[Q("查杀站点","sName",je.value,{attrs:{class:"!w-[300px]",disabled:De.value,onChange:a=>{e.value.name="木马查杀["+("ALL"===a?"全部":a)+"]"}}}),he("消息通道","urladdress",{attrs:{placeholder:"请选择消息通道",isShowApi:!1,isDefault:!0,isShowAll:!1,limit:["sms"],multiple:!1,class:"!w-[300px]"}})]))(e);case"sync_time":return(e=>(Me.value&&Oe(e),[ee("时区选择",()=>t(s,{class:"w-[32rem]",options:He.value,modelValue:Re.value,props:{expandTrigger:"hover"},onChange:a=>{e.value.name="定期同步服务器时间[".concat(a[0],"/").concat(a[1],"]"),e.value.sName="".concat(a[0],"/").concat(a[1]),Re.value=[a[0],a[1]],e.value.region=a[0],e.value.zone=a[1]}},null)),X("温馨提示",[{content:"默认从NTP服务器同步时间，失败时将同步bt.cn的服务器时间。"}])]))(e);case"rememory":return!gl.value&&(e.value.name="释放内存"),[X("温馨提示",[{content:"释放PHP、MYSQL、PURE-FTPD、APACHE、NGINX的内存占用,建议在每天半夜执行!"}])];case"toUrl":return(e=>(ze.value&&(e.value.name="访问URL-[ http:// ]",e.value.urladdress="http://"),[K([ae("URL地址","urladdress",{attrs:{placeholder:"请输入URL地址",class:"!w-[30rem]",onInput:a=>{e.value.name="访问URL-[ ".concat(a," ]")}},rules:[{required:!0,message:"请输入URL地址",trigger:"blur"}]}),J("测试URL",{attrs:{class:"!ml-4px",onClick:()=>Ge(e)}})]),$("User-Agent","user_agent",{attrs:{placeholder:"请输入User-Agent",class:"w-[60rem]"}})]))(e);case"to_post":return(e=>(Ke.value&&(e.value.name="访问URL-POST[ http:// ]",e.value.urladdress="http://"),[ae("URL地址","urladdress",{attrs:{placeholder:"请输入URL地址",class:"!w-[30rem]",onInput:a=>{e.value.name="访问URL-POST[ ".concat(a," ]")}},rules:[{required:!0,message:"URL地址不可为空",trigger:["blur","input"]},{validator:(e,a,l)=>{"http://"===a||"https://"===a?l(new Error("输入内容不可为空")):l()},trigger:["blur","input"]}]}),$("User-Agent","user_agent",{attrs:{placeholder:"请输入User-Agent",class:"w-[60rem]"}})]))(e);case"site_restart":return(e=>(la.value&&na(e),[Q("网站","sName",ea.value,{attrs:{class:"!w-[30rem]",disabled:ua.value,onChange:a=>{e.value.name="网站启停["+("ALL"===a?"所有":a)+"]"}}}),K([ee("开启时间",()=>t(u,{"prefix-icon":"none",clearable:!0,placeholder:"请选择开启时间",class:"!w-22rem",modelValue:ta.value,"onUpdate:modelValue":e=>ta.value=e,onChange:a=>{ta.value=a,e.value.startTime=a,e.value.special_time="".concat(ta.value,",").concat(sa.value)},start:"00:00",step:"00:05",end:"23:59"},null),"startTime",{rules:[{required:!0,message:"请选择开启时间",trigger:"change"}]}),ee("停止时间",()=>t(u,{"prefix-icon":"none",clearable:!0,placeholder:"请选择停止时间",class:"!w-22rem",modelValue:sa.value,"onUpdate:modelValue":e=>sa.value=e,onChange:a=>{sa.value=a,e.value.stopTime=a,e.value.special_time="".concat(ta.value,",").concat(sa.value)},start:"00:00",step:"00:05",end:"23:59"},null),"stopTime",{rules:[{required:!0,message:"请选择停止时间",trigger:"change"}]})]),X("温馨提示",[{content:"执行周期为每天一次"}])]))(e);case"log_cleanup":return(e=>(va.value&&ha(e),[le("清理类型","radioType",[{label:"选择类型",value:1},{label:"自定义路径",value:2}],{attrs:{disabled:ca.value,onChange:a=>{ra.value=a,e.value.radioType=a,e.value.clearLogType=[],e.value.sName="",e.value.name="日志清理",1===a&&(e.value.sName="user_config")}}}),1===ra.value?Q(" ","clearLogType",ma,{attrs:{multiple:!0,disabled:ca.value,class:"!w-[30rem]",placeholder:"请选择日志类型",onChange:a=>{e.value.clearLogType=a,e.value.sName=a.join(",");const l=a.map(e=>{var a;return null==(a=ma.find(a=>a.value===e))?void 0:a.label});e.value.name=a.length<=2?"日志清理[".concat(l.join(","),"]"):"日志清理[".concat(l.slice(0,2).join(","),"...等").concat(l.length,"项]")}},rules:[{required:!0,message:"请选择日志类型",trigger:"change"}]}):K([$(" ","logText",{attrs:{class:"!w-[32rem]",disabled:ca.value,placeholder:"请选择或输入自定义目录，一行一个",onInput:a=>{e.value.logText=a,e.value.log_cut_path=a.split("\n").filter(e=>""!==e).join(","),e.value.name=ba(a,2)}},rules:[{required:!0,message:"请输入自定义目录",trigger:"blur"}]}),J("添加目录",{attrs:{disabled:ca.value,class:"!ml-8px",onClick:()=>da(e)}})]),X("温馨提示",[{content:"自定义选择的目录支持切割的日志类型有：.log、.txt、.out、.err、.log.1"}])]))(e);case"path":return(e=>(Ua.value&&Ea(e),[K([Y("备份目录","sName",{attrs:{disabled:Ca.value,placeholder:"请输入备份目录",class:"!w-[30rem]",onInput:a=>{e.value.name="备份目录[".concat(a,"]")}},rules:[{required:!0,message:"请输入备份目录",trigger:"blur"}]},()=>!Ca.value&&Ba(e)),Q("备份到","backupTo",Da.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[16rem]"}}),Z("保留最新","save","份",{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"w-[14rem]"},rules:[{required:!0,message:"保留最新份数不可为空",trigger:"blur"},{validator:Il,trigger:"blur"}]})]),e.value.backupTo&&"localhost"!==e.value.backupTo?Nl(e.value.sType):null,$("排除目录","sBody",{attrs:{rows:10,resize:"none",class:"w-[60rem]",placeholder:"每行一条规则,目录不能以/结尾，\n 示例：data/config.php \n static/upload \n *.log,"}})]))(e);case"site":return(e=>(Ra.value&&Wa(e),[K([Q("备份网站","sName",Oa.value,{attrs:{placeholder:"请选择备份网站",class:"!w-[30rem]",disabled:Fa.value,onChange:a=>{e.value.name="备份网站[ ".concat("ALL"===a?"所有":a," ]")}}}),Q("备份到","backupTo",Pa.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[16rem]"}}),Z("保留最新","save","份",{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"w-[14rem]"},rules:[{required:!0,message:"保留最新份数不可为空",trigger:"blur"},{validator:Il,trigger:"blur"}]})]),e.value.backupTo&&"localhost"!==e.value.backupTo?Nl(e.value.sType):null,Ga(e)&&Y("备份路径","db_backup_path",{attrs:{placeholder:"请输入备份路径",class:"!w-[30rem]"},rules:[{required:!0,message:"备份路径不可为空",trigger:"blur"}]},()=>Qa(e)),$("排除规则","sBody",{attrs:{rows:10,resize:"none",class:"w-[60rem]",placeholder:"每行一条规则,目录不能以/结尾，\n 示例：data/config.php \n static/upload \n *.log,"}})]))(e);case"database":return(e=>{var a;return Xa.value&&ul(e),[K([Q("数据库","db_type",sl,{attrs:{class:"!w-[9rem]",disabled:ll.value,onChange:a=>{ol(a),e.value.name="备份".concat(a,"数据库[ 所有 ]"),e.value.sName="ALL",e.value.table_list="ALL"}}}),Q("数据库","sName",Za.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[16rem]",disabled:ll.value,onChange:a=>{var l,t;e.value.sName=a,"ALL"===a?e.value.name="备份".concat(e.value.db_type,"数据库[ 所有 ]"):(al.value=null==(t=null==(l=Za.value.find(e=>e.value===a))?void 0:l.table_list)?void 0:t.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value})),e.value.name="备份".concat(e.value.db_type,"数据库[ ").concat(a," ]"))}}}),Q("","table_list",al.value,{attrs:{disabled:ll.value,class:"!w-[16rem] ml-8px"+("ALL"!==e.value.sName&&(null==(a=al.value)?void 0:a.length)&&"mysql"===e.value.db_type?"":" !hidden"),onChange:a=>{e.value.name="备份".concat(e.value.db_type,"数据库[ ").concat(e.value.sName," - ").concat(a," ]")}}}),Q("备份到","backupTo",Ya.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[12rem]"}}),Z("保留最新","save","份",{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"w-[10rem]"},rules:[{required:!0,message:"保留最新份数不可为空",trigger:"blur"},{validator:Il,trigger:"blur"}]})]),e.value.backupTo&&"localhost"!==e.value.backupTo?Nl(e.value.sType):null,Y("备份路径","db_backup_path",{attrs:{class:"!w-[42rem]"},rules:[{required:!0,message:"备份路径不可为空",trigger:"blur"}]},()=>nl(e)),ee(" ",()=>t("div",{class:"text-[1.2rem] text-[#666] flex items-center h-full"},[t(S,{class:"!mr-[12px]",modelValue:el.value,"onUpdate:modelValue":e=>el.value=e,onChange:()=>{e.value.backup_mode=el.value?1:0}},{default:()=>[g("使用数据库对应账号备份")]}),t("span",{class:"text-[#999] text-[1.2rem]"},[g(" *注意：目前只支持mysql数据库的本地数据库备份 ")])])),X("温馨提示",[{content:"远程数据库不支持备份表"}])]})(e);case"enterpriseBackup":return(e=>(pl.value&&hl(e),[K([Q("备份数据库","db_name",il.value,{attrs:{class:"!w-[20rem] mr-8px",disabled:ml.value,onChange:a=>{var l;e.value.tb_name="ALL",e.value.name="[勿删]数据库增量备份[ ".concat(a," - 所有 ]"),vl.value=null==(l=il.value.find(e=>e.value===a))?void 0:l.table_list.map(e=>({label:e.tb_name,value:""===e.value?"ALL":e.value}))}}}),vl.value&&Q("","tb_name",vl.value,{attrs:{disabled:ml.value,class:"!w-[20rem]",onChange:a=>{var l;const t=null==(l=il.value.find(a=>a.value===e.value.db_name))?void 0:l.label;e.value.name="[勿删]数据库增量备份[ ".concat(t," - ").concat("ALL"===a?"所有":a," ]")}}}),Q("备份到","backupTo",rl.value,{labelAttrs:{class:"el-small-label ml-8px"},attrs:{class:"!w-[16rem]"}})]),e.value.backupTo&&"localhost"!==e.value.backupTo?Nl(e.value.sType):null,(bl.value||dl.value)&&te("压缩密码","zip_password",{attrs:{class:"w-[32rem]",placeholder:"请输入压缩密码"}},()=>{e.value.zip_password=z(16)}),X("温馨提示",[{content:'<span class="text-[#ef0808]">注意：请牢记压缩密码，以免因压缩密码导致无法恢复和下载数据</span>',isHtml:!0},{content:"【使用提醒】当前数据库暂不支持SQLServer、MongoDB、Redis、PgSQL备份"}])]))(e);default:return()=>[]}var l},Dl=e=>("log_cleanup"===e.sType?(1===e.radioType&&(e.log_cut_path=""),delete e.radioType,delete e.clearLogType,delete e.logText):"site_restart"===e.sType&&(delete e.startTime,delete e.stopTime),delete e.specialHour,delete e.specialMinute,delete e.echo,delete e.type_zh,delete e.type_name,delete e.sort,delete e.cycle,delete e.rname,e),Bl=async e=>{if("ltd"!==wl.value.authType&&"enterpriseBackup"===e.sType)return ge({sourceId:53}),!1;let a=H.load("正在提交，请稍候...");try{const a="enterpriseBackup"===e.sType,l=(e=>{var a;let l={name:"",sType:"toShell",sBody:"",sName:"",backupTo:"",save:"",urladdress:"",save_local:0,notice:0,notice_channel:"",datab_name:e.db_name||"",tables_name:e.tb_name||"",keyword:"",flock:1,version:"",user:"",...e,stop_site:Number(null==(a=Vl.value)?void 0:a.WebStopSite)||0,...Al.value};if(l=Object.assign(l,Ul.value),l.flock=Number(Ul.value.flock),"sweek"===l.type){l.where1="5",l.hour="1",l.minute="5",l.week="1";let e=[];l.specialHour.forEach(a=>{l.specialMinute.forEach(l=>{e.push((a<10?"0"+a:a)+":"+(l<10?"0"+l:l)),e=Array.from(new Set(e))})}),l.special_time=e.join(","),l.time_set=l.timeSet,l.time_type=l.timeType,delete l.timeSet,delete l.timeType}return"site_restart"===e.sType&&(l.minute="5",l.where1="5",l.type="sweek"),"second-n"!==Al.value.type&&delete l.second,"to_post"===e.sType&&(l.post_param=JSON.stringify(We.value)),["database","enterpriseBackup","site","path"].includes(e.sType)&&!G(Cl.value.split_value)&&(l=Object.assign(l,Cl.value)),Dl(l)})(e);if(a)return await El(l);{let e;return e=gl.value.id?await ce(l):await pe(l),ql(e),H.request(e),e.status&&fe(),e.status}}catch(l){}finally{a.close()}},El=async e=>{try{const a=gl.value.id;"ALL"===e.tb_name&&(e.tb_name="");const l=a?await de(e):await me(e);return H.request(l),fe(),l.status}catch(a){}},ql=e=>{e.msg.includes("系统加固")&&E({title:"临时关闭系统加固",area:44,component:()=>q(()=>import("./index421.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),showFooter:!0})},Ml=()=>{Object.assign(Al.value,{type:"day",week:"1",hour:"1",minute:"30",second:"5",where1:"1",timeSet:["1"],timeType:"sday",specialHour:[0],specialMinute:[0]}),Object.assign(Ul.value,{notice:0,notice_channel:"",keyword:"",flock:!0})},Hl={class:"p-2rem"},Rl={class:"w-[60rem]"},Pl=["onClick"],Ol=O(o({__name:"index",setup(e,{expose:s}){const{rowData:u,typeInit:o}=a(_e()),n=l(()=>["logs","webshell","site_restart","path","site","database","enterpriseBackup"].includes(_.value.sType)),r=l(()=>!["site_restart"].includes(_.value.sType)),i=l(()=>u.value&&u.value.id),b=l(()=>u.value&&!u.value.id),{BtForm:h,param:_,submit:f,clearValidate:x}=W({data:()=>u.value?((()=>{const e=gl.value.special_time.split(",");let a=[],l=[];e.forEach(e=>{a.push(parseInt(e.split(":")[0])||0),l.push(parseInt(e.split(":")[1])||0),a=Array.from(new Set(a)),l=Array.from(new Set(l))});const t=gl.value.timeSet?gl.value.timeSet.split(","):gl.value.time_set?gl.value.time_set.split(","):["1"];Al.value={type:gl.value.type,hour:gl.value.where_hour,minute:gl.value.where_minute,where1:gl.value.where1,week:gl.value.where1,timeType:gl.value.timeType||gl.value.time_type,timeSet:t,specialHour:a,specialMinute:l,second:gl.value.second||"5"};const s=["notice","notice_channel","keyword","flock"];for(let u in Ul.value)s.includes(u)&&(Ul.value[u]=gl.value[u],"flock"===u&&(Ul.value[u]=1===gl.value[u]));Cl.value={split_value:gl.value.split_value,split_type:gl.value.split_type,save_local:Number(gl.value.save_local)}})(),"to_post"===u.value.sType&&(We.value=JSON.parse(u.value.post_param)),{...u.value,sType:"mysql_increment_backup"===u.value.sType?"enterpriseBackup":u.value.sType,name:u.value.rname||u.value.name}):{sType:"toShell",name:""},options:e=>l(()=>[K([Q("任务类型","sType",fl,{attrs:{clearable:!1,class:"!w-[30rem]",disabled:i.value||b.value,onChange:()=>{x(),o.value=!0,e.value.name=""}}}),se(()=>t(N,{placement:"top-start",width:"260","popper-class":"green-tips-popover",trigger:"hover"},{default:()=>t("div",null,[t("span",{class:"text-[#fff]"},[g("任务类型包含以下部分：Shell脚本、备份网站、备份数据库、数据库增量备份、网站日志切割、自定义日志切割、释放内存、访问URL-GET、访问URL-POST、备份目录、木马查杀、同步时间")])]),reference:()=>t("i",{class:"inline-block svgtofont-el-question-filled text-warning ml-[12px] mt-8px"},null)}))]),ae("任务名称","name",{attrs:{placeholder:"请输入计划任务名称",disabled:n.value&&!i.value&&!b.value,class:"w-[30rem]"},rules:[{required:!0,message:"请输入计划任务名称",trigger:"blur"}]}),r.value?Sl(e.value.sType):null,...jl(e),{type:"slots",key:"custom"}]),submit:async(e,a,l)=>{var t;return await a(),await(null==(t=Vl.value)?void 0:t.validate()),await Bl(e.value)}});return s({onConfirm:f}),I(()=>{_e().$resetForm(),Ml()}),(e,a)=>{const l=R,s=j,u=D,o=B,n=V;return v(),c("div",Hl,[t(d(h),null,{custom:p(()=>["to_post"===d(_).sType?(v(),y(n,{key:0,label:"参数配置"},{default:p(()=>[m("div",Rl,[t(u,{ref_key:"paramTableRef",ref:Je,class:"param-table",data:d(We),"row-class-name":d($e),"max-height":"200",onSelectionChange:d(Xe)},{default:p(()=>[t(s,{label:"参数名",prop:"paramName",width:"240"},{default:p(({row:e})=>[t(l,{modelValue:e.paramName,"onUpdate:modelValue":a=>e.paramName=a,type:"text",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(s,{label:"参数值",prop:"paramValue"},{default:p(({row:e})=>[t(l,{modelValue:e.paramValue,"onUpdate:modelValue":a=>e.paramValue=a,type:"text",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(s,{label:"操作",align:"right",width:"70"},{default:p(({row:e,index:a})=>[m("span",{class:"bt-link",onClick:l=>d(Ze)(e,a)},"删除",8,Pl)]),_:1})]),_:1},8,["data","row-class-name","onSelectionChange"]),t(o,{type:"primary",size:"small",class:"!mt-[1rem]",onClick:d(Ye)},{default:p(()=>[...a[0]||(a[0]=[m("i",{class:"svgtofont-el-plus text-white font-bold mr-[0.4rem]"},null,-1),g("添加参数 ",-1)])]),_:1},8,["onClick"])])]),_:1})):w("",!0)]),_:1})])}}}),[["__scopeId","data-v-3de9b748"]]);export{Ol as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
