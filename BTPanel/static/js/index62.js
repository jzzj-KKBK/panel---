import{M as e,eO as t,l as a,L as l,K as s,eP as o,aH as n,eQ as r,o as i,eR as d,eS as u,eT as p,u as c,aM as m,a6 as _,eU as v,aj as h,R as b,a7 as f,a8 as g,eV as y,eW as x,eX as w,al as C,e as T}from"./utils-lib.js?v=1756369731";import{u as D,c as k,o as E}from"./useController10.js?v=1756369731";import{_ as R}from"./index103.js?v=1756369731";import{s as P,j as B,r as L,c as j,e as q,aw as O,au as H,B as S,ax as V,q as A,v as I,A as N,y as z,x as M,J as U,bL as J,P as F}from"./base-lib.js?v=1756369731";import{c as K,a as Q,u as W}from"./column.js?v=1756369731";import{_ as X}from"./index145.js?v=1756369731";const $=B("CLB-HTTP-STORE",()=>{const e=L(),t=L([]);return{httpRowData:e,isHttpClbEdit:L(!1),addNodeData:t,HttpNodeList:L([]),nodeClbHttpRefresh:L(!1),domainList:L([])}}),G=()=>P($()),{httpRowData:Y,isHttpClbEdit:Z,addNodeData:ee,nodeClbHttpRefresh:te,domainList:ae}=G(),{testLinkStatus:le}=D(),se=async s=>{if(Y.value=s,Z.value=!!s,!Z.value){const a=e.load("正在获取网站列表，请稍后...");try{const a=await t();a.msg&&!1===a.status&&e.error(a.msg),ae.value=a.data.map(e=>({label:e.site_name,value:e.site_id}))}catch(o){}finally{a.close()}}a({isAsync:!0,title:"".concat(s?"编辑【".concat(s.ps,"】"):"添加HTTP负载均衡"),area:110,btn:"".concat(s?"保存":"确认"),compData:s||{},component:()=>l(()=>import("./index342.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},oe={load_id:"",name:"",site_name:"",http_alg:"round_robin",ps:"",request:"",error:"",qps:"",upstream_time:"",last_request_time:"",nodes:[]},ne=()=>{var e;try{const t=Y.value||{};return{...oe,...t,http_alg:(null==(e=null==t?void 0:t.http_config)?void 0:e.http_alg)||"round_robin",nodes:(null==t?void 0:t.nodes)||[]}}catch(t){return{...oe}}},re=async()=>{const t=await s({loading:"正在获取节点列表，请稍后...",request:o()});t.msg&&!1===t.status&&e.error(t.msg);const n=t.data.data.map(e=>({label:e.remarks,value:e.id,server_ip:e.server_ip,version:e.version,useful_version:e.useful_version}));a({title:"添加节点",area:54,btn:["添加","取消"],compData:{nodes:n},component:()=>l(()=>import("./index343.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},ie=async(t,a)=>{var l;le.value=!0;const{port:s,node_site_id:o,node_site_name:i,...d}=t.value,u=a.some(e=>e.label===i);try{const a=/^(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}$/;if(!t.value.node_id)return e.error("请选择负载均衡节点");if(!n(i)&&!a.test(i))return void e.error("请输入正确的节点网站格式");if(!s)return e.error("请输入端口");const l={port:Number(s),...u?{node_site_id:o,node_site_name:i}:{node_site_name:i},...d};await k({mod_name:"node",sub_mod_name:"load",def_name:"check_http_node",ws_callback:"check_http_node",data:{...l}},{loading:!1})}catch(p){}finally{if(!u){if(!t.value.node_id)return le.value=!1;const{data:e}=await r({node_id:t.value.node_id}),o=null==(l=e.data.find(e=>e.site_name==i))?void 0:l.site_id;t.value.node_site_id=o,a.push({label:i,value:o,port:Number(s)})}le.value=!1}},de=async e=>{await i({icon:"warning-filled",title:"删除负载均衡【".concat(e.ps,"】"),content:"即将删除负载均衡，是否继续操作？"}),await s({loading:"正在删除负载均衡，请稍后...",request:d({load_id:e.load_id}),message:!0,success:e=>{te.value=!0}})},ue=e=>{Y.value=e,a({title:"配置高级设置",area:46,btn:!0,compData:e,component:()=>l(()=>import("./index344.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},pe=e=>{ee.value.splice(e,1)},ce=async t=>{try{return(await s({request:u(t),message:!0,loading:"正在设置负载均衡，请稍后...",success:t=>{t.msg&&!1===t.status&&(e.error(t.msg)||e.success("设置成功"))}})).status}catch(a){return!1}finally{te.value=!0}},me=e=>{const t=[],a=/http_(\d{3})/g;let l;for(;null!==(l=a.exec(e));)t.push(l[1]);return t},_e=[{label:"删除",value:"delete",event:async(t,s,o,n)=>{const{label:r,value:i}=n;let d=[],u=[];o.value.forEach(e=>{void 0!==e.hash&&null!==e.hash?u.push(e.hash):void 0!==e.index&&null!==e.index&&d.push(e.index)});await a({title:"批量".concat(r,"负载均衡"),area:46,component:()=>l(()=>import("./index118.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{resultTitle:"批量".concat(r,"负载均衡"),resultData:o.value,resultColumn:[{label:"名称",prop:"ps"},K()],autoTitle:"批量".concat(r,"负载均衡")},showFooter:!0,onConfirm:async()=>{const t=e.load("正在删除，请稍候...");try{await(async()=>{const e=o.value.map(e=>e.load_id);if("delete"===i)return await p({load_ids:JSON.stringify(e)})})(),e.success("删除成功"),te.value=!0}catch(a){e.error("删除失败")}finally{t.close()}}})}}],ve=e=>(t,a)=>{const l=t?e.filter((e=>t=>0===t.label.toLowerCase().indexOf(e.toLowerCase()))(t)):e;a(l)},he={class:"node-clb-http"},be={class:"flex items-center"},fe={class:"flex items-center"},ge=j({__name:"index",setup(t){const{mainHeight:a}=c(),{nodesStatusList:l}=D(),{httpRowData:s,isHttpClbEdit:o,nodeClbHttpRefresh:n}=G(),r=g(_e),{BtOperation:i}=m({options:[{type:"button",label:"添加负载均衡",active:!0,onClick:()=>se()}]}),{BtTable:d,BtPage:u,BtRefresh:p,BtSearch:y,BtColumn:x,BtBatch:w,BtErrorMask:C,refresh:T,config:k,classList:P}=_({request:async t=>{const{p:a,limit:l,search:s}=t,{data:o}=await v({page:a,page_size:l,search:s});return o.msg&&!1===o.status&&e.error(o.msg),{data:o.data,total:h(o.page),other:{}}},columns:[Q({type:"page",key:"load_id"}),{label:"负载均衡名称",prop:"ps"},{label:"网站",prop:"site_name",width:180,isCustom:!0},{label:"节点数量",prop:"nodes",isCustom:!0,render:e=>q(V,{trigger:"hover",title:"节点详细信息",placement:"bottom","popper-class":"node-clb-popover",width:"auto","open-delay":100,"close-delay":0},{default:()=>q(O,{data:e.nodes,style:{width:"auto"},"max-height":"480px"},{default:()=>[q(H,{prop:"node_remarks",label:"节点",width:"120"},null),q(H,{prop:"node_site_name",label:"节点网站",width:"120"},null),q(H,{prop:"port",label:"端口"},null),q(H,{prop:"path",label:"验证路径"},null),q(H,{prop:"node_status",label:"节点状态"},{default:({row:e})=>{const t=l.value.find(t=>t.value===e.node_status);return q("span",null,[(null==t?void 0:t.label)||"/"])}}),q(H,{prop:"weight",label:"权重"},null),q(H,{prop:"max_fail",label:"最大失败次数","min-width":"100"},null),q(H,{prop:"fail_timeout",label:"恢复时间（秒）","min-width":"100"},null),q(H,{prop:"ps",label:"备注"},null)]}),reference:()=>q("div",{style:"color: #999;"},[e.nodes.length,q("span",{class:"ml-4px size-12px bt-ico-ask"},[S("!")])])})},{label:"请求数",prop:"requests",isCustom:!0},{label:"错误数",prop:"errors",isCustom:!0},{label:"并发数",prop:"qps",isCustom:!0},{label:"回源耗时（秒）",prop:"max_upstream_time",isCustom:!0,render:e=>q("div",null,[e.max_upstream_time])},{label:"上次访问",prop:"last_update",isCustom:!0,render:e=>q("div",null,[0===e.last_update?"--":b(e.last_update)])},W([{onClick:E,title:"日志"},{onClick:se,title:"编辑"},{onClick:ue,title:"配置"},{onClick:de,title:"删除"}])],extension:[r,f(n)]});return(e,t)=>{const l=R;return A(),I("div",he,[q(l,null,{"header-left":N(()=>[z("div",be,[q(M(i))])]),"header-right":N(()=>[z("div",fe,[q(M(y),{class:U(["mr-[10px]","!w-[210px]"]),placeholder:"请输入负载名称"}),q(M(p),{class:"mr-[10px]"}),q(M(x))])]),content:N(()=>[q(M(d),{"min-height":M(a)},null,8,["min-height"])]),"footer-left":N(()=>[q(M(w))]),"footer-right":N(()=>[q(M(u))]),_:1})])}}}),ye=B("CLB-TCPUDP-STORE",()=>({tcpudpRowData:L(),isTcpudpClbEdit:L(!1),addTcpudpNodeData:L([]),nodeClbTcpudpRefresh:L(!1)})),xe=()=>P(ye()),{tcpudpRowData:we,isTcpudpClbEdit:Ce,nodeClbTcpudpRefresh:Te}=xe(),{testLinkStatus:De}=D(),ke=e=>{we.value=e,Ce.value=!!e,a({isAsync:!0,title:"".concat(e?"编辑【".concat(e.ps,"】"):"添加TCP/UDP负载均衡"),area:74,btn:"".concat(e?"保存":"确认"),compData:e||{},component:()=>l(()=>import("./index345.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},Ee=()=>{var e,t,a,l,s,o,n,r,i,d,u,p,c,m;try{return{load_id:(null==(e=we.value)?void 0:e.load_id)||0,name:(null==(t=we.value)?void 0:t.name)||"",type:(null==(l=null==(a=we.value)?void 0:a.tcp_config)?void 0:l.type)||"tcp",host:(null==(o=null==(s=we.value)?void 0:s.tcp_config)?void 0:o.host)||"127.0.0.1",port:(null==(r=null==(n=we.value)?void 0:n.tcp_config)?void 0:r.port)||null,proxy_timeout:(null==(d=null==(i=we.value)?void 0:i.tcp_config)?void 0:d.proxy_timeout)||8,proxy_connect_timeout:(null==(p=null==(u=we.value)?void 0:u.tcp_config)?void 0:p.proxy_connect_timeout)||86400,ps:(null==(c=we.value)?void 0:c.ps)||"",nodes:(null==(m=we.value)?void 0:m.nodes)||[]}}catch(_){return{}}},Re=async()=>{const t=await s({loading:"正在获取节点列表，请稍后...",request:o()});t.msg&&!1===t.status&&e.error(t.msg);const n=t.data.data.map(e=>({label:e.remarks,value:e.id,server_ip:e.server_ip,version:e.version,useful_version:e.useful_version}));a({title:"添加节点",area:56,btn:!0,compData:{nodes:n},component:()=>l(()=>import("./index346.js?v=1756369731"),__vite__mapDeps([]),import.meta.url)})},Pe=async t=>{try{De.value=!0;const{port:a,...l}=t;if(""==l.node_id)return e.error("请选择负载均衡节点"),!1;const s={type:"tcp",port:Number(a),...l};await k({mod_name:"node",sub_mod_name:"load",def_name:"check_tcp_node",ws_callback:"check_tcp_node",data:{...s}},{loading:!1})}catch(a){}finally{De.value=!1}},Be=async e=>{try{await i({icon:"warning-filled",title:"删除负载均衡【".concat(e.ps,"】"),content:"即将删除负载均衡，是否继续操作？"}),await s({loading:"正在删除负载均衡，请稍后...",request:y({load_id:e.load_id}),message:!0,success:e=>{Te.value=!0}})}catch(t){}},Le=[{label:"删除",value:"delete",event:async(t,s,o,n)=>{const{label:r,value:i}=n;let d=[],u=[];o.value.forEach(e=>{void 0!==e.hash&&null!==e.hash?u.push(e.hash):void 0!==e.index&&null!==e.index&&d.push(e.index)});await a({title:"批量".concat(r,"负载均衡"),area:46,component:()=>l(()=>import("./index118.js?v=1756369731"),__vite__mapDeps([]),import.meta.url),compData:{resultTitle:"批量".concat(r,"负载均衡"),resultData:o.value,resultColumn:[{label:"名称",prop:"ps"},K()],autoTitle:"批量".concat(r,"负载均衡")},showFooter:!0,onConfirm:async()=>{const t=e.load("正在删除，请稍候...");try{await(async()=>{if("delete"===i)return await x({load_ids:JSON.stringify(o.value.map(e=>e.load_id))})})(),e.success("删除成功"),Te.value=!0}catch(a){e.error("删除失败")}finally{t.close()}}})}}],je={class:"node-clb-tcpudp"},qe={class:"flex items-center"},Oe={class:"flex items-center"},He=j({__name:"index",setup(t){const{mainHeight:a}=c(),{nodeClbTcpudpRefresh:l}=xe(),s=[{content:"添加负载均衡",dropdownClass:"bg-white",splitButton:!0,active:!0,event:()=>ke()}],o=g(Le),{BtTable:n,BtPage:r,BtRefresh:i,BtColumn:d,BtBatch:u,BtSearch:p,BtErrorMask:m,classList:v,config:y}=_({request:async t=>{const{p:a,limit:l,search:s}=t,{data:o}=await w({page:a,page_size:l,search:s});return o.msg&&!1===o.status&&e.error(o.msg),{data:o.data,total:h(o.page),other:{}}},columns:[Q({type:"page",key:"load_id"}),{label:"负载均衡名称",prop:"ps"},{label:"监听地址",prop:"host",isCustom:!0,render:e=>q("span",null,[e.tcp_config.host,S(":"),e.tcp_config.port])},{label:"节点数量",prop:"nodes",isCustom:!0,render:e=>q(V,{trigger:"hover",title:"节点详细信息",placement:"bottom","popper-class":"node-clb-popover",width:"auto","open-delay":100,"close-delay":0},{default:()=>q(O,{data:null==e?void 0:e.nodes,"max-height":"480px"},{default:()=>[q(H,{prop:"host",label:"节点IP",width:"110"},null),q(H,{prop:"requests",label:"请求数"},null),q(H,{prop:"errors",label:"错误数"},null),q(H,{prop:"qps",label:"并发数"},null),q(H,{prop:"max_upstream_time",label:"回源耗时（秒）",width:"120"},null),q(H,{prop:"ps",label:"备注",width:"120"},null),q(H,{prop:"last_update",label:"上次访问",width:"150"},{default:()=>{var t;return[0===(null==(t=null==e?void 0:e.nodes)?void 0:t.last_update)?"--":b(null==e?void 0:e.nodes.last_update)]}})]}),reference:()=>q("div",{style:"color: #999;"},[e.nodes.length,q("span",{class:"ml-4px size-12px bt-ico-ask"},[S("!")])])})},{label:"请求数",prop:"requests",isCustom:!0},{label:"错误数",prop:"errors",isCustom:!0},{label:"并发数",prop:"qps",isCustom:!0},{label:"回源耗时（秒）",prop:"max_upstream_time",isCustom:!0,render:e=>q("span",null,[e.max_upstream_time])},{label:"上次访问",prop:"last_update",isCustom:!0,render:e=>q("div",null,[0===e.last_update?"--":b(e.last_update)])},W([{onClick:E,title:"日志"},{onClick:ke,title:"编辑"},{onClick:Be,title:"删除"}])],extension:[o,f(l)]});return(e,t)=>{const l=X,o=R;return A(),I("div",je,[q(o,null,{"header-left":N(()=>[z("div",qe,[q(l,{options:s})])]),"header-right":N(()=>[z("div",Oe,[q(M(p),{class:U(["mr-[10px]","!w-[210px]"]),placeholder:"请输入负载名称"}),q(M(i),{class:"mr-[10px]"}),q(M(d))])]),content:N(()=>[q(M(n),{"min-height":M(a)},null,8,["min-height"])]),"footer-left":N(()=>[q(M(u))]),"footer-right":N(()=>[q(M(r))]),_:1})])}}}),Se={class:"node-clb module-ui"},Ve=T(j({__name:"index",setup(e){const{activeTabs:t}=D(),a=L([{label:"HTTP",name:"http",render:()=>q(ge,null,null)},{label:"TCP/UDP",name:"tcpudp",lazy:!0,render:()=>q(He,null,null)}]);return J(()=>{}),(e,l)=>{const s=C;return A(),I("div",Se,[q(s,{type:"card",modelValue:M(t),"onUpdate:modelValue":l[0]||(l[0]=e=>F(t)?t.value=e:null),options:M(a)},null,8,["modelValue","options"])])}}}),[["__scopeId","data-v-27315d6c"]]),Ae=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));export{ce as H,re as a,xe as b,ve as c,Ee as d,me as e,Re as f,Pe as g,ne as h,Ae as i,pe as r,ie as t,G as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
