import{_ as e}from"./index103.js?v=1756369731";import{o as a,b as l,a_ as t,N as n,ab as o,J as s,j as d,j2 as r,e as c}from"./utils-lib.js?v=1756369731";import{c as i,r as m,k as u,p,G as _,q as w,v,e as y,A as f,x as k,B as h,M as b,y as x,C as A,H as C,z as D,F as V,a_ as g,D as I,aW as R,au as M,aj as j,aw as U,ai as X}from"./base-lib.js?v=1756369731";import{_ as T}from"./index104.js?v=1756369731";import{_ as N}from"./index123.js?v=1756369731";import{u as W,B as z}from"./column.js?v=1756369731";import{S as E}from"./ssl.js?v=1756369731";import{g as $}from"./useStore10.js?v=1756369731";import"./__commonjsHelpers__.js?v=1756369731";const q={class:"px-1.6rem py-1rem"},F={key:0,class:"p-1rem"},L={class:"w-full hint-table"},O={key:1,class:"pl-[.8rem] text-[#777] leading-[2.4rem]"},S={class:"w-full hint-table"},B={key:1},H={key:1},P={key:1},G={key:1},J={key:0,class:"flex"},K=["onClick"],Q=["onClick"],Y=c(i({__name:"index",props:{compData:{type:Object,default:()=>{}}},setup(c){const i=l(),{refs:{isRefreshDomainList:Y}}=$(),Z=c,ee=m(!0),ae=m(!1),le=m(!1),te=m([]),ne=m([]),oe=m("name"),se=[{title:"A",key:"A"},{title:"TXT",key:"TXT"},{title:"CNAME",key:"CNAME"},{title:"MX",key:"MX"},{title:"CAA",key:"CAA"},{title:"AAAA",key:"AAAA"}],de=u({dns_id:"",domain_name:"",record_type:"A",fun_name:"get_dns_record",search:"",p:1,limit:10,total:0}),re=u({dns_id:"",domain_name:"",record_type:"",fun_name:"delete_dns_record",RecordId:""}),ce=u({dns_id:"",domain_name:"",fun_name:"set_dns_record_status",status:1,RecordId:""}),ie=m(!1),me=m([]);W([{onClick:e=>{fe(e)},title:"删除"}]);const ue=e=>{const a=Math.floor(e/3600),l=Math.floor(e%3600/60),t=e%60;return"".concat(a>0?a+"小时":"").concat(l>0?l+"分钟":"").concat(t>0?t+"秒":"")},pe=async()=>{if(ae.value)return i.error("请先保存当前修改的数据，再进行其他操作！");ie.value=!0;const{data:e}=await E(de),a=t(e);if(a("list")){const{list:a}=e;n(a)&&(me.value=a,te.value=o(a)),ee.value=!n(a)}if(a("info")){const{record_total:a}=e.info;de.total=a}ie.value=!1},_e=e=>{oe.value=e,me.value=o(me.value)},we=(e,a)=>{var l,t;let n=o(te.value);const s=null==(t=null==(l=null==n?void 0:n.find(e=>e.RecordId===me.value[0].RecordId))?void 0:l[a])?void 0:t.split(".");me.value[0][a]="2"==e?s?s[0]:"abc":e},ve=(e,a)=>{ae.value=!1,le.value=!1,oe.value="name",ne.value=[],me.value=o(te.value)},ye=()=>ee.value?i.error("此域名配置的dns账号不正确"):ae.value?i.error("请先保存当前修改的数据，再进行其他操作！"):(ae.value=!0,le.value=!0,ne.value=[0],void me.value.unshift({RecordId:0,name:"",type:"A",line:"default",value:"",ttl:600,status:"启用",remark:"",mx:0})),fe=async e=>{if(ae.value)return i.error("请先保存当前修改的数据，再进行其他操作！");re.record_type=e.type,re.domain_name=e.name,re.RecordId=e.RecordId,await a({title:"删除【".concat(e.name,"】"),content:"删除该子域名，是否继续操作？",icon:"warning"});try{const e=i.load("正在删除子域名，请稍候..."),a=await E(re);e&&e.close(),i.request(a),a.status&&(await pe(),Y.value=!0)}catch(l){}};return p(()=>{var e;(null==(e=Z.compData.row)?void 0:e.dns_id)&&(de.dns_id=Z.compData.row.dns_id,de.domain_name=Z.compData.row.domain,re.dns_id=Z.compData.row.dns_id,ce.dns_id=Z.compData.row.dns_id,pe())}),(a,l)=>{const t=I,n=R,o=s,m=N,u=M,p=d,W=X,$=j,te=T,re=U,ke=r,he=e,be=_("bt-loading");return w(),v("div",q,[y(he,null,{"header-left":f(()=>[y(t,{type:"primary",onClick:ye,disabled:k(ee)},{default:f(()=>[...l[16]||(l[16]=[h("添加",-1)])]),_:1},8,["disabled"]),"WestDns"===c.compData.row.dns.dns_name?(w(),b(n,{key:0,type:"warning",class:"h-[100%] !ml-[1rem]",closable:!1,"show-icon":""},{title:f(()=>[...l[17]||(l[17]=[x("span",{class:"text-[1.3rem]"},[x("span",null," 提示：WestDns 西部数码不支持修改解析记录的主机记录和记录类型")],-1)])]),_:1})):A("",!0)]),"header-right":f(()=>[y(o,{modelValue:k(de).search,"onUpdate:modelValue":l[0]||(l[0]=e=>k(de).search=e),placeholder:"请输入主机记录",onSearch:pe,class:"!mr-[.8rem] !w-[23rem]"},null,8,["modelValue"]),y(m,{onRefresh:pe,class:"!mr-[.8rem]"})]),content:f(()=>[C((w(),b(re,{class:"w-full sub-domain-table",data:k(me),"row-key":"RecordId","expand-row-keys":k(ne),"max-height":550},{empty:f(()=>[h(D(k(ee)?"此域名配置的dns账号不正确":"列表为空"),1)]),default:f(()=>[y(u,{type:"expand",width:"1","min-width":"1"},{default:f(()=>[k(ae)?(w(),v("div",F,["name"===k(oe)?(w(),v(V,{key:0},[l[23]||(l[23]=x("div",{class:"text-[#777] pl-[.8rem]"},[h("要解析www.bt.cn，请填写www。主机记录就是域名前缀，"),x("span",{class:"text-orange font-bold"},"点击下列选项可自行填充"),h("：")],-1)),x("table",L,[x("tbody",null,[x("tr",{onClick:l[1]||(l[1]=e=>we("www","name"))},[...l[18]||(l[18]=[x("th",null,"www",-1),x("td",{class:"text-[#777]"},"解析后的域名为www.bt.cn",-1)])]),x("tr",{onClick:l[2]||(l[2]=e=>we("@","name"))},[...l[19]||(l[19]=[x("th",null,"@",-1),x("td",{class:"text-[#777]"},"直接解析主域名bt.cn",-1)])]),x("tr",{onClick:l[3]||(l[3]=e=>we("*","name"))},[...l[20]||(l[20]=[x("th",null,"*",-1),x("td",{class:"text-[#777]"},"泛解析，匹配其他所有域名*.bt.cn",-1)])]),x("tr",{onClick:l[4]||(l[4]=e=>we("mail","name"))},[...l[21]||(l[21]=[x("th",null,"mail",-1),x("td",{class:"text-[#777]"},"将域名解析为mail.bt.cn，通常用于解析邮箱服务器",-1)])]),x("tr",{onClick:l[5]||(l[5]=e=>we("2","name"))},[...l[22]||(l[22]=[x("th",null,"二级域名",-1),x("td",{class:"text-[#777]"},"如：abc.bt.cn，填写abc",-1)])])])])],64)):(w(),v("div",O,[l[30]||(l[30]=x("div",null,"将域名指向云服务器，请选择「A」",-1)),l[31]||(l[31]=x("div",null,"将域名指向另一个域名，请选择「CNAME」",-1)),l[32]||(l[32]=x("div",null,"建立邮箱请选择「MX」，根据邮箱服务商提供的MX记录",-1)),x("table",S,[x("tbody",null,[x("tr",{onClick:l[6]||(l[6]=e=>we("A","type"))},[...l[24]||(l[24]=[x("th",null,"A",-1),x("td",{class:"text-[#777]"},"将域名指向IPv4地址",-1)])]),x("tr",{onClick:l[7]||(l[7]=e=>we("CNAME","type"))},[...l[25]||(l[25]=[x("th",null,"CNAME",-1),x("td",{class:"text-[#777]"},"将域名指向另外一个域名",-1)])]),x("tr",{onClick:l[8]||(l[8]=e=>we("MX","type"))},[...l[26]||(l[26]=[x("th",null,"MX",-1),x("td",{class:"text-[#777]"},"如果需要设置邮箱，让邮箱能收到邮件，就需要添加MX记录。",-1)])]),x("tr",{onClick:l[9]||(l[9]=e=>we("TXT","type"))},[...l[27]||(l[27]=[x("th",null,"TXT",-1),x("td",{class:"text-[#777]"},"设置文本记录",-1)])]),x("tr",{onClick:l[10]||(l[10]=e=>we("CAA","type"))},[...l[28]||(l[28]=[x("th",null,"CAA",-1),x("td",{class:"text-[#777]"},"CA证书颁发机构授权校验",-1)])]),x("tr",{onClick:l[11]||(l[11]=e=>we("AAAA","type"))},[...l[29]||(l[29]=[x("th",null,"AAAA",-1),x("td",{class:"text-[#777]"},"用来指定主机名（或域名）对应的IPv6地址（例如：ff06:0:0:0:0:0:0:c3）记录。",-1)])])])])]))])):A("",!0)]),_:1}),y(u,{label:"主机记录",prop:"name"},{default:f(({row:e,$index:a})=>[k(ae)&&0==a?(w(),b(p,{key:0,class:"record-name-input",disabled:"WestDns"===c.compData.row.dns.dns_name&&!k(le),modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,type:"text",size:"small",placeholder:"根据下方提示填写",title:"".concat(e.name,".").concat(Z.compData.row.domain),onFocus:l[12]||(l[12]=e=>_e("name"))},{append:f(()=>[h(D(".".concat(c.compData.row.domain)),1)]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","title"])):(w(),v("span",B,D(e.name),1))]),_:1}),y(u,{label:"记录类型",prop:"type",width:"100"},{default:f(({row:e,$index:a})=>[k(ae)&&0==a?(w(),b($,{key:0,onFocus:l[13]||(l[13]=e=>_e("type")),size:"small",disabled:"WestDns"===c.compData.row.dns.dns_name&&!k(le),modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,class:"!w-[8rem]",placeholder:"请选择",onChange:a=>((e,a)=>{a.type=e})(a,e)},{default:f(()=>[(w(),v(V,null,g(se,e=>y(W,{key:e.key,label:e.title,value:e.key},null,8,["label","value"])),64))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","onChange"])):(w(),v("span",H,D(e.type),1))]),_:1}),y(u,{label:"解析请求来源",prop:"line",width:"100"},{default:f(({row:e})=>[x("span",null,D(e.line),1)]),_:1}),y(u,{label:"记录值",prop:"value"},{default:f(({row:e,$index:a})=>[k(ae)&&0==a?(w(),b(p,{key:0,modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,type:"text",placeholder:"必填",size:"small"},null,8,["modelValue","onUpdate:modelValue"])):(w(),v("span",P,D(e.value),1))]),_:1}),y(u,{label:"TTL",prop:"ttl",width:"100"},{default:f(({row:e})=>[x("span",null,D(ue(e.ttl)),1)]),_:1}),y(u,{label:"状态",prop:"status",width:"80"},{default:f(({row:e})=>[y(k(z),{data:["暂停","启用"],modelValue:"启用"===e.status,onClick:a=>(async e=>{let a;try{ce.RecordId=e.RecordId,ce.status="启用"===e.status?1:0,ce.domain_name=e.name.indexOf(Z.compData.row.domain)>-1?e.name:"".concat(e.name,".").concat(Z.compData.row.domain),a=i.load("正在修改状态，请稍候...");const l=await E(ce);i.request(l),l.status&&(ve(),await pe())}catch(l){}finally{a&&a.close()}})(e)},null,8,["modelValue","onClick"])]),_:1}),y(u,{label:"备注",prop:"remark",width:"120"},{default:f(({row:e,$index:a})=>[k(ae)&&0==a?(w(),b(p,{key:0,disabled:"WestDns"===c.compData.row.dns.dns_name,modelValue:e.remark,"onUpdate:modelValue":a=>e.remark=a,type:"text",size:"small",placeholder:"请输入备注"},null,8,["disabled","modelValue","onUpdate:modelValue"])):(w(),v("span",G,D(e.remark),1))]),_:1}),y(u,{label:"操作",width:"140",align:"right"},{default:f(({row:e,$index:a})=>[k(ae)&&0==a?(w(),v("div",J,[y(t,{type:"primary",onClick:a=>(async e=>{if(!e.name)return void i.error("主机记录不能为空");if(!e.value)return void i.error("记录值不能为空");const a=i.load("正在修改子域名，请稍候...");let l={fun_name:"update_dns_record",dns_id:Z.compData.row.dns_id,domain_name:e.name.indexOf(Z.compData.row.domain)>-1?e.name:"".concat(e.name,".").concat(Z.compData.row.domain),domain_dns_value:e.value,record_type:e.type,RecordId:e.RecordId,mx:e.mx,RecordLine:e.line,remark:e.remark};0===l.RecordId&&(delete l.RecordId,l.fun_name="create_dns_record");try{const e=await E(l);a&&a.close(),i.request(e),e.status&&(ae.value=!1,le.value=!1,oe.value="name",ne.value=[],await pe(),Y.value=!0)}catch(t){}})(e)},{default:f(()=>[...l[33]||(l[33]=[h("保存",-1)])]),_:2},1032,["onClick"]),y(t,{type:"default",onClick:e=>ve()},{default:f(()=>[...l[34]||(l[34]=[h("取消",-1)])]),_:2},1032,["onClick"])])):(w(),v(V,{key:1},[x("span",{class:"bt-link cursor-pointer",onClick:l=>((e,a)=>{if(ae.value)return i.error("请先保存当前修改的数据，再进行其他操作！");if(ae.value=!0,ne.value=[e.RecordId],0!==a){let l=e.name.replace(".".concat(Z.compData.row.domain),"");const t=me.value[0];e.name.replace(".".concat(Z.compData.row.domain),"")===e.name&&(l="@"),me.value[0]={...e,name:l},me.value[a]=t}else me.value[0]={...e,name:e.name.replace(".".concat(Z.compData.row.domain),"")}})(e,a)},"修改",8,K),y(te),x("span",{class:"bt-link cursor-pointer",onClick:a=>fe(e)},"删除",8,Q)],64))]),_:1})]),_:1},8,["data","expand-row-keys"])),[[be,k(ie)],[be,"正在加载子域名列表，请稍后...","title"]])]),"footer-right":f(()=>[y(ke,{page:k(de).p,"onUpdate:page":l[14]||(l[14]=e=>k(de).p=e),row:k(de).limit,"onUpdate:row":l[15]||(l[15]=e=>k(de).limit=e),total:k(de).total,onChange:pe},null,8,["page","row","total"])]),_:1})])}}}),[["__scopeId","data-v-9cdfe372"]]);export{Y as default};
